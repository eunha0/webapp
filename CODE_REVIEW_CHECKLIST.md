# 코드 리뷰 체크리스트

**프로젝트**: AI 논술 평가 시스템  
**목적**: 코드 품질 개선 및 기술 부채 감소  
**최종 업데이트**: 2024-12-15

---

## 📋 사용 방법

이 체크리스트는 다음과 같은 경우에 사용합니다:
1. **PR(Pull Request) 리뷰 시**: 새로운 코드 변경 검토
2. **정기 코드 감사**: 월간/분기별 코드 품질 점검
3. **리팩토링 전**: 개선 대상 식별
4. **온보딩**: 신규 개발자 코드 베이스 이해

각 항목에 ✅ 체크하며 검토하고, 문제가 발견되면 📝 메모를 남깁니다.

---

## 🏗️ 아키텍처 및 구조

### 파일 조직
- [ ] 각 파일이 단일 책임 원칙(SRP)을 따르는가?
- [ ] 파일 크기가 적절한가? (500줄 이하 권장)
- [ ] 파일명이 내용을 명확히 설명하는가?
- [ ] 비슷한 기능이 같은 디렉토리에 그룹화되어 있는가?

**📝 메모**:
- **index.tsx**: 10,870줄 → 분리 필요 (최우선)
- 라우트 핸들러를 `routes/` 디렉토리로 이동 권장

### 모듈 의존성
- [ ] 순환 의존성이 없는가?
- [ ] 의존성 방향이 명확한가? (상위 → 하위)
- [ ] 불필요한 의존성이 포함되지 않았는가?
- [ ] 외부 라이브러리 버전이 최신인가?

**📝 메모**:
```
# 의존성 체크
npm outdated
npm audit
```

### 레이어 분리
- [ ] 비즈니스 로직과 프레젠테이션 레이어가 분리되어 있는가?
- [ ] 데이터베이스 접근이 서비스 레이어로 추상화되어 있는가?
- [ ] API 라우트가 비즈니스 로직을 직접 포함하지 않는가?
- [ ] 재사용 가능한 유틸리티가 별도로 관리되는가?

**현재 레이어**:
```
✅ 서비스 레이어: upload-service, grading-service, db-service 등
⚠️ 라우트 레이어: index.tsx에 집중 → 분리 필요
✅ 데이터 접근: db-service.ts로 추상화됨
```

---

## 💻 코드 품질

### 가독성
- [ ] 변수명이 의도를 명확히 표현하는가?
- [ ] 함수명이 동사로 시작하고 행위를 설명하는가?
- [ ] 매직 넘버가 상수로 정의되어 있는가?
- [ ] 복잡한 로직에 주석이 있는가?

**예시**:
```typescript
// ❌ 나쁜 예
const x = 10485760;
function f(a, b) { return a + b; }

// ✅ 좋은 예  
const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
function calculateTotal(price, quantity) { return price * quantity; }
```

### 함수 크기
- [ ] 각 함수가 하나의 작업만 수행하는가?
- [ ] 함수 크기가 100줄 이하인가?
- [ ] 함수 매개변수가 5개 이하인가?
- [ ] 중첩 깊이가 3단계 이하인가?

**📝 메모**:
- `index.tsx` 내 일부 함수가 너무 길 수 있음 → 확인 필요

### 중복 코드
- [ ] DRY 원칙을 따르는가?
- [ ] 유사한 패턴이 함수로 추상화되어 있는가?
- [ ] Copy-paste 코드가 없는가?
- [ ] jscpd 분석 결과가 5% 이하인가?

**현재 상태**: ✅ 4.43% (양호)

**발견된 중복**:
- `upload-service.ts`: Google Vision API 호출 패턴 (3곳)
  - **해결책**: `callVisionAPI()` 공통 함수 생성

---

## 🔒 타입 안전성 (TypeScript)

### 타입 정의
- [ ] `any` 타입 사용을 최소화했는가?
- [ ] 함수 시그니처에 타입이 명시되어 있는가?
- [ ] 인터페이스/타입이 재사용되고 있는가?
- [ ] `unknown` 대신 `any`를 사용하지 않았는가?

**체크 명령어**:
```bash
# any 사용 횟수 확인
grep -r ": any" src/ | wc -l
grep -r "as any" src/ | wc -l
```

### 타입 체크
- [ ] `strict` 모드가 활성화되어 있는가?
- [ ] null/undefined 체크가 적절한가?
- [ ] 타입 가드를 사용하는가?
- [ ] 빌드 시 타입 에러가 없는가?

**📝 메모**:
```typescript
// tsconfig.json 확인
{
  "strict": true,
  "noImplicitAny": true,
  "strictNullChecks": true
}
```

---

## 🐛 에러 처리

### 에러 핸들링
- [ ] 모든 비동기 함수에 try-catch가 있는가?
- [ ] 에러 메시지가 사용자 친화적인가?
- [ ] 에러가 적절히 로깅되는가?
- [ ] 에러 타입별로 다르게 처리되는가?

**패턴**:
```typescript
try {
  const result = await riskyOperation();
  return c.json({ success: true, data: result });
} catch (error) {
  console.error('Operation failed:', error);
  return c.json({ 
    error: 'User-friendly message',
    details: process.env.NODE_ENV === 'development' ? String(error) : undefined
  }, 500);
}
```

### 입력 검증
- [ ] 사용자 입력이 검증되는가?
- [ ] 파일 업로드 시 타입/크기 체크가 있는가?
- [ ] SQL 인젝션 방지를 위한 prepared statement를 사용하는가?
- [ ] XSS 방지 처리가 되어 있는가?

**현재 구현**: ✅ validateFile() 함수 사용

---

## ⚡ 성능

### 최적화
- [ ] 불필요한 재계산이 없는가?
- [ ] 데이터베이스 쿼리가 최적화되어 있는가?
- [ ] N+1 쿼리 문제가 없는가?
- [ ] 대용량 파일 처리 시 스트리밍을 사용하는가?

### 메모리 관리
- [ ] 메모리 누수 위험이 없는가?
- [ ] 큰 배열/객체가 적절히 해제되는가?
- [ ] 파일 핸들이 제대로 닫히는가?
- [ ] 불필요한 전역 변수가 없는가?

---

## 🧪 테스트 가능성

### 단위 테스트
- [ ] 함수가 순수 함수로 작성되었는가?
- [ ] 외부 의존성이 주입 가능한가?
- [ ] Mock/Stub이 가능한 구조인가?
- [ ] 테스트 커버리지가 충분한가? (70% 이상)

**현재 상태**: ⚠️ 테스트 코드 없음

**추가 권장**:
```bash
npm install -D vitest @vitest/ui
```

### 통합 테스트
- [ ] API 엔드포인트 테스트가 있는가?
- [ ] 주요 시나리오가 테스트되는가?
- [ ] 에러 케이스가 테스트되는가?

---

## 🔐 보안

### 인증/권한
- [ ] 모든 보호된 엔드포인트에 인증이 적용되는가?
- [ ] 세션 관리가 안전한가?
- [ ] CSRF 보호가 구현되어 있는가?
- [ ] 비밀번호가 해싱되어 저장되는가?

**현재 구현**: ✅ 세션 기반 인증

### 데이터 보호
- [ ] 민감한 정보가 로그에 출력되지 않는가?
- [ ] API 키가 환경변수로 관리되는가?
- [ ] SQL 인젝션 방지가 되어 있는가?
- [ ] 파일 업로드 시 악성 파일 체크가 있는가?

**환경변수 체크**:
```bash
# .env 파일이 .gitignore에 포함되어 있는지 확인
grep "\.env" .gitignore
```

---

## 📚 문서화

### 코드 주석
- [ ] 복잡한 알고리즘에 설명이 있는가?
- [ ] 왜(Why)를 설명하는 주석이 있는가? (무엇What은 코드로)
- [ ] TODO/FIXME가 이슈 트래커와 연결되어 있는가?
- [ ] 주석이 최신 상태인가?

### API 문서
- [ ] 각 엔드포인트의 설명이 있는가?
- [ ] 요청/응답 형식이 문서화되어 있는가?
- [ ] 에러 코드가 설명되어 있는가?
- [ ] 예제 코드가 제공되는가?

**권장**: OpenAPI/Swagger 문서 추가

### README
- [ ] 프로젝트 설명이 명확한가?
- [ ] 설치 및 실행 방법이 설명되어 있는가?
- [ ] 환경변수 설정 가이드가 있는가?
- [ ] 기여 가이드라인이 있는가?

**현재**: ✅ README.md 존재

---

## 🚀 배포 준비도

### 환경 설정
- [ ] 개발/스테이징/프로덕션 환경이 분리되어 있는가?
- [ ] 환경별 설정이 외부화되어 있는가?
- [ ] 비밀 정보가 안전하게 관리되는가?

### 모니터링
- [ ] 로깅이 적절히 구현되어 있는가?
- [ ] 에러 추적 시스템이 있는가? (Sentry 등)
- [ ] 성능 모니터링이 있는가?
- [ ] 헬스 체크 엔드포인트가 있는가?

**추가 권장**:
```typescript
// Health check endpoint
app.get('/health', (c) => {
  return c.json({
    status: 'ok',
    timestamp: new Date().toISOString(),
    version: process.env.APP_VERSION
  });
});
```

---

## 📊 메트릭 및 측정

### 코드 메트릭
- [ ] 파일당 평균 줄 수: < 300줄
- [ ] 함수당 평균 줄 수: < 50줄
- [ ] 중복 코드 비율: < 5%
- [ ] 순환 복잡도: < 15

**현재 메트릭**:
- 파일당 평균: ~240줄 (index.tsx 제외 시)
- 중복 코드: 4.43% ✅
- 가장 큰 파일: 10,870줄 ⚠️

### 테스트 메트릭
- [ ] 라인 커버리지: > 70%
- [ ] 브랜치 커버리지: > 60%
- [ ] 함수 커버리지: > 80%

**현재**: 테스트 없음 → 추가 필요

---

## ✅ 체크리스트 완료 기준

### 파일별 리뷰
각 파일마다 다음을 확인:
- [ ] 코드 스타일이 일관적인가?
- [ ] 불필요한 코드가 없는가?
- [ ] 최신 모범 사례를 따르는가?

### 전체 프로젝트 리뷰
- [ ] 아키텍처가 명확한가?
- [ ] 확장 가능한 구조인가?
- [ ] 유지보수가 쉬운가?
- [ ] 새로운 개발자가 이해하기 쉬운가?

---

## 🎯 우선순위별 개선 항목

### P0 (즉시)
1. [ ] index.tsx 파일 분리
2. [ ] 중복 API 호출 코드 제거
3. [ ] ESLint 설정 및 실행

### P1 (단기)
1. [ ] 단위 테스트 추가
2. [ ] 에러 처리 통일
3. [ ] API 문서화

### P2 (중기)
1. [ ] 성능 최적화
2. [ ] 코드 커버리지 70% 달성
3. [ ] CI/CD 파이프라인 구축

### P3 (장기)
1. [ ] 아키텍처 문서 작성
2. [ ] 마이크로서비스 고려
3. [ ] 모니터링 대시보드

---

## 📝 리뷰 노트

**리뷰어**: _______________  
**날짜**: _______________  
**파일/PR**: _______________

### 발견된 이슈
1. 
2. 
3. 

### 긍정적인 부분
1. 
2. 
3. 

### 개선 제안
1. 
2. 
3. 

### 다음 단계
- [ ] 
- [ ] 
- [ ] 

---

**참고 자료**:
- [Clean Code by Robert C. Martin](https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882)
- [TypeScript Best Practices](https://www.typescriptlang.org/docs/handbook/declaration-files/do-s-and-don-ts.html)
- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)
