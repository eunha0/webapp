[{"filePath":"/home/user/webapp-ai/src/db-service.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token {","line":2,"column":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Database service for essay grading system\nimport type { \n  Bindings, \n  GradingRequest, \n  GradingResult, \n  GradingSession,\n  Essay,\n  StoredGradingResult,\n  RubricCriterion\n} from './types';\n\n/**\n * Creates a new grading session with rubric criteria\n */\nexport async function createGradingSession(\n  db: D1Database,\n  request: GradingRequest\n): Promise<number> {\n  // Insert grading session\n  const sessionResult = await db\n    .prepare(\n      'INSERT INTO grading_sessions (assignment_prompt, grade_level) VALUES (?, ?)'\n    )\n    .bind(request.assignment_prompt, request.grade_level)\n    .run();\n\n  const sessionId = sessionResult.meta.last_row_id as number;\n\n  // Insert rubric criteria\n  for (const criterion of request.rubric_criteria) {\n    await db\n      .prepare(\n        'INSERT INTO rubric_criteria (session_id, criterion_name, criterion_description, criterion_order) VALUES (?, ?, ?, ?)'\n      )\n      .bind(\n        sessionId,\n        criterion.criterion_name,\n        criterion.criterion_description,\n        criterion.criterion_order\n      )\n      .run();\n  }\n\n  return sessionId;\n}\n\n/**\n * Creates a new essay submission\n */\nexport async function createEssay(\n  db: D1Database,\n  sessionId: number,\n  essayText: string\n): Promise<number> {\n  const result = await db\n    .prepare('INSERT INTO essays (session_id, essay_text) VALUES (?, ?)')\n    .bind(sessionId, essayText)\n    .run();\n\n  return result.meta.last_row_id as number;\n}\n\n/**\n * Stores grading results for an essay\n */\nexport async function storeGradingResult(\n  db: D1Database,\n  essayId: number,\n  sessionId: number,\n  result: GradingResult\n): Promise<number> {\n  // Insert grading result\n  const resultInsert = await db\n    .prepare(\n      `INSERT INTO grading_results \n       (essay_id, total_score, summary_evaluation, overall_comment, revision_suggestions, next_steps_advice) \n       VALUES (?, ?, ?, ?, ?, ?)`\n    )\n    .bind(\n      essayId,\n      result.total_score,\n      result.summary_evaluation,\n      result.overall_comment,\n      result.revision_suggestions,\n      result.next_steps_advice\n    )\n    .run();\n\n  const resultId = resultInsert.meta.last_row_id as number;\n\n  // Get criterion IDs\n  const criteria = await db\n    .prepare('SELECT id, criterion_name FROM rubric_criteria WHERE session_id = ? ORDER BY criterion_order')\n    .bind(sessionId)\n    .all();\n\n  // Insert criterion scores\n  for (const criterionScore of result.criterion_scores) {\n    const criterion = criteria.results.find(\n      (c: any) => c.criterion_name === criterionScore.criterion_name\n    ) as any;\n\n    if (criterion) {\n      await db\n        .prepare(\n          `INSERT INTO criterion_scores \n           (result_id, criterion_id, score, strengths, areas_for_improvement) \n           VALUES (?, ?, ?, ?, ?)`\n        )\n        .bind(\n          resultId,\n          criterion.id,\n          criterionScore.score,\n          criterionScore.strengths,\n          criterionScore.areas_for_improvement\n        )\n        .run();\n    }\n  }\n\n  return resultId;\n}\n\n/**\n * Retrieves a complete grading result by essay ID\n */\nexport async function getGradingResult(\n  db: D1Database,\n  essayId: number\n): Promise<StoredGradingResult | null> {\n  // Get grading result\n  const result = await db\n    .prepare(\n      `SELECT * FROM grading_results WHERE essay_id = ?`\n    )\n    .bind(essayId)\n    .first();\n\n  if (!result) {\n    return null;\n  }\n\n  // Get essay to find session_id\n  const essay = await db\n    .prepare('SELECT session_id FROM essays WHERE id = ?')\n    .bind(essayId)\n    .first();\n\n  if (!essay) {\n    return null;\n  }\n\n  // Get criterion scores with criterion names and max scores\n  const scores = await db\n    .prepare(\n      `SELECT \n        cs.score,\n        cs.strengths,\n        cs.areas_for_improvement,\n        rc.criterion_name,\n        rc.max_score\n       FROM criterion_scores cs\n       JOIN rubric_criteria rc ON cs.criterion_id = rc.id\n       WHERE cs.result_id = ?\n       ORDER BY rc.criterion_order`\n    )\n    .bind(result.id)\n    .all();\n\n  return {\n    id: result.id as number,\n    essay_id: result.essay_id as number,\n    total_score: result.total_score as number,\n    summary_evaluation: result.summary_evaluation as string,\n    overall_comment: result.overall_comment as string,\n    revision_suggestions: result.revision_suggestions as string,\n    next_steps_advice: result.next_steps_advice as string,\n    graded_at: result.graded_at as string,\n    criterion_scores: scores.results.map((s: any) => ({\n      criterion_name: s.criterion_name,\n      score: s.score,\n      max_score: s.max_score || 4,\n      strengths: s.strengths,\n      areas_for_improvement: s.areas_for_improvement\n    }))\n  };\n}\n\n/**\n * Lists all grading sessions with their essays\n */\nexport async function listGradingSessions(\n  db: D1Database,\n  limit: number = 50\n): Promise<any[]> {\n  const sessions = await db\n    .prepare(\n      `SELECT \n        gs.id,\n        gs.assignment_prompt,\n        gs.grade_level,\n        gs.created_at,\n        COUNT(e.id) as essay_count\n       FROM grading_sessions gs\n       LEFT JOIN essays e ON gs.id = e.session_id\n       GROUP BY gs.id\n       ORDER BY gs.created_at DESC\n       LIMIT ?`\n    )\n    .bind(limit)\n    .all();\n\n  return sessions.results;\n}\n\n/**\n * Gets session details with rubric criteria\n */\nexport async function getSessionDetails(\n  db: D1Database,\n  sessionId: number\n): Promise<any> {\n  const session = await db\n    .prepare('SELECT * FROM grading_sessions WHERE id = ?')\n    .bind(sessionId)\n    .first();\n\n  if (!session) {\n    return null;\n  }\n\n  const criteria = await db\n    .prepare(\n      'SELECT * FROM rubric_criteria WHERE session_id = ? ORDER BY criterion_order'\n    )\n    .bind(sessionId)\n    .all();\n\n  const essays = await db\n    .prepare(\n      `SELECT \n        e.*,\n        gr.total_score,\n        gr.graded_at\n       FROM essays e\n       LEFT JOIN grading_results gr ON e.id = gr.essay_id\n       WHERE e.session_id = ?\n       ORDER BY e.submitted_at DESC`\n    )\n    .bind(sessionId)\n    .all();\n\n  return {\n    ...session,\n    rubric_criteria: criteria.results,\n    essays: essays.results\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/feedback-service.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: The keyword 'interface' is reserved","line":3,"column":1}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Detailed Feedback Generation Service\n\ninterface CriterionFeedback {\n  criterion_name: string\n  score: number\n  positive_feedback: string\n  improvement_areas: string\n  specific_suggestions: string\n}\n\ninterface DetailedFeedbackResult {\n  criterion_feedbacks: CriterionFeedback[]\n  overall_summary: {\n    total_score: number\n    strengths: string\n    weaknesses: string\n    overall_comment: string\n    improvement_priority: string\n  }\n}\n\ninterface FeedbackRequest {\n  essay_text: string\n  grade_level: string\n  rubric_criteria: Array<{\n    criterion_name: string\n    criterion_description: string\n  }>\n  criterion_scores: Array<{\n    criterion_name: string\n    score: number\n    strengths: string\n    areas_for_improvement: string\n  }>\n  feedback_level?: 'detailed' | 'moderate' | 'brief'\n  grading_strictness?: 'lenient' | 'moderate' | 'strict'\n}\n\n/**\n * Generate detailed feedback for each criterion with tone adjusted for grade level\n */\nexport async function generateDetailedFeedback(request: FeedbackRequest): Promise<DetailedFeedbackResult> {\n  const { \n    essay_text, \n    grade_level, \n    rubric_criteria, \n    criterion_scores,\n    feedback_level = 'detailed',\n    grading_strictness = 'moderate'\n  } = request\n  \n  // Determine tone based on grade level\n  const tone = getGradeLevelTone(grade_level)\n  \n  // Generate feedback for each criterion\n  const criterion_feedbacks: CriterionFeedback[] = criterion_scores.map(score => {\n    const criterion = rubric_criteria.find(r => r.criterion_name === score.criterion_name)\n    \n    return {\n      criterion_name: score.criterion_name,\n      score: score.score,\n      positive_feedback: generatePositiveFeedback(score, criterion?.criterion_description || '', tone, feedback_level),\n      improvement_areas: adjustImprovementAreasByLevel(score.areas_for_improvement, feedback_level),\n      specific_suggestions: generateSpecificSuggestions(score, criterion?.criterion_description || '', tone, feedback_level)\n    }\n  })\n  \n  // Calculate total score\n  const total_score = criterion_scores.reduce((sum, s) => sum + s.score, 0)\n  const max_score = criterion_scores.length * 4\n  const percentage = (total_score / max_score) * 100\n  \n  // Generate overall summary\n  const strengths = extractStrengths(criterion_scores)\n  const weaknesses = extractWeaknesses(criterion_scores)\n  const overall_comment = generateOverallComment(percentage, strengths, weaknesses, tone)\n  const improvement_priority = determineImprovementPriority(criterion_scores)\n  \n  return {\n    criterion_feedbacks,\n    overall_summary: {\n      total_score,\n      strengths,\n      weaknesses,\n      overall_comment,\n      improvement_priority\n    }\n  }\n}\n\n/**\n * Determine feedback tone based on grade level\n */\nfunction getGradeLevelTone(grade_level: string): 'elementary' | 'middle' | 'high' {\n  if (grade_level.includes('ì´ˆë“±')) return 'elementary'\n  if (grade_level.includes('ì¤‘í•™')) return 'middle'\n  return 'high'\n}\n\n/**\n * Generate positive feedback based on score\n */\nfunction generatePositiveFeedback(\n  score: { criterion_name: string; score: number; strengths: string },\n  description: string,\n  tone: string,\n  feedbackLevel: string = 'detailed'\n): string {\n  const { criterion_name, score: points, strengths } = score\n  \n  if (points === 4) {\n    return tone === 'elementary' \n      ? `\"${criterion_name}\" ë¶€ë¶„ì´ ì•„ì£¼ í›Œë¥­í•´ìš”! ${strengths} ì •ë§ ì˜í–ˆì–´ìš”!`\n      : tone === 'middle'\n      ? `\"${criterion_name}\" ì˜ì—­ì—ì„œ ìš°ìˆ˜í•œ ìˆ˜ì¤€ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤. ${strengths}`\n      : `\"${criterion_name}\" ì¸¡ë©´ì—ì„œ íƒì›”í•œ ì—­ëŸ‰ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ${strengths} ì´ëŠ” ë§¤ìš° ë†’ì€ ìˆ˜ì¤€ì˜ ì´í•´ë„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.`\n  } else if (points === 3) {\n    return tone === 'elementary'\n      ? `\"${criterion_name}\" ë¶€ë¶„ì´ ì˜ ë˜ì—ˆì–´ìš”. ${strengths} ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•˜ë©´ ë” ì¢‹ì•„ì§ˆ ê±°ì˜ˆìš”!`\n      : tone === 'middle'\n      ? `\"${criterion_name}\" ì˜ì—­ì—ì„œ ì–‘í˜¸í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ${strengths} ì¶”ê°€ì ì¸ ë°œì „ ê°€ëŠ¥ì„±ì´ ë³´ì…ë‹ˆë‹¤.`\n      : `\"${criterion_name}\" ì¸¡ë©´ì—ì„œ ì¤€ìˆ˜í•œ ì—­ëŸ‰ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ${strengths} í•œ ë‹¨ê³„ ë” ë°œì „ì‹œí‚¬ ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.`\n  } else if (points === 2) {\n    return tone === 'elementary'\n      ? `\"${criterion_name}\" ë¶€ë¶„ì€ ê¸°ë³¸ì€ ì˜ ì´í•´í–ˆì–´ìš”. ${strengths} ì¡°ê¸ˆ ë” ë…¸ë ¥ì´ í•„ìš”í•´ìš”.`\n      : tone === 'middle'\n      ? `\"${criterion_name}\" ì˜ì—­ì—ì„œ ê¸°ì´ˆì ì¸ ì´í•´ë¥¼ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤. ${strengths} ê·¸ëŸ¬ë‚˜ ë” ë°œì „ì‹œì¼œì•¼ í•  ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.`\n      : `\"${criterion_name}\" ì¸¡ë©´ì—ì„œ ê¸°ë³¸ì ì¸ ì—­ëŸ‰ì€ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤. ${strengths} í•˜ì§€ë§Œ ë³´ì™„ì´ í•„ìš”í•œ ì˜ì—­ì´ ìˆìŠµë‹ˆë‹¤.`\n  } else {\n    return tone === 'elementary'\n      ? `\"${criterion_name}\" ë¶€ë¶„ì„ ì¢€ ë” ì—°ìŠµí•´ì•¼ í•´ìš”. ì„ ìƒë‹˜ì´ ë„ì™€ì¤„ê²Œìš”!`\n      : tone === 'middle'\n      ? `\"${criterion_name}\" ì˜ì—­ì—ì„œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. ê¸°ì´ˆë¶€í„° ë‹¤ì‹œ ë‹¤ì ¸ë³´ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.`\n      : `\"${criterion_name}\" ì¸¡ë©´ì—ì„œ ìƒë‹¹í•œ ë³´ì™„ì´ í•„ìš”í•©ë‹ˆë‹¤. ê¸°ë³¸ ê°œë…ë¶€í„° ì¬ì •ë¦½í•˜ëŠ” ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤.`\n  }\n}\n\n/**\n * Adjust improvement areas based on feedback level\n */\nfunction adjustImprovementAreasByLevel(text: string, feedbackLevel: string): string {\n  if (feedbackLevel === 'brief') {\n    // Return first sentence only\n    const sentences = text.split('.')\n    return sentences[0] + (sentences[0].endsWith('.') ? '' : '.')\n  } else if (feedbackLevel === 'moderate') {\n    // Return first 2 sentences\n    const sentences = text.split('.')\n    return sentences.slice(0, 2).join('.') + (sentences.length > 1 ? '.' : '')\n  }\n  return text // detailed: return all\n}\n\n/**\n * Generate specific, actionable suggestions\n */\nfunction generateSpecificSuggestions(\n  score: { criterion_name: string; score: number; areas_for_improvement: string },\n  description: string,\n  tone: string,\n  feedbackLevel: string = 'detailed'\n): string {\n  const { criterion_name, score: points, areas_for_improvement } = score\n  \n  const suggestions: string[] = []\n  \n  // Adjust detail level based on feedback_level\n  const maxSuggestions = feedbackLevel === 'brief' ? 1 : feedbackLevel === 'moderate' ? 2 : 3\n  \n  if (points < 4) {\n    if (tone === 'elementary') {\n      if (maxSuggestions >= 1) suggestions.push(`ğŸ’¡ ë‹¤ìŒë²ˆì—ëŠ” ì´ë ‡ê²Œ í•´ë³´ì„¸ìš”:`)\n      if (maxSuggestions >= 1) suggestions.push(`1. ${areas_for_improvement}`)\n      if (maxSuggestions >= 2) suggestions.push(`2. ì„ ìƒë‹˜ê»˜ ë” ìì„¸íˆ ì—¬ì­¤ë³´ì„¸ìš”`)\n      if (maxSuggestions >= 3) suggestions.push(`3. ì¹œêµ¬ë“¤ì˜ ì¢‹ì€ ì˜ˆë¥¼ ì°¸ê³ í•´ë³´ì„¸ìš”`)\n    } else if (tone === 'middle') {\n      if (maxSuggestions >= 1) suggestions.push(`ğŸ’¡ êµ¬ì²´ì ì¸ ê°œì„  ë°©ì•ˆ:`)\n      if (maxSuggestions >= 1) suggestions.push(`1. ${areas_for_improvement}`)\n      if (maxSuggestions >= 2) suggestions.push(`2. ê´€ë ¨ ì˜ˆì‹œë¥¼ ë” ë§ì´ ì°¾ì•„ë³´ì„¸ìš”`)\n      if (maxSuggestions >= 3) suggestions.push(`3. ë…¼ë¦¬ì  ì—°ê²°ì„ ê°•í™”í•˜ê¸° ìœ„í•´ ì ‘ì†ì‚¬ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”`)\n    } else {\n      if (maxSuggestions >= 1) suggestions.push(`ğŸ’¡ ì‹¬í™” í•™ìŠµ ë°©í–¥:`)\n      if (maxSuggestions >= 1) suggestions.push(`1. ${areas_for_improvement}`)\n      if (maxSuggestions >= 2) suggestions.push(`2. í•™ìˆ ì  ê·¼ê±°ë¥¼ ë³´ê°•í•˜ê¸° ìœ„í•´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ë¥¼ ì¸ìš©í•˜ì„¸ìš”`)\n      if (maxSuggestions >= 3) suggestions.push(`3. ë°˜ë¡ ì„ ê³ ë ¤í•˜ì—¬ ë…¼ì¦ì˜ ì„¤ë“ë ¥ì„ ë†’ì´ì„¸ìš”`)\n    }\n  }\n  \n  return suggestions.join('\\n')\n}\n\n/**\n * Extract overall strengths from criterion scores\n */\nfunction extractStrengths(scores: Array<{ criterion_name: string; score: number; strengths: string }>): string {\n  const highScores = scores.filter(s => s.score >= 3)\n  if (highScores.length === 0) {\n    return 'ê¸°ë³¸ì ì¸ ê¸€ì“°ê¸° êµ¬ì¡°ë¥¼ ê°–ì¶”ë ¤ê³  ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.'\n  }\n  \n  return highScores.map(s => s.criterion_name).join(', ') + ' ì˜ì—­ì—ì„œ ìš°ìˆ˜í•œ ì—­ëŸ‰ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.'\n}\n\n/**\n * Extract areas needing improvement\n */\nfunction extractWeaknesses(scores: Array<{ criterion_name: string; score: number }>): string {\n  const lowScores = scores.filter(s => s.score <= 2)\n  if (lowScores.length === 0) {\n    return 'ì „ë°˜ì ìœ¼ë¡œ ê· í˜•ì¡íŒ ê¸€ì“°ê¸°ë¥¼ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.'\n  }\n  \n  return lowScores.map(s => s.criterion_name).join(', ') + ' ì˜ì—­ì—ì„œ ë³´ì™„ì´ í•„ìš”í•©ë‹ˆë‹¤.'\n}\n\n/**\n * Generate overall comment based on performance\n */\nfunction generateOverallComment(\n  percentage: number,\n  strengths: string,\n  weaknesses: string,\n  tone: string\n): string {\n  if (percentage >= 90) {\n    return tone === 'elementary'\n      ? `ì•„ì£¼ í›Œë¥­í•œ ë…¼ìˆ ì…ë‹ˆë‹¤! ${strengths} ê³„ì† ì´ë ‡ê²Œ ì—´ì‹¬íˆ í•˜ì„¸ìš”!`\n      : tone === 'middle'\n      ? `ë§¤ìš° ìš°ìˆ˜í•œ ë…¼ìˆ  ì‹¤ë ¥ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤. ${strengths} ì´ ìˆ˜ì¤€ì„ ìœ ì§€í•˜ë©° ë”ìš± ë°œì „ì‹œì¼œ ë‚˜ê°€ì„¸ìš”.`\n      : `íƒì›”í•œ ë…¼ìˆ  ì—­ëŸ‰ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ${strengths} í•™ìˆ ì  ê¸€ì“°ê¸°ì˜ ëª¨ë²”ì  ì‚¬ë¡€ë¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`\n  } else if (percentage >= 75) {\n    return tone === 'elementary'\n      ? `ì˜ ì“´ ë…¼ìˆ ì´ì—ìš”! ${strengths} ${weaknesses} ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•˜ë©´ ì™„ë²½í•´ì§ˆ ê±°ì˜ˆìš”!`\n      : tone === 'middle'\n      ? `ì–‘í˜¸í•œ ë…¼ìˆ  ìˆ˜ì¤€ì…ë‹ˆë‹¤. ${strengths} ë‹¤ë§Œ, ${weaknesses} ì´ ë¶€ë¶„ì„ ë³´ì™„í•˜ë©´ ë”ìš± ì¢‹ì•„ì§ˆ ê²ƒì…ë‹ˆë‹¤.`\n      : `ì¤€ìˆ˜í•œ ë…¼ìˆ  ì—­ëŸ‰ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ${strengths} ê·¸ëŸ¬ë‚˜ ${weaknesses} ì´ëŸ¬í•œ ì¸¡ë©´ì„ ê°œì„ í•œë‹¤ë©´ í•œ ë‹¨ê³„ ë„ì•½í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.`\n  } else if (percentage >= 60) {\n    return tone === 'elementary'\n      ? `ê¸°ë³¸ì€ ì˜ ê°–ì¶˜ ë…¼ìˆ ì´ì—ìš”. ${weaknesses} ì„ ìƒë‹˜ê³¼ í•¨ê»˜ ì—°ìŠµí•˜ë©´ ë” ì˜í•  ìˆ˜ ìˆì–´ìš”!`\n      : tone === 'middle'\n      ? `ê¸°ì´ˆì ì¸ ë…¼ìˆ  ì—­ëŸ‰ì€ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤. ${weaknesses} ì´ ì˜ì—­ì„ ì§‘ì¤‘ì ìœ¼ë¡œ í•™ìŠµí•˜ë©´ ì‹¤ë ¥ì´ í¬ê²Œ í–¥ìƒë  ê²ƒì…ë‹ˆë‹¤.`\n      : `ê¸°ë³¸ì ì¸ ë…¼ìˆ  êµ¬ì¡°ëŠ” ì´í•´í•˜ê³  ìˆìŠµë‹ˆë‹¤. ${weaknesses} ì²´ê³„ì ì¸ í•™ìŠµì„ í†µí•´ ì´ëŸ¬í•œ ë¶€ë¶„ì„ ë³´ì™„í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.`\n  } else {\n    return tone === 'elementary'\n      ? `ë…¼ìˆ  ì—°ìŠµì´ ë” í•„ìš”í•´ìš”. ì„ ìƒë‹˜ì´ ë„ì™€ì¤„ í…Œë‹ˆ í¬ê¸°í•˜ì§€ ë§ê³  ê³„ì† ë…¸ë ¥í•´ìš”!`\n      : tone === 'middle'\n      ? `ë…¼ìˆ  ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ê¸°ì´ˆë¶€í„° ì²´ê³„ì ì¸ í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤. ê¾¸ì¤€íˆ ì—°ìŠµí•˜ë©´ ë¶„ëª…íˆ ì¢‹ì•„ì§ˆ ê²ƒì…ë‹ˆë‹¤.`\n      : `ë…¼ìˆ ì˜ ê¸°ë³¸ ìš”ì†Œì— ëŒ€í•œ ì´í•´ë¥¼ ë†’ì¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¨ê³„ì  í•™ìŠµê³¼ ì§€ì†ì ì¸ ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.`\n  }\n}\n\n/**\n * Determine which area needs most improvement\n */\nfunction determineImprovementPriority(scores: Array<{ criterion_name: string; score: number }>): string {\n  const lowest = scores.reduce((min, s) => s.score < min.score ? s : min, scores[0])\n  return `\"${lowest.criterion_name}\" ì˜ì—­ì„ ìš°ì„ ì ìœ¼ë¡œ ê°œì„ í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.`\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/google-auth-service.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: The keyword 'interface' is reserved","line":4,"column":1}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Google OAuth 2.0 Service Account Authentication for Cloudflare Workers\n// Uses Web Crypto API to sign JWT tokens\n\ninterface ServiceAccountCredentials {\n  client_email: string;\n  private_key: string;\n  project_id: string;\n}\n\n/**\n * Load service account credentials from environment variable\n * credentialsJson parameter should be the raw JSON string from environment\n */\nexport async function loadServiceAccountCredentials(\n  credentialsJson: string\n): Promise<ServiceAccountCredentials> {\n  // In Cloudflare Workers, we cannot use fs.readFileSync\n  // Instead, we parse credentials directly from environment variable\n  \n  if (!credentialsJson) {\n    throw new Error('Service account credentials JSON not provided');\n  }\n  \n  try {\n    const credentials = JSON.parse(credentialsJson);\n    \n    // Validate required fields\n    if (!credentials.client_email || !credentials.private_key || !credentials.project_id) {\n      throw new Error('Invalid credentials: missing required fields (client_email, private_key, project_id)');\n    }\n    \n    return credentials;\n  } catch (error) {\n    throw new Error(`Failed to parse service account credentials: ${error}`);\n  }\n}\n\n/**\n * Generate JWT token for Google API authentication\n */\nasync function createJWT(\n  credentials: ServiceAccountCredentials,\n  scope: string\n): Promise<string> {\n  const now = Math.floor(Date.now() / 1000);\n  const expiry = now + 3600; // 1 hour\n\n  // JWT Header\n  const header = {\n    alg: 'RS256',\n    typ: 'JWT',\n  };\n\n  // JWT Payload\n  const payload = {\n    iss: credentials.client_email,\n    scope: scope,\n    aud: 'https://oauth2.googleapis.com/token',\n    exp: expiry,\n    iat: now,\n  };\n\n  // Encode header and payload\n  const encodedHeader = base64UrlEncode(JSON.stringify(header));\n  const encodedPayload = base64UrlEncode(JSON.stringify(payload));\n  const unsignedToken = `${encodedHeader}.${encodedPayload}`;\n\n  // Import private key\n  const privateKey = await importPrivateKey(credentials.private_key);\n\n  // Sign the token\n  const signature = await signData(privateKey, unsignedToken);\n  const encodedSignature = base64UrlEncode(signature);\n\n  return `${unsignedToken}.${encodedSignature}`;\n}\n\n/**\n * Get access token from Google OAuth 2.0\n */\nexport async function getAccessToken(\n  credentials: ServiceAccountCredentials,\n  scope: string = 'https://www.googleapis.com/auth/cloud-vision'\n): Promise<string> {\n  const jwt = await createJWT(credentials, scope);\n\n  const response = await fetch('https://oauth2.googleapis.com/token', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: new URLSearchParams({\n      grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',\n      assertion: jwt,\n    }),\n  });\n\n  if (!response.ok) {\n    const error = await response.text();\n    throw new Error(`Failed to get access token: ${error}`);\n  }\n\n  const data = await response.json();\n  return data.access_token;\n}\n\n/**\n * Import private key for signing\n */\nasync function importPrivateKey(privateKeyPem: string): Promise<CryptoKey> {\n  // Remove PEM headers and whitespace\n  const pemContents = privateKeyPem\n    .replace('-----BEGIN PRIVATE KEY-----', '')\n    .replace('-----END PRIVATE KEY-----', '')\n    .replace(/\\\\n/g, '')\n    .replace(/\\s/g, '');\n\n  // Convert base64 to ArrayBuffer\n  const binaryDer = base64Decode(pemContents);\n\n  // Import the key\n  return await crypto.subtle.importKey(\n    'pkcs8',\n    binaryDer,\n    {\n      name: 'RSASSA-PKCS1-v1_5',\n      hash: 'SHA-256',\n    },\n    false,\n    ['sign']\n  );\n}\n\n/**\n * Sign data with private key\n */\nasync function signData(\n  privateKey: CryptoKey,\n  data: string\n): Promise<ArrayBuffer> {\n  const encoder = new TextEncoder();\n  const dataBuffer = encoder.encode(data);\n\n  return await crypto.subtle.sign(\n    'RSASSA-PKCS1-v1_5',\n    privateKey,\n    dataBuffer\n  );\n}\n\n/**\n * Base64 URL encoding\n */\nfunction base64UrlEncode(data: string | ArrayBuffer): string {\n  let base64: string;\n  \n  if (typeof data === 'string') {\n    base64 = btoa(data);\n  } else {\n    const bytes = new Uint8Array(data);\n    let binary = '';\n    for (let i = 0; i < bytes.length; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    base64 = btoa(binary);\n  }\n\n  return base64\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '');\n}\n\n/**\n * Base64 decoding\n */\nfunction base64Decode(base64: string): ArrayBuffer {\n  const binaryString = atob(base64);\n  const bytes = new Uint8Array(binaryString.length);\n  for (let i = 0; i < binaryString.length; i++) {\n    bytes[i] = binaryString.charCodeAt(i);\n  }\n  return bytes.buffer;\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/grading-service.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token {","line":2,"column":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// AI-powered essay grading service\nimport type { GradingRequest, GradingResult, CriterionScore } from './types';\n\n/**\n * Generates a comprehensive grading prompt based on the CoGrader rubric\n */\nfunction generateGradingPrompt(request: GradingRequest): string {\n  const rubricTable = request.rubric_criteria\n    .map((c, i) => `${i + 1}. ${c.criterion_name}\\n   ${c.criterion_description}`)\n    .join('\\n\\n');\n\n  return `You are an expert in Automated Essay Grading (AEG) powered by cutting-edge Large Language Models (LLMs). Your mission is to grade student essays according to a given rubric and provide comprehensive, detailed feedback that promotes learning and growth.\n\nYour grading objectives are as follows:\n1. Consistent Grading (AES): Achieve Substantial agreement (QWK 0.61 or higher) with human markers as the top priority.\n2. In-depth Feedback (AWE): Feedback must be timely, specific, detailed, and supportive.\n\n---\n\nINPUT PARAMETERS:\n\nA. Assignment Prompt:\n${request.assignment_prompt}\n\nGrade Level: ${request.grade_level}\n\nB. Rubric Criteria:\n${rubricTable}\n\nC. Student Essay:\n${request.essay_text}\n\n---\n\nOUTPUT REQUIREMENTS:\n\nPlease provide your evaluation in the following JSON format (must be valid JSON):\n\n{\n  \"total_score\": [number out of 10],\n  \"summary_evaluation\": \"[Brief summary of overall quality and main factors affecting the score]\",\n  \"criterion_scores\": [\n    {\n      \"criterion_name\": \"[Exact criterion name from rubric]\",\n      \"score\": [1-4],\n      \"strengths\": \"[Specific positive elements with examples from the essay]\",\n      \"areas_for_improvement\": \"[Specific weaknesses with examples from the essay]\"\n    }\n  ],\n  \"overall_comment\": \"[Comprehensive opinion on how well the essay met the assignment prompt]\",\n  \"revision_suggestions\": \"[At least 3 specific examples of errors found in the essay with detailed recommendations for revision. Include specific quotes from the essay and explain how to fix each issue.]\",\n  \"next_steps_advice\": \"[Practical strategies for overall writing improvement, considering student's proficiency level]\"\n}\n\nImportant:\n- Assign a score from 1 to 4 for each criterion\n- Calculate total_score out of 10 based on the criterion scores\n- Provide specific examples from the essay in your feedback\n- Be constructive and supportive in your criticism\n- Focus on actionable improvements\n- Return ONLY valid JSON, no additional text`;\n}\n\n/**\n * Simulates AI grading using a structured analysis approach\n * In production, this would call an actual LLM API (OpenAI, Anthropic, etc.)\n */\nexport async function gradeEssay(request: GradingRequest): Promise<GradingResult> {\n  const prompt = generateGradingPrompt(request);\n  \n  // For demo purposes, we'll create a structured analysis\n  // In production, replace this with actual LLM API call:\n  // const response = await fetch('https://api.openai.com/v1/chat/completions', {\n  //   method: 'POST',\n  //   headers: {\n  //     'Authorization': `Bearer ${API_KEY}`,\n  //     'Content-Type': 'application/json',\n  //   },\n  //   body: JSON.stringify({\n  //     model: 'gpt-4',\n  //     messages: [{ role: 'user', content: prompt }],\n  //     temperature: 0.3,\n  //   }),\n  // });\n  \n  // Demo grading logic (replace with actual LLM response)\n  const result = await simulateGrading(request);\n  \n  return result;\n}\n\n/**\n * Simulates grading for demonstration purposes\n * This provides a template for how the actual LLM response should be structured\n */\nasync function simulateGrading(request: GradingRequest): Promise<GradingResult> {\n  // Analyze essay characteristics\n  const wordCount = request.essay_text.trim().split(/\\s+/).length;\n  const paragraphCount = request.essay_text.trim().split(/\\n\\n+/).length;\n  const sentenceCount = request.essay_text.trim().split(/[.!?]+/).length;\n  \n  // Simulate criterion scoring\n  const criterion_scores: CriterionScore[] = request.rubric_criteria.map((criterion, index) => {\n    // Vary scores based on essay characteristics\n    let score = 3; // Default to \"proficient\"\n    \n    if (index === 0) { // Understanding and Analysis\n      score = wordCount > 300 ? 3 : 2;\n    } else if (index === 1) { // Use of Evidence\n      score = paragraphCount >= 4 ? 3 : 2;\n    } else if (index === 2) { // Accuracy of Citations\n      const hasCitations = /documentary|source|according to/i.test(request.essay_text);\n      score = hasCitations ? 3 : 2;\n    } else if (index === 3) { // Grammar and Organization\n      score = sentenceCount >= 10 ? 3 : 2;\n    }\n    \n    return {\n      criterion_name: criterion.criterion_name,\n      score: score,\n      strengths: generateStrengths(criterion.criterion_name, score, request.essay_text),\n      areas_for_improvement: generateImprovements(criterion.criterion_name, score, request.essay_text)\n    };\n  });\n  \n  // Calculate total score\n  const totalPoints = criterion_scores.reduce((sum, c) => sum + c.score, 0);\n  const maxPoints = criterion_scores.length * 4;\n  const total_score = Math.round((totalPoints / maxPoints) * 10 * 10) / 10;\n  \n  return {\n    total_score,\n    summary_evaluation: `This essay demonstrates ${total_score >= 7.5 ? 'strong' : total_score >= 6 ? 'adequate' : 'developing'} understanding of the topic. The essay contains approximately ${wordCount} words and ${paragraphCount} paragraphs, showing ${total_score >= 7 ? 'good' : 'moderate'} organization and depth of analysis.`,\n    criterion_scores,\n    overall_comment: `The essay addresses the assignment prompt by discussing the major causes of World War II. ${total_score >= 7 ? 'The writer demonstrates a solid grasp of historical concepts and provides relevant examples.' : 'However, there is room for improvement in developing deeper analysis and providing more specific historical evidence.'} The organizational structure ${paragraphCount >= 5 ? 'effectively guides the reader through the argument' : 'could be strengthened with clearer paragraph transitions and topic sentences'}.`,\n    revision_suggestions: `1. **Citation Enhancement**: Add more specific references to the required documentary source. For example, instead of general statements, cite specific scenes or experts featured in \"Documentary 'World War II'\" with timestamps or chapter references.\\n\\n2. **Historical Specificity**: Replace general phrases with concrete dates, names, and events. For instance, when discussing the Treaty of Versailles, mention specific articles (such as Article 231, the \"War Guilt Clause\") and their exact impacts on German reparations.\\n\\n3. **Analytical Depth**: Strengthen causal connections between events. Rather than simply listing causes, explain the mechanisms by which each factor led to war. For example, show how the economic provisions of the Treaty of Versailles created conditions that allowed extremist political movements to gain support.`,\n    next_steps_advice: `To improve your analytical writing skills for ${request.grade_level} level:\\n\\n1. **Practice Evidence Integration**: Work on smoothly incorporating quotations and paraphrases from sources. Use signal phrases (e.g., \"According to...\", \"As demonstrated in...\") and always cite your sources accurately.\\n\\n2. **Develop Thesis-Driven Writing**: Ensure every paragraph connects back to your main argument. Ask yourself: \"How does this evidence support my thesis?\"\\n\\n3. **Enhance Vocabulary**: Build domain-specific vocabulary related to your topic. For historical writing, learn terms like \"causation,\" \"historical context,\" \"primary source,\" and \"historiography.\"\\n\\n4. **Peer Review**: Exchange essays with classmates and practice giving and receiving constructive feedback using the rubric criteria.\\n\\n5. **Revision Strategy**: After receiving feedback, create a revision plan that addresses specific weaknesses. Focus on one criterion at a time rather than trying to fix everything at once.`\n  };\n}\n\nfunction generateStrengths(criterionName: string, score: number, essayText: string): string {\n  const excerptLength = 100;\n  const excerpt = essayText.substring(0, excerptLength) + (essayText.length > excerptLength ? '...' : '');\n  \n  if (score >= 3) {\n    return `The essay demonstrates ${score === 4 ? 'exceptional' : 'solid'} performance in \"${criterionName}\". The writing shows clear understanding and appropriate development of ideas. The opening \"${excerpt}\" establishes a ${score === 4 ? 'compelling' : 'clear'} direction for the analysis.`;\n  } else {\n    return `The essay shows emerging competence in \"${criterionName}\". There are foundational elements in place that can be built upon with further development.`;\n  }\n}\n\nfunction generateImprovements(criterionName: string, score: number, essayText: string): string {\n  if (score === 4) {\n    return `While performance is strong, consider adding even more nuanced analysis and exploring counterarguments to achieve exceptional depth in \"${criterionName}\".`;\n  } else if (score === 3) {\n    return `To elevate performance in \"${criterionName}\", focus on providing more specific examples and deeper analysis. Expand on the connections between your evidence and main arguments.`;\n  } else if (score === 2) {\n    return `The essay would benefit from significant enhancement in \"${criterionName}\". Work on developing more detailed explanations, providing specific evidence, and strengthening the logical connections between ideas.`;\n  } else {\n    return `Substantial improvement is needed in \"${criterionName}\". Focus on understanding the basic requirements of this criterion, provide relevant examples, and ensure all components of the rubric are adequately addressed.`;\n  }\n}\n\n// Export the prompt generator for testing/debugging purposes\nexport { generateGradingPrompt };\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/hybrid-grading-service.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token {","line":5,"column":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Hybrid AI-powered essay grading service\n// GPT-4o for scoring, Claude 3.5 Sonnet for feedback generation\nimport OpenAI from 'openai';\nimport Anthropic from '@anthropic-ai/sdk';\nimport type { GradingRequest, GradingResult, CriterionScore } from './types';\n\n/**\n * Initialize AI clients with configuration\n */\nfunction initializeClients(env: any) {\n  // OpenAI client for scoring (GPT-4o)\n  const openai = new OpenAI({\n    apiKey: env.OPENAI_API_KEY,\n    baseURL: env.OPENAI_BASE_URL || 'https://api.openai.com/v1',\n  });\n\n  // Anthropic client for feedback generation (Claude 3.5 Sonnet)\n  // Support both ANTHROPIC_API_KEY and CLAUDE_API_KEY for flexibility\n  const anthropic = new Anthropic({\n    apiKey: env.ANTHROPIC_API_KEY || env.CLAUDE_API_KEY,\n  });\n\n  return { openai, anthropic };\n}\n\n/**\n * Phase 1: GPT-4o generates rubric-based scores\n */\nfunction generateScoringPrompt(request: GradingRequest): string {\n  // Calculate total max score\n  const totalMaxScore = request.rubric_criteria.reduce((sum, c) => sum + (c.max_score || 4), 0);\n  \n  // Format rubric as detailed JSON\n  const rubricJson = JSON.stringify({\n    total_max_score: totalMaxScore,\n    criteria: request.rubric_criteria.map(c => ({\n      category: c.criterion_name,\n      description: c.criterion_description,\n      max_score: c.max_score || 4\n    }))\n  }, null, 2);\n\n  return `ë‹¹ì‹ ì€ ${request.grade_level} í•™ìƒì˜ ë…¼ìˆ ì„ í‰ê°€í•˜ëŠ” ì „ë¬¸ ì±„ì ìì…ë‹ˆë‹¤.\n\nì—­í•  ì •ì˜:\n- í•™ë…„: ${request.grade_level}\n- í‰ê°€ ëª©í‘œ: ë£¨ë¸Œë¦­ ê¸°ì¤€ì— ë”°ë¼ ì •í™•í•˜ê³  ì¼ê´€ëœ ì ìˆ˜ ë¶€ì—¬\n\nëª©í‘œ(Objective):\ní•™ìƒì˜ ê¸€ì„ ì•„ë˜ [ì±„ì  ê¸°ì¤€í‘œ(Rubric)]ì— ë”°ë¼ ë¶„ì„í•˜ê³ , ê° ê¸°ì¤€ë³„ ì ìˆ˜ì™€ ì´ì ì„ ì œê³µí•©ë‹ˆë‹¤.\n\nì…ë ¥ ë°ì´í„°:\n\nA. ì—ì„¸ì´ ì£¼ì œ:\n${request.assignment_prompt}\n\nB. ì—ì„¸ì´ ë‚´ìš©:\n${request.essay_text}\n\nC. ì±„ì  ê¸°ì¤€í‘œ (Rubric) - JSON í˜•ì‹:\n${rubricJson}\n\nì±„ì  ì§€ì¹¨:\n1. ê° ê¸°ì¤€ì— ëŒ€í•´ ì§€ì •ëœ ìµœëŒ€ ì ìˆ˜(max_score) ë²”ìœ„ ë‚´ì—ì„œ í‰ê°€:\n   ${request.rubric_criteria.map((c, i) => `   ê¸°ì¤€ ${i + 1} \"${c.criterion_name}\": 0-${c.max_score || 4}ì `).join('\\n')}\n   \n   ì ìˆ˜ ê¸°ì¤€:\n   - ìµœëŒ€ ì ìˆ˜: ê¸°ëŒ€ ì´ìƒ, íƒì›”í•œ ìˆ˜ì¤€\n   - ìµœëŒ€ì˜ 75%: ê¸°ëŒ€ ì¶©ì¡±, ëŠ¥ìˆ™í•œ ìˆ˜ì¤€  \n   - ìµœëŒ€ì˜ 50%: ê¸°ëŒ€ ë¶€ë¶„ ì¶©ì¡±, ë°œì „ ì¤‘ì¸ ìˆ˜ì¤€\n   - ìµœëŒ€ì˜ 25% ì´í•˜: ê¸°ëŒ€ ë¯¸ì¶©ì¡±, ìƒë‹¹í•œ ê°œì„  í•„ìš”\n\n2. ${request.grade_level} í•™ìƒì˜ ë°œë‹¬ ë‹¨ê³„ë¥¼ ê³ ë ¤í•˜ì—¬ í‰ê°€\n3. ë£¨ë¸Œë¦­ ê¸°ì¤€ì—ë§Œ ê·¼ê±°í•˜ì—¬ ê°ê´€ì ìœ¼ë¡œ í‰ê°€\n4. ì´ì ì€ ê° ê¸°ì¤€ ì ìˆ˜ì˜ í•©ê³„ (ìµœëŒ€ ${totalMaxScore}ì )\n\nì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ JSONë§Œ ë°˜í™˜):\n{\n  \"total_score\": [ëª¨ë“  ê¸°ì¤€ ì ìˆ˜ì˜ í•©ê³„, ìµœëŒ€ ${totalMaxScore}ì ],\n  \"criterion_scores\": [\n    {\n      \"criterion_name\": \"[ì •í™•í•œ ê¸°ì¤€ëª…]\",\n      \"score\": [í•´ë‹¹ ê¸°ì¤€ì˜ ìµœëŒ€ ì ìˆ˜ ë²”ìœ„ ë‚´],\n      \"brief_rationale\": \"[ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í•œ ì´ìœ  1-2ë¬¸ì¥]\"\n    }\n  ]\n}\n\nì¤‘ìš”:\n- ì¼ê´€ì„± ìˆê³  ê°ê´€ì ì¸ ì±„ì \n- ë£¨ë¸Œë¦­ ê¸°ì¤€ì—ë§Œ ê·¼ê±°\n- ê° ê¸°ì¤€ì˜ ìµœëŒ€ ì ìˆ˜ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜\n- ì´ì ì€ ê° ê¸°ì¤€ ì ìˆ˜ì˜ í•©ê³„ (ìµœëŒ€ ${totalMaxScore}ì )\n- ìœ íš¨í•œ JSONë§Œ ë°˜í™˜, ì¶”ê°€ í…ìŠ¤íŠ¸ ì—†ìŒ`;\n}\n\n/**\n * Get grade-level specific tone and approach\n */\nfunction getGradeLevelContext(gradeLevel: string): { \n  role: string; \n  tone: string; \n  feedbackStructure: string;\n} {\n  const level = gradeLevel.toLowerCase();\n  \n  if (level.includes('ì´ˆë“±') || level.includes('elementary')) {\n    return {\n      role: 'ì´ˆë“±í•™ìƒì„ ìœ„í•œ ê¸€ì“°ê¸° ë©˜í†  ì„ ìƒë‹˜',\n      tone: 'ì¹œê·¼í•˜ê³  ë¶€ë“œëŸ¬ìš´ ë§íˆ¬ë¡œ ì¹­ì°¬ì„ ë§ì´ í•˜ë©°, ì–´ë ¤ìš´ ìš©ì–´ ëŒ€ì‹  ì‰¬ìš´ ì„¤ëª…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.',\n      feedbackStructure: 'ìƒŒë“œìœ„ì¹˜ í”¼ë“œë°±: ì¹­ì°¬ â†’ ê°œì„ ì  ì œì‹œ â†’ êµ¬ì²´ì  ì˜ˆì‹œ â†’ ê²©ë ¤'\n    };\n  } else if (level.includes('ì¤‘í•™') || level.includes('middle')) {\n    return {\n      role: 'ì¤‘í•™ìƒì„ ìœ„í•œ ê¸€ì“°ê¸° ë©˜í†  ì„ ìƒë‹˜',\n      tone: 'ì¡´ì¤‘í•˜ë©´ì„œë„ ì¹œê·¼í•œ ë§íˆ¬ë¡œ ë…¼ë¦¬ì  ì‚¬ê³ ë¥¼ ê²©ë ¤í•˜ë©°, êµ¬ì²´ì ì¸ ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…í•©ë‹ˆë‹¤.',\n      feedbackStructure: 'ìƒŒë“œìœ„ì¹˜ í”¼ë“œë°±: ê°•ì  ì¸ì • â†’ ë…¼ë¦¬ì  ê°œì„ ì  â†’ ì‹¤ì²œ ê°€ëŠ¥í•œ ì¡°ì–¸ â†’ ê²©ë ¤'\n    };\n  } else if (level.includes('ê³ ë“±') || level.includes('high')) {\n    return {\n      role: 'ê³ ë“±í•™ìƒì„ ìœ„í•œ ê¸€ì“°ê¸° ë©˜í†  ì„ ìƒë‹˜',\n      tone: 'ì¡´ì¤‘í•˜ê³  ê²©ì‹ ìˆëŠ” ë§íˆ¬ë¡œ ë¹„íŒì  ì‚¬ê³ ì™€ ê¹Šì´ ìˆëŠ” ë¶„ì„ì„ ë…ë ¤í•˜ë©°, í•™ìˆ ì  ê¸€ì“°ê¸° ìˆ˜ì¤€ì„ ë†’ì…ë‹ˆë‹¤.',\n      feedbackStructure: 'ìƒŒë“œìœ„ì¹˜ í”¼ë“œë°±: í†µì°°ë ¥ ì¸ì • â†’ ë¶„ì„ì  ê°œì„ ì  â†’ êµ¬ì²´ì  ì „ëµ â†’ í•™ìˆ ì  ì„±ì¥ ê²©ë ¤'\n    };\n  }\n  \n  // Default to middle school\n  return {\n    role: 'í•™ìƒì„ ìœ„í•œ ê¸€ì“°ê¸° ë©˜í†  ì„ ìƒë‹˜',\n    tone: 'ì¡´ì¤‘í•˜ë©´ì„œë„ ì¹œê·¼í•œ ë§íˆ¬ë¡œ ë…¼ë¦¬ì  ì‚¬ê³ ë¥¼ ê²©ë ¤í•©ë‹ˆë‹¤.',\n    feedbackStructure: 'ìƒŒë“œìœ„ì¹˜ í”¼ë“œë°±: ì¹­ì°¬ â†’ ê°œì„ ì  â†’ êµ¬ì²´ì  ì˜ˆì‹œ â†’ ê²©ë ¤'\n  };\n}\n\n/**\n * Phase 2: Claude 3.5 Sonnet generates detailed feedback\n */\nfunction generateFeedbackPrompt(\n  request: GradingRequest,\n  scoringResult: any\n): string {\n  // Calculate total max score from rubric criteria\n  const totalMaxScore = request.rubric_criteria.reduce((sum, c) => sum + (c.max_score || 4), 0);\n  \n  // Create scores table with actual max scores\n  const scoresTable = scoringResult.criterion_scores\n    .map((c: any) => {\n      const criterion = request.rubric_criteria.find(rc => rc.criterion_name === c.criterion_name);\n      const maxScore = criterion?.max_score || 4;\n      return `- ${c.criterion_name}: ${c.score}/${maxScore} (${c.brief_rationale})`;\n    })\n    .join('\\n');\n  \n  const gradeContext = getGradeLevelContext(request.grade_level);\n  \n  // Format rubric as JSON for structured reference\n  const rubricJson = JSON.stringify({\n    rubric_criteria: request.rubric_criteria.map(c => ({\n      criterion_name: c.criterion_name,\n      description: c.criterion_description\n    }))\n  }, null, 2);\n\n  return `ë‹¹ì‹ ì€ \"${gradeContext.role}\"ì…ë‹ˆë‹¤.\n\nì—­í•  ì •ì˜:\n- í•™ë…„: ${request.grade_level}\n- ë§íˆ¬: ${gradeContext.tone}\n- í”¼ë“œë°± êµ¬ì¡°: ${gradeContext.feedbackStructure}\n\nëª©í‘œ(Objective):\ní•™ìƒì˜ ê¸€ì„ ì•„ë˜ [ì±„ì  ê¸°ì¤€í‘œ(Rubric)]ì— ë”°ë¼ ë¶„ì„í•˜ê³ , ì ìˆ˜ì™€ í•¨ê»˜ í•™ìƒì´ ì´í•´í•˜ê¸° ì‰¬ìš´ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.\n\ní”¼ë“œë°± ê°€ì´ë“œë¼ì¸:\n1. í†¤(Tone):\n   - ${gradeContext.tone}\n   - ì ˆëŒ€ ë¹„ë‚œí•˜ì§€ ì•Šê³ , í•™ìƒì´ ë…¸ë ¥í•œ ë¶€ë¶„ì„ ë¨¼ì € ì¸ì •\n   - ê¸°ê³„ì ì´ì§€ ì•Šê³  ë”°ëœ»í•˜ë©° ì¸ê°„ì ì¸ ë§íˆ¬\n\n2. êµ¬ì¡°(Structure) - ìƒŒë“œìœ„ì¹˜ í”¼ë“œë°±:\n   ${gradeContext.feedbackStructure}\n\n3. ê¸ˆì§€ ìš”ì†Œ:\n   - \"ì´ ê¸€ì€ í˜•í¸ì—†ë‹¤\", \"ì „í˜€ ì´í•´í•˜ì§€ ëª»í–ˆë‹¤\" ë“± ì§ì ‘ì  ë¹„ë‚œ\n   - ê¸°ê³„ì ì´ê³  ë¬´ë¯¸ê±´ì¡°í•œ ë§íˆ¬\n   - ë§‰ì—°í•œ ì¡°ì–¸ (\"ë” ì—´ì‹¬íˆ í•˜ì„¸ìš”\" ëŒ€ì‹  \"ì„œë¡ ì— ì£¼ì¥ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ëª…í™•íˆ ì ì–´ë³´ì„¸ìš”\")\n\nì…ë ¥ ë°ì´í„°:\n\nA. ì—ì„¸ì´ ì£¼ì œ:\n${request.assignment_prompt}\n\nB. ì—ì„¸ì´ ë‚´ìš©:\n${request.essay_text}\n\nC. ì±„ì  ê¸°ì¤€í‘œ (Rubric):\n${rubricJson}\n\nD. ì´ë¯¸ ë¶€ì—¬ëœ ì ìˆ˜ (ë‹¤ë¥¸ AIê°€ í‰ê°€):\nì´ì : ${scoringResult.total_score}/${totalMaxScore}\n${scoresTable}\n\në‹¹ì‹ ì€ ìœ„ ì ìˆ˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•™ìƒì—ê²Œ ë”°ëœ»í•˜ê³  êµ¬ì²´ì ì´ë©° ì‹¤ì²œ ê°€ëŠ¥í•œ í”¼ë“œë°±ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.\n\nì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ JSON):\n{\n  \"total_score\": ${scoringResult.total_score},\n  \"grade_level_analysis\": \"${request.grade_level} í•™ìƒì—ê²Œ ì í•©í•œ í‰ê°€ ë° ê²©ë ¤ ë©”ì‹œì§€\",\n  \"feedback_content\": {\n    \"warm_opening\": \"í•™ìƒì˜ ë…¸ë ¥ì„ ì¸ì •í•˜ê³  ê²©ë ¤í•˜ëŠ” ë”°ëœ»í•œ ì‹œì‘ (2-3ë¬¸ì¥)\",\n    \"strength_points\": [\n      \"êµ¬ì²´ì ì¸ ê°•ì  1 (ì—ì„¸ì´ì—ì„œ ì¸ìš©)\",\n      \"êµ¬ì²´ì ì¸ ê°•ì  2 (ì—ì„¸ì´ì—ì„œ ì¸ìš©)\"\n    ],\n    \"improvement_areas\": [\n      {\n        \"criterion\": \"ê°œì„ ì´ í•„ìš”í•œ ê¸°ì¤€ëª…\",\n        \"specific_issue\": \"êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë¶€ë¶„ì´ ë¶€ì¡±í•œì§€ (ì—ì„¸ì´ ì¸ìš©)\",\n        \"actionable_advice\": \"í•™ìƒì´ ë°”ë¡œ ì‹¤ì²œí•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì  ì¡°ì–¸\"\n      }\n    ],\n    \"closing_encouragement\": \"ë‹¤ìŒ ê¸€ì“°ê¸°ë¥¼ ì‘ì›í•˜ëŠ” ë”°ëœ»í•œ ë§ˆë¬´ë¦¬ (2-3ë¬¸ì¥)\"\n  }\n}\n\nì¤‘ìš”: ë°˜ë“œì‹œ ìœ íš¨í•œ JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”. ì¶”ê°€ í…ìŠ¤íŠ¸ ì—†ì´ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;\n}\n\n/**\n * Main hybrid grading function\n */\nexport async function gradeEssayHybrid(\n  request: GradingRequest,\n  env: any\n): Promise<GradingResult> {\n  try {\n    // Check if AI API keys are configured\n    if (!env.OPENAI_API_KEY || (!env.ANTHROPIC_API_KEY && !env.CLAUDE_API_KEY)) {\n      console.log('AI API keys not configured, falling back to simulation mode');\n      return simulateGrading(request);\n    }\n\n    const { openai, anthropic } = initializeClients(env);\n\n    // Phase 1: GPT-4o scores the essay\n    console.log('[Hybrid AI] Phase 1: GPT-4o scoring...');\n    const scoringPrompt = generateScoringPrompt(request);\n    \n    const scoringResponse = await openai.chat.completions.create({\n      model: 'gpt-4o',\n      messages: [\n        {\n          role: 'system',\n          content: 'ë‹¹ì‹ ì€ í•™ìƒ ë…¼ìˆ ì„ ë£¨ë¸Œë¦­ ê¸°ì¤€ì— ë”°ë¼ ì •í™•í•˜ê³  ì¼ê´€ë˜ê²Œ ì±„ì í•˜ëŠ” ì „ë¬¸ í‰ê°€ìì…ë‹ˆë‹¤. í•­ìƒ ìœ íš¨í•œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.'\n        },\n        {\n          role: 'user',\n          content: scoringPrompt\n        }\n      ],\n      temperature: 0.3, // Lower temperature for consistency\n      response_format: { type: 'json_object' }\n    });\n\n    const scoringResultText = scoringResponse.choices[0].message.content || '{}';\n    const scoringResult = JSON.parse(scoringResultText);\n    console.log('[Hybrid AI] Phase 1 complete. Total score:', scoringResult.total_score);\n\n    // Phase 2: Claude 3.5 Sonnet generates feedback\n    console.log('[Hybrid AI] Phase 2: Claude 3.5 Sonnet feedback generation...');\n    const feedbackPrompt = generateFeedbackPrompt(request, scoringResult);\n    \n    const feedbackResponse = await anthropic.messages.create({\n      model: 'claude-sonnet-4-5-20250929', // Claude Sonnet 4.5 (latest)\n      max_tokens: 4096,\n      temperature: 0.7, // Higher temperature for creative feedback\n      messages: [\n        {\n          role: 'user',\n          content: feedbackPrompt\n        }\n      ]\n    });\n\n    const feedbackText = feedbackResponse.content[0].type === 'text' \n      ? feedbackResponse.content[0].text \n      : '{}';\n    \n    // Extract JSON from Claude's response (it might include extra text)\n    const jsonMatch = feedbackText.match(/\\{[\\s\\S]*\\}/);\n    const feedbackResult = jsonMatch ? JSON.parse(jsonMatch[0]) : JSON.parse(feedbackText);\n    console.log('[Hybrid AI] Phase 2 complete');\n\n    // Merge results: scores from GPT-4o, feedback from Claude\n    // Support both new and old feedback formats\n    const feedbackContent = feedbackResult.feedback_content || feedbackResult;\n    \n    // Build criterion scores with detailed feedback\n    const criterion_scores: CriterionScore[] = scoringResult.criterion_scores.map((score: any) => {\n      // Try to find matching improvement area from new format\n      let improvementFeedback = '';\n      let strengthsFeedback = score.brief_rationale;\n      \n      if (feedbackContent.improvement_areas && Array.isArray(feedbackContent.improvement_areas)) {\n        const improvement = feedbackContent.improvement_areas.find(\n          (area: any) => area.criterion === score.criterion_name || \n                        area.criterion_name === score.criterion_name\n        );\n        if (improvement) {\n          improvementFeedback = improvement.actionable_advice || improvement.specific_issue || '';\n        }\n      }\n      \n      // Fallback to old format\n      if (!improvementFeedback && feedbackResult.criterion_feedback) {\n        const oldFeedback = feedbackResult.criterion_feedback.find(\n          (f: any) => f.criterion_name === score.criterion_name\n        );\n        if (oldFeedback) {\n          strengthsFeedback = oldFeedback.strengths || score.brief_rationale;\n          improvementFeedback = oldFeedback.areas_for_improvement || '';\n        }\n      }\n      \n      return {\n        criterion_name: score.criterion_name,\n        score: score.score,\n        strengths: strengthsFeedback,\n        areas_for_improvement: improvementFeedback || 'ì´ ê¸°ì¤€ì„ ë”ìš± ë°œì „ì‹œì¼œ ë³´ì„¸ìš”.'\n      };\n    });\n\n    // Build summary evaluation\n    const summaryEvaluation = feedbackResult.grade_level_analysis || \n                              feedbackContent.warm_opening || \n                              feedbackResult.summary_evaluation || \n                              'ì¢‹ì€ ì‹œë„ì…ë‹ˆë‹¤!';\n    \n    // Build overall comment from strength points and closing\n    let overallComment = feedbackResult.overall_comment || '';\n    if (!overallComment && feedbackContent.strength_points) {\n      const strengthsText = Array.isArray(feedbackContent.strength_points) \n        ? feedbackContent.strength_points.join(' ') \n        : feedbackContent.strength_points;\n      const closingText = feedbackContent.closing_encouragement || '';\n      overallComment = `${strengthsText}\\n\\n${closingText}`;\n    }\n    \n    // Build revision suggestions\n    let revisionSuggestions = feedbackResult.revision_suggestions || '';\n    if (!revisionSuggestions && feedbackContent.improvement_areas) {\n      revisionSuggestions = Array.isArray(feedbackContent.improvement_areas)\n        ? feedbackContent.improvement_areas.map((area: any, idx: number) => \n            `${idx + 1}. ${area.criterion || area.criterion_name}: ${area.actionable_advice || area.specific_issue}`\n          ).join('\\n')\n        : '';\n    }\n\n    const result: GradingResult = {\n      total_score: scoringResult.total_score,\n      summary_evaluation: summaryEvaluation,\n      criterion_scores: criterion_scores,\n      overall_comment: overallComment || 'ê³„ì†í•´ì„œ ê¸€ì“°ê¸° ì‹¤ë ¥ì„ ë°œì „ì‹œì¼œ ë‚˜ê°€ì„¸ìš”.',\n      revision_suggestions: revisionSuggestions || 'ì‘ì„±í•œ ê¸€ì„ ë‹¤ì‹œ ì½ì–´ë³´ë©° ê°œì„ ì ì„ ì°¾ì•„ë³´ì„¸ìš”.',\n      next_steps_advice: feedbackResult.next_steps_advice || feedbackContent.closing_encouragement || 'ë‹¤ìŒë²ˆì—ëŠ” ë” ì¢‹ì€ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!'\n    };\n\n    console.log('[Hybrid AI] Grading complete successfully');\n    return result;\n\n  } catch (error) {\n    console.error('[Hybrid AI] Error during grading:', error);\n    console.log('[Hybrid AI] Falling back to simulation mode');\n    \n    // Fallback to simulation if API calls fail\n    return simulateGrading(request);\n  }\n}\n\n/**\n * Fallback simulation for when AI APIs are not available\n */\nasync function simulateGrading(request: GradingRequest): Promise<GradingResult> {\n  console.log('[Simulation] Using fallback grading logic');\n  \n  // Analyze essay characteristics\n  const wordCount = request.essay_text.trim().split(/\\s+/).length;\n  const paragraphCount = request.essay_text.trim().split(/\\n\\n+/).length;\n  const sentenceCount = request.essay_text.trim().split(/[.!?]+/).length;\n  \n  // Simulate criterion scoring\n  const criterion_scores: CriterionScore[] = request.rubric_criteria.map((criterion, index) => {\n    let score = 3; // Default to \"proficient\"\n    \n    if (index === 0) {\n      score = wordCount > 300 ? 3 : 2;\n    } else if (index === 1) {\n      score = paragraphCount >= 4 ? 3 : 2;\n    } else if (index === 2) {\n      const hasCitations = /documentary|source|according to/i.test(request.essay_text);\n      score = hasCitations ? 3 : 2;\n    } else if (index === 3) {\n      score = sentenceCount >= 10 ? 3 : 2;\n    }\n    \n    return {\n      criterion_name: criterion.criterion_name,\n      score: score,\n      strengths: generateStrengths(criterion.criterion_name, score, request.essay_text),\n      areas_for_improvement: generateImprovements(criterion.criterion_name, score, request.essay_text)\n    };\n  });\n  \n  // Calculate total score (sum of all criterion scores)\n  const total_score = criterion_scores.reduce((sum, c) => sum + c.score, 0);\n  // Calculate max points from rubric criteria\n  const maxPoints = request.rubric_criteria.reduce((sum, c) => sum + (c.max_score || 4), 0);\n  \n  // Calculate percentage for evaluation\n  const percentage = (total_score / maxPoints) * 100;\n  \n  return {\n    total_score,\n    summary_evaluation: `[ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ] ì´ ì—ì„¸ì´ëŠ” ${percentage >= 75 ? 'ê°•í•œ' : percentage >= 60 ? 'ì ì ˆí•œ' : 'ë°œì „ ì¤‘ì¸'} ì£¼ì œ ì´í•´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì•½ ${wordCount}ë‹¨ì–´ì™€ ${paragraphCount}ê°œ ë¬¸ë‹¨ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ${percentage >= 70 ? 'ì¢‹ì€' : 'ë³´í†µì˜'} ì¡°ì§ë ¥ê³¼ ë¶„ì„ ê¹Šì´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.`,\n    criterion_scores,\n    overall_comment: `[ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ] ì´ ì—ì„¸ì´ëŠ” ê³¼ì œ ì£¼ì œë¥¼ ë‹¤ë£¨ê³  ìˆìŠµë‹ˆë‹¤. ${percentage >= 70 ? 'ì‘ì„±ìëŠ” ê°œë…ì— ëŒ€í•œ íƒ„íƒ„í•œ ì´í•´ë¥¼ ë³´ì—¬ì£¼ë©° ê´€ë ¨ ì˜ˆì‹œë¥¼ ì œê³µí•©ë‹ˆë‹¤.' : 'ê·¸ëŸ¬ë‚˜ ë” ê¹Šì€ ë¶„ì„ê³¼ êµ¬ì²´ì ì¸ ì¦ê±° ì œê³µì—ì„œ ê°œì„ ì˜ ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.'} ì¡°ì§ êµ¬ì¡°ëŠ” ${paragraphCount >= 5 ? 'íš¨ê³¼ì ìœ¼ë¡œ ë…¼ì¦ì„ ì•ˆë‚´í•©ë‹ˆë‹¤' : 'ë” ëª…í™•í•œ ë¬¸ë‹¨ ì „í™˜ê³¼ ì£¼ì œë¬¸ìœ¼ë¡œ ê°•í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤'}.`,\n    revision_suggestions: `[ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ]\\n1. **ì¸ìš© ê°•í™”**: ë” êµ¬ì²´ì ì¸ ì¶œì²˜ ì°¸ì¡°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.\\n2. **ì—­ì‚¬ì  êµ¬ì²´ì„±**: ì¼ë°˜ì ì¸ í‘œí˜„ì„ êµ¬ì²´ì ì¸ ë‚ ì§œ, ì´ë¦„, ì‚¬ê±´ìœ¼ë¡œ ëŒ€ì²´í•˜ì„¸ìš”.\\n3. **ë¶„ì„ ê¹Šì´**: ì‚¬ê±´ ê°„ì˜ ì¸ê³¼ ê´€ê³„ë¥¼ ê°•í™”í•˜ì„¸ìš”.`,\n    next_steps_advice: `[ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ] ${request.grade_level} ìˆ˜ì¤€ì˜ ë¶„ì„ì  ê¸€ì“°ê¸° ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´:\\n1. ì¦ê±° í†µí•© ì—°ìŠµ\\n2. ë…¼ì œ ì¤‘ì‹¬ ê¸€ì“°ê¸° ê°œë°œ\\n3. ì–´íœ˜ë ¥ í–¥ìƒ\\n4. ë™ë£Œ í‰ê°€ ì°¸ì—¬\\n5. ìˆ˜ì • ì „ëµ ìˆ˜ë¦½`\n  };\n}\n\nfunction generateStrengths(criterionName: string, score: number, essayText: string): string {\n  const excerptLength = 100;\n  const excerpt = essayText.substring(0, excerptLength) + (essayText.length > excerptLength ? '...' : '');\n  \n  if (score >= 3) {\n    return `\"${criterionName}\" ê¸°ì¤€ì—ì„œ ${score === 4 ? 'íƒì›”í•œ' : 'ê²¬ê³ í•œ'} ì„±ê³¼ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ê¸€ì€ ëª…í™•í•œ ì´í•´ì™€ ì ì ˆí•œ ì•„ì´ë””ì–´ ê°œë°œì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì„œë‘ \"${excerpt}\"ëŠ” ë¶„ì„ì„ ìœ„í•œ ${score === 4 ? 'ì„¤ë“ë ¥ ìˆëŠ”' : 'ëª…í™•í•œ'} ë°©í–¥ì„ ì œì‹œí•©ë‹ˆë‹¤.`;\n  } else {\n    return `\"${criterionName}\" ê¸°ì¤€ì—ì„œ ì‹ í¥ ì—­ëŸ‰ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì¶”ê°€ ê°œë°œë¡œ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” ê¸°ì´ˆ ìš”ì†Œê°€ ìˆìŠµë‹ˆë‹¤.`;\n  }\n}\n\nfunction generateImprovements(criterionName: string, score: number, essayText: string): string {\n  if (score === 4) {\n    return `ì„±ê³¼ê°€ ê°•ë ¥í•˜ì§€ë§Œ, \"${criterionName}\"ì—ì„œ íƒì›”í•œ ê¹Šì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ë” ë¯¸ë¬˜í•œ ë¶„ì„ê³¼ ë°˜ëŒ€ ë…¼ì¦ íƒêµ¬ë¥¼ ê³ ë ¤í•˜ì„¸ìš”.`;\n  } else if (score === 3) {\n    return `\"${criterionName}\"ì—ì„œ ì„±ê³¼ë¥¼ ë†’ì´ë ¤ë©´ ë” êµ¬ì²´ì ì¸ ì˜ˆì‹œ ì œê³µê³¼ ë” ê¹Šì€ ë¶„ì„ì— ì§‘ì¤‘í•˜ì„¸ìš”. ì¦ê±°ì™€ ì£¼ìš” ë…¼ì¦ ê°„ì˜ ì—°ê²°ì„ í™•ì¥í•˜ì„¸ìš”.`;\n  } else if (score === 2) {\n    return `\"${criterionName}\"ì—ì„œ ìƒë‹¹í•œ ê°œì„ ì´ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤. ë” ìƒì„¸í•œ ì„¤ëª… ê°œë°œ, êµ¬ì²´ì ì¸ ì¦ê±° ì œê³µ, ì•„ì´ë””ì–´ ê°„ì˜ ë…¼ë¦¬ì  ì—°ê²° ê°•í™”ì— ë…¸ë ¥í•˜ì„¸ìš”.`;\n  } else {\n    return `\"${criterionName}\"ì—ì„œ ì‹¤ì§ˆì ì¸ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ê¸°ì¤€ì˜ ê¸°ë³¸ ìš”êµ¬ ì‚¬í•­ì„ ì´í•´í•˜ê³ , ê´€ë ¨ ì˜ˆì‹œë¥¼ ì œê³µí•˜ë©°, ë£¨ë¸Œë¦­ì˜ ëª¨ë“  êµ¬ì„± ìš”ì†Œê°€ ì ì ˆíˆ ë‹¤ë£¨ì–´ì§€ë„ë¡ í•˜ëŠ” ë° ì§‘ì¤‘í•˜ì„¸ìš”.`;\n  }\n}\n\n// Export for backward compatibility\nexport { generateScoringPrompt, generateFeedbackPrompt };\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/index.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token {","line":4,"column":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Hono } from 'hono'\nimport { cors } from 'hono/cors'\nimport { serveStatic } from 'hono/cloudflare-workers'\nimport type { Bindings, GradingRequest } from './types'\nimport { gradeEssay } from './grading-service'\nimport { gradeEssayHybrid } from './hybrid-grading-service'\nimport { generateDetailedFeedback } from './feedback-service'\nimport {\n  createGradingSession,\n  createEssay,\n  storeGradingResult,\n  getGradingResult,\n  listGradingSessions,\n  getSessionDetails\n} from './db-service'\nimport {\n  validateFile,\n  generateStorageKey,\n  processImageOCR,\n  processPDFExtraction,\n  processImagePDFOCR,\n  processOCRSpace,\n  logProcessingStep,\n  uploadToR2,\n  deleteFromR2\n} from './upload-service'\n\nconst app = new Hono<{ Bindings: Bindings }>()\n\n// Helper function to get user from session\nasync function getUserFromSession(c: any): Promise<{ id: number; name: string; email: string } | null> {\n  const sessionId = c.req.header('X-Session-ID')\n  if (!sessionId) return null\n  \n  const db = c.env.DB\n  const session = await db.prepare(\n    'SELECT s.*, u.id as user_id, u.name, u.email FROM sessions s JOIN users u ON s.user_id = u.id WHERE s.id = ? AND s.expires_at > datetime(\"now\")'\n  ).bind(sessionId).first()\n  \n  if (!session) return null\n  \n  return {\n    id: session.user_id as number,\n    name: session.name as string,\n    email: session.email as string\n  }\n}\n\n// Helper function to require authentication\nasync function requireAuth(c: any) {\n  const user = await getUserFromSession(c)\n  if (!user) {\n    return c.json({ error: 'Unauthorized - Please login' }, 401)\n  }\n  return user\n}\n\n// Helper function to convert ArrayBuffer to base64\nfunction arrayBufferToBase64(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer)\n  let binary = ''\n  for (let i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i])\n  }\n  return btoa(binary)\n}\n\n// Enable CORS for API routes\napp.use('/api/*', cors())\n\n// Serve static files\napp.use('/static/*', serveStatic({ root: './' }))\napp.use('/rubric-pdfs/*', serveStatic({ root: './' }))\n\n// API Routes\n\n/**\n * POST /api/grade - Grade an essay\n */\napp.post('/api/grade', async (c) => {\n  try {\n    const request: GradingRequest = await c.req.json()\n\n    // Validate request\n    if (!request.assignment_prompt || !request.essay_text || !request.rubric_criteria || request.rubric_criteria.length === 0) {\n      return c.json({ error: 'Missing required fields' }, 400)\n    }\n\n    const db = c.env.DB\n\n    // Create grading session\n    const sessionId = await createGradingSession(db, request)\n\n    // Create essay\n    const essayId = await createEssay(db, sessionId, request.essay_text)\n\n    // Grade the essay using Hybrid AI (GPT-4o for scoring + Claude for feedback)\n    const gradingResult = await gradeEssayHybrid(request, c.env)\n\n    // Store grading result\n    const resultId = await storeGradingResult(db, essayId, sessionId, gradingResult)\n\n    // Return the complete result\n    return c.json({\n      success: true,\n      session_id: sessionId,\n      essay_id: essayId,\n      result_id: resultId,\n      grading_result: gradingResult\n    })\n  } catch (error) {\n    console.error('Error grading essay:', error)\n    return c.json({ error: 'Failed to grade essay', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/result/:essayId - Get grading result for an essay\n */\napp.get('/api/result/:essayId', async (c) => {\n  try {\n    const essayId = parseInt(c.req.param('essayId'))\n    const db = c.env.DB\n\n    const result = await getGradingResult(db, essayId)\n\n    if (!result) {\n      return c.json({ error: 'Grading result not found' }, 404)\n    }\n\n    return c.json(result)\n  } catch (error) {\n    console.error('Error fetching result:', error)\n    return c.json({ error: 'Failed to fetch result', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/sessions - List all grading sessions\n */\napp.get('/api/sessions', async (c) => {\n  try {\n    const db = c.env.DB\n    const sessions = await listGradingSessions(db)\n\n    return c.json(sessions)\n  } catch (error) {\n    console.error('Error fetching sessions:', error)\n    return c.json({ error: 'Failed to fetch sessions', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/session/:sessionId - Get session details\n */\napp.get('/api/session/:sessionId', async (c) => {\n  try {\n    const sessionId = parseInt(c.req.param('sessionId'))\n    const db = c.env.DB\n\n    const session = await getSessionDetails(db, sessionId)\n\n    if (!session) {\n      return c.json({ error: 'Session not found' }, 404)\n    }\n\n    return c.json(session)\n  } catch (error) {\n    console.error('Error fetching session:', error)\n    return c.json({ error: 'Failed to fetch session', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/health - Health check\n */\napp.get('/api/health', (c) => {\n  return c.json({ status: 'ok', timestamp: new Date().toISOString() })\n})\n\n/**\n * POST /api/upload/image - Upload and process image file\n */\napp.post('/api/upload/image', async (c) => {\n  try {\n    const user = await getUserFromSession(c)\n    const student = await getStudentFromSession(c)\n    \n    // Either teacher or student must be logged in\n    if (!user && !student) {\n      return c.json({ error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' }, 401)\n    }\n    \n    const db = c.env.DB\n    const credentialsJson = c.env.GOOGLE_APPLICATION_CREDENTIALS\n    \n    // Parse multipart form data\n    const formData = await c.req.formData()\n    const file = formData.get('file') as File\n    const submissionId = formData.get('submission_id') as string | null\n    \n    if (!file) {\n      return c.json({ error: 'íŒŒì¼ì´ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤' }, 400)\n    }\n    \n    // Get allowed types and max size from environment\n    const maxSize = parseInt(c.env.MAX_FILE_SIZE || '10485760') // 10MB default\n    const allowedTypes = (c.env.ALLOWED_IMAGE_TYPES || 'image/jpeg,image/png,image/jpg,image/webp').split(',')\n    \n    // Validate file\n    const validation = validateFile(file, allowedTypes, maxSize)\n    if (!validation.valid) {\n      return c.json({ error: validation.error }, 400)\n    }\n    \n    // Generate storage key\n    const storageKey = generateStorageKey(user?.id || student?.id || null, file.name)\n    \n    // Read file as ArrayBuffer\n    const fileBuffer = await file.arrayBuffer()\n    \n    // Upload to R2 storage\n    const r2Bucket = c.env.R2_BUCKET\n    const r2Result = await uploadToR2(r2Bucket, storageKey, fileBuffer, file.type)\n    \n    if (!r2Result.success) {\n      return c.json({ error: r2Result.error || 'R2 ì—…ë¡œë“œ ì‹¤íŒ¨' }, 500)\n    }\n    \n    // Store file metadata in database\n    const result = await db.prepare(\n      `INSERT INTO uploaded_files \n       (user_id, student_user_id, submission_id, file_name, file_type, mime_type, file_size, storage_key, storage_url, processing_status)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\n    ).bind(\n      user?.id || null,\n      student?.id || null,\n      submissionId || null,\n      file.name,\n      'image',\n      file.type,\n      file.size,\n      storageKey,\n      r2Result.url || null,\n      'processing'\n    ).run()\n    \n    const uploadedFileId = result.meta.last_row_id as number\n    \n    // Log upload step\n    await logProcessingStep(db, uploadedFileId, 'upload', 'completed', 'R2 ì—…ë¡œë“œ ë° ë©”íƒ€ë°ì´í„° ì €ì¥ ì™„ë£Œ', null)\n    \n    // Process image with OCR - Try Google Vision API first (higher accuracy)\n    let extractedText = null\n    const startTime = Date.now()\n    \n    try {\n      // Try Google Vision API first if credentials available\n      if (credentialsJson) {\n        try {\n          const ocrResult = await processImageOCR(\n            { name: file.name, buffer: fileBuffer, type: file.type, size: file.size },\n            credentialsJson\n          )\n          \n          if (ocrResult.success && ocrResult.extractedText) {\n            extractedText = ocrResult.extractedText\n            \n            // Update database with extracted text\n            await db.prepare(\n              `UPDATE uploaded_files \n               SET extracted_text = ?, processing_status = ?, processed_at = CURRENT_TIMESTAMP\n               WHERE id = ?`\n            ).bind(ocrResult.extractedText, 'completed', uploadedFileId).run()\n            \n            // Log OCR step\n            await logProcessingStep(\n              db,\n              uploadedFileId,\n              'ocr',\n              'completed',\n              `ì¶”ì¶œëœ í…ìŠ¤íŠ¸: ${ocrResult.extractedText.length} characters (Google Vision)`,\n              ocrResult.processingTimeMs || null\n            )\n          } else {\n            throw new Error('Google Vision OCR failed - no text extracted')\n          }\n        } catch (googleError) {\n          console.error('Google Vision API error, trying OCR.space fallback:', googleError)\n          \n          // Fallback to OCR.space using file upload (supports larger files than base64)\n          const ocrApiKey = c.env.OCR_SPACE_API_KEY || 'K87899142388957'\n          \n          console.log('Uploading file directly to OCR.space...')\n          \n          // Create a File-like object from ArrayBuffer\n          const blob = new Blob([fileBuffer], { type: file.type })\n          const ocrFormData = new FormData()\n          ocrFormData.append('file', blob, file.name)\n          ocrFormData.append('language', 'kor')\n          ocrFormData.append('isOverlayRequired', 'false')\n          ocrFormData.append('detectOrientation', 'true')\n          ocrFormData.append('scale', 'true')\n          ocrFormData.append('OCREngine', '2')\n          ocrFormData.append('apikey', ocrApiKey)\n          \n          const ocrResponse = await fetch('https://api.ocr.space/parse/image', {\n            method: 'POST',\n            body: ocrFormData\n          })\n          \n          const ocrData = await ocrResponse.json()\n          console.log('OCR.space response (file upload):', JSON.stringify(ocrData))\n          \n          if (ocrData.IsErroredOnProcessing === false && ocrData.ParsedResults && ocrData.ParsedResults.length > 0) {\n            extractedText = ocrData.ParsedResults[0].ParsedText\n            \n            if (extractedText && extractedText.trim().length > 0) {\n              // Update database with extracted text\n              await db.prepare(\n                `UPDATE uploaded_files \n                 SET extracted_text = ?, processing_status = ?, processed_at = CURRENT_TIMESTAMP\n                 WHERE id = ?`\n              ).bind(extractedText, 'completed', uploadedFileId).run()\n              \n              // Log OCR step\n              await logProcessingStep(\n                db,\n                uploadedFileId,\n                'ocr',\n                'completed',\n                `ì¶”ì¶œëœ í…ìŠ¤íŠ¸: ${extractedText.length} characters (OCR.space fallback)`,\n                Date.now() - startTime\n              )\n            } else {\n              console.error('OCR.space: Empty text extracted')\n              throw new Error('OCR.space fallback: ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')\n            }\n          } else {\n            const errorMsg = ocrData.ErrorMessage && ocrData.ErrorMessage.length > 0 \n              ? ocrData.ErrorMessage.join(', ') \n              : `OCR.space ì˜¤ë¥˜: ${JSON.stringify(ocrData)}`\n            console.error('OCR.space failed:', errorMsg)\n            throw new Error(errorMsg)\n          }\n        }\n      } else {\n        // No Google credentials - use OCR.space as primary\n        const ocrApiKey = c.env.OCR_SPACE_API_KEY || 'K87899142388957'\n        \n        console.log('Uploading file directly to OCR.space (primary)...')\n        \n        // Create a File-like object from ArrayBuffer\n        const blob = new Blob([fileBuffer], { type: file.type })\n        const ocrFormData = new FormData()\n        ocrFormData.append('file', blob, file.name)\n        ocrFormData.append('language', 'kor')\n        ocrFormData.append('isOverlayRequired', 'false')\n        ocrFormData.append('detectOrientation', 'true')\n        ocrFormData.append('scale', 'true')\n        ocrFormData.append('OCREngine', '2')\n        ocrFormData.append('apikey', ocrApiKey)\n        \n        const ocrResponse = await fetch('https://api.ocr.space/parse/image', {\n          method: 'POST',\n          body: ocrFormData\n        })\n        \n        const ocrData = await ocrResponse.json()\n        console.log('OCR.space response (file upload, primary):', JSON.stringify(ocrData))\n        \n        if (ocrData.IsErroredOnProcessing === false && ocrData.ParsedResults && ocrData.ParsedResults.length > 0) {\n          extractedText = ocrData.ParsedResults[0].ParsedText\n          \n          if (extractedText && extractedText.trim().length > 0) {\n            // Update database with extracted text\n            await db.prepare(\n              `UPDATE uploaded_files \n               SET extracted_text = ?, processing_status = ?, processed_at = CURRENT_TIMESTAMP\n               WHERE id = ?`\n            ).bind(extractedText, 'completed', uploadedFileId).run()\n            \n            // Log OCR step\n            await logProcessingStep(\n              db,\n              uploadedFileId,\n              'ocr',\n              'completed',\n              `ì¶”ì¶œëœ í…ìŠ¤íŠ¸: ${extractedText.length} characters (OCR.space)`,\n              Date.now() - startTime\n            )\n          } else {\n            console.error('OCR.space: Empty text extracted')\n            throw new Error('ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')\n          }\n        } else {\n          const errorMsg = ocrData.ErrorMessage && ocrData.ErrorMessage.length > 0 \n            ? ocrData.ErrorMessage.join(', ') \n            : `OCR.space ì˜¤ë¥˜: ${JSON.stringify(ocrData)}`\n          console.error('OCR.space failed:', errorMsg)\n          throw new Error(errorMsg)\n        }\n      }\n    } catch (error) {\n      console.error('All OCR methods failed:', error)\n      \n      // All OCR methods failed - mark as completed without text\n      await db.prepare(\n        `UPDATE uploaded_files \n         SET processing_status = ?, processed_at = CURRENT_TIMESTAMP\n         WHERE id = ?`\n      ).bind('completed', uploadedFileId).run()\n      \n      await logProcessingStep(\n        db,\n        uploadedFileId,\n        'ocr',\n        'failed',\n        `ëª¨ë“  OCR ë°©ë²• ì‹¤íŒ¨: ${String(error)}`,\n        Date.now() - startTime\n      )\n    }\n    \n    // Return response with OCR status\n    if (!extractedText || extractedText.trim().length === 0) {\n      return c.json({\n        success: false,\n        error: 'ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ê°€ ëª…í™•í•œì§€, í…ìŠ¤íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.',\n        file_id: uploadedFileId,\n        file_name: file.name,\n        storage_url: r2Result.url,\n        extracted_text: null,\n        ocr_available: !!credentialsJson\n      }, 400)\n    }\n    \n    return c.json({\n      success: true,\n      file_id: uploadedFileId,\n      file_name: file.name,\n      storage_url: r2Result.url,\n      extracted_text: extractedText,\n      ocr_available: !!credentialsJson\n    })\n  } catch (error) {\n    console.error('Image upload error:', error)\n    return c.json({ error: 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ ì‹¤íŒ¨', details: String(error) }, 500)\n  }\n})\n\n/**\n * POST /api/upload/pdf - Upload and process PDF file\n */\napp.post('/api/upload/pdf', async (c) => {\n  try {\n    const user = await getUserFromSession(c)\n    const student = await getStudentFromSession(c)\n    \n    // Either teacher or student must be logged in\n    if (!user && !student) {\n      return c.json({ error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' }, 401)\n    }\n    \n    const db = c.env.DB\n    const credentialsJson = c.env.GOOGLE_APPLICATION_CREDENTIALS\n    \n    // Parse multipart form data\n    const formData = await c.req.formData()\n    const file = formData.get('file') as File\n    const submissionId = formData.get('submission_id') as string | null\n    \n    if (!file) {\n      return c.json({ error: 'íŒŒì¼ì´ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤' }, 400)\n    }\n    \n    // Get allowed types and max size from environment\n    const maxSize = parseInt(c.env.MAX_FILE_SIZE || '10485760') // 10MB default\n    const allowedTypes = (c.env.ALLOWED_PDF_TYPES || 'application/pdf').split(',')\n    \n    // Validate file\n    const validation = validateFile(file, allowedTypes, maxSize)\n    if (!validation.valid) {\n      return c.json({ error: validation.error }, 400)\n    }\n    \n    // Generate storage key\n    const storageKey = generateStorageKey(user?.id || student?.id || null, file.name)\n    \n    // Read file as ArrayBuffer\n    const fileBuffer = await file.arrayBuffer()\n    \n    // Upload to R2 storage\n    const r2Bucket = c.env.R2_BUCKET\n    const r2Result = await uploadToR2(r2Bucket, storageKey, fileBuffer, file.type)\n    \n    if (!r2Result.success) {\n      return c.json({ error: r2Result.error || 'R2 ì—…ë¡œë“œ ì‹¤íŒ¨' }, 500)\n    }\n    \n    // Store file metadata in database\n    const result = await db.prepare(\n      `INSERT INTO uploaded_files \n       (user_id, student_user_id, submission_id, file_name, file_type, mime_type, file_size, storage_key, storage_url, processing_status)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\n    ).bind(\n      user?.id || null,\n      student?.id || null,\n      submissionId || null,\n      file.name,\n      'pdf',\n      file.type,\n      file.size,\n      storageKey,\n      r2Result.url || null,\n      'processing'\n    ).run()\n    \n    const uploadedFileId = result.meta.last_row_id as number\n    \n    // Log upload step\n    await logProcessingStep(db, uploadedFileId, 'upload', 'completed', 'R2 ì—…ë¡œë“œ ë° ë©”íƒ€ë°ì´í„° ì €ì¥ ì™„ë£Œ', null)\n    \n    // For PDF files, use OCR.space API\n    // OCR.space natively supports PDF files and works well in Cloudflare Workers\n    try {\n      const ocrSpaceApiKey = c.env.OCR_SPACE_API_KEY\n      \n      if (!ocrSpaceApiKey) {\n        throw new Error('OCR.space API key not configured')\n      }\n      \n      await logProcessingStep(\n        db,\n        uploadedFileId,\n        'pdf_processing',\n        'started',\n        'PDF OCR ì²˜ë¦¬ ì‹œì‘ (OCR.space)...',\n        null\n      )\n      \n      const ocrResult = await processOCRSpace(\n        { name: file.name, buffer: fileBuffer, type: file.type, size: file.size },\n        ocrSpaceApiKey\n      )\n      \n      if (ocrResult.success && ocrResult.extractedText) {\n        await db.prepare(\n          `UPDATE uploaded_files \n           SET extracted_text = ?, processing_status = ?, processed_at = CURRENT_TIMESTAMP\n           WHERE id = ?`\n        ).bind(ocrResult.extractedText, 'completed', uploadedFileId).run()\n        \n        await logProcessingStep(\n          db,\n          uploadedFileId,\n          'pdf_ocr',\n          'completed',\n          `ì¶”ì¶œëœ í…ìŠ¤íŠ¸ (OCR): ${ocrResult.extractedText.length} characters`,\n          ocrResult.processingTimeMs || null\n        )\n        \n        return c.json({\n          success: true,\n          file_id: uploadedFileId,\n          file_name: file.name,\n          extracted_text: ocrResult.extractedText,\n          method: 'ocr',\n          processing_time_ms: ocrResult.processingTimeMs\n        })\n      } else {\n        throw new Error(ocrResult.error || 'PDF OCR failed')\n      }\n    } catch (error) {\n      // Log error\n      await db.prepare(\n        `UPDATE uploaded_files \n         SET processing_status = ?, error_message = ?, processed_at = CURRENT_TIMESTAMP\n         WHERE id = ?`\n      ).bind('failed', String(error), uploadedFileId).run()\n      \n      await logProcessingStep(db, uploadedFileId, 'pdf_processing', 'failed', String(error), null)\n      \n      throw error\n    }\n  } catch (error) {\n    console.error('PDF upload error:', error)\n    return c.json({ error: 'PDF ì—…ë¡œë“œ ì²˜ë¦¬ ì‹¤íŒ¨', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/upload/:id - Get uploaded file details\n */\napp.get('/api/upload/:id', async (c) => {\n  try {\n    const user = await getUserFromSession(c)\n    const student = await getStudentFromSession(c)\n    \n    if (!user && !student) {\n      return c.json({ error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' }, 401)\n    }\n    \n    const fileId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Get file details\n    const file = await db.prepare(\n      `SELECT * FROM uploaded_files WHERE id = ? AND (user_id = ? OR student_user_id = ?)`\n    ).bind(fileId, user?.id || null, student?.id || null).first()\n    \n    if (!file) {\n      return c.json({ error: 'íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)\n    }\n    \n    // Get processing logs\n    const logs = await db.prepare(\n      `SELECT * FROM file_processing_log WHERE uploaded_file_id = ? ORDER BY created_at`\n    ).bind(fileId).all()\n    \n    return c.json({\n      file,\n      processing_logs: logs.results || []\n    })\n  } catch (error) {\n    console.error('Get file error:', error)\n    return c.json({ error: 'íŒŒì¼ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }, 500)\n  }\n})\n\n/**\n * DELETE /api/upload/:id - Delete uploaded file\n */\napp.delete('/api/upload/:id', async (c) => {\n  try {\n    const user = await getUserFromSession(c)\n    const student = await getStudentFromSession(c)\n    \n    if (!user && !student) {\n      return c.json({ error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' }, 401)\n    }\n    \n    const fileId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    const r2Bucket = c.env.R2_BUCKET\n    \n    // Get file info first\n    const file = await db.prepare(\n      'SELECT storage_key FROM uploaded_files WHERE id = ? AND (user_id = ? OR student_user_id = ?)'\n    ).bind(fileId, user?.id || null, student?.id || null).first()\n    \n    if (!file) {\n      return c.json({ error: 'íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)\n    }\n    \n    // Delete from R2\n    const r2Result = await deleteFromR2(r2Bucket, file.storage_key as string)\n    \n    if (!r2Result.success) {\n      console.error('R2 delete failed:', r2Result.error)\n      // Continue to delete from database even if R2 delete fails\n    }\n    \n    // Delete from database\n    await db.prepare(\n      'DELETE FROM uploaded_files WHERE id = ?'\n    ).bind(fileId).run()\n    \n    return c.json({ success: true })\n  } catch (error) {\n    console.error('Delete file error:', error)\n    return c.json({ error: 'íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }, 500)\n  }\n})\n\n/**\n * POST /api/auth/signup - User signup\n */\napp.post('/api/auth/signup', async (c) => {\n  try {\n    const { name, email, password } = await c.req.json()\n    const db = c.env.DB\n    \n    // Check if user already exists\n    const existingUser = await db.prepare(\n      'SELECT id FROM users WHERE email = ?'\n    ).bind(email).first()\n    \n    if (existingUser) {\n      return c.json({ error: 'Email already registered' }, 400)\n    }\n    \n    // In production, use proper password hashing (bcrypt)\n    // For now, we'll use a simple hash (NOT SECURE - replace in production)\n    const passwordHash = btoa(password) // Simple base64 encoding - INSECURE!\n    \n    // Insert new user\n    const result = await db.prepare(\n      'INSERT INTO users (name, email, password_hash) VALUES (?, ?, ?)'\n    ).bind(name, email, passwordHash).run()\n    \n    // Create free subscription\n    await db.prepare(\n      'INSERT INTO subscriptions (user_id, plan_type, billing_cycle) VALUES (?, ?, ?)'\n    ).bind(result.meta.last_row_id, 'free', 'monthly').run()\n    \n    return c.json({ success: true, user_id: result.meta.last_row_id })\n  } catch (error) {\n    console.error('Signup error:', error)\n    return c.json({ error: 'Failed to create account' }, 500)\n  }\n})\n\n/**\n * POST /api/auth/login - User login\n */\napp.post('/api/auth/login', async (c) => {\n  try {\n    const { email, password } = await c.req.json()\n    const db = c.env.DB\n    \n    // Find user\n    const user = await db.prepare(\n      'SELECT id, name, email, password_hash FROM users WHERE email = ?'\n    ).bind(email).first()\n    \n    if (!user) {\n      return c.json({ error: 'Invalid email or password' }, 401)\n    }\n    \n    // Verify password (in production, use bcrypt.compare)\n    const passwordHash = btoa(password)\n    if (passwordHash !== user.password_hash) {\n      return c.json({ error: 'Invalid email or password' }, 401)\n    }\n    \n    // Create session\n    const sessionId = crypto.randomUUID()\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 days\n    \n    await db.prepare(\n      'INSERT INTO sessions (id, user_id, expires_at) VALUES (?, ?, ?)'\n    ).bind(sessionId, user.id, expiresAt.toISOString()).run()\n    \n    return c.json({\n      success: true,\n      session_id: sessionId,\n      user: {\n        id: user.id,\n        name: user.name,\n        email: user.email\n      }\n    })\n  } catch (error) {\n    console.error('Login error:', error)\n    return c.json({ error: 'Failed to login' }, 500)\n  }\n})\n\n/**\n * POST /api/auth/logout - User logout\n */\napp.post('/api/auth/logout', async (c) => {\n  try {\n    const { session_id } = await c.req.json()\n    const db = c.env.DB\n    \n    await db.prepare(\n      'DELETE FROM sessions WHERE id = ?'\n    ).bind(session_id).run()\n    \n    return c.json({ success: true })\n  } catch (error) {\n    console.error('Logout error:', error)\n    return c.json({ error: 'Failed to logout' }, 500)\n  }\n})\n\n/**\n * POST /api/student/auth/signup - Student signup\n */\napp.post('/api/student/auth/signup', async (c) => {\n  try {\n    const { name, email, password, grade_level } = await c.req.json()\n    const db = c.env.DB\n    \n    // Check if student already exists\n    const existingStudent = await db.prepare(\n      'SELECT id FROM student_users WHERE email = ?'\n    ).bind(email).first()\n    \n    if (existingStudent) {\n      return c.json({ error: 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤' }, 400)\n    }\n    \n    // Simple password hashing (use bcrypt in production)\n    const passwordHash = btoa(password)\n    \n    // Insert new student\n    const result = await db.prepare(\n      'INSERT INTO student_users (name, email, password_hash, grade_level) VALUES (?, ?, ?, ?)'\n    ).bind(name, email, passwordHash, grade_level).run()\n    \n    return c.json({ success: true, student_id: result.meta.last_row_id })\n  } catch (error) {\n    console.error('Student signup error:', error)\n    return c.json({ error: 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }, 500)\n  }\n})\n\n/**\n * POST /api/student/auth/login - Student login\n */\napp.post('/api/student/auth/login', async (c) => {\n  try {\n    const { email, password } = await c.req.json()\n    const db = c.env.DB\n    \n    // Find student\n    const student = await db.prepare(\n      'SELECT id, name, email, password_hash, grade_level FROM student_users WHERE email = ?'\n    ).bind(email).first()\n    \n    if (!student) {\n      return c.json({ error: 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' }, 401)\n    }\n    \n    // Verify password\n    const passwordHash = btoa(password)\n    if (passwordHash !== student.password_hash) {\n      return c.json({ error: 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' }, 401)\n    }\n    \n    // Create session\n    const sessionId = crypto.randomUUID()\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 days\n    \n    await db.prepare(\n      'INSERT INTO student_sessions (id, student_id, expires_at) VALUES (?, ?, ?)'\n    ).bind(sessionId, student.id, expiresAt.toISOString()).run()\n    \n    return c.json({\n      success: true,\n      session_id: sessionId,\n      student: {\n        id: student.id,\n        name: student.name,\n        email: student.email,\n        grade_level: student.grade_level\n      }\n    })\n  } catch (error) {\n    console.error('Student login error:', error)\n    return c.json({ error: 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }, 500)\n  }\n})\n\n/**\n * Helper function to get student from session\n */\nasync function getStudentFromSession(c: any) {\n  const sessionId = c.req.header('X-Student-Session-ID')\n  if (!sessionId) return null\n  \n  const db = c.env.DB\n  const session = await db.prepare(\n    'SELECT s.*, u.id as student_id, u.name, u.email, u.grade_level FROM student_sessions s JOIN student_users u ON s.student_id = u.id WHERE s.id = ? AND s.expires_at > datetime(\"now\")'\n  ).bind(sessionId).first()\n  \n  if (!session) return null\n  \n  return {\n    id: session.student_id as number,\n    name: session.name as string,\n    email: session.email as string,\n    grade_level: session.grade_level as string\n  }\n}\n\n/**\n * Helper function to require student authentication\n */\nasync function requireStudentAuth(c: any) {\n  const student = await getStudentFromSession(c)\n  if (!student) {\n    return c.json({ error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' }, 401)\n  }\n  return student\n}\n\n/**\n * GET /api/assignments - Get user's assignments\n */\napp.get('/api/assignments', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const db = c.env.DB\n    \n    const result = await db.prepare(\n      'SELECT * FROM assignments WHERE user_id = ? ORDER BY created_at DESC'\n    ).bind(user.id).all()\n    \n    return c.json(result.results || [])\n  } catch (error) {\n    console.error('Error fetching assignments:', error)\n    return c.json({ error: 'Failed to fetch assignments' }, 500)\n  }\n})\n\n/**\n * POST /api/assignments - Create new assignment\n */\napp.post('/api/assignments', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const { title, description, grade_level, due_date, rubric_criteria, prompts } = await c.req.json()\n    const db = c.env.DB\n    \n    // Create assignment without access code (will be generated later if needed)\n    const promptsJSON = prompts ? JSON.stringify(prompts) : null\n    const result = await db.prepare(\n      'INSERT INTO assignments (user_id, title, description, grade_level, due_date, prompts, access_code) VALUES (?, ?, ?, ?, ?, ?, NULL)'\n    ).bind(user.id, title, description, grade_level, due_date, promptsJSON).run()\n    \n    const assignmentId = result.meta.last_row_id\n    \n    // Add rubric criteria\n    if (rubric_criteria && rubric_criteria.length > 0) {\n      for (const criterion of rubric_criteria) {\n        await db.prepare(\n          'INSERT INTO assignment_rubrics (assignment_id, criterion_name, criterion_description, criterion_order) VALUES (?, ?, ?, ?)'\n        ).bind(assignmentId, criterion.name, criterion.description, criterion.order).run()\n      }\n    }\n    \n    return c.json({ success: true, assignment_id: assignmentId })\n  } catch (error) {\n    console.error('Error creating assignment:', error)\n    return c.json({ error: 'Failed to create assignment' }, 500)\n  }\n})\n\n/**\n * GET /api/assignment/code/:accessCode - Get assignment by access code (for students)\n */\napp.get('/api/assignment/code/:accessCode', async (c) => {\n  try {\n    const accessCode = c.req.param('accessCode')\n    const db = c.env.DB\n    \n    // Find assignment by access code\n    const assignment = await db.prepare(\n      'SELECT * FROM assignments WHERE access_code = ?'\n    ).bind(accessCode).first()\n    \n    if (!assignment) {\n      return c.json({ error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì•¡ì„¸ìŠ¤ ì½”ë“œì…ë‹ˆë‹¤.' }, 404)\n    }\n    \n    // Parse prompts if exists\n    if (assignment.prompts) {\n      try {\n        assignment.prompts = JSON.parse(assignment.prompts)\n      } catch (e) {\n        assignment.prompts = []\n      }\n    } else {\n      assignment.prompts = []\n    }\n    \n    // Get rubrics\n    const rubrics = await db.prepare(\n      'SELECT * FROM assignment_rubrics WHERE assignment_id = ? ORDER BY criterion_order'\n    ).bind(assignment.id).all()\n    \n    assignment.rubrics = rubrics.results || []\n    \n    return c.json(assignment)\n  } catch (error) {\n    console.error('Error fetching assignment by access code:', error)\n    return c.json({ error: 'ê³¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' }, 500)\n  }\n})\n\n/**\n * POST /api/assignment/:id/generate-access-code - Generate access code for assignment\n */\napp.post('/api/assignment/:id/generate-access-code', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const assignmentId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Verify assignment ownership\n    const assignment = await db.prepare(\n      'SELECT * FROM assignments WHERE id = ? AND user_id = ?'\n    ).bind(assignmentId, user.id).first()\n    \n    if (!assignment) {\n      return c.json({ error: 'Assignment not found or access denied' }, 404)\n    }\n    \n    // Check if access code already exists\n    if (assignment.access_code) {\n      return c.json({ access_code: assignment.access_code })\n    }\n    \n    // Generate unique 6-digit access code\n    let accessCode = ''\n    let isUnique = false\n    while (!isUnique) {\n      accessCode = Math.floor(100000 + Math.random() * 900000).toString()\n      const existing = await db.prepare(\n        'SELECT id FROM assignments WHERE access_code = ?'\n      ).bind(accessCode).first()\n      if (!existing) isUnique = true\n    }\n    \n    // Update assignment with access code\n    await db.prepare(\n      'UPDATE assignments SET access_code = ? WHERE id = ?'\n    ).bind(accessCode, assignmentId).run()\n    \n    return c.json({ success: true, access_code: accessCode })\n  } catch (error) {\n    console.error('Error generating access code:', error)\n    return c.json({ error: 'Failed to generate access code' }, 500)\n  }\n})\n\n/**\n * GET /api/assignment/:id - Get assignment details with submissions\n */\napp.get('/api/assignment/:id', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const assignmentId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Get assignment and verify ownership\n    const assignment = await db.prepare(\n      'SELECT * FROM assignments WHERE id = ? AND user_id = ?'\n    ).bind(assignmentId, user.id).first()\n    \n    if (!assignment) {\n      return c.json({ error: 'Assignment not found or access denied' }, 404)\n    }\n    \n    // Get rubrics\n    const rubrics = await db.prepare(\n      'SELECT * FROM assignment_rubrics WHERE assignment_id = ? ORDER BY criterion_order'\n    ).bind(assignmentId).all()\n    \n    // Get submissions with grading results\n    const submissions = await db.prepare(\n      `SELECT s.*, gr.total_score as overall_score, gr.overall_comment as overall_feedback \n       FROM student_submissions s \n       LEFT JOIN grading_results gr ON s.grade_result_id = gr.id \n       WHERE s.assignment_id = ? \n       ORDER BY s.submitted_at DESC`\n    ).bind(assignmentId).all()\n    \n    // Parse prompts from JSON\n    const parsedAssignment = {\n      ...assignment,\n      prompts: assignment.prompts ? JSON.parse(assignment.prompts) : [],\n      rubrics: rubrics.results || [],\n      submissions: submissions.results || []\n    }\n    \n    return c.json(parsedAssignment)\n  } catch (error) {\n    console.error('Error fetching assignment:', error)\n    return c.json({ error: 'Failed to fetch assignment' }, 500)\n  }\n})\n\n/**\n * POST /api/assignment/:id/submission - Add student submission\n */\napp.post('/api/assignment/:id/submission', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const assignmentId = parseInt(c.req.param('id'))\n    const { student_name, essay_text } = await c.req.json()\n    const db = c.env.DB\n    \n    // Verify assignment ownership\n    const assignment = await db.prepare(\n      'SELECT id FROM assignments WHERE id = ? AND user_id = ?'\n    ).bind(assignmentId, user.id).first()\n    \n    if (!assignment) {\n      return c.json({ error: 'Assignment not found or access denied' }, 404)\n    }\n    \n    const result = await db.prepare(\n      'INSERT INTO student_submissions (assignment_id, student_name, essay_text) VALUES (?, ?, ?)'\n    ).bind(assignmentId, student_name, essay_text).run()\n    \n    return c.json({ success: true, submission_id: result.meta.last_row_id })\n  } catch (error) {\n    console.error('Error creating submission:', error)\n    return c.json({ error: 'Failed to create submission' }, 500)\n  }\n})\n\n/**\n * DELETE /api/assignment/:id - Delete assignment\n */\napp.delete('/api/assignment/:id', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const assignmentId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Verify ownership before deleting\n    await db.prepare('DELETE FROM assignments WHERE id = ? AND user_id = ?').bind(assignmentId, user.id).run()\n    \n    return c.json({ success: true })\n  } catch (error) {\n    console.error('Error deleting assignment:', error)\n    return c.json({ error: 'Failed to delete assignment' }, 500)\n  }\n})\n\n/**\n * POST /api/assignment/:id/access-code - Generate access code for assignment\n */\napp.post('/api/assignment/:id/access-code', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user\n    \n    const assignmentId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Verify ownership\n    const assignment = await db.prepare(\n      'SELECT id FROM assignments WHERE id = ? AND user_id = ?'\n    ).bind(assignmentId, user.id).first()\n    \n    if (!assignment) {\n      return c.json({ error: 'Assignment not found' }, 404)\n    }\n    \n    // Check if access code already exists\n    const existing = await db.prepare(\n      'SELECT access_code FROM assignment_access_codes WHERE assignment_id = ?'\n    ).bind(assignmentId).first()\n    \n    if (existing) {\n      return c.json({ access_code: existing.access_code })\n    }\n    \n    // Generate 6-digit access code\n    const accessCode = Math.floor(100000 + Math.random() * 900000).toString()\n    \n    await db.prepare(\n      'INSERT INTO assignment_access_codes (assignment_id, access_code) VALUES (?, ?)'\n    ).bind(assignmentId, accessCode).run()\n    \n    return c.json({ access_code: accessCode })\n  } catch (error) {\n    console.error('Error generating access code:', error)\n    return c.json({ error: 'Failed to generate access code' }, 500)\n  }\n})\n\n/**\n * GET /api/student/assignment/:code - Get assignment by access code\n */\napp.get('/api/student/assignment/:code', async (c) => {\n  try {\n    const student = await requireStudentAuth(c)\n    if (!student.id) return student\n    \n    const accessCode = c.req.param('code')\n    const db = c.env.DB\n    \n    // Find assignment by access code\n    const result = await db.prepare(\n      `SELECT a.id, a.title, a.description, a.grade_level, a.due_date\n       FROM assignments a\n       JOIN assignment_access_codes ac ON a.id = ac.assignment_id\n       WHERE ac.access_code = ?`\n    ).bind(accessCode).first()\n    \n    if (!result) {\n      return c.json({ error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì•¡ì„¸ìŠ¤ ì½”ë“œì…ë‹ˆë‹¤' }, 404)\n    }\n    \n    // Get rubrics\n    const rubrics = await db.prepare(\n      'SELECT criterion_name, criterion_description FROM assignment_rubrics WHERE assignment_id = ? ORDER BY criterion_order'\n    ).bind(result.id).all()\n    \n    return c.json({\n      ...result,\n      rubrics: rubrics.results || []\n    })\n  } catch (error) {\n    console.error('Error fetching assignment:', error)\n    return c.json({ error: 'Failed to fetch assignment' }, 500)\n  }\n})\n\n/**\n * POST /api/student/submit - Submit student essay\n */\napp.post('/api/student/submit', async (c) => {\n  try {\n    const student = await requireStudentAuth(c)\n    if (!student.id) return student\n    \n    const { access_code, essay_text } = await c.req.json()\n    const db = c.env.DB\n    \n    console.log('[DEBUG] Student submit - access_code:', access_code, 'student_id:', student.id)\n    \n    // Find assignment by access code directly from assignments table\n    const assignment = await db.prepare(\n      'SELECT id FROM assignments WHERE access_code = ?'\n    ).bind(access_code).first()\n    \n    console.log('[DEBUG] Assignment found:', assignment)\n    \n    if (!assignment) {\n      return c.json({ \n        error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì•¡ì„¸ìŠ¤ ì½”ë“œì…ë‹ˆë‹¤. êµì‚¬ì—ê²Œ ì •í™•í•œ 6ìë¦¬ ì½”ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.'\n      }, 404)\n    }\n    \n    // Check if student already submitted\n    const existing = await db.prepare(\n      'SELECT id, submission_version FROM student_submissions WHERE assignment_id = ? AND student_user_id = ? ORDER BY submission_version DESC LIMIT 1'\n    ).bind(assignment.id, student.id).first()\n    \n    let submissionVersion = 1\n    let isResubmission = false\n    let previousSubmissionId = null\n    \n    if (existing) {\n      submissionVersion = (existing.submission_version as number) + 1\n      isResubmission = true\n      previousSubmissionId = existing.id as number\n    }\n    \n    // Insert submission\n    const result = await db.prepare(\n      `INSERT INTO student_submissions \n       (assignment_id, student_name, student_user_id, essay_text, submission_version, is_resubmission, previous_submission_id)\n       VALUES (?, ?, ?, ?, ?, ?, ?)`\n    ).bind(assignment.id, student.name, student.id, essay_text, submissionVersion, isResubmission ? 1 : 0, previousSubmissionId).run()\n    \n    return c.json({ \n      success: true, \n      submission_id: result.meta.last_row_id,\n      is_resubmission: isResubmission,\n      version: submissionVersion\n    })\n  } catch (error) {\n    console.error('Error submitting essay:', error)\n    return c.json({ error: 'Failed to submit essay' }, 500)\n  }\n})\n\n/**\n * POST /api/submission/:id/grade - Grade a student submission\n */\napp.post('/api/submission/:id/grade', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const submissionId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Get grading settings from request body (optional)\n    const body = await c.req.json().catch(() => ({}))\n    const feedbackLevel = body.feedback_level || 'detailed' // 'detailed', 'moderate', 'brief'\n    const gradingStrictness = body.grading_strictness || 'moderate' // 'lenient', 'moderate', 'strict'\n    \n    // Get submission and verify assignment ownership\n    const submission = await db.prepare(\n      `SELECT s.*, a.title as assignment_title, a.description as assignment_prompt, a.grade_level, a.user_id\n       FROM student_submissions s\n       JOIN assignments a ON s.assignment_id = a.id\n       WHERE s.id = ?`\n    ).bind(submissionId).first()\n    \n    if (!submission) {\n      return c.json({ error: 'Submission not found' }, 404)\n    }\n    \n    if (submission.user_id !== user.id) {\n      return c.json({ error: 'Access denied' }, 403)\n    }\n    \n    // Get rubric criteria for this assignment\n    const rubrics = await db.prepare(\n      'SELECT id, criterion_name, criterion_description FROM assignment_rubrics WHERE assignment_id = ? ORDER BY criterion_order'\n    ).bind(submission.assignment_id).all()\n    \n    if (!rubrics.results || rubrics.results.length === 0) {\n      return c.json({ error: 'No rubric criteria found for this assignment' }, 400)\n    }\n    \n    // Build grading request\n    const gradingRequest: GradingRequest = {\n      assignment_prompt: submission.assignment_prompt as string,\n      essay_text: submission.essay_text as string,\n      grade_level: submission.grade_level as string,\n      rubric_criteria: rubrics.results.map((r: any, idx: number) => ({\n        criterion_name: r.criterion_name,\n        criterion_description: r.criterion_description,\n        criterion_order: idx + 1\n      }))\n    }\n    \n    // Create grading session\n    const sessionId = await createGradingSession(db, gradingRequest)\n    \n    // Create essay\n    const essayId = await createEssay(db, sessionId, submission.essay_text as string)\n    \n    // Grade the essay using AI\n    const gradingResult = await gradeEssayHybrid(gradingRequest, c.env)\n    \n    // Store grading result\n    const resultId = await storeGradingResult(db, essayId, sessionId, gradingResult)\n    \n    // Generate detailed feedback with grade-level tone adjustment and custom settings\n    const detailedFeedback = await generateDetailedFeedback({\n      essay_text: submission.essay_text as string,\n      grade_level: submission.grade_level as string,\n      rubric_criteria: rubrics.results.map((r: any) => ({\n        criterion_name: r.criterion_name,\n        criterion_description: r.criterion_description\n      })),\n      criterion_scores: gradingResult.criterion_scores.map((cs: any) => ({\n        criterion_name: cs.criterion_name,\n        score: cs.score,\n        strengths: cs.strengths,\n        areas_for_improvement: cs.areas_for_improvement\n      })),\n      feedback_level: feedbackLevel,\n      grading_strictness: gradingStrictness\n    })\n    \n    // Delete existing feedback for regrade (if any)\n    await db.prepare(\n      'DELETE FROM submission_feedback WHERE submission_id = ?'\n    ).bind(submissionId).run()\n    \n    await db.prepare(\n      'DELETE FROM submission_summary WHERE submission_id = ?'\n    ).bind(submissionId).run()\n    \n    // Store detailed feedback for each criterion\n    for (let i = 0; i < detailedFeedback.criterion_feedbacks.length; i++) {\n      const feedback = detailedFeedback.criterion_feedbacks[i]\n      const rubric = rubrics.results.find((r: any) => r.criterion_name === feedback.criterion_name)\n      \n      if (rubric) {\n        await db.prepare(\n          `INSERT INTO submission_feedback \n           (submission_id, criterion_id, score, positive_feedback, improvement_areas, specific_suggestions)\n           VALUES (?, ?, ?, ?, ?, ?)`\n        ).bind(\n          submissionId,\n          rubric.id,\n          feedback.score,\n          feedback.positive_feedback,\n          feedback.improvement_areas,\n          feedback.specific_suggestions\n        ).run()\n      }\n    }\n    \n    // Store overall summary\n    await db.prepare(\n      `INSERT INTO submission_summary \n       (submission_id, total_score, strengths, weaknesses, overall_comment, improvement_priority, revision_suggestions, next_steps_advice, summary_evaluation)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`\n    ).bind(\n      submissionId,\n      detailedFeedback.overall_summary.total_score,\n      detailedFeedback.overall_summary.strengths,\n      detailedFeedback.overall_summary.weaknesses,\n      detailedFeedback.overall_summary.overall_comment,\n      detailedFeedback.overall_summary.improvement_priority,\n      gradingResult.revision_suggestions || '',\n      gradingResult.next_steps_advice || '',\n      gradingResult.summary_evaluation || ''\n    ).run()\n    \n    // Update submission with grading result\n    await db.prepare(\n      'UPDATE student_submissions SET graded = 1, grade_result_id = ? WHERE id = ?'\n    ).bind(resultId, submissionId).run()\n    \n    // Update student progress tracking\n    const studentUserId = submission.student_user_id\n    if (studentUserId) {\n      const assignmentId = submission.assignment_id\n      \n      // Get previous submissions count and scores\n      const progressData = await db.prepare(\n        `SELECT COUNT(*) as count, MAX(ss.total_score) as best_score\n         FROM student_submissions s\n         LEFT JOIN submission_summary ss ON s.id = ss.submission_id\n         WHERE s.assignment_id = ? AND s.student_user_id = ?`\n      ).bind(assignmentId, studentUserId).first()\n      \n      const submissionCount = (progressData?.count as number) || 0\n      const bestScore = (progressData?.best_score as number) || detailedFeedback.overall_summary.total_score\n      const latestScore = detailedFeedback.overall_summary.total_score\n      \n      // Calculate improvement rate (if there's a previous submission)\n      let improvementRate = 0\n      if (submissionCount > 1 && bestScore) {\n        improvementRate = ((latestScore - bestScore) / bestScore) * 100\n      }\n      \n      // Update or insert progress record\n      await db.prepare(\n        `INSERT INTO student_progress (student_user_id, assignment_id, submission_count, best_score, latest_score, improvement_rate)\n         VALUES (?, ?, ?, ?, ?, ?)\n         ON CONFLICT(student_user_id, assignment_id) DO UPDATE SET\n         submission_count = ?,\n         best_score = MAX(best_score, ?),\n         latest_score = ?,\n         improvement_rate = ?,\n         tracked_at = CURRENT_TIMESTAMP`\n      ).bind(\n        studentUserId, assignmentId, submissionCount, bestScore, latestScore, improvementRate,\n        submissionCount, latestScore, latestScore, improvementRate\n      ).run()\n    }\n    \n    return c.json({\n      success: true,\n      submission_id: submissionId,\n      result_id: resultId,\n      grading_result: gradingResult,\n      detailed_feedback: detailedFeedback\n    })\n  } catch (error) {\n    console.error('Error grading submission:', error)\n    return c.json({ error: 'Failed to grade submission', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/submission/:id - Get submission details\n */\napp.get('/api/submission/:id', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user\n    \n    const submissionId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Get submission with assignment info\n    const submission = await db.prepare(\n      `SELECT s.*, a.title as assignment_title, a.user_id\n       FROM student_submissions s\n       JOIN assignments a ON s.assignment_id = a.id\n       WHERE s.id = ?`\n    ).bind(submissionId).first()\n    \n    if (!submission) {\n      return c.json({ error: 'Submission not found' }, 404)\n    }\n    \n    if (submission.user_id !== user.id) {\n      return c.json({ error: 'Access denied' }, 403)\n    }\n    \n    return c.json(submission)\n  } catch (error) {\n    console.error('Error fetching submission:', error)\n    return c.json({ error: 'Failed to fetch submission', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/submission/:id/feedback - Get feedback for teacher review\n */\napp.get('/api/submission/:id/feedback', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user\n    \n    const submissionId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Verify ownership\n    const submission = await db.prepare(\n      `SELECT s.*, a.user_id \n       FROM student_submissions s\n       JOIN assignments a ON s.assignment_id = a.id\n       WHERE s.id = ?`\n    ).bind(submissionId).first()\n    \n    if (!submission) {\n      return c.json({ error: 'Submission not found' }, 404)\n    }\n    \n    if (submission.user_id !== user.id) {\n      return c.json({ error: 'Access denied' }, 403)\n    }\n    \n    // Get criterion feedbacks\n    const feedbacks = await db.prepare(\n      `SELECT \n        sf.*,\n        ar.criterion_name,\n        ar.criterion_description\n       FROM submission_feedback sf\n       JOIN assignment_rubrics ar ON sf.criterion_id = ar.id\n       WHERE sf.submission_id = ?\n       ORDER BY sf.id`\n    ).bind(submissionId).all()\n    \n    // Get overall summary\n    const summary = await db.prepare(\n      'SELECT * FROM submission_summary WHERE submission_id = ?'\n    ).bind(submissionId).first()\n    \n    return c.json({\n      criteria: feedbacks.results || [],\n      summary: summary || null\n    })\n  } catch (error) {\n    console.error('Error fetching feedback:', error)\n    return c.json({ error: 'Failed to fetch feedback', details: String(error) }, 500)\n  }\n})\n\n/**\n * PUT /api/submission/:id/feedback - Update grading feedback\n */\napp.put('/api/submission/:id/feedback', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user\n    \n    const submissionId = parseInt(c.req.param('id'))\n    const { grading_result } = await c.req.json()\n    const db = c.env.DB\n    \n    // Verify ownership\n    const submission = await db.prepare(\n      `SELECT s.*, a.user_id FROM student_submissions s\n       JOIN assignments a ON s.assignment_id = a.id\n       WHERE s.id = ?`\n    ).bind(submissionId).first()\n    \n    if (!submission) {\n      return c.json({ error: 'Submission not found' }, 404)\n    }\n    \n    if (submission.user_id !== user.id) {\n      return c.json({ error: 'Access denied' }, 403)\n    }\n    \n    // Update submission summary\n    await db.prepare(\n      `UPDATE submission_summary \n       SET total_score = ?, overall_comment = ?\n       WHERE submission_id = ?`\n    ).bind(\n      grading_result.total_score,\n      grading_result.overall_comment,\n      submissionId\n    ).run()\n    \n    // Update criterion feedback\n    for (let i = 0; i < grading_result.criterion_scores.length; i++) {\n      const criterion = grading_result.criterion_scores[i]\n      \n      // Get rubric ID by name\n      const rubric = await db.prepare(\n        `SELECT r.id FROM assignment_rubrics r\n         JOIN assignments a ON r.assignment_id = a.id\n         JOIN student_submissions s ON s.assignment_id = a.id\n         WHERE s.id = ? AND r.criterion_name = ?`\n      ).bind(submissionId, criterion.criterion_name).first()\n      \n      if (rubric) {\n        await db.prepare(\n          `UPDATE submission_feedback \n           SET score = ?, positive_feedback = ?, improvement_areas = ?\n           WHERE submission_id = ? AND criterion_id = ?`\n        ).bind(\n          criterion.score,\n          criterion.strengths,\n          criterion.areas_for_improvement,\n          submissionId,\n          rubric.id\n        ).run()\n      }\n    }\n    \n    // Mark as graded\n    await db.prepare(\n      'UPDATE student_submissions SET graded = 1 WHERE id = ?'\n    ).bind(submissionId).run()\n    \n    return c.json({ success: true })\n  } catch (error) {\n    console.error('Error updating feedback:', error)\n    return c.json({ error: 'Failed to update feedback', details: String(error) }, 500)\n  }\n})\n\n/**\n * GET /api/grading-history - Get user's grading history\n */\napp.get('/api/grading-history', async (c) => {\n  try {\n    const user = await requireAuth(c)\n    if (!user.id) return user // Return error response\n    \n    const db = c.env.DB\n    \n    // Get all graded submissions for user's assignments\n    const result = await db.prepare(\n      `SELECT \n        s.id as submission_id,\n        s.assignment_id,\n        s.student_name,\n        s.submitted_at,\n        a.title as assignment_title,\n        a.grade_level,\n        COALESCE(ss.total_score, gr.total_score) as overall_score,\n        gr.overall_comment as overall_feedback,\n        gr.graded_at\n       FROM student_submissions s\n       JOIN assignments a ON s.assignment_id = a.id\n       LEFT JOIN grading_results gr ON s.grade_result_id = gr.id\n       LEFT JOIN submission_summary ss ON s.id = ss.submission_id\n       WHERE a.user_id = ? AND s.graded = 1\n       ORDER BY s.submitted_at DESC`\n    ).bind(user.id).all()\n    \n    // Get rubric criteria count for each assignment to calculate max score\n    const submissionsWithMaxScore = await Promise.all((result.results || []).map(async (submission: any) => {\n      const criteriaCount = await db.prepare(\n        'SELECT COUNT(*) as count FROM assignment_rubrics WHERE assignment_id = ?'\n      ).bind(submission.assignment_id).first()\n      \n      // Each criterion is worth 4 points, so max score = criteria count Ã— 4\n      const count = (criteriaCount?.count as number) || 1\n      const maxScore = count * 4\n      return {\n        ...submission,\n        max_score: maxScore\n      }\n    }))\n    \n    return c.json(submissionsWithMaxScore)\n  } catch (error) {\n    console.error('Error fetching grading history:', error)\n    return c.json({ error: 'Failed to fetch grading history' }, 500)\n  }\n})\n\n/**\n * GET /api/admin/stats - Get system-wide statistics (Admin only)\n */\napp.get('/api/admin/stats', async (c) => {\n  try {\n    const db = c.env.DB\n    \n    // Total users (teachers)\n    const teacherCount = await db.prepare('SELECT COUNT(*) as count FROM users').first()\n    \n    // Total students\n    const studentCount = await db.prepare('SELECT COUNT(*) as count FROM student_users').first()\n    \n    // Total assignments\n    const assignmentCount = await db.prepare('SELECT COUNT(*) as count FROM assignments').first()\n    \n    // Total submissions\n    const submissionCount = await db.prepare('SELECT COUNT(*) as count FROM student_submissions').first()\n    \n    // Graded submissions\n    const gradedCount = await db.prepare('SELECT COUNT(*) as count FROM student_submissions WHERE graded = 1').first()\n    \n    // Average scores\n    const avgScores = await db.prepare(\n      'SELECT AVG(total_score) as avg_score FROM submission_summary'\n    ).first()\n    \n    // Recent activity (last 7 days)\n    const recentSubmissions = await db.prepare(\n      `SELECT COUNT(*) as count FROM student_submissions \n       WHERE submitted_at > datetime('now', '-7 days')`\n    ).first()\n    \n    const recentGrading = await db.prepare(\n      `SELECT COUNT(*) as count FROM student_submissions \n       WHERE graded = 1 AND submitted_at > datetime('now', '-7 days')`\n    ).first()\n    \n    // Top teachers by submissions\n    const topTeachers = await db.prepare(\n      `SELECT u.name, u.email, COUNT(s.id) as submission_count\n       FROM users u\n       JOIN assignments a ON u.id = a.user_id\n       JOIN student_submissions s ON a.id = s.assignment_id\n       GROUP BY u.id\n       ORDER BY submission_count DESC\n       LIMIT 10`\n    ).all()\n    \n    // Most active students\n    const activeStudents = await db.prepare(\n      `SELECT su.name, su.email, su.grade_level, COUNT(s.id) as submission_count\n       FROM student_users su\n       JOIN student_submissions s ON su.id = s.student_user_id\n       GROUP BY su.id\n       ORDER BY submission_count DESC\n       LIMIT 10`\n    ).all()\n    \n    return c.json({\n      overview: {\n        total_teachers: teacherCount?.count || 0,\n        total_students: studentCount?.count || 0,\n        total_assignments: assignmentCount?.count || 0,\n        total_submissions: submissionCount?.count || 0,\n        graded_submissions: gradedCount?.count || 0,\n        pending_submissions: (submissionCount?.count || 0) - (gradedCount?.count || 0),\n        average_score: avgScores?.avg_score || 0\n      },\n      recent_activity: {\n        submissions_last_7_days: recentSubmissions?.count || 0,\n        graded_last_7_days: recentGrading?.count || 0\n      },\n      top_teachers: topTeachers.results || [],\n      active_students: activeStudents.results || []\n    })\n  } catch (error) {\n    console.error('Error fetching admin stats:', error)\n    return c.json({ error: 'Failed to fetch statistics' }, 500)\n  }\n})\n\n/**\n * GET /api/admin/recent-activity - Get recent system activity\n */\napp.get('/api/admin/recent-activity', async (c) => {\n  try {\n    const db = c.env.DB\n    \n    const activities = await db.prepare(\n      `SELECT \n        'submission' as type,\n        s.id,\n        s.submitted_at as timestamp,\n        s.student_name,\n        a.title as assignment_title,\n        u.name as teacher_name,\n        s.graded\n       FROM student_submissions s\n       JOIN assignments a ON s.assignment_id = a.id\n       JOIN users u ON a.user_id = u.id\n       ORDER BY s.submitted_at DESC\n       LIMIT 50`\n    ).all()\n    \n    return c.json(activities.results || [])\n  } catch (error) {\n    console.error('Error fetching recent activity:', error)\n    return c.json({ error: 'Failed to fetch activity' }, 500)\n  }\n})\n\n/**\n * GET /api/admin/users - Get all users with details\n */\napp.get('/api/admin/users', async (c) => {\n  try {\n    const db = c.env.DB\n    \n    // Teachers\n    const teachers = await db.prepare(\n      `SELECT \n        u.id,\n        u.name,\n        u.email,\n        u.created_at,\n        COUNT(DISTINCT a.id) as assignment_count,\n        COUNT(DISTINCT s.id) as submission_count\n       FROM users u\n       LEFT JOIN assignments a ON u.id = a.user_id\n       LEFT JOIN student_submissions s ON a.id = s.assignment_id\n       GROUP BY u.id\n       ORDER BY u.created_at DESC`\n    ).all()\n    \n    // Students\n    const students = await db.prepare(\n      `SELECT \n        su.id,\n        su.name,\n        su.email,\n        su.grade_level,\n        su.created_at,\n        COUNT(s.id) as submission_count\n       FROM student_users su\n       LEFT JOIN student_submissions s ON su.id = s.student_user_id\n       GROUP BY su.id\n       ORDER BY su.created_at DESC`\n    ).all()\n    \n    return c.json({\n      teachers: teachers.results || [],\n      students: students.results || []\n    })\n  } catch (error) {\n    console.error('Error fetching users:', error)\n    return c.json({ error: 'Failed to fetch users' }, 500)\n  }\n})\n\n/**\n * GET /api/student/my-submissions - Get student's own submissions\n */\napp.get('/api/student/my-submissions', async (c) => {\n  try {\n    const student = await requireStudentAuth(c)\n    if (!student.id) return student\n    \n    const db = c.env.DB\n    \n    const submissions = await db.prepare(\n      `SELECT \n        s.id,\n        s.assignment_id,\n        s.submitted_at,\n        s.graded,\n        s.submission_version,\n        s.is_resubmission,\n        a.title as assignment_title,\n        a.grade_level,\n        ss.total_score,\n        ss.strengths,\n        ss.weaknesses\n       FROM student_submissions s\n       JOIN assignments a ON s.assignment_id = a.id\n       LEFT JOIN submission_summary ss ON s.id = ss.submission_id\n       WHERE s.student_user_id = ?\n       ORDER BY s.submitted_at DESC`\n    ).bind(student.id).all()\n    \n    return c.json(submissions.results || [])\n  } catch (error) {\n    console.error('Error fetching student submissions:', error)\n    return c.json({ error: 'ì œì¶œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }, 500)\n  }\n})\n\n/**\n * GET /api/student/submission/:id/feedback - Get detailed feedback for submission\n */\napp.get('/api/student/submission/:id/feedback', async (c) => {\n  try {\n    const student = await requireStudentAuth(c)\n    if (!student.id) return student\n    \n    const submissionId = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    // Verify ownership\n    const submission = await db.prepare(\n      'SELECT id FROM student_submissions WHERE id = ? AND student_user_id = ?'\n    ).bind(submissionId, student.id).first()\n    \n    if (!submission) {\n      return c.json({ error: 'ì œì¶œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, 404)\n    }\n    \n    // Get criterion feedbacks\n    const feedbacks = await db.prepare(\n      `SELECT \n        sf.*,\n        ar.criterion_name,\n        ar.criterion_description\n       FROM submission_feedback sf\n       JOIN assignment_rubrics ar ON sf.criterion_id = ar.id\n       WHERE sf.submission_id = ?\n       ORDER BY sf.id`\n    ).bind(submissionId).all()\n    \n    // Get overall summary\n    const summary = await db.prepare(\n      'SELECT * FROM submission_summary WHERE submission_id = ?'\n    ).bind(submissionId).first()\n    \n    return c.json({\n      criterion_feedbacks: feedbacks.results || [],\n      summary: summary || null\n    })\n  } catch (error) {\n    console.error('Error fetching feedback:', error)\n    return c.json({ error: 'í”¼ë“œë°±ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }, 500)\n  }\n})\n\n/**\n * GET /api/student/progress - Get student's progress across all assignments\n */\napp.get('/api/student/progress', async (c) => {\n  try {\n    const student = await requireStudentAuth(c)\n    if (!student.id) return student\n    \n    const db = c.env.DB\n    \n    const progress = await db.prepare(\n      `SELECT \n        sp.*,\n        a.title as assignment_title\n       FROM student_progress sp\n       JOIN assignments a ON sp.assignment_id = a.id\n       WHERE sp.student_user_id = ?\n       ORDER BY sp.tracked_at DESC`\n    ).bind(student.id).all()\n    \n    return c.json(progress.results || [])\n  } catch (error) {\n    console.error('Error fetching progress:', error)\n    return c.json({ error: 'ì„±ì¥ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }, 500)\n  }\n})\n\n/**\n * GET /api/resources/:category - Get resource posts by category\n */\napp.get('/api/resources/:category', async (c) => {\n  try {\n    const category = c.req.param('category')\n    \n    // Handle exam category (static PDF files)\n    if (category === 'exam') {\n      const examQuestions = [\n        {\n          id: 'exam-1',\n          title: '201001 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì‹ ì„ê¸° í˜ëª… ë†ì—… í˜ëª… ê·¸ë¦° í˜ëª…',\n          content: 'PDF íŒŒì¼',\n          file: '/exam-questions/201001 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì‹ ì„ê¸° í˜ëª… ë†ì—… í˜ëª… ê·¸ë¦° í˜ëª….pdf',\n          author: 'Admin',\n          created_at: '2010-01-01'\n        },\n        {\n          id: 'exam-2',\n          title: '201206 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë…ì¬ ì •ì¹˜ê°€ ì§„ì‹œí™©ì œ í‘œíŠ¸ë¥´ ë£¨ì´14ì„¸',\n          content: 'PDF íŒŒì¼',\n          file: '/exam-questions/201206 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë…ì¬ ì •ì¹˜ê°€ ì§„ì‹œí™©ì œ í‘œíŠ¸ë¥´ ë£¨ì´14ì„¸.pdf',\n          author: 'Admin',\n          created_at: '2012-06-01'\n        },\n        {\n          id: 'exam-3',\n          title: '201506 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë¡œë§ˆ ì œêµ­ ì˜¤ìŠ¤ë§Œ ì œêµ­ ëŒ€ì˜ ì œêµ­ ë©¸ë§',\n          content: 'PDF íŒŒì¼',\n          file: '/exam-questions/201506 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë¡œë§ˆ ì œêµ­ ì˜¤ìŠ¤ë§Œ ì œêµ­ ëŒ€ì˜ ì œêµ­ ë©¸ë§.pdf',\n          author: 'Admin',\n          created_at: '2015-06-01'\n        },\n        {\n          id: 'exam-4',\n          title: '200906 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì¤‘ì„¸ë§ì˜ ì‚¬íšŒ ë³€í™” ì‚°ì—… í˜ëª… ì„¸ê³„í™”',\n          content: 'PDF íŒŒì¼',\n          file: '/exam-questions/200906 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì¤‘ì„¸ë§ì˜ ì‚¬íšŒ ë³€í™” ì‚°ì—… í˜ëª… ì„¸ê³„í™”.pdf',\n          author: 'Admin',\n          created_at: '2009-06-01'\n        }\n      ]\n      return c.json(examQuestions)\n    }\n    \n    // Handle other categories from database\n    const db = c.env.DB\n    \n    const result = await db.prepare(\n      'SELECT * FROM resource_posts WHERE category = ? ORDER BY created_at DESC'\n    ).bind(category).all()\n    \n    return c.json(result.results || [])\n  } catch (error) {\n    console.error('Error fetching resources:', error)\n    return c.json({ error: 'Failed to fetch resources' }, 500)\n  }\n})\n\n/**\n * GET /api/resource/:id - Get single resource post\n */\napp.get('/api/resource/:id', async (c) => {\n  try {\n    const id = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    const result = await db.prepare(\n      'SELECT * FROM resource_posts WHERE id = ?'\n    ).bind(id).first()\n    \n    if (!result) {\n      return c.json({ error: 'Resource not found' }, 404)\n    }\n    \n    return c.json(result)\n  } catch (error) {\n    console.error('Error fetching resource:', error)\n    return c.json({ error: 'Failed to fetch resource' }, 500)\n  }\n})\n\n/**\n * POST /api/admin/resource - Create new resource post (admin only)\n */\napp.post('/api/admin/resource', async (c) => {\n  try {\n    const { category, title, content, author } = await c.req.json()\n    const db = c.env.DB\n    \n    const result = await db.prepare(\n      'INSERT INTO resource_posts (category, title, content, author) VALUES (?, ?, ?, ?)'\n    ).bind(category, title, content, author || 'Admin').run()\n    \n    return c.json({ success: true, id: result.meta.last_row_id })\n  } catch (error) {\n    console.error('Error creating resource:', error)\n    return c.json({ error: 'Failed to create resource' }, 500)\n  }\n})\n\n/**\n * PUT /api/admin/resource/:id - Update resource post (admin only)\n */\napp.put('/api/admin/resource/:id', async (c) => {\n  try {\n    const id = parseInt(c.req.param('id'))\n    const { title, content, author } = await c.req.json()\n    const db = c.env.DB\n    \n    await db.prepare(\n      'UPDATE resource_posts SET title = ?, content = ?, author = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?'\n    ).bind(title, content, author, id).run()\n    \n    return c.json({ success: true })\n  } catch (error) {\n    console.error('Error updating resource:', error)\n    return c.json({ error: 'Failed to update resource' }, 500)\n  }\n})\n\n/**\n * DELETE /api/admin/resource/:id - Delete resource post (admin only)\n */\napp.delete('/api/admin/resource/:id', async (c) => {\n  try {\n    const id = parseInt(c.req.param('id'))\n    const db = c.env.DB\n    \n    await db.prepare('DELETE FROM resource_posts WHERE id = ?').bind(id).run()\n    \n    return c.json({ success: true })\n  } catch (error) {\n    console.error('Error deleting resource:', error)\n    return c.json({ error: 'Failed to delete resource' }, 500)\n  }\n})\n\n// User Guide Page\napp.get('/guide', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ì‚¬ìš©ë²• ì•ˆë‚´ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n        <style>\n          .guide-section {\n            scroll-margin-top: 100px;\n          }\n          .step-number {\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            width: 32px;\n            height: 32px;\n            background: #1e3a8a;\n            color: white;\n            border-radius: 50%;\n            font-weight: bold;\n            margin-right: 12px;\n          }\n          .feature-badge {\n            display: inline-block;\n            background: #dbeafe;\n            color: #1e40af;\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 0.875rem;\n            font-weight: 600;\n            margin-top: 8px;\n          }\n        </style>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/\" class=\"text-gray-700 hover:text-navy-700 font-medium\">í™ˆ</a>\n                        <a href=\"/guide\" class=\"text-navy-700 font-semibold\">ì‚¬ìš©ë²• ì•ˆë‚´</a>\n                        <a href=\"/login?type=teacher\" class=\"bg-navy-900 text-white px-6 py-2 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                            ì‹œì‘í•˜ê¸°\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Hero Section -->\n        <div class=\"bg-gradient-to-r from-navy-900 to-navy-700 text-white py-12\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <h1 class=\"text-4xl font-bold mb-4\">\n                    <i class=\"fas fa-book-open mr-3\"></i>ì‚¬ìš©ë²• ì•ˆë‚´\n                </h1>\n                <p class=\"text-xl text-blue-100\">AI ë…¼ìˆ  ì±„ì  ì„œë¹„ìŠ¤ë¥¼ ì²˜ìŒ ì´ìš©í•˜ì‹œëŠ” êµì‚¬ë¶„ë“¤ì„ ìœ„í•œ ìƒì„¸ ê°€ì´ë“œ</p>\n            </div>\n        </div>\n\n        <!-- Quick Navigation -->\n        <div class=\"bg-white border-b border-gray-200 sticky top-16 z-40\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n                <div class=\"flex flex-wrap gap-3 items-center text-sm\">\n                    <span class=\"font-semibold text-gray-700\">ë°”ë¡œê°€ê¸°:</span>\n                    <a href=\"#section-a\" class=\"text-navy-700 hover:text-navy-900 font-medium\">A. ê³¼ì œ ê´€ë¦¬</a>\n                    <span class=\"text-gray-300\">â€¢</span>\n                    <a href=\"#section-b\" class=\"text-navy-700 hover:text-navy-900 font-medium\">B. í•™ìƒ ë‹µì•ˆ ê´€ë¦¬</a>\n                    <span class=\"text-gray-300\">â€¢</span>\n                    <a href=\"#section-c\" class=\"text-navy-700 hover:text-navy-900 font-medium\">C. ì•¡ì„¸ìŠ¤ ì½”ë“œ</a>\n                    <span class=\"text-gray-300\">â€¢</span>\n                    <a href=\"#section-d\" class=\"text-navy-700 hover:text-navy-900 font-medium\">D. AI ì±„ì </a>\n                    <span class=\"text-gray-300\">â€¢</span>\n                    <a href=\"#section-e\" class=\"text-navy-700 hover:text-navy-900 font-medium\">E. ì±„ì  ì´ë ¥</a>\n                </div>\n            </div>\n        </div>\n\n        <!-- Main Content -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            \n            <!-- Section A: ê³¼ì œ ê´€ë¦¬ -->\n            <section id=\"section-a\" class=\"guide-section mb-16\">\n                <div class=\"bg-white rounded-xl shadow-lg p-8\">\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-6 border-b-4 border-navy-700 pb-3\">\n                        A. ê³¼ì œ ê´€ë¦¬\n                    </h2>\n\n                    <!-- A-1: ìƒˆ ê³¼ì œ ë§Œë“¤ê¸° -->\n                    <div class=\"mb-10\">\n                        <h3 class=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\n                            <i class=\"fas fa-plus-circle text-navy-700 mr-3\"></i>\n                            ìƒˆ ê³¼ì œ ë§Œë“¤ê¸°\n                        </h3>\n                        \n                        <div class=\"space-y-4 ml-8\">\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">1</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">\"ìƒˆ ê³¼ì œ ë§Œë“¤ê¸°\" ë²„íŠ¼ í´ë¦­</p>\n                                    <p class=\"text-gray-600 text-sm mt-1\">ë‚˜ì˜ í˜ì´ì§€ ìš°ì¸¡ ìƒë‹¨ì— ìˆëŠ” íŒŒë€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step1-my-page.png\" alt=\"ë‚˜ì˜ í˜ì´ì§€ - ìƒˆ ê³¼ì œ ë§Œë“¤ê¸° ë²„íŠ¼\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">2</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">ê³¼ì œ ì •ë³´ ì…ë ¥</p>\n                                    <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                        <li><strong>ì œëª©:</strong> ì˜ˆ) \"ì œ2ì°¨ ì„¸ê³„ ëŒ€ì „ì˜ ì›ì¸\"</li>\n                                        <li><strong>ì„¤ëª…:</strong> ì˜ˆ) \"1939ë…„ ì‹œì‘ëœ ì œ2ì°¨ ì„¸ê³„ëŒ€ì „ì€... ê²°ë¡ ì„ ë…¼ìˆ í•˜ì‹œì˜¤\"</li>\n                                        <li><strong>í•™ë…„ ìˆ˜ì¤€:</strong> ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒ (ì´ˆë“±/ì¤‘ë“±/ê³ ë“±)</li>\n                                        <li><strong>ë§ˆê°ì¼:</strong> ë‚ ì§œ ì„ íƒ (ì„ íƒì‚¬í•­)</li>\n                                    </ul>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step2-create-assignment.png\" alt=\"ê³¼ì œ ì •ë³´ ì…ë ¥ í™”ë©´\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">3</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">ì œì‹œë¬¸ ì¶”ê°€ <span class=\"feature-badge\"><i class=\"fas fa-image mr-1\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ ì§€ì›</span></p>\n                                    <ul class=\"list-disc list-inside text-gray-600 space-y-2 ml-4\">\n                                        <li>4ê°œ ê¸°ë³¸ ì œì‹œë¬¸ ì…ë ¥ í•„ë“œ ì œê³µ (ìµœëŒ€ 11ê°œê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥)</li>\n                                        <li>ê° ì œì‹œë¬¸ì— í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥ ë˜ëŠ” ì´ë¯¸ì§€ ì—…ë¡œë“œ</li>\n                                    </ul>\n                                    <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-3\">\n                                        <p class=\"font-semibold text-blue-900 mb-2\"><i class=\"fas fa-magic mr-2\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥</p>\n                                        <ul class=\"list-disc list-inside text-blue-800 text-sm space-y-1 ml-4\">\n                                            <li>\"ì´ë¯¸ì§€ ì—…ë¡œë“œ\" ë²„íŠ¼ í´ë¦­</li>\n                                            <li>ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ (JPG, PNG, WebP, ìµœëŒ€ 10MB)</li>\n                                            <li>ìë™ OCR ì²˜ë¦¬ë¡œ í…ìŠ¤íŠ¸ ì¶”ì¶œ</li>\n                                            <li>ì¶”ì¶œëœ í…ìŠ¤íŠ¸ê°€ ì…ë ¥ í•„ë“œì— ìë™ ì‚½ì…</li>\n                                            <li>ì²˜ë¦¬ ì‹œê°„: ì•½ 5-10ì´ˆ</li>\n                                        </ul>\n                                    </div>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step3-add-prompts.png\" alt=\"ì œì‹œë¬¸ ì¶”ê°€ ë° ë£¨ë¸Œë¦­ ì„¤ì •\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">4</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-3\">ë£¨ë¸Œë¦­ ê¸°ì¤€ ì„¤ì •</p>\n                                    \n                                    <!-- Option A: Platform Rubric -->\n                                    <div class=\"mb-4 bg-blue-50 p-4 rounded-lg border border-blue-200\">\n                                        <p class=\"text-gray-800 font-semibold mb-2\">a. í”Œë«í¼ ë£¨ë¸Œë¦­ ì¤‘ ì„ íƒ</p>\n                                        <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4 text-sm\">\n                                            <li>í”Œë«í¼ ë£¨ë¸Œë¦­ íƒ­ ì„ íƒ (ê¸°ë³¸ê°’)</li>\n                                            <li>ë£¨ë¸Œë¦­ ì¹´ë“œ í´ë¦­ â†’ PDF ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ í™•ì¸</li>\n                                            <li>PDF ë‚´ìš© í™•ì¸ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥)</li>\n                                            <li>\"ì„ íƒí•˜ê¸° â†’\" ë²„íŠ¼ í´ë¦­ â†’ ë£¨ë¸Œë¦­ ì„ íƒ í™•ì¸</li>\n                                        </ul>\n                                        <div class=\"mt-3 flex justify-center\">\n                                            <img src=\"/guide-screenshots/rubric-selection-platform.png\" alt=\"í”Œë«í¼ ë£¨ë¸Œë¦­ ì„ íƒ\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                        </div>\n                                    </div>\n                                    \n                                    <!-- Option B: Custom Rubric -->\n                                    <div class=\"bg-green-50 p-4 rounded-lg border border-green-200\">\n                                        <p class=\"text-gray-800 font-semibold mb-2\">b. ë‚˜ì˜ ë£¨ë¸Œë¦­ ì‘ì„±</p>\n                                        <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4 text-sm\">\n                                            <li>\"ê¸°ì¤€ 1\"ì˜ ì´ë¦„ê³¼ ì„¤ëª…, ìµœëŒ€ ì ìˆ˜ ì…ë ¥</li>\n                                            <li>\"ê¸°ì¤€ 2\"ì˜ ì´ë¦„ê³¼ ì„¤ëª…, ìµœëŒ€ ì ìˆ˜ ì…ë ¥</li>\n                                            <li>\"ê¸°ì¤€ 3\"ì˜ ì´ë¦„ê³¼ ì„¤ëª…, ìµœëŒ€ ì ìˆ˜ ì…ë ¥</li>\n                                            <li>\"ê¸°ì¤€ 4\"ì˜ ì´ë¦„ê³¼ ì„¤ëª…, ìµœëŒ€ ì ìˆ˜ ì…ë ¥</li>\n                                            <li>\"í‰ê°€ ê¸°ì¤€ ì¶”ê°€\" ë²„íŠ¼ í´ë¦­ (ìƒì„¸ ê¸°ì¤€ì´ 5ê°œ ì´ìƒì¼ ê²½ìš°)</li>\n                                        </ul>\n                                        <div class=\"mt-3 flex justify-center\">\n                                            <img src=\"/guide-screenshots/custom-rubric-creation.png\" alt=\"ë‚˜ì˜ ë£¨ë¸Œë¦­ ì‘ì„±\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">5</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">\"ê³¼ì œ ìƒì„±\" ë²„íŠ¼ í´ë¦­</p>\n                                    <p class=\"text-gray-600 text-sm mt-1\">ëª¨ë“  ì •ë³´ ì…ë ¥ í›„ ê³¼ì œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step5-assignment-modal.png\" alt=\"ê³¼ì œ ìƒì„± ëª¨ë‹¬\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- A-2: ê³¼ì œ ìƒì„¸ ì •ë³´ í™•ì¸ ë° ì¶œë ¥ -->\n                    <div class=\"mb-6\">\n                        <h3 class=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\n                            <i class=\"fas fa-info-circle text-navy-700 mr-3\"></i>\n                            ê³¼ì œ ìƒì„¸ ì •ë³´ í™•ì¸ ë° ì¶œë ¥\n                        </h3>\n                        \n                        <div class=\"space-y-4 ml-8\">\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">1</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">ê³¼ì œ ì¹´ë“œ í´ë¦­</p>\n                                    <p class=\"text-gray-600 text-sm mt-1\">ê³¼ì œ ëª©ë¡ì—ì„œ ì›í•˜ëŠ” ê³¼ì œë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ì´ ì—´ë¦½ë‹ˆë‹¤.</p>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step4-assignment-created.png\" alt=\"ê³¼ì œ ìƒì„± ì™„ë£Œ\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">2</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">í‘œì‹œë˜ëŠ” ì •ë³´</p>\n                                    <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                        <li>ê³¼ì œ ì œëª© ë° ì„¤ëª…</li>\n                                        <li>ì œì‹œë¬¸ (ì…ë ¥ëœ ê²½ìš° ëª¨ë‘ í‘œì‹œ)</li>\n                                        <li>í‰ê°€ ë£¨ë¸Œë¦­ (ê¸°ì¤€ ë° ì„¤ëª…)</li>\n                                        <li>í•™ìƒ ì•¡ì„¸ìŠ¤ ì½”ë“œ (ìƒì„±ëœ ê²½ìš°)</li>\n                                    </ul>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step5-assignment-detail.png\" alt=\"ê³¼ì œ ìƒì„¸ ì •ë³´ í™•ì¸\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">3</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">ì¶œë ¥ ê¸°ëŠ¥ <span class=\"feature-badge\"><i class=\"fas fa-print mr-1\"></i>ì¸ì‡„ ê°€ëŠ¥</span></p>\n                                    <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                        <li>ëª¨ë‹¬ ìš°ì¸¡ ìƒë‹¨ \"ì¶œë ¥\" ë²„íŠ¼ í´ë¦­</li>\n                                        <li>ìƒˆ ì°½ì—ì„œ ê³¼ì œ ì „ì²´ ì •ë³´ í‘œì‹œ</li>\n                                        <li>ë‚´ìš© í™•ì¸ í›„ \"ì¶œë ¥\" ë²„íŠ¼ìœ¼ë¡œ ì¸ì‡„</li>\n                                        <li>í¬í•¨ í•­ëª©: ê³¼ì œ ì œëª©, ì„¤ëª…, ì œì‹œë¬¸, í‰ê°€ ë£¨ë¸Œë¦­, í•™ìƒ ì•¡ì„¸ìŠ¤ ì½”ë“œ</li>\n                                    </ul>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">4</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">ê³¼ì œ ì‚­ì œ</p>\n                                    <p class=\"text-gray-600 text-sm mt-1\">\n                                        <i class=\"fas fa-exclamation-triangle text-yellow-600 mr-1\"></i>\n                                        \"ì‚­ì œ\" ë²„íŠ¼ í´ë¦­ ì‹œ ê³¼ì œì™€ ê´€ë ¨ëœ í•™ìƒ ì œì¶œë¬¼ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            <!-- Section B: í•™ìƒ ë‹µì•ˆ ê´€ë¦¬ -->\n            <section id=\"section-b\" class=\"guide-section mb-16\">\n                <div class=\"bg-white rounded-xl shadow-lg p-8\">\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-6 border-b-4 border-navy-700 pb-3\">\n                        B. í•™ìƒ ë‹µì•ˆ ê´€ë¦¬\n                    </h2>\n\n                    <!-- B-1: í…ìŠ¤íŠ¸ë¡œ ë‹µì•ˆ ì¶”ê°€ -->\n                    <div class=\"mb-10\">\n                        <h3 class=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\n                            <i class=\"fas fa-keyboard text-navy-700 mr-3\"></i>\n                            í…ìŠ¤íŠ¸ë¡œ ë‹µì•ˆ ì¶”ê°€\n                        </h3>\n                        \n                        <div class=\"space-y-4 ml-8\">\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">1</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">ê³¼ì œ ì¹´ë“œ í´ë¦­í•˜ì—¬ ìƒì„¸ í˜ì´ì§€ ì—´ê¸°</p>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">2</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">\"ë‹µì•ˆì§€ ì¶”ê°€\" ë²„íŠ¼ í´ë¦­</p>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">3</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">í•™ìƒ ì •ë³´ ì…ë ¥</p>\n                                    <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                        <li>í•™ìƒ ì´ë¦„</li>\n                                        <li>ë…¼ìˆ  ë‚´ìš© (í…ìŠ¤íŠ¸ ì…ë ¥)</li>\n                                    </ul>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">4</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">\"ì¶”ê°€\" ë²„íŠ¼ í´ë¦­</p>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step8-text-input.png\" alt=\"í…ìŠ¤íŠ¸ë¡œ ë‹µì•ˆ ì¶”ê°€\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- B-2: íŒŒì¼ë¡œ ë‹µì•ˆ ì¶”ê°€ -->\n                    <div class=\"mb-6\">\n                        <h3 class=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\n                            <i class=\"fas fa-file-upload text-navy-700 mr-3\"></i>\n                            íŒŒì¼ë¡œ ë‹µì•ˆ ì¶”ê°€ <span class=\"feature-badge\"><i class=\"fas fa-robot mr-1\"></i>AI OCR ì§€ì›</span>\n                        </h3>\n                        \n                        <div class=\"space-y-4 ml-8\">\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">1</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium\">\"íŒŒì¼ ì„ íƒ\" íƒ­ í´ë¦­</p>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">2</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">ì§€ì› íŒŒì¼ í˜•ì‹</p>\n                                    <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                        <li><strong>ì´ë¯¸ì§€:</strong> JPG, PNG, WebP (ìµœëŒ€ 10MB)</li>\n                                        <li><strong>PDF:</strong> í…ìŠ¤íŠ¸/ì´ë¯¸ì§€ ê¸°ë°˜ PDF (ìµœëŒ€ 10MB)</li>\n                                    </ul>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">3</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">íŒŒì¼ ì—…ë¡œë“œ í”„ë¡œì„¸ìŠ¤</p>\n                                    <ol class=\"list-decimal list-inside text-gray-600 space-y-1 ml-4\">\n                                        <li>íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸ì•¤ë“œë¡­</li>\n                                        <li>íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° í™•ì¸</li>\n                                        <li>\"ì¶”ê°€\" ë²„íŠ¼ í´ë¦­</li>\n                                        <li>ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì§„í–‰</li>\n                                        <li>\"ì±„ì í•˜ê¸°\" ë²„íŠ¼ í´ë¦­</li>\n                                        <li>ì¶”ì¶œëœ í…ìŠ¤íŠ¸ë¡œ ì±„ì  ì§„í–‰</li>\n                                    </ol>\n                                </div>\n                            </div>\n\n                            <div class=\"flex items-start\">\n                                <span class=\"step-number\">4</span>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-gray-700 font-medium mb-2\">ì²˜ë¦¬ ì‹œê°„</p>\n                                    <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                        <li>ì´ë¯¸ì§€ OCR: 5-10ì´ˆ</li>\n                                        <li>í…ìŠ¤íŠ¸ PDF: 3-5ì´ˆ</li>\n                                        <li>ì´ë¯¸ì§€ PDF OCR: 10-15ì´ˆ</li>\n                                    </ul>\n                                    <div class=\"mt-3 flex justify-center\">\n                                        <img src=\"/guide-screenshots/step7-add-submission-file.png\" alt=\"íŒŒì¼ë¡œ ë‹µì•ˆ ì¶”ê°€\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            <!-- Section C: ì•¡ì„¸ìŠ¤ ì½”ë“œ ìƒì„± ë° ê³µìœ  -->\n            <section id=\"section-c\" class=\"guide-section mb-16\">\n                <div class=\"bg-white rounded-xl shadow-lg p-8\">\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-6 border-b-4 border-navy-700 pb-3\">\n                        C. ì•¡ì„¸ìŠ¤ ì½”ë“œ ìƒì„± ë° ê³µìœ \n                    </h2>\n\n                    <div class=\"space-y-4 ml-8\">\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">1</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium\">ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ \"ì•¡ì„¸ìŠ¤ ì½”ë“œ ìƒì„±\" ë²„íŠ¼ í´ë¦­</p>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">2</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium\">6ìë¦¬ ìˆ«ì ì½”ë“œ ìë™ ìƒì„±</p>\n                                <p class=\"text-gray-600 text-sm mt-1\">ì˜ˆì‹œ: 123456</p>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">3</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium mb-2\">í•™ìƒë“¤ì—ê²Œ ì½”ë“œ ê³µìœ  ë°©ë²•</p>\n                                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-3\">\n                                    <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-blue-900 mb-2\">\n                                            <i class=\"fas fa-desktop mr-2\"></i>í™”ë©´ ê³µìœ \n                                        </p>\n                                        <p class=\"text-sm text-blue-800\">ê³¼ì œ ìƒì„¸ ëª¨ë‹¬ì—ì„œ ì§ì ‘ ì½”ë“œ í‘œì‹œ</p>\n                                    </div>\n                                    <div class=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-green-900 mb-2\">\n                                            <i class=\"fas fa-print mr-2\"></i>ì¸ì‡„ë¬¼ ë°°í¬\n                                        </p>\n                                        <p class=\"text-sm text-green-800\">\"ì¶œë ¥\" ë²„íŠ¼ìœ¼ë¡œ ì•¡ì„¸ìŠ¤ ì½”ë“œ í¬í•¨í•˜ì—¬ ì¸ì‡„</p>\n                                    </div>\n                                    <div class=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-purple-900 mb-2\">\n                                            <i class=\"fas fa-share-alt mr-2\"></i>ë””ì§€í„¸ ê³µìœ \n                                        </p>\n                                        <p class=\"text-sm text-purple-800\">ì½”ë“œ ë³µì‚¬í•˜ì—¬ ì´ë©”ì¼/ë©”ì‹ ì €ë¡œ ì „ì†¡</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">4</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium\">í•™ìƒë“¤ì´ ì½”ë“œë¡œ ê³¼ì œ ì ‘ê·¼ ë° ì œì¶œ</p>\n                                <p class=\"text-gray-600 text-sm mt-1\">í•™ìƒ ëŒ€ì‹œë³´ë“œì—ì„œ ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ ì…ë ¥í•˜ë©´ ê³¼ì œì— ì ‘ê·¼í•˜ì—¬ ë‹µì•ˆì„ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            <!-- Section D: AI ì±„ì  ë° í”¼ë“œë°± ê²€í†  -->\n            <section id=\"section-d\" class=\"guide-section mb-16\">\n                <div class=\"bg-white rounded-xl shadow-lg p-8\">\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-6 border-b-4 border-navy-700 pb-3\">\n                        D. AI ì±„ì  ë° í”¼ë“œë°± ê²€í† \n                    </h2>\n\n                    <div class=\"space-y-4 ml-8\">\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">1</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium\">ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì œì¶œë¬¼ ëª©ë¡ í™•ì¸</p>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">2</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium\">\"ì±„ì í•˜ê¸°\" ë²„íŠ¼ í´ë¦­</p>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">3</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium\">AI ì±„ì  ì§„í–‰</p>\n                                <p class=\"text-gray-600 text-sm mt-1\">\n                                    <i class=\"fas fa-clock mr-1\"></i>ì†Œìš” ì‹œê°„: ì•½ 10-30ì´ˆ\n                                </p>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">4</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium mb-2\">ì±„ì  ê²°ê³¼ ê²€í†  ëª¨ë‹¬ (Split-Screen Layout)</p>\n                                <div class=\"bg-gray-50 border border-gray-300 rounded-lg p-4 mt-3\">\n                                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                        <div>\n                                            <p class=\"font-semibold text-gray-900 mb-2\">\n                                                <i class=\"fas fa-file-alt text-blue-600 mr-2\"></i>ì™¼ìª½ íŒ¨ë„\n                                            </p>\n                                            <ul class=\"list-disc list-inside text-gray-600 text-sm space-y-1 ml-4\">\n                                                <li>í•™ìƒ ë‹µì•ˆ ì „ì²´ ë‚´ìš©</li>\n                                                <li>ì½ê¸° ì „ìš©</li>\n                                                <li>ìŠ¤í¬ë¡¤ ê°€ëŠ¥</li>\n                                            </ul>\n                                        </div>\n                                        <div>\n                                            <p class=\"font-semibold text-gray-900 mb-2\">\n                                                <i class=\"fas fa-edit text-green-600 mr-2\"></i>ì˜¤ë¥¸ìª½ íŒ¨ë„\n                                            </p>\n                                            <ul class=\"list-disc list-inside text-gray-600 text-sm space-y-1 ml-4\">\n                                                <li>í”¼ë“œë°± ë° í‰ê°€ (í¸ì§‘ ê°€ëŠ¥)</li>\n                                                <li>ì „ì²´ ì ìˆ˜ ìˆ˜ì • (0-10ì )</li>\n                                                <li>ì¢…í•© í‰ê°€ í¸ì§‘</li>\n                                                <li>ê¸°ì¤€ë³„ ì ìˆ˜ ë° í”¼ë“œë°± ìˆ˜ì •</li>\n                                                <li>ì¢…í•© ì˜ê²¬, ìˆ˜ì • ì œì•ˆ, ë‹¤ìŒ ë‹¨ê³„ ì¡°ì–¸ í¸ì§‘</li>\n                                            </ul>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"mt-3 flex justify-center\">\n                                    <img src=\"/guide-screenshots/step10-grading-settings.png\" alt=\"ì±„ì  ì„¤ì •\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                </div>\n                                <div class=\"mt-3 flex justify-center\">\n                                    <img src=\"/guide-screenshots/step10-grading-review-modal.png\" alt=\"ì±„ì  ê²°ê³¼ ê²€í† \" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">5</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium mb-2\">ê²€í†  í›„ 3ê°€ì§€ ì˜µì…˜</p>\n                                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-3\">\n                                    <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-blue-900 mb-2\">\n                                            <i class=\"fas fa-print mr-2\"></i>ì¶œë ¥\n                                        </p>\n                                        <p class=\"text-sm text-blue-800\">ì±„ì  ê²°ê³¼ ë° í”¼ë“œë°±ì„ ë³„ë„ ì°½ì—ì„œ ì¶œë ¥/ì €ì¥</p>\n                                    </div>\n                                    <div class=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-green-900 mb-2\">\n                                            <i class=\"fas fa-save mr-2\"></i>ì €ì¥í•˜ê³  ì™„ë£Œ\n                                        </p>\n                                        <p class=\"text-sm text-green-800\">ìˆ˜ì •ëœ í”¼ë“œë°±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥</p>\n                                    </div>\n                                    <div class=\"bg-gray-50 border border-gray-300 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-gray-900 mb-2\">\n                                            <i class=\"fas fa-times mr-2\"></i>ì·¨ì†Œ\n                                        </p>\n                                        <p class=\"text-sm text-gray-700\">ë³€ê²½ì‚¬í•­ ì—†ì´ ëª¨ë‹¬ ë‹«ê¸°</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">6</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium mb-2\">ìƒì„¸ í”¼ë“œë°± ìë™ ìƒì„±</p>\n                                <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                    <li>ê° ê¸°ì¤€ë³„ ê¸ì •ì  í”¼ë“œë°±</li>\n                                    <li>ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„</li>\n                                    <li>êµ¬ì²´ì ì¸ ê°œì„  ë°©ë²• (ë‹¨ê³„ë³„)</li>\n                                    <li>í•™ë…„ì— ë§ëŠ” í†¤ ì¡°ì • (ì´ˆë“±/ì¤‘ë“±/ê³ ë“±)</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            <!-- Section E: ì±„ì  ì´ë ¥ í™•ì¸ ë° ì¼ê´„ ì¶œë ¥ -->\n            <section id=\"section-e\" class=\"guide-section mb-16\">\n                <div class=\"bg-white rounded-xl shadow-lg p-8\">\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-6 border-b-4 border-navy-700 pb-3\">\n                        E. ì±„ì  ì´ë ¥ í™•ì¸ ë° ì¼ê´„ ì¶œë ¥\n                    </h2>\n\n                    <div class=\"space-y-4 ml-8\">\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">1</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium\">\"ì±„ì  ì´ë ¥\" íƒ­ í´ë¦­</p>\n                                <p class=\"text-gray-600 text-sm mt-1\">ë‚˜ì˜ í˜ì´ì§€ ìƒë‹¨ íƒ­ì—ì„œ \"ì±„ì  ì´ë ¥\"ì„ ì„ íƒí•˜ì„¸ìš”.</p>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">2</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium mb-2\">ëª¨ë“  ì±„ì  ì™„ë£Œëœ ë‹µì•ˆ í™•ì¸</p>\n                                <p class=\"text-gray-600 text-sm mb-2\">ë‹¤ìŒ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤:</p>\n                                <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                    <li>ê³¼ì œ ì œëª©</li>\n                                    <li>í•™ìƒ ì´ë¦„</li>\n                                    <li>ì ìˆ˜</li>\n                                    <li>ì¢…í•© í”¼ë“œë°±</li>\n                                    <li>ì œì¶œì¼ ë° ì±„ì ì¼</li>\n                                </ul>\n                                <div class=\"mt-3 flex justify-center\">\n                                    <img src=\"/guide-screenshots/step11-grading-history-list.png\" alt=\"ì±„ì  ì´ë ¥ í™•ì¸\" class=\"w-3/4 rounded-lg shadow-lg border border-gray-300\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">3</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium mb-2\">ë‹µì•ˆ ì¬ê²€í†  ê¸°ëŠ¥</p>\n                                <ul class=\"list-disc list-inside text-gray-600 space-y-1 ml-4\">\n                                    <li>ë‹µì•ˆ ì¹´ë“œ í´ë¦­ ì‹œ Split-Screen ê²€í†  ëª¨ë‹¬ ì—´ë¦¼</li>\n                                    <li>í•™ìƒ ë‹µì•ˆ(ì¢Œì¸¡) + í”¼ë“œë°±(ìš°ì¸¡) ë™ì‹œ í™•ì¸</li>\n                                    <li>ëª¨ë“  í”¼ë“œë°± í•„ë“œ ìˆ˜ì • ê°€ëŠ¥</li>\n                                    <li>ìˆ˜ì • í›„ \"ì €ì¥í•˜ê³  ì™„ë£Œ\" ë˜ëŠ” \"ì¶œë ¥\" ì„ íƒ</li>\n                                </ul>\n                            </div>\n                        </div>\n\n                        <div class=\"flex items-start\">\n                            <span class=\"step-number\">4</span>\n                            <div class=\"flex-1\">\n                                <p class=\"text-gray-700 font-medium mb-2\">ì¼ê´„ ì¶œë ¥ ê¸°ëŠ¥ ì‚¬ìš© <span class=\"feature-badge\"><i class=\"fas fa-file-pdf mr-1\"></i>PDF í†µí•© ì§€ì›</span></p>\n                                <ol class=\"list-decimal list-inside text-gray-600 space-y-2 ml-4\">\n                                    <li>ê° ë‹µì•ˆ ì™¼ìª½ ì²´í¬ë°•ìŠ¤ë¡œ ì¶œë ¥í•  í•­ëª© ì„ íƒ</li>\n                                    <li>\"ì „ì²´ ì„ íƒ\" ì²´í¬ë°•ìŠ¤ë¡œ ëª¨ë“  ë‹µì•ˆ ì„ íƒ ê°€ëŠ¥</li>\n                                    <li>\"ì¶œë ¥\" ë²„íŠ¼ í´ë¦­í•˜ì—¬ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì—´ê¸°</li>\n                                </ol>\n                                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\n                                    <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-blue-900 mb-2\">\n                                            <i class=\"fas fa-file-alt mr-2\"></i>PDF (ê°œë³„ ì¶œë ¥)\n                                        </p>\n                                        <p class=\"text-sm text-blue-800\">ê° ë‹µì•ˆì„ ë³„ë„ ì°½ì—ì„œ ì—´ì–´ ê°œë³„ ì¸ì‡„</p>\n                                    </div>\n                                    <div class=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                                        <p class=\"font-semibold text-green-900 mb-2\">\n                                            <i class=\"fas fa-file-pdf mr-2\"></i>ë‹¨ì¼ PDF íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°\n                                        </p>\n                                        <p class=\"text-sm text-green-800\">ëª¨ë“  ì„ íƒ ë‹µì•ˆì„ í•˜ë‚˜ì˜ ë¬¸ì„œë¡œ í†µí•©í•˜ì—¬ ì¼ê´„ ì¸ì‡„</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            <!-- Bottom CTA -->\n            <div class=\"bg-gradient-to-r from-navy-900 to-navy-700 rounded-xl shadow-lg p-8 text-center text-white\">\n                <h3 class=\"text-2xl font-bold mb-4\">\n                    <i class=\"fas fa-rocket mr-2\"></i>ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•˜ì„¸ìš”!\n                </h3>\n                <p class=\"text-xl text-blue-100 mb-6\">AI ë…¼ìˆ  ì±„ì  ì„œë¹„ìŠ¤ë¡œ ì±„ì  ì‹œê°„ì„ 90% ì¤„ì´ì„¸ìš”</p>\n                <div class=\"flex justify-center gap-4\">\n                    <a href=\"/login?type=teacher\" class=\"bg-white text-navy-900 px-8 py-3 rounded-lg font-bold hover:bg-blue-50 transition\">\n                        êµì‚¬ ë¡œê·¸ì¸\n                    </a>\n                    <a href=\"/signup\" class=\"bg-lime-400 text-navy-900 px-8 py-3 rounded-lg font-bold hover:bg-lime-300 transition\">\n                        ë¬´ë£Œë¡œ ì‹œì‘í•˜ê¸°\n                    </a>\n                </div>\n            </div>\n\n        </div>\n\n        <!-- Footer -->\n        <footer class=\"bg-gray-900 text-gray-300 py-12 mt-16\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n                <p class=\"text-lg font-semibold text-white mb-2\">AI ë…¼ìˆ  í‰ê°€ ì‹œìŠ¤í…œ</p>\n                <p class=\"text-sm\">Â© 2024 All rights reserved.</p>\n                <div class=\"mt-4\">\n                    <a href=\"/\" class=\"text-blue-400 hover:text-blue-300 mx-2\">í™ˆ</a>\n                    <a href=\"/guide\" class=\"text-blue-400 hover:text-blue-300 mx-2\">ì‚¬ìš©ë²•</a>\n                    <a href=\"/pricing\" class=\"text-blue-400 hover:text-blue-300 mx-2\">ìš”ê¸ˆì œ</a>\n                </div>\n            </div>\n        </footer>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n    </body>\n    </html>\n  `)\n})\n\n// Frontend Route\napp.get('/', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>AI ë…¼ìˆ  í‰ê°€ | êµì‚¬ë¥¼ ìœ„í•œ AI ë…¼ìˆ  ì±„ì  ì‹œìŠ¤í…œ</title>\n        <meta name=\"description\" content=\"AIë¡œ ë…¼ìˆ  ë‹µì•ˆì§€ë¥¼ 10ë°° ë¹ ë¥´ê²Œ ì±„ì í•˜ì„¸ìš”. ìƒì„¸í•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ í”¼ë“œë°±ì„ ë°›ìœ¼ì„¸ìš”. 1,000ëª… ì´ìƒì˜ êµì‚¬ê°€ ì‹ ë¢°í•©ë‹ˆë‹¤.\">\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  primary: '#1e3a8a',\n                  secondary: '#3b82f6',\n                  accent: '#f59e0b',\n                  navy: {\n                    50: '#f0f4ff',\n                    100: '#e0e9ff',\n                    200: '#c7d7ff',\n                    300: '#a4b8ff',\n                    400: '#8195ff',\n                    500: '#6366f1',\n                    600: '#4f46e5',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n        <style>\n          .hero-gradient {\n            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);\n          }\n          .feature-card {\n            transition: transform 0.3s ease, box-shadow 0.3s ease;\n          }\n          .feature-card:hover {\n            transform: translateY(-8px);\n            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);\n          }\n          .criterion-card {\n            transition: all 0.3s ease;\n          }\n          .criterion-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n          }\n          .score-badge {\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            width: 2.5rem;\n            height: 2.5rem;\n            border-radius: 9999px;\n            font-weight: bold;\n            font-size: 1.125rem;\n          }\n          .loading-spinner {\n            border: 3px solid #f3f3f3;\n            border-top: 3px solid #1e3a8a;\n            border-radius: 50%;\n            width: 50px;\n            height: 50px;\n            animation: spin 1s linear infinite;\n          }\n          .material-item {\n            transition: all 0.3s ease;\n          }\n          .material-item:hover {\n            background-color: #f9fafb;\n          }\n          .rubric-tab {\n            transition: all 0.3s ease;\n          }\n          .rubric-tab.active {\n            background-color: #1e3a8a;\n            color: white;\n          }\n          .essay-input-tab {\n            transition: all 0.3s ease;\n          }\n          .essay-input-tab.active {\n            background-color: #1e3a8a;\n            color: white;\n            border-color: #1e3a8a;\n          }\n          .dropdown {\n            position: relative !important;\n            display: inline-block !important;\n          }\n          .dropdown-content {\n            display: none !important;\n            position: absolute !important;\n            top: 100% !important;\n            left: 0 !important;\n            background-color: white !important;\n            min-width: 220px !important;\n            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2) !important;\n            z-index: 1000 !important;\n            border-radius: 8px !important;\n            overflow: hidden !important;\n            margin-top: 0px !important;\n            padding-top: 8px !important;\n          }\n          .dropdown:hover .dropdown-content,\n          .dropdown-content:hover {\n            display: block !important;\n          }\n          .dropdown button {\n            font-size: 1rem !important;\n            padding: 8px 0 !important;\n            outline: none !important;\n            background: transparent !important;\n            border: none !important;\n          }\n          .dropdown button:focus {\n            outline: none !important;\n          }\n          .dropdown-content a {\n            color: #374151 !important;\n            padding: 12px 16px !important;\n            text-decoration: none !important;\n            display: block !important;\n            transition: background-color 0.2s !important;\n          }\n          .dropdown-content a:hover {\n            background-color: #f3f4f6 !important;\n            color: #1e3a8a !important;\n          }\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n          .result-section {\n            animation: fadeIn 0.5s ease-in;\n          }\n          @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n          }\n          .step-number {\n            width: 60px;\n            height: 60px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);\n            color: white;\n            border-radius: 50%;\n            margin: 0 auto 1rem;\n          }\n        </style>\n    </head>\n    <body class=\"bg-white\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <div class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </div>\n                    <div class=\"hidden md:flex items-center space-x-8\">\n                        <a href=\"#features\" class=\"text-gray-700 hover:text-navy-700 font-medium\">ê¸°ëŠ¥</a>\n                        <a href=\"/guide\" class=\"text-gray-700 hover:text-navy-700 font-medium\">ì‚¬ìš©ë²• ì•ˆë‚´</a>\n                        <div class=\"dropdown\">\n                            <button class=\"text-gray-700 hover:text-navy-700 font-medium cursor-pointer\">\n                                í‰ê°€ ê´€ë ¨ ìë£Œ <i class=\"fas fa-chevron-down text-xs ml-1\"></i>\n                            </button>\n                            <div class=\"dropdown-content\">\n                                <a href=\"/resources/rubric\"><i class=\"fas fa-clipboard-list mr-2 text-navy-700\"></i>ë£¨ë¸Œë¦­</a>\n                                <a href=\"/resources/exam\"><i class=\"fas fa-file-alt mr-2 text-navy-700\"></i>ê¸°ì¶œ ë¬¸ì œ</a>\n                                <a href=\"/resources/evaluation\"><i class=\"fas fa-book mr-2 text-navy-700\"></i>ë…¼ìˆ  í‰ê°€ ìë£Œ</a>\n                            </div>\n                        </div>\n                        <a href=\"#faq\" class=\"text-gray-700 hover:text-navy-700 font-medium\">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</a>\n                        <a href=\"/pricing\" class=\"text-gray-700 hover:text-navy-700 font-medium\">ìš”ê¸ˆì œ</a>\n                        <a href=\"/my-page\" id=\"myPageLink\" class=\"text-gray-700 hover:text-navy-700 font-medium\" style=\"display: none;\">ë‚˜ì˜ í˜ì´ì§€</a>\n                        <div class=\"dropdown\" id=\"loginDropdown\">\n                            <button class=\"text-gray-700 hover:text-navy-700 font-medium cursor-pointer\">\n                                ë¡œê·¸ì¸ <i class=\"fas fa-chevron-down text-xs ml-1\"></i>\n                            </button>\n                            <div class=\"dropdown-content\">\n                                <a href=\"/login?type=teacher\"><i class=\"fas fa-chalkboard-teacher mr-2 text-navy-700\"></i>êµì‚¬</a>\n                                <a href=\"/login?type=student\"><i class=\"fas fa-user-graduate mr-2 text-navy-700\"></i>í•™ìƒ</a>\n                            </div>\n                        </div>\n                        <a href=\"/signup\" class=\"bg-navy-900 text-white px-6 py-2 rounded-lg font-semibold hover:bg-navy-800 hover:shadow-lg transition\">\n                            ë¬´ë£Œë¡œ ì‹œì‘í•˜ê¸°\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Hero Section -->\n        <section class=\"hero-gradient text-white py-20\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n                <div class=\"mb-6\">\n                    <span class=\"inline-block bg-white/20 backdrop-blur px-4 py-2 rounded-full text-sm font-semibold\">\n                        1,000ëª… ì´ìƒì˜ êµì‚¬ê°€ ì‹ ë¢°í•˜ëŠ” ì„œë¹„ìŠ¤\n                    </span>\n                </div>\n                <h1 class=\"text-5xl md:text-6xl font-bold mb-6 leading-tight\">\n                    AIë¡œ ë…¼ìˆ  ë‹µì•ˆì§€ë¥¼<br/>10ë°° ë¹ ë¥´ê²Œ ì±„ì \n                </h1>\n                <p class=\"text-xl md:text-2xl mb-8 text-white/90 max-w-3xl mx-auto\">\n                    í•™ìƒ ë…¼ìˆ ì— ëŒ€í•œ ìƒì„¸í•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ í”¼ë“œë°±ì„ ëª‡ ë¶„ ì•ˆì— ë°›ìœ¼ì„¸ìš”. \n                    ì¼ê´€ë˜ê³  ê³ í’ˆì§ˆì˜ í”¼ë“œë°±ì„ ì œê³µí•˜ë©´ì„œ ì‹œê°„ì„ ì ˆì•½í•˜ì„¸ìš”.\n                </p>\n                <div class=\"flex flex-col sm:flex-row gap-4 justify-center items-center\">\n                    <button onclick=\"scrollToGrader()\" class=\"bg-white text-navy-900 px-8 py-4 rounded-lg font-bold text-lg hover:shadow-2xl transition transform hover:scale-105\">\n                        <i class=\"fas fa-rocket mr-2\"></i>ë¬´ë£Œë¡œ ì±„ì  ì‹œì‘í•˜ê¸°\n                    </button>\n                    <button onclick=\"scrollToDemo()\" class=\"bg-navy-800/50 backdrop-blur text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-navy-800/70 transition\">\n                        <i class=\"fas fa-play-circle mr-2\"></i>ì‘ë™ ë°©ì‹ ë³´ê¸°\n                    </button>\n                </div>\n                <p class=\"mt-6 text-white/80 text-sm\">\n                    <i class=\"fas fa-check-circle mr-2\"></i>ì‹ ìš©ì¹´ë“œ ë¶ˆí•„ìš” â€¢ ë¬´ë£Œ í”Œëœ ì´ìš© ê°€ëŠ¥\n                </p>\n            </div>\n        </section>\n\n        <!-- Trust Bar -->\n        <section class=\"bg-gray-50 py-8 border-b\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"grid grid-cols-2 md:grid-cols-4 gap-8 text-center\">\n                    <div>\n                        <div class=\"text-3xl font-bold text-navy-700\">10ë°°</div>\n                        <div class=\"text-sm text-gray-600\">ë¹ ë¥¸ ì±„ì </div>\n                    </div>\n                    <div>\n                        <div class=\"text-3xl font-bold text-navy-700\">1,000+</div>\n                        <div class=\"text-sm text-gray-600\">ì‹ ë¢°í•˜ëŠ” êµì‚¬</div>\n                    </div>\n                    <div>\n                        <div class=\"text-3xl font-bold text-navy-700\">&lt;4%</div>\n                        <div class=\"text-sm text-gray-600\">ì ìˆ˜ í¸ì°¨</div>\n                    </div>\n                    <div>\n                        <div class=\"text-3xl font-bold text-navy-700\">100%</div>\n                        <div class=\"text-sm text-gray-600\">í”„ë¼ì´ë²„ì‹œ ìš°ì„ </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- How It Works -->\n        <section id=\"how-it-works\" class=\"py-20 bg-white\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"text-center mb-16\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">ì‘ë™ ë°©ì‹</h2>\n                    <p class=\"text-xl text-gray-600\">ë” ë‚˜ì€, ë” ë¹ ë¥¸ ì±„ì ì„ ìœ„í•œ ì„¸ ê°€ì§€ ê°„ë‹¨í•œ ë‹¨ê³„</p>\n                </div>\n                <div class=\"grid md:grid-cols-3 gap-12\">\n                    <div class=\"text-center\">\n                        <div class=\"step-number\">1</div>\n                        <div class=\"mb-4\">\n                            <i class=\"fas fa-file-upload text-5xl text-navy-700\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ë£¨ë¸Œë¦­ ì—…ë¡œë“œ</h3>\n                        <p class=\"text-gray-600\">ì±„ì  ë£¨ë¸Œë¦­ì„ ìƒì„±í•˜ê±°ë‚˜ ê°€ì ¸ì˜¤ì„¸ìš”. 10ê°œ ì´ìƒì˜ ì‚¬ì „ ì œì‘ ë£¨ë¸Œë¦­ ì¤‘ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ë§ì¶¤ ì„¤ì •í•˜ì„¸ìš”.</p>\n                    </div>\n                    <div class=\"text-center\">\n                        <div class=\"step-number\">2</div>\n                        <div class=\"mb-4\">\n                            <i class=\"fas fa-upload text-5xl text-navy-700\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ë…¼ìˆ  ì—…ë¡œë“œ</h3>\n                        <p class=\"text-gray-600\">í•™ìƒ ë…¼ìˆ ì„ ê°œë³„ì ìœ¼ë¡œ ë˜ëŠ” ëŒ€ëŸ‰ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”. ë‹¤ì–‘í•œ í˜•ì‹ê³¼ ì–¸ì–´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</p>\n                    </div>\n                    <div class=\"text-center\">\n                        <div class=\"step-number\">3</div>\n                        <div class=\"mb-4\">\n                            <i class=\"fas fa-download text-5xl text-navy-700\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</h3>\n                        <p class=\"text-gray-600\">ì ìˆ˜, ì½”ë©˜íŠ¸ ë° ì œì•ˆì´ í¬í•¨ëœ ìƒì„¸í•œ í”¼ë“œë°±ì„ ë°›ìœ¼ì„¸ìš”. LMSë¡œ ë‚´ë³´ë‚´ê±°ë‚˜ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Features Section -->\n        <section id=\"features\" class=\"py-20 bg-gray-50\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"text-center mb-16\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">ê°•ë ¥í•œ ê¸°ëŠ¥</h2>\n                    <p class=\"text-xl text-gray-600\">ë…¼ìˆ ì„ íš¨ê³¼ì ìœ¼ë¡œ ì±„ì í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  ê²ƒ</p>\n                </div>\n                <!-- First row: 3 columns -->\n                <div class=\"grid md:grid-cols-3 gap-8 mb-8\">\n                    <div class=\"feature-card bg-white p-6 rounded-xl shadow-md\">\n                        <div class=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4\">\n                            <i class=\"fas fa-folder-open text-2xl text-green-600\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ê¸°ì¡´ ê³¼ì œ ë¶ˆëŸ¬ì˜¤ê¸°</h3>\n                        <p class=\"text-gray-600\">ìƒˆ ê³¼ì œ ë§Œë“¤ê¸°ì—ì„œ ê¸°ì¡´ì— ì¶œì œí–ˆë˜ ê³¼ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ê³¼ì œë¥¼ í¸ì§‘í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”.</p>\n                    </div>\n                    <div class=\"feature-card bg-white p-6 rounded-xl shadow-md\">\n                        <div class=\"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4\">\n                            <i class=\"fas fa-pen-fancy text-2xl text-purple-600\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ì†ê¸€ì”¨ í…ìŠ¤íŠ¸ ë³€í™˜</h3>\n                        <p class=\"text-gray-600\">í•™ìƒì´ ì†ê¸€ì”¨ë¡œ ì‘ì„±í•œ ë…¼ìˆ ë¬¸ì„ ì—…ë¡œë“œí•˜ì—¬ ì±„ì í•˜ì„¸ìš”. ê´‘í•™ ë¬¸ì ì¸ì‹(OCR) ë„êµ¬ë¡œ ì†ê¸€ì”¨ ì´ë¯¸ì§€ë¥¼ ë””ì§€í„¸ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>\n                    </div>\n                    <div class=\"feature-card bg-white p-6 rounded-xl shadow-md\">\n                        <div class=\"w-12 h-12 bg-navy-100 rounded-lg flex items-center justify-center mb-4\">\n                            <i class=\"fas fa-bolt text-2xl text-navy-700\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ì´ˆê³ ì† ì±„ì </h3>\n                        <p class=\"text-gray-600\">ì „ì²´ í•™ê¸‰ì„ ëª‡ ë¶„ ì•ˆì— ì±„ì í•˜ì„¸ìš”. ë§¤ì£¼ ëª‡ ì‹œê°„ì˜ ì±„ì  ì‹œê°„ì„ ì ˆì•½í•˜ì„¸ìš”.</p>\n                    </div>\n                </div>\n                \n                <!-- Second row: 2 columns centered -->\n                <div class=\"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n                    <div class=\"feature-card bg-white p-6 rounded-xl shadow-md\">\n                        <div class=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4\">\n                            <i class=\"fas fa-chart-line text-2xl text-blue-600\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ìƒì„¸í•œ í”¼ë“œë°±</h3>\n                        <p class=\"text-gray-600\">ë¬¸ë²•, êµ¬ì¡°, ì¦ê±° ë° ë¶„ì„ì— ëŒ€í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë©˜íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>\n                    </div>\n                    <div class=\"feature-card bg-white p-6 rounded-xl shadow-md\">\n                        <div class=\"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-4\">\n                            <i class=\"fas fa-balance-scale text-2xl text-indigo-600\"></i>\n                        </div>\n                        <h3 class=\"text-xl font-bold mb-2\">ì¼ê´€ëœ ì±„ì </h3>\n                        <p class=\"text-gray-600\">í¸í–¥ì„ ì œê±°í•˜ê³  ëª¨ë“  í•™ìƒì—ê²Œ ê³µì •í•˜ê³  í‘œì¤€ì— ë¶€í•©í•˜ëŠ” í‰ê°€ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Grading Interface -->\n        <section id=\"grader\" class=\"py-20 bg-white\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"text-center mb-12\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">ì§€ê¸ˆ ì‚¬ìš©í•´ ë³´ê¸°</h2>\n                    <p class=\"text-xl text-gray-600\">ëª‡ ì´ˆ ë§Œì— ì²« ë…¼ìˆ  ì±„ì í•˜ê¸°</p>\n                </div>\n\n                <!-- Main Grading Interface -->\n                <div id=\"mainInterface\">\n                    <div class=\"bg-white rounded-xl shadow-2xl p-8 border border-gray-200\">\n                        <form id=\"gradingForm\" class=\"space-y-6\">\n                            <div class=\"grid md:grid-cols-2 gap-6\">\n                                <div>\n                                    <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                        <i class=\"fas fa-file-alt mr-2 text-navy-700\"></i>ê³¼ì œ ì§€ì‹œë¬¸\n                                    </label>\n                                    <textarea \n                                        id=\"assignmentPrompt\" \n                                        rows=\"4\" \n                                        class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent\"\n                                        placeholder=\"ê³¼ì œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...\"\n                                        required\n                                    ></textarea>\n                                    \n                                    <!-- Reference Materials Section -->\n                                    <div class=\"mt-4\">\n                                        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                            <i class=\"fas fa-paperclip mr-2 text-navy-700\"></i>ì œì‹œë¬¸\n                                        </label>\n                                        <div id=\"materialsContainer\" class=\"space-y-2\">\n                                            <!-- Materials will be added dynamically -->\n                                        </div>\n                                        <button \n                                            type=\"button\" \n                                            onclick=\"addMaterial()\" \n                                            class=\"mt-2 px-4 py-2 bg-navy-50 text-navy-700 rounded-lg hover:bg-navy-100 transition text-sm border border-navy-200\"\n                                        >\n                                            <i class=\"fas fa-plus mr-2\"></i>ìë£Œ ì¶”ê°€ (ìµœëŒ€ 11ê°œ)\n                                        </button>\n                                        <p class=\"text-xs text-gray-500 mt-1\">ë¬¸ì„œ, ì´ë¯¸ì§€, ë§í¬ ë“±ì„ ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>\n                                    </div>\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                        <i class=\"fas fa-user-graduate mr-2 text-navy-700\"></i>í•™ë…„ ìˆ˜ì¤€\n                                    </label>\n                                    <select \n                                        id=\"gradeLevel\" \n                                        class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent mb-4\"\n                                        required\n                                    >\n                                        <option value=\"\">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”</option>\n                                        <option value=\"ì´ˆë“±í•™êµ\">ì´ˆë“±í•™êµ</option>\n                                        <option value=\"ì¤‘í•™êµ 1í•™ë…„\">ì¤‘í•™êµ 1í•™ë…„</option>\n                                        <option value=\"ì¤‘í•™êµ 2í•™ë…„\">ì¤‘í•™êµ 2í•™ë…„</option>\n                                        <option value=\"ì¤‘í•™êµ 3í•™ë…„\">ì¤‘í•™êµ 3í•™ë…„</option>\n                                        <option value=\"ê³ ë“±í•™êµ 1í•™ë…„\">ê³ ë“±í•™êµ 1í•™ë…„</option>\n                                        <option value=\"ê³ ë“±í•™êµ 2í•™ë…„\">ê³ ë“±í•™êµ 2í•™ë…„</option>\n                                        <option value=\"ê³ ë“±í•™êµ 3í•™ë…„\">ê³ ë“±í•™êµ 3í•™ë…„</option>\n                                    </select>\n                                    \n                                    <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                        <i class=\"fas fa-clipboard-list mr-2 text-navy-700\"></i>ë£¨ë¸Œë¦­ ê¸°ì¤€\n                                    </label>\n                                    \n                                    <!-- Rubric Type Selection -->\n                                    <div class=\"flex gap-2 mb-4\">\n                                        <button \n                                            type=\"button\" \n                                            id=\"platformRubricBtn\"\n                                            onclick=\"switchRubricType('platform')\" \n                                            class=\"rubric-tab flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm font-semibold transition active\"\n                                        >\n                                            í”Œë«í¼ ë£¨ë¸Œë¦­\n                                        </button>\n                                        <button \n                                            type=\"button\" \n                                            id=\"customRubricBtn\"\n                                            onclick=\"switchRubricType('custom')\" \n                                            class=\"rubric-tab flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm font-semibold transition\"\n                                        >\n                                            ë‚˜ì˜ ë£¨ë¸Œë¦­\n                                        </button>\n                                    </div>\n                                    \n                                    <!-- Platform Rubric -->\n                                    <div id=\"platformRubricContainer\">\n                                        <select \n                                            id=\"platformRubric\" \n                                            class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent\"\n                                        >\n                                            <option value=\"\">ë£¨ë¸Œë¦­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>\n                                        </select>\n                                    </div>\n                                    \n                                    <!-- Custom Rubric -->\n                                    <div id=\"customRubricContainer\" class=\"hidden\">\n                                        <div id=\"rubricContainer\" class=\"space-y-2 max-h-64 overflow-y-auto mb-2\">\n                                            <!-- Criteria will be added dynamically -->\n                                        </div>\n                                        <button \n                                            type=\"button\" \n                                            onclick=\"addCriterion()\" \n                                            class=\"w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm\"\n                                        >\n                                            <i class=\"fas fa-plus mr-2\"></i>ê¸°ì¤€ ì¶”ê°€\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                    <i class=\"fas fa-pen-fancy mr-2 text-navy-700\"></i>í•™ìƒ ë…¼ìˆ \n                                </label>\n                                \n                                <!-- Essay Input Type Tabs -->\n                                <div class=\"flex gap-2 mb-4\">\n                                    <button \n                                        type=\"button\" \n                                        id=\"textInputBtn\"\n                                        onclick=\"switchEssayInputType('text')\" \n                                        class=\"essay-input-tab flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm font-semibold transition active\"\n                                    >\n                                        <i class=\"fas fa-keyboard mr-2\"></i>í…ìŠ¤íŠ¸ ì…ë ¥\n                                    </button>\n                                    <button \n                                        type=\"button\" \n                                        id=\"fileInputBtn\"\n                                        onclick=\"switchEssayInputType('file')\" \n                                        class=\"essay-input-tab flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm font-semibold transition\"\n                                    >\n                                        <i class=\"fas fa-file-upload mr-2\"></i>íŒŒì¼ ì„ íƒ\n                                    </button>\n                                </div>\n                                \n                                <!-- Text Input Container -->\n                                <div id=\"textInputContainer\">\n                                    <textarea \n                                        id=\"essayText\" \n                                        rows=\"10\" \n                                        class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent font-mono text-sm\"\n                                        placeholder=\"í•™ìƒì´ ì‘ì„±í•œ ë…¼ìˆ ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...\"\n                                    ></textarea>\n                                </div>\n                                \n                                <!-- File Input Container -->\n                                <div id=\"fileInputContainer\" class=\"hidden\">\n                                    <div class=\"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-navy-500 transition\">\n                                        <input \n                                            type=\"file\" \n                                            id=\"essayFile\" \n                                            accept=\"image/*,.pdf,.doc,.docx,.txt\"\n                                            class=\"hidden\"\n                                            onchange=\"handleFileSelect(event)\"\n                                        />\n                                        <label for=\"essayFile\" class=\"cursor-pointer\">\n                                            <div class=\"mb-4\">\n                                                <i class=\"fas fa-cloud-upload-alt text-6xl text-navy-700\"></i>\n                                            </div>\n                                            <p class=\"text-lg font-semibold text-gray-700 mb-2\">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</p>\n                                            <p class=\"text-sm text-gray-500 mb-4\">\n                                                ì§€ì› í˜•ì‹: ì´ë¯¸ì§€ (JPG, PNG), PDF, Word ë¬¸ì„œ, í…ìŠ¤íŠ¸ íŒŒì¼\n                                            </p>\n                                            <span class=\"inline-block bg-navy-900 text-white px-6 py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                                                <i class=\"fas fa-folder-open mr-2\"></i>íŒŒì¼ ì°¾ê¸°\n                                            </span>\n                                        </label>\n                                    </div>\n                                    \n                                    <!-- File Preview -->\n                                    <div id=\"filePreview\" class=\"hidden mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n                                        <div class=\"flex items-center justify-between\">\n                                            <div class=\"flex items-center\">\n                                                <i class=\"fas fa-file-alt text-3xl text-navy-700 mr-3\"></i>\n                                                <div>\n                                                    <p id=\"fileName\" class=\"font-semibold text-gray-800\"></p>\n                                                    <p id=\"fileSize\" class=\"text-sm text-gray-500\"></p>\n                                                </div>\n                                            </div>\n                                            <button \n                                                type=\"button\" \n                                                onclick=\"clearFile()\" \n                                                class=\"text-red-500 hover:text-red-700\"\n                                            >\n                                                <i class=\"fas fa-times-circle text-2xl\"></i>\n                                            </button>\n                                        </div>\n                                        <!-- Image preview (for image files) -->\n                                        <div id=\"imagePreview\" class=\"hidden mt-4\">\n                                            <img id=\"previewImg\" src=\"\" alt=\"Preview\" class=\"max-w-full h-auto rounded-lg border border-gray-300\" />\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"flex justify-center\">\n                                <button \n                                    type=\"submit\" \n                                    class=\"bg-navy-900 text-white px-12 py-4 rounded-lg font-bold text-lg hover:bg-navy-800 hover:shadow-2xl transition transform hover:scale-105\"\n                                >\n                                    <i class=\"fas fa-magic mr-2\"></i>AIë¡œ ë…¼ìˆ  ì±„ì í•˜ê¸°\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n\n                <!-- Loading Indicator -->\n                <div id=\"loadingIndicator\" class=\"hidden text-center py-20\">\n                    <div class=\"loading-spinner mx-auto mb-6\"></div>\n                    <p class=\"text-2xl font-semibold text-gray-700\">ë…¼ìˆ ì„ ë¶„ì„í•˜ëŠ” ì¤‘...</p>\n                    <p class=\"text-gray-500 mt-2\">ì¼ë°˜ì ìœ¼ë¡œ 5-10ì´ˆ ì†Œìš”ë©ë‹ˆë‹¤</p>\n                </div>\n\n                <!-- Results Display -->\n                <div id=\"resultsContainer\" class=\"hidden\"></div>\n            </div>\n        </section>\n\n        <!-- Privacy Section -->\n        <section class=\"py-16 bg-gray-50\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"text-center mb-12\">\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-4\">í”„ë¼ì´ë²„ì‹œë¥¼ ìµœìš°ì„ ìœ¼ë¡œ</h2>\n                    <p class=\"text-xl text-gray-600\">ì—¬ëŸ¬ë¶„ì˜ ë°ì´í„°ëŠ” ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤</p>\n                </div>\n                <div class=\"grid md:grid-cols-4 gap-8\">\n                    <div class=\"text-center\">\n                        <i class=\"fas fa-lock text-4xl text-navy-700 mb-4\"></i>\n                        <h3 class=\"font-bold mb-2\">ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì¤€ìˆ˜</h3>\n                        <p class=\"text-sm text-gray-600\">í•™ìƒ ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì™„ì „ ì¤€ìˆ˜</p>\n                    </div>\n                    <div class=\"text-center\">\n                        <i class=\"fas fa-shield-alt text-4xl text-navy-600 mb-4\"></i>\n                        <h3 class=\"font-bold mb-2\">AES-256 ì•”í˜¸í™”</h3>\n                        <p class=\"text-sm text-gray-600\">ëª¨ë“  ë°ì´í„°ì— ì€í–‰ê¸‰ ë³´ì•ˆ ì ìš©</p>\n                    </div>\n                    <div class=\"text-center\">\n                        <i class=\"fas fa-user-shield text-4xl text-navy-600 mb-4\"></i>\n                        <h3 class=\"font-bold mb-2\">ë°ì´í„° ì†Œìœ ê¶Œ</h3>\n                        <p class=\"text-sm text-gray-600\">ì—¬ëŸ¬ë¶„ì˜ ë°ì´í„°, ì–¸ì œë“ ì§€ ì‚­ì œ ê°€ëŠ¥</p>\n                    </div>\n                    <div class=\"text-center\">\n                        <i class=\"fas fa-certificate text-4xl text-navy-700 mb-4\"></i>\n                        <h3 class=\"font-bold mb-2\">SOC 2 Type I</h3>\n                        <p class=\"text-sm text-gray-600\">ì¸ì¦ëœ ë³´ì•ˆ í‘œì¤€</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- FAQ Section -->\n        <section id=\"faq\" class=\"py-20 bg-white\">\n            <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"text-center mb-12\">\n                    <h2 class=\"text-4xl font-bold text-gray-900 mb-4\">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h2>\n                </div>\n                <div class=\"space-y-4\">\n                    <details class=\"bg-gray-50 p-6 rounded-lg\">\n                        <summary class=\"font-bold cursor-pointer\">AI ë…¼ìˆ  í‰ê°€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ì–´ë–¤ ì´ì ì´ ìˆë‚˜ìš”?</summary>\n                        <p class=\"mt-4 text-gray-600\">AI ë…¼ìˆ  í‰ê°€ ì„œë¹„ìŠ¤ëŠ” êµì‚¬ê°€ í•™ìƒì˜ ë…¼ìˆ  ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ êµ¬ì²´ì ì´ê³  ì‹œì˜ì ì ˆí•œ í”¼ë“œë°±ì„ ì œê³µí•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤. í•™ìƒì€ ê°œì¸í™”ëœ ìƒì„¸ í”¼ë“œë°±ìœ¼ë¡œ ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­ì„ ëª…í™•íˆ ì•Œê²Œ ë˜ì–´ ë¹ ë¥¸ í–¥ìƒê³¼ í•™ìŠµ ì„±ê³¼ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>\n                    </details>\n                    <details class=\"bg-gray-50 p-6 rounded-lg\">\n                        <summary class=\"font-bold cursor-pointer\">AI ì±„ì ì€ ì–¼ë§ˆë‚˜ ì •í™•í•œê°€ìš”?</summary>\n                        <p class=\"mt-4 text-gray-600\">ìš°ë¦¬ AIëŠ” ì¸ê°„ ì±„ì ìì™€ ë¹„êµí•˜ì—¬ 4% ë¯¸ë§Œì˜ í¸ì°¨ë¥¼ ë‹¬ì„±í•˜ë©°, í•™ë¬¸ì  ì‚¬ìš©ì— í•„ìš”í•œ ì‹¤ì§ˆì  ì¼ì¹˜ ì„ê³„ê°’(QWK 0.61+)ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.</p>\n                    </details>\n                    <details class=\"bg-gray-50 p-6 rounded-lg\">\n                        <summary class=\"font-bold cursor-pointer\">AI ë…¼ìˆ  í‰ê°€ì˜ ìµœì¢… ì„±ì ì€ ëˆ„ê°€ ì±…ì„ ì§€ë‚˜ìš”?</summary>\n                        <p class=\"mt-4 text-gray-600\">AI ë…¼ìˆ  í‰ê°€ ì„œë¹„ìŠ¤ëŠ” ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ì œì•ˆìœ¼ë¡œ ì±„ì  ê³¼ì •ì„ ê°„ì†Œí™”í•˜ì—¬ êµì‚¬ë¥¼ ì§€ì›í•˜ë„ë¡ ì„¤ê³„ëœ ê²ƒìœ¼ë¡œ ì–´ë””ê¹Œì§€ë‚˜ ë³´ì¡°ì ì¸ ìš©ë„ë¡œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. êµì‚¬ëŠ” ì±„ì  ê²°ê³¼ë¥¼ ìµœì¢… í™•ì •í•˜ê¸° ì „ì— ì„±ì ê³¼ í”¼ë“œë°±ì„ ê²€í† í•˜ê³  ê²€ì¦í•´ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì±„ì  ê²°ê³¼ì— ëŒ€í•œ ì±…ì„ì€ êµì‚¬ì—ê²Œ ìˆìŠµë‹ˆë‹¤.</p>\n                    </details>\n                    <details class=\"bg-gray-50 p-6 rounded-lg\">\n                        <summary class=\"font-bold cursor-pointer\">í•™ìƒì´ ë…¼ìˆ  ë‹µì•ˆì„ ì–´ë–»ê²Œ ì œì¶œí•˜ë‚˜ìš”?</summary>\n                        <p class=\"mt-4 text-gray-600\">ë„¤! êµì‚¬ê°€ ê³¼ì œë¥¼ ìƒì„±í•˜ë©´ í•™ìƒ ì „ìš© ì•¡ì„¸ìŠ¤ ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤. í•™ìƒë“¤ì€ ì´ ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ í†µí•´ ë…¼ìˆ  ë‹µì•ˆì„ ê°„í¸í•˜ê²Œ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n                    </details>\n                    <details class=\"bg-gray-50 p-6 rounded-lg\">\n                        <summary class=\"font-bold cursor-pointer\">ë¬´ë£Œ ì²´í—˜ì´ ê°€ëŠ¥í•œê°€ìš”?</summary>\n                        <p class=\"mt-4 text-gray-600\">ë„¤! ë¬´ë£Œ ì²´í—˜ í”Œëœìœ¼ë¡œ ì›” 20ê°œì˜ ë…¼ìˆ  ë‹µì•ˆì§€ë¥¼ ì±„ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ ë£Œ í”Œëœì€ í•œë‹¬ì— 7,500ì›ìœ¼ë¡œ 90ê°œì˜ ë…¼ìˆ  ë‹µì•ˆì§€ë¥¼ ì±„ì í•  ìˆ˜ ìˆëŠ” \"ìŠ¤íƒ€í„°\" ìš”ê¸ˆì œë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤.</p>\n                    </details>\n                </div>\n            </div>\n        </section>\n\n        <!-- CTA Section -->\n        <section class=\"hero-gradient text-white py-20\">\n            <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n                <h2 class=\"text-2xl md:text-3xl font-bold mb-6\">ë…¼ìˆ  ì±„ì ì— ë“¤ì–´ê°€ëŠ” ì‹œê°„ì„ ì ˆì•½í•  ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?</h2>\n                <p class=\"text-xl mb-8\">AI ë…¼ìˆ  í‰ê°€ë¥¼ ì‚¬ìš©í•˜ëŠ” 1,000ëª… ì´ìƒì˜ êµì‚¬ì™€ í•¨ê»˜í•˜ì„¸ìš”</p>\n                <button onclick=\"scrollToGrader()\" class=\"bg-white text-navy-900 px-12 py-4 rounded-lg font-bold text-lg hover:shadow-2xl transition transform hover:scale-105\">\n                    <i class=\"fas fa-rocket mr-2\"></i>ë¬´ë£Œë¡œ ì±„ì  ì‹œì‘í•˜ê¸°\n                </button>\n                <p class=\"mt-6 text-white/80 text-sm\">ì‹ ìš©ì¹´ë“œ ë¶ˆí•„ìš” â€¢ ë¬´ë£Œ í”Œëœ ì´ìš© ê°€ëŠ¥ â€¢ ì–¸ì œë“ ì§€ ì·¨ì†Œ ê°€ëŠ¥</p>\n            </div>\n        </section>\n\n        <!-- Footer -->\n        <footer class=\"bg-gray-900 text-white py-12\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"grid md:grid-cols-4 gap-8\">\n                    <div>\n                        <h3 class=\"font-bold text-xl mb-4\">AI ë…¼ìˆ  í‰ê°€</h3>\n                        <p class=\"text-gray-400 text-sm\">êµì‚¬ë¥¼ ìœ„í•œ AI ê¸°ë°˜ ë…¼ìˆ  ì±„ì  ì‹œìŠ¤í…œ</p>\n                    </div>\n                    <div>\n                        <h4 class=\"font-bold mb-4\">ì œí’ˆ</h4>\n                        <ul class=\"space-y-2 text-gray-400 text-sm\">\n                            <li><a href=\"#features\" class=\"hover:text-white\">ê¸°ëŠ¥</a></li>\n                            <li><a href=\"/pricing\" class=\"hover:text-white\">ìš”ê¸ˆì œ</a></li>\n                        </ul>\n                    </div>\n                    <div>\n                        <h4 class=\"font-bold mb-4\">ê³ ê° ì§€ì›</h4>\n                        <ul class=\"space-y-2 text-gray-400 text-sm\">\n                            <li><a href=\"mailto:simmanistudy@gmail.com\" class=\"hover:text-white\">ë¬¸ì˜í•˜ê¸°</a></li>\n                            <li class=\"text-gray-400\">âœ‰ simmanistudy@gmail.com</li>\n                            <li class=\"text-gray-400\">â˜ 02-6339-6059</li>\n                        </ul>\n                    </div>\n                    <div>\n                        <h4 class=\"font-bold mb-4\">ë²•ì  ê³ ì§€</h4>\n                        <ul class=\"space-y-2 text-gray-400 text-sm\">\n                            <li><a href=\"/terms\" class=\"hover:text-white\">ì´ìš© ì•½ê´€</a></li>\n                            <li><a href=\"/privacy\" class=\"hover:text-white\">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a></li>\n                        </ul>\n                    </div>\n                </div>\n                <div class=\"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm\">\n                    <p>Â© 2025 AI ë…¼ìˆ  í‰ê°€. All rights reserved.</p>\n                </div>\n            </div>\n        </footer>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          // Check if user is logged in and show \"ë‚˜ì˜ í˜ì´ì§€\" link\n          function checkLoginStatus() {\n            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';\n            const myPageLink = document.getElementById('myPageLink');\n            if (isLoggedIn && myPageLink) {\n              myPageLink.style.display = 'inline-block';\n            }\n          }\n          \n          // Run on page load\n          document.addEventListener('DOMContentLoaded', checkLoginStatus);\n        </script>\n        <script src=\"/static/app.js\"></script>\n    </body>\n    </html>\n  `)\n})\n\n// Resource List Page\napp.get('/resources/:category', async (c) => {\n  const category = c.req.param('category')\n  const categoryName = category === 'rubric' ? 'ë£¨ë¸Œë¦­' : category === 'exam' ? 'ê¸°ì¶œ ë¬¸ì œ' : 'ë…¼ìˆ  í‰ê°€ ìë£Œ'\n  \n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>${categoryName} | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    100: '#e0e9ff',\n                    200: '#c7d7ff',\n                    300: '#a4b8ff',\n                    400: '#8195ff',\n                    500: '#6366f1',\n                    600: '#4f46e5',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/\" class=\"text-gray-700 hover:text-navy-700 font-medium\">í™ˆ</a>\n                        <a href=\"/admin\" class=\"text-gray-700 hover:text-navy-700 font-medium\">ê´€ë¦¬ì</a>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <div class=\"mb-8\">\n                <h1 class=\"text-4xl font-bold text-gray-900 mb-4\">${categoryName}</h1>\n                <p class=\"text-xl text-gray-600\">êµìœ¡ í˜„ì¥ì— ë„ì›€ì´ ë˜ëŠ” ìë£Œë¥¼ í™•ì¸í•˜ì„¸ìš”</p>\n            </div>\n\n            <!-- Search Box -->\n            <div class=\"mb-8\">\n                <div class=\"relative max-w-2xl mx-auto\">\n                    <input \n                        type=\"text\" \n                        id=\"searchInput\" \n                        placeholder=\"ìë£Œ ê²€ìƒ‰...\" \n                        class=\"w-full px-6 py-4 pl-12 text-lg border-2 border-gray-300 rounded-xl focus:outline-none focus:border-navy-700 transition\"\n                        onkeyup=\"filterResources()\"\n                    />\n                    <i class=\"fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl\"></i>\n                </div>\n            </div>\n\n            <div id=\"postsList\" class=\"space-y-6\">\n                <p class=\"text-gray-500 text-center py-8\">ìë£Œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js\"></script>\n        <script>\n          const category = '${category}';\n          let allItems = [];\n          \n          // ê¸°ì¶œ ë¬¸ì œ ëª©ë¡\n          const examQuestions = [\n            {\n              id: 'exam-1',\n              title: '201001 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì‹ ì„ê¸° í˜ëª… ë†ì—… í˜ëª… ê·¸ë¦° í˜ëª…',\n              file: '/exam-questions/201001 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì‹ ì„ê¸° í˜ëª… ë†ì—… í˜ëª… ê·¸ë¦° í˜ëª….pdf',\n              date: '2010-01-01'\n            },\n            {\n              id: 'exam-2',\n              title: '201206 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë…ì¬ ì •ì¹˜ê°€ ì§„ì‹œí™©ì œ í‘œíŠ¸ë¥´ ë£¨ì´14ì„¸',\n              file: '/exam-questions/201206 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë…ì¬ ì •ì¹˜ê°€ ì§„ì‹œí™©ì œ í‘œíŠ¸ë¥´ ë£¨ì´14ì„¸.pdf',\n              date: '2012-06-01'\n            },\n            {\n              id: 'exam-3',\n              title: '201506 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë¡œë§ˆ ì œêµ­ ì˜¤ìŠ¤ë§Œ ì œêµ­ ëŒ€ì˜ ì œêµ­ ë©¸ë§',\n              file: '/exam-questions/201506 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ë¡œë§ˆ ì œêµ­ ì˜¤ìŠ¤ë§Œ ì œêµ­ ëŒ€ì˜ ì œêµ­ ë©¸ë§.pdf',\n              date: '2015-06-01'\n            },\n            {\n              id: 'exam-4',\n              title: '200906 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì¤‘ì„¸ë§ì˜ ì‚¬íšŒ ë³€í™” ì‚°ì—… í˜ëª… ì„¸ê³„í™”',\n              file: '/exam-questions/200906 ë¦¬ì  íŠ¸ ì‹œí—˜ DBQ - ì¤‘ì„¸ë§ì˜ ì‚¬íšŒ ë³€í™” ì‚°ì—… í˜ëª… ì„¸ê³„í™”.pdf',\n              date: '2009-06-01'\n            }\n          ];\n          \n          function filterResources() {\n            const searchTerm = document.getElementById('searchInput').value.toLowerCase();\n            const filtered = allItems.filter(item => \n              item.title.toLowerCase().includes(searchTerm)\n            );\n            displayItems(filtered);\n          }\n          \n          function displayItems(items) {\n            const container = document.getElementById('postsList');\n            \n            if (items.length === 0) {\n              container.innerHTML = \\`\n                <div class=\"text-center py-12\">\n                  <i class=\"fas fa-inbox text-6xl text-gray-300 mb-4\"></i>\n                  <p class=\"text-gray-500 text-lg\">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>\n                </div>\n              \\`;\n              return;\n            }\n            \n            if (category === 'exam') {\n              container.innerHTML = items.map(item => \\`\n                <div class=\"bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition cursor-pointer\" onclick=\"openPDF('\\${item.file}', '\\${item.title}')\">\n                  <div class=\"flex items-center justify-between\">\n                    <div class=\"flex-1\">\n                      <h2 class=\"text-2xl font-bold text-gray-900 mb-3 hover:text-navy-700 transition\">\\${item.title}</h2>\n                      <div class=\"flex items-center text-sm text-gray-500\">\n                        <i class=\"fas fa-file-pdf mr-2 text-red-600\"></i>\n                        <span>PDF ë¬¸ì„œ</span>\n                        <span class=\"mx-2\">â€¢</span>\n                        <i class=\"fas fa-calendar mr-2\"></i>\n                        <span>\\${new Date(item.date).toLocaleDateString('ko-KR')}</span>\n                      </div>\n                    </div>\n                    <div>\n                      <i class=\"fas fa-eye text-3xl text-navy-700\"></i>\n                    </div>\n                  </div>\n                </div>\n              \\`).join('');\n            } else {\n              container.innerHTML = items.map(post => {\n                const hasFile = post.file && post.file.trim() !== '';\n                const onclick = hasFile ? \\`openDocument('\\${post.file}', '\\${post.title}')\\` : \\`location.href='/resource/\\${post.id}'\\`;\n                return \\`\n                  <div class=\"bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition cursor-pointer\" onclick=\"\\${onclick}\">\n                    <div class=\"flex items-center justify-between\">\n                      <div class=\"flex-1\">\n                        <h2 class=\"text-2xl font-bold text-gray-900 mb-3 hover:text-navy-700 transition\">\\${post.title}</h2>\n                        <div class=\"flex items-center text-sm text-gray-500\">\n                          <i class=\"fas fa-user mr-2\"></i>\n                          <span>\\${post.author || 'AI ë…¼ìˆ  í‰ê°€ ì‹œìŠ¤í…œ'}</span>\n                          <span class=\"mx-2\">â€¢</span>\n                          <i class=\"fas fa-calendar mr-2\"></i>\n                          <span>\\${new Date(post.created_at).toLocaleDateString('ko-KR')}</span>\n                          \\${hasFile ? '<span class=\"mx-2\">â€¢</span><i class=\"fas fa-file-alt mr-2 text-navy-600\"></i><span class=\"text-navy-600\">ë¬¸ì„œ</span>' : ''}\n                        </div>\n                      </div>\n                      <div>\n                        <i class=\"fas \\${hasFile ? 'fa-eye' : 'fa-arrow-right'} text-3xl text-navy-700\"></i>\n                      </div>\n                    </div>\n                  </div>\n                \\`;\n              }).join('');\n            }\n          }\n          \n          function openPDF(url, title) {\n            const modal = document.createElement('div');\n            modal.id = 'pdfModal';\n            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4';\n            modal.innerHTML = \\`\n              <div class=\"bg-white rounded-lg w-full max-w-6xl h-5/6 flex flex-col\">\n                <div class=\"flex items-center justify-between p-4 border-b\">\n                  <h3 class=\"text-xl font-bold text-gray-900 truncate\">\\${title}</h3>\n                  <button onclick=\"closePDF()\" class=\"text-gray-500 hover:text-gray-700 text-2xl font-bold\">\n                    <i class=\"fas fa-times\"></i>\n                  </button>\n                </div>\n                <div class=\"flex-1 overflow-auto\">\n                  <iframe src=\"\\${url}\" class=\"w-full h-full\" frameborder=\"0\"></iframe>\n                </div>\n              </div>\n            \\`;\n            document.body.appendChild(modal);\n          }\n          \n          function openDocument(url, title) {\n            const modal = document.createElement('div');\n            modal.id = 'documentModal';\n            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4';\n            modal.innerHTML = \\`\n              <div class=\"bg-white rounded-lg w-full max-w-6xl h-5/6 flex flex-col\">\n                <div class=\"flex items-center justify-between p-4 border-b bg-navy-900\">\n                  <h3 class=\"text-xl font-bold text-white truncate\">\\${title}</h3>\n                  <button onclick=\"closeDocument()\" class=\"text-white hover:text-gray-300 text-2xl font-bold p-2 hover:bg-navy-800 rounded transition\">\n                    <i class=\"fas fa-times\"></i>\n                  </button>\n                </div>\n                <div class=\"flex-1 overflow-auto bg-white\">\n                  <iframe src=\"\\${url}\" class=\"w-full h-full border-0\"></iframe>\n                </div>\n              </div>\n            \\`;\n            document.body.appendChild(modal);\n          }\n          \n          function closePDF() {\n            const modal = document.getElementById('pdfModal');\n            if (modal) {\n              modal.remove();\n            }\n          }\n          \n          function closeDocument() {\n            const modal = document.getElementById('documentModal');\n            if (modal) {\n              modal.remove();\n            }\n          }\n          \n          async function loadPosts() {\n            try {\n              if (category === 'exam') {\n                allItems = examQuestions;\n                displayItems(allItems);\n              } else {\n                const response = await axios.get('/api/resources/' + category);\n                allItems = response.data;\n                displayItems(allItems);\n              }\n            } catch (error) {\n              console.error('Error loading posts:', error);\n              document.getElementById('postsList').innerHTML = \\`\n                <div class=\"text-center py-8 text-red-600\">\n                  <i class=\"fas fa-exclamation-triangle text-3xl mb-3\"></i>\n                  <p>ìë£Œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>\n                </div>\n              \\`;\n            }\n          }\n          \n          loadPosts();\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Resource Detail Page\napp.get('/resource/:id', async (c) => {\n  const id = c.req.param('id')\n  \n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ìë£Œ ìƒì„¸ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    100: '#e0e9ff',\n                    200: '#c7d7ff',\n                    300: '#a4b8ff',\n                    400: '#8195ff',\n                    500: '#6366f1',\n                    600: '#4f46e5',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/\" class=\"text-gray-700 hover:text-navy-700 font-medium\">í™ˆ</a>\n                        <button onclick=\"history.back()\" class=\"text-gray-700 hover:text-navy-700 font-medium\">\n                          <i class=\"fas fa-arrow-left mr-2\"></i>ëª©ë¡ìœ¼ë¡œ\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <div id=\"postDetail\">\n                <p class=\"text-gray-500 text-center py-8\">ìë£Œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          // Simple markdown-like formatting to HTML converter\n          function formatContent(content) {\n            // If content already contains HTML tags (rubric-container, div class, etc.), return as-is\n            if (content.includes('<div') || content.includes('rubric-container')) {\n              return content;\n            }\n            \n            // Otherwise, apply simple markdown-like formatting\n            return content\n              .split('\\\\n')\n              .map(line => {\n                // Convert **text** to <strong>text</strong>\n                line = line.replace(/\\\\*\\\\*(.*?)\\\\*\\\\*/g, '<strong class=\"text-navy-900 font-bold\">$1</strong>');\n                \n                // Convert bullet points (â€¢) to proper list items\n                if (line.trim().startsWith('â€¢')) {\n                  return \\`<li class=\"ml-4 mb-2 text-gray-700\">\\${line.replace('â€¢', '').trim()}</li>\\`;\n                }\n                \n                // Empty lines\n                if (line.trim() === '') {\n                  return '<div class=\"h-2\"></div>';\n                }\n                \n                // Regular paragraphs\n                return \\`<p class=\"mb-3 text-gray-700 leading-relaxed\">\\${line}</p>\\`;\n              })\n              .join('');\n          }\n        \n          async function loadPost() {\n            try {\n              const response = await axios.get('/api/resource/${id}');\n              const post = response.data;\n              \n              const categoryName = post.category === 'rubric' ? 'ë£¨ë¸Œë¦­' : 'ë…¼ìˆ  í‰ê°€ ìë£Œ';\n              const formattedContent = formatContent(post.content);\n              \n              document.getElementById('postDetail').innerHTML = \\`\n                <div class=\"bg-white rounded-xl shadow-lg p-8\">\n                  <div class=\"mb-6\">\n                    <span class=\"inline-block bg-navy-100 text-navy-800 px-3 py-1 rounded-full text-sm font-semibold mb-4\">\n                      \\${categoryName}\n                    </span>\n                    <h1 class=\"text-4xl font-bold text-gray-900 mb-4\">\\${post.title}</h1>\n                    <div class=\"flex items-center text-sm text-gray-500\">\n                      <i class=\"fas fa-user mr-2\"></i>\n                      <span>\\${post.author || 'Admin'}</span>\n                      <span class=\"mx-2\">â€¢</span>\n                      <i class=\"fas fa-calendar mr-2\"></i>\n                      <span>\\${new Date(post.created_at).toLocaleDateString('ko-KR')}</span>\n                      <span class=\"mx-2\">â€¢</span>\n                      <i class=\"fas fa-clock mr-2\"></i>\n                      <span>\\${new Date(post.updated_at).toLocaleDateString('ko-KR')} ìˆ˜ì •</span>\n                    </div>\n                  </div>\n                  \n                  <div class=\"border-t border-gray-200 pt-8\">\n                    <div class=\"prose prose-lg max-w-none\">\n                      \\${formattedContent}\n                    </div>\n                  </div>\n                  \n                  <div class=\"mt-8 pt-6 border-t border-gray-200 flex justify-between\">\n                    <button onclick=\"history.back()\" class=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition\">\n                      <i class=\"fas fa-arrow-left mr-2\"></i>ëª©ë¡ìœ¼ë¡œ\n                    </button>\n                    <a href=\"/admin/edit/\\${post.id}\" class=\"px-6 py-3 bg-navy-900 text-white rounded-lg font-semibold hover:bg-navy-800 transition\">\n                      <i class=\"fas fa-edit mr-2\"></i>ìˆ˜ì •í•˜ê¸°\n                    </a>\n                  </div>\n                </div>\n              \\`;\n            } catch (error) {\n              console.error('Error loading post:', error);\n              document.getElementById('postDetail').innerHTML = \\`\n                <div class=\"text-center py-8 text-red-600\">\n                  <i class=\"fas fa-exclamation-triangle text-3xl mb-3\"></i>\n                  <p>ìë£Œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>\n                </div>\n              \\`;\n            }\n          }\n          \n          loadPost();\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Student Login Page\napp.get('/student/login', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>í•™ìƒ ë¡œê·¸ì¸ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n    </head>\n    <body class=\"bg-gray-50\">\n        <nav class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                </div>\n            </div>\n        </nav>\n\n        <div class=\"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n            <div class=\"max-w-md w-full space-y-8\">\n                <div>\n                    <h2 class=\"mt-6 text-center text-3xl font-bold text-gray-900\">\n                        í•™ìƒ ë¡œê·¸ì¸\n                    </h2>\n                    <p class=\"mt-2 text-center text-sm text-gray-600\">\n                        ë˜ëŠ”\n                        <a href=\"/student/signup\" class=\"font-medium text-blue-600 hover:text-blue-700\">\n                            ìƒˆ ê³„ì • ë§Œë“¤ê¸°\n                        </a>\n                    </p>\n                </div>\n                <form class=\"mt-8 space-y-6\" onsubmit=\"handleLogin(event)\">\n                    <div class=\"rounded-md shadow-sm space-y-4\">\n                        <div>\n                            <label for=\"email\" class=\"block text-sm font-medium text-gray-700 mb-1\">ì´ë©”ì¼</label>\n                            <input id=\"email\" name=\"email\" type=\"email\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500\" \n                                   placeholder=\"ì´ë©”ì¼ ì£¼ì†Œ\">\n                        </div>\n                        <div>\n                            <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-1\">ë¹„ë°€ë²ˆí˜¸</label>\n                            <input id=\"password\" name=\"password\" type=\"password\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500\" \n                                   placeholder=\"ë¹„ë°€ë²ˆí˜¸\">\n                        </div>\n                    </div>\n\n                    <div>\n                        <button type=\"submit\" \n                                class=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\">\n                            ë¡œê·¸ì¸\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          async function handleLogin(event) {\n            event.preventDefault();\n            \n            const email = document.getElementById('email').value;\n            const password = document.getElementById('password').value;\n            \n            try {\n              const response = await axios.post('/api/student/auth/login', {\n                email,\n                password\n              });\n              \n              if (response.data.success) {\n                localStorage.setItem('student_session_id', response.data.session_id);\n                localStorage.setItem('student_name', response.data.student.name);\n                localStorage.setItem('student_email', response.data.student.email);\n                localStorage.setItem('student_grade_level', response.data.student.grade_level);\n                localStorage.setItem('isLoggedIn', 'true');\n                \n                alert(\\`í™˜ì˜í•©ë‹ˆë‹¤, \\${response.data.student.name}ë‹˜!\\`);\n                window.location.href = '/student/dashboard';\n              }\n            } catch (error) {\n              alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (error.response?.data?.error || error.message));\n            }\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Student Signup Page\napp.get('/student/signup', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>í•™ìƒ íšŒì›ê°€ì… | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n    </head>\n    <body class=\"bg-gray-50\">\n        <nav class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                </div>\n            </div>\n        </nav>\n\n        <div class=\"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n            <div class=\"max-w-md w-full space-y-8\">\n                <div>\n                    <h2 class=\"mt-6 text-center text-3xl font-bold text-gray-900\">\n                        í•™ìƒ íšŒì›ê°€ì…\n                    </h2>\n                    <p class=\"mt-2 text-center text-sm text-gray-600\">\n                        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?\n                        <a href=\"/student/login\" class=\"font-medium text-blue-600 hover:text-blue-700\">\n                            ë¡œê·¸ì¸í•˜ê¸°\n                        </a>\n                    </p>\n                </div>\n                <form class=\"mt-8 space-y-6\" onsubmit=\"handleSignup(event)\">\n                    <div class=\"rounded-md shadow-sm space-y-4\">\n                        <div>\n                            <label for=\"name\" class=\"block text-sm font-medium text-gray-700 mb-1\">ì´ë¦„</label>\n                            <input id=\"name\" name=\"name\" type=\"text\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500\" \n                                   placeholder=\"ì´ë¦„\">\n                        </div>\n                        <div>\n                            <label for=\"email\" class=\"block text-sm font-medium text-gray-700 mb-1\">ì´ë©”ì¼</label>\n                            <input id=\"email\" name=\"email\" type=\"email\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500\" \n                                   placeholder=\"ì´ë©”ì¼ ì£¼ì†Œ\">\n                        </div>\n                        <div>\n                            <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-1\">ë¹„ë°€ë²ˆí˜¸</label>\n                            <input id=\"password\" name=\"password\" type=\"password\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500\" \n                                   placeholder=\"ë¹„ë°€ë²ˆí˜¸ (8ì ì´ìƒ)\">\n                        </div>\n                        <div>\n                            <label for=\"grade_level\" class=\"block text-sm font-medium text-gray-700 mb-1\">í•™ë…„</label>\n                            <select id=\"grade_level\" name=\"grade_level\" required\n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500\">\n                                <option value=\"\">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”</option>\n                                <option value=\"ì´ˆë“±í•™êµ\">ì´ˆë“±í•™êµ</option>\n                                <option value=\"ì¤‘í•™êµ 1í•™ë…„\">ì¤‘í•™êµ 1í•™ë…„</option>\n                                <option value=\"ì¤‘í•™êµ 2í•™ë…„\">ì¤‘í•™êµ 2í•™ë…„</option>\n                                <option value=\"ì¤‘í•™êµ 3í•™ë…„\">ì¤‘í•™êµ 3í•™ë…„</option>\n                                <option value=\"ê³ ë“±í•™êµ 1í•™ë…„\">ê³ ë“±í•™êµ 1í•™ë…„</option>\n                                <option value=\"ê³ ë“±í•™êµ 2í•™ë…„\">ê³ ë“±í•™êµ 2í•™ë…„</option>\n                                <option value=\"ê³ ë“±í•™êµ 3í•™ë…„\">ê³ ë“±í•™êµ 3í•™ë…„</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <div>\n                        <button type=\"submit\" \n                                class=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\">\n                            íšŒì›ê°€ì…\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          async function handleSignup(event) {\n            event.preventDefault();\n            \n            const name = document.getElementById('name').value;\n            const email = document.getElementById('email').value;\n            const password = document.getElementById('password').value;\n            const grade_level = document.getElementById('grade_level').value;\n            \n            if (password.length < 8) {\n              alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤');\n              return;\n            }\n            \n            try {\n              const response = await axios.post('/api/student/auth/signup', {\n                name,\n                email,\n                password,\n                grade_level\n              });\n              \n              if (response.data.success) {\n                alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');\n                window.location.href = '/student/login';\n              }\n            } catch (error) {\n              alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + (error.response?.data?.error || error.message));\n            }\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Teacher Login Page\napp.get('/login', (c) => {\n  const type = c.req.query('type') || 'teacher';\n  const isTeacher = type === 'teacher';\n  const pageTitle = isTeacher ? 'êµì‚¬ ë¡œê·¸ì¸' : 'í•™ìƒ ë¡œê·¸ì¸';\n  const icon = isTeacher ? 'fa-chalkboard-teacher' : 'fa-user-graduate';\n  const alternateType = isTeacher ? 'student' : 'teacher';\n  const alternateText = isTeacher ? 'í•™ìƒì´ì‹ ê°€ìš”?' : 'êµì‚¬ì´ì‹ ê°€ìš”?';\n  const alternateLink = isTeacher ? 'í•™ìƒ ë¡œê·¸ì¸' : 'êµì‚¬ ë¡œê·¸ì¸';\n  \n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>${pageTitle} | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Login Form -->\n        <div class=\"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n            <div class=\"max-w-md w-full space-y-8\">\n                <div>\n                    <div class=\"flex justify-center mb-4\">\n                        <div class=\"w-16 h-16 bg-navy-100 rounded-full flex items-center justify-center\">\n                            <i class=\"fas ${icon} text-3xl text-navy-900\"></i>\n                        </div>\n                    </div>\n                    <h2 class=\"mt-6 text-center text-3xl font-bold text-gray-900\">\n                        ${pageTitle}\n                    </h2>\n                    <p class=\"mt-2 text-center text-sm text-gray-600\">\n                        ë˜ëŠ”\n                        <a href=\"/signup\" class=\"font-medium text-navy-700 hover:text-navy-800\">\n                            ìƒˆ ê³„ì • ë§Œë“¤ê¸°\n                        </a>\n                    </p>\n                    <p class=\"mt-1 text-center text-sm text-gray-600\">\n                        ${alternateText}\n                        <a href=\"/login?type=${alternateType}\" class=\"font-medium text-blue-600 hover:text-blue-700\">\n                            ${alternateLink}\n                        </a>\n                    </p>\n                </div>\n                <form class=\"mt-8 space-y-6\" onsubmit=\"handleLogin(event)\">\n                    <div class=\"rounded-md shadow-sm -space-y-px\">\n                        <div>\n                            <label for=\"email\" class=\"sr-only\">ì´ë©”ì¼</label>\n                            <input id=\"email\" name=\"email\" type=\"email\" required \n                                   class=\"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-navy-700 focus:border-navy-700 focus:z-10 sm:text-sm\" \n                                   placeholder=\"ì´ë©”ì¼ ì£¼ì†Œ\">\n                        </div>\n                        <div>\n                            <label for=\"password\" class=\"sr-only\">ë¹„ë°€ë²ˆí˜¸</label>\n                            <input id=\"password\" name=\"password\" type=\"password\" required \n                                   class=\"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-navy-700 focus:border-navy-700 focus:z-10 sm:text-sm\" \n                                   placeholder=\"ë¹„ë°€ë²ˆí˜¸\">\n                        </div>\n                    </div>\n\n                    <div class=\"flex items-center justify-between\">\n                        <div class=\"flex items-center\">\n                            <input id=\"remember-me\" name=\"remember-me\" type=\"checkbox\" \n                                   class=\"h-4 w-4 text-navy-700 focus:ring-navy-700 border-gray-300 rounded\">\n                            <label for=\"remember-me\" class=\"ml-2 block text-sm text-gray-900\">\n                                ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€\n                            </label>\n                        </div>\n\n                        <div class=\"text-sm\">\n                            <a href=\"/forgot-password\" class=\"font-medium text-navy-700 hover:text-navy-800\">\n                                ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°\n                            </a>\n                        </div>\n                    </div>\n\n                    <div>\n                        <button type=\"submit\" \n                                class=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-navy-900 hover:bg-navy-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-navy-700\">\n                            <span class=\"absolute left-0 inset-y-0 flex items-center pl-3\">\n                                <i class=\"fas fa-lock text-navy-700 group-hover:text-navy-800\"></i>\n                            </span>\n                            ë¡œê·¸ì¸\n                        </button>\n                    </div>\n                </form>\n\n                <div class=\"mt-6\">\n                    <div class=\"relative\">\n                        <div class=\"absolute inset-0 flex items-center\">\n                            <div class=\"w-full border-t border-gray-300\"></div>\n                        </div>\n                        <div class=\"relative flex justify-center text-sm\">\n                            <span class=\"px-2 bg-gray-50 text-gray-500\">ë˜ëŠ” ë‹¤ìŒìœ¼ë¡œ ê³„ì†í•˜ê¸°</span>\n                        </div>\n                    </div>\n\n                    <div class=\"mt-6 grid grid-cols-2 gap-3\">\n                        <button class=\"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\">\n                            <i class=\"fab fa-google text-red-500 mr-2\"></i>\n                            Google\n                        </button>\n                        <button class=\"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\">\n                            <i class=\"fas fa-comment text-yellow-400 mr-2\"></i>\n                            Kakao\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          const urlParams = new URLSearchParams(window.location.search);\n          const loginType = urlParams.get('type') || 'teacher';\n          const isStudentLogin = loginType === 'student';\n          \n          async function handleLogin(event) {\n            event.preventDefault();\n            \n            const email = document.getElementById('email').value;\n            const password = document.getElementById('password').value;\n            \n            try {\n              // Use different API endpoint based on login type\n              const apiEndpoint = isStudentLogin ? '/api/student/auth/login' : '/api/auth/login';\n              const response = await axios.post(apiEndpoint, {\n                email,\n                password\n              });\n              \n              if (response.data.success) {\n                if (isStudentLogin) {\n                  // Student login - store student session\n                  localStorage.setItem('student_session_id', response.data.session_id);\n                  localStorage.setItem('student_name', response.data.student.name);\n                  localStorage.setItem('student_email', response.data.student.email);\n                  localStorage.setItem('student_grade_level', response.data.student.grade_level);\n                  localStorage.setItem('isStudentLoggedIn', 'true');\n                  \n                  alert(\\`í™˜ì˜í•©ë‹ˆë‹¤, \\${response.data.student.name}ë‹˜!\\`);\n                  window.location.href = '/student/dashboard';\n                } else {\n                  // Teacher login - store teacher session\n                  localStorage.setItem('session_id', response.data.session_id);\n                  localStorage.setItem('user_name', response.data.user.name);\n                  localStorage.setItem('user_email', response.data.user.email);\n                  localStorage.setItem('isLoggedIn', 'true');\n                  \n                  alert(\\`í™˜ì˜í•©ë‹ˆë‹¤, \\${response.data.user.name}ë‹˜!\\`);\n                  window.location.href = '/my-page';\n                }\n              }\n            } catch (error) {\n              alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (error.response?.data?.error || error.message));\n            }\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Signup Page\napp.get('/signup', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>íšŒì›ê°€ì… | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Signup Form -->\n        <div class=\"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n            <div class=\"max-w-md w-full space-y-8\">\n                <div>\n                    <h2 class=\"mt-6 text-center text-3xl font-bold text-gray-900\">\n                        íšŒì›ê°€ì…\n                    </h2>\n                    <p class=\"mt-2 text-center text-sm text-gray-600\">\n                        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?\n                        <a href=\"/login\" class=\"font-medium text-navy-700 hover:text-navy-800\">\n                            ë¡œê·¸ì¸í•˜ê¸°\n                        </a>\n                    </p>\n                    <p class=\"mt-1 text-center text-sm text-gray-600\">\n                        í•™ìƒì´ì‹ ê°€ìš”?\n                        <a href=\"/student/signup\" class=\"font-medium text-blue-600 hover:text-blue-700\">\n                            í•™ìƒ íšŒì›ê°€ì…\n                        </a>\n                    </p>\n                </div>\n                \n                <!-- Google Sign Up Button -->\n                <div class=\"mt-8\">\n                    <button type=\"button\" onclick=\"signUpWithGoogle()\" \n                            class=\"w-full flex items-center justify-center gap-3 px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-navy-700 transition\">\n                        <svg class=\"w-6 h-6\" viewBox=\"0 0 24 24\">\n                            <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n                            <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n                            <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n                            <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n                        </svg>\n                        <span class=\"text-base font-medium text-gray-700\">Googleë¡œ ê°€ì…í•˜ê¸°</span>\n                    </button>\n                </div>\n                \n                <!-- Divider -->\n                <div class=\"mt-6\">\n                    <div class=\"relative\">\n                        <div class=\"absolute inset-0 flex items-center\">\n                            <div class=\"w-full border-t border-gray-300\"></div>\n                        </div>\n                        <div class=\"relative flex justify-center text-sm\">\n                            <span class=\"px-2 bg-white text-gray-500\">ë˜ëŠ” ì´ë©”ì¼ë¡œ ê°€ì…</span>\n                        </div>\n                    </div>\n                </div>\n                \n                <form class=\"mt-6 space-y-6\" onsubmit=\"handleSignup(event)\">\n                    <div class=\"rounded-md shadow-sm space-y-3\">\n                        <div>\n                            <label for=\"name\" class=\"sr-only\">ì´ë¦„</label>\n                            <input id=\"name\" name=\"name\" type=\"text\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-navy-700 focus:border-navy-700 sm:text-sm\" \n                                   placeholder=\"ì´ë¦„\">\n                        </div>\n                        <div>\n                            <label for=\"email\" class=\"sr-only\">ì´ë©”ì¼</label>\n                            <input id=\"email\" name=\"email\" type=\"email\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-navy-700 focus:border-navy-700 sm:text-sm\" \n                                   placeholder=\"ì´ë©”ì¼ ì£¼ì†Œ\">\n                        </div>\n                        <div>\n                            <label for=\"password\" class=\"sr-only\">ë¹„ë°€ë²ˆí˜¸</label>\n                            <input id=\"password\" name=\"password\" type=\"password\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-navy-700 focus:border-navy-700 sm:text-sm\" \n                                   placeholder=\"ë¹„ë°€ë²ˆí˜¸ (8ì ì´ìƒ)\">\n                        </div>\n                        <div>\n                            <label for=\"password-confirm\" class=\"sr-only\">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>\n                            <input id=\"password-confirm\" name=\"password-confirm\" type=\"password\" required \n                                   class=\"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-navy-700 focus:border-navy-700 sm:text-sm\" \n                                   placeholder=\"ë¹„ë°€ë²ˆí˜¸ í™•ì¸\">\n                        </div>\n                    </div>\n\n                    <div class=\"flex items-center\">\n                        <input id=\"terms\" name=\"terms\" type=\"checkbox\" required\n                               class=\"h-4 w-4 text-navy-700 focus:ring-navy-700 border-gray-300 rounded\">\n                        <label for=\"terms\" class=\"ml-2 block text-sm text-gray-900\">\n                            <a href=\"/terms\" class=\"text-navy-700 hover:text-navy-800\">ì´ìš©ì•½ê´€</a>ê³¼ \n                            <a href=\"/privacy\" class=\"text-navy-700 hover:text-navy-800\">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•©ë‹ˆë‹¤\n                        </label>\n                    </div>\n\n                    <div>\n                        <button type=\"submit\" \n                                class=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-navy-900 hover:bg-navy-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-navy-700\">\n                            <span class=\"absolute left-0 inset-y-0 flex items-center pl-3\">\n                                <i class=\"fas fa-user-plus text-navy-700 group-hover:text-navy-800\"></i>\n                            </span>\n                            íšŒì›ê°€ì…\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          // Google Sign Up\n          function signUpWithGoogle() {\n            // Google OAuth 2.0 ì¸ì¦ URL (ì‹¤ì œ êµ¬í˜„ ì‹œ ì„¤ì • í•„ìš”)\n            alert('Google ê°€ì… ê¸°ëŠ¥ì€ í˜„ì¬ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. Google OAuth 2.0 ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.');\n            \n            // ì‹¤ì œ êµ¬í˜„ ì˜ˆì‹œ:\n            // const clientId = 'YOUR_GOOGLE_CLIENT_ID';\n            // const redirectUri = window.location.origin + '/api/auth/google/callback';\n            // const scope = 'profile email';\n            // const googleAuthUrl = 'https://accounts.google.com/o/oauth2/v2/auth?client_id=' + clientId + '&redirect_uri=' + redirectUri + '&response_type=code&scope=' + scope;\n            // window.location.href = googleAuthUrl;\n          }\n          \n          async function handleSignup(event) {\n            event.preventDefault();\n            \n            const name = document.getElementById('name').value;\n            const email = document.getElementById('email').value;\n            const password = document.getElementById('password').value;\n            const passwordConfirm = document.getElementById('password-confirm').value;\n            \n            if (password !== passwordConfirm) {\n              alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');\n              return;\n            }\n            \n            if (password.length < 8) {\n              alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n              return;\n            }\n            \n            try {\n              const response = await axios.post('/api/auth/signup', {\n                name,\n                email,\n                password\n              });\n              \n              if (response.data.success) {\n                alert('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');\n                window.location.href = '/login';\n              }\n            } catch (error) {\n              alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + (error.response?.data?.error || error.message));\n            }\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Terms of Service Page\napp.get('/terms', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ì´ìš© ì•½ê´€ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n    </head>\n    <body class=\"bg-gray-50\">\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-10\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-gray-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                </div>\n            </div>\n        </nav>\n\n        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <h1 class=\"text-4xl font-bold text-gray-900 mb-2 text-center\">AI ë…¼ìˆ  í‰ê°€ ì„œë¹„ìŠ¤</h1>\n            <h2 class=\"text-3xl font-bold text-gray-800 mb-8 text-center\">ì´ìš©ì•½ê´€</h2>\n            \n            <div class=\"bg-white rounded-lg shadow-lg p-8\">\n                <p class=\"text-gray-700 mb-3 leading-relaxed\">AI ë…¼ìˆ  í‰ê°€ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ1ì¡° (ëª©ì )</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì´ ì•½ê´€ì€ ì‹¬ë§ˆë‹ˆ ìŠ¤í„°ë””(ì´í•˜ \"íšŒì‚¬\")ê°€ ì œê³µí•˜ëŠ” ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ë…¼ìˆ  í‰ê°€ ì„œë¹„ìŠ¤ \"AI ë…¼ìˆ  í‰ê°€\"(ì´í•˜ \"ì„œë¹„ìŠ¤\")ì˜ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ íšŒì‚¬ì™€ ì´ìš©ì ê°„ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­, ê¸°íƒ€ í•„ìš”í•œ ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ2ì¡° (ìš©ì–´ì˜ ì •ì˜)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì´ ì•½ê´€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì£¼ìš”í•œ ìš©ì–´ì˜ ì •ì˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. \"ì„œë¹„ìŠ¤\"ë€ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” AI ê¸°ë°˜ ë…¼ìˆ  ë‹µì•ˆì§€ í‰ê°€ ë° ê´€ë ¨ ì œë°˜ ì„œë¹„ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. \"íšŒì›\"ì´ë€ ì´ ì•½ê´€ì— ë™ì˜í•˜ê³  íšŒì‚¬ì™€ ì„œë¹„ìŠ¤ ì´ìš©ê³„ì•½ì„ ì²´ê²°í•˜ê³ , íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ìë¥¼ ë§í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. \"ì•„ì´ë””(ID)\"ë€ íšŒì›ì˜ ì‹ë³„ê³¼ ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•˜ì—¬ íšŒì›ì´ ì„¤ì •í•˜ê³  íšŒì‚¬ê°€ ìŠ¹ì¸í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë§í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">4. \"ë¹„ë°€ë²ˆí˜¸\"ë€ íšŒì›ì˜ ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ íšŒì› ìì‹ ì´ ì„¤ì •í•œ ë¬¸ìì™€ ìˆ«ìì˜ ì¡°í•©ì„ ë§í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">5. \"êµ¬ë…\"ì´ë€ ì¼ì • ê¸°ê°„ ë™ì•ˆ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆëŠ” ê¶Œë¦¬ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">6. \"ì •ê¸°ê²°ì œ\"ë€ íšŒì›ì´ ì„ íƒí•œ êµ¬ë… í”Œëœì— ë”°ë¼ ìë™ìœ¼ë¡œ ê²°ì œê°€ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ3ì¡° (ì•½ê´€ì˜ íš¨ë ¥ ë° ë³€ê²½)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. ì´ ì•½ê´€ì€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê³ ì í•˜ëŠ” ëª¨ë“  íšŒì›ì—ê²Œ ê·¸ íš¨ë ¥ì´ ë°œìƒí•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” í•„ìš”í•œ ê²½ìš° ê´€ë ¨ ë²•ë ¹ì„ ìœ„ë°°í•˜ì§€ ì•ŠëŠ” ë²”ìœ„ ë‚´ì—ì„œ ì´ ì•½ê´€ì„ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°, ì•½ê´€ì´ ë³€ê²½ë˜ëŠ” ê²½ìš° ë³€ê²½ì‚¬í•­ì„ ì‹œí–‰ì¼ì 7ì¼ ì „ë¶€í„° ê³µì§€í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. íšŒì›ì´ ë³€ê²½ëœ ì•½ê´€ì— ë™ì˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ì„œë¹„ìŠ¤ ì´ìš©ì„ ì¤‘ë‹¨í•˜ê³  íƒˆí‡´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€ê²½ëœ ì•½ê´€ì˜ íš¨ë ¥ ë°œìƒì¼ ì´í›„ì—ë„ ì„œë¹„ìŠ¤ë¥¼ ê³„ì† ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” ì•½ê´€ ë³€ê²½ì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ4ì¡° (íšŒì›ê°€ì…)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì›ê°€ì…ì€ ì´ìš©ì‹ ì²­ìê°€ ì•½ê´€ì˜ ë‚´ìš©ì— ëŒ€í•˜ì—¬ ë™ì˜í•˜ê³  íšŒì›ê°€ì… ì‹ ì²­ì„ í•œ í›„ íšŒì‚¬ê°€ ì´ëŸ¬í•œ ì‹ ì²­ì— ëŒ€í•˜ì—¬ ìŠ¹ì¸í•¨ìœ¼ë¡œì¨ ì²´ê²°ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” ë‹¤ìŒ ê° í˜¸ì— í•´ë‹¹í•˜ëŠ” ì‹ ì²­ì— ëŒ€í•˜ì—¬ëŠ” ìŠ¹ì¸ì„ í•˜ì§€ ì•Šê±°ë‚˜ ì‚¬í›„ì— ì´ìš©ê³„ì•½ì„ í•´ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì‹¤ëª…ì´ ì•„ë‹ˆê±°ë‚˜ íƒ€ì¸ì˜ ëª…ì˜ë¥¼ ì´ìš©í•œ ê²½ìš°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ í—ˆìœ„ì˜ ì •ë³´ë¥¼ ê¸°ì¬í•˜ê±°ë‚˜, íšŒì‚¬ê°€ ì œì‹œí•˜ëŠ” ë‚´ìš©ì„ ê¸°ì¬í•˜ì§€ ì•Šì€ ê²½ìš°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ 14ì„¸ ë¯¸ë§Œ ì•„ë™ì´ ë²•ì • ëŒ€ë¦¬ì¸ì˜ ë™ì˜ë¥¼ ì–»ì§€ ì•„ë‹ˆí•œ ê²½ìš°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì´ìš©ìì˜ ê·€ì±…ì‚¬ìœ ë¡œ ì¸í•˜ì—¬ ìŠ¹ì¸ì´ ë¶ˆê°€ëŠ¥í•˜ê±°ë‚˜ ê¸°íƒ€ ê·œì •í•œ ì œë°˜ ì‚¬í•­ì„ ìœ„ë°˜í•˜ë©° ì‹ ì²­í•˜ëŠ” ê²½ìš°</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ5ì¡° (íšŒì›íƒˆí‡´ ë° ìê²© ìƒì‹¤)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì›ì€ ì–¸ì œë“ ì§€ íƒˆí‡´ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìœ¼ë©°, íšŒì‚¬ëŠ” ì¦‰ì‹œ íšŒì›íƒˆí‡´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì›ì´ ë‹¤ìŒ ê° í˜¸ì˜ ì‚¬ìœ ì— í•´ë‹¹í•˜ëŠ” ê²½ìš°, íšŒì‚¬ëŠ” íšŒì›ìê²©ì„ ì œí•œ ë° ì •ì§€ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê°€ì… ì‹ ì²­ ì‹œì— í—ˆìœ„ ë‚´ìš©ì„ ë“±ë¡í•œ ê²½ìš°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë‹¤ë¥¸ ì‚¬ëŒì˜ ì„œë¹„ìŠ¤ ì´ìš©ì„ ë°©í•´í•˜ê±°ë‚˜ ê·¸ ì •ë³´ë¥¼ ë„ìš©í•˜ëŠ” ë“± ì „ììƒê±°ë˜ ì§ˆì„œë¥¼ ìœ„í˜‘í•˜ëŠ” ê²½ìš°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ë²•ë ¹ ë˜ëŠ” ë³¸ ì•½ê´€ì´ ê¸ˆì§€í•˜ê±°ë‚˜ ê³µì„œì–‘ì†ì— ë°˜í•˜ëŠ” í–‰ìœ„ë¥¼ í•˜ëŠ” ê²½ìš°</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ6ì¡° (ì„œë¹„ìŠ¤ì˜ ì œê³µ ë° ë³€ê²½)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ë…¼ìˆ  ë‹µì•ˆì§€ ìë™ ì±„ì  ë° í”¼ë“œë°± ì„œë¹„ìŠ¤</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë…¼ë¦¬ êµ¬ì¡°, ê·¼ê±° íƒ€ë‹¹ì„±, ì–¸ì–´í‘œí˜„ë ¥ ë¶„ì„</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ìƒì„¸í•œ í”¼ë“œë°± ë° ê°œì„  ì œì•ˆ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê¸°íƒ€ íšŒì‚¬ê°€ ì •í•˜ëŠ” ì„œë¹„ìŠ¤</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” í•„ìš”í•œ ê²½ìš° ì„œë¹„ìŠ¤ì˜ ë‚´ìš©ì„ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°, ë³€ê²½ ì‹œ ì‚¬ì „ì— ê³µì§€í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ì˜ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•´ ì§€ì†ì ìœ¼ë¡œ ë…¸ë ¥í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ7ì¡° (ì„œë¹„ìŠ¤ì˜ ì¤‘ë‹¨)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ëŠ” ì»´í“¨í„° ë“± ì •ë³´í†µì‹  ì„¤ë¹„ì˜ ë³´ìˆ˜ ì ê²€, êµì²´ ë° ê³ ì¥, í†µì‹ ì˜ ë‘ì ˆ ë“±ì˜ ì‚¬ìœ ê°€ ë°œìƒí•œ ê²½ìš°ì—ëŠ” ì„œë¹„ìŠ¤ì˜ ì œê³µì„ ì¼ì‹œì ìœ¼ë¡œ ì¤‘ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” ì²œì¬ì§€ë³€, êµ­ê°€ë¹„ìƒì‚¬íƒœ ë“± ë¶ˆê°€í•­ë ¥ì  ì‚¬ìœ ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ëŠ” ì„œë¹„ìŠ¤ì˜ ì œê³µì„ ì œí•œí•˜ê±°ë‚˜ ì¤‘ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. ì œ1í•­ ë° ì œ2í•­ì— ì˜í•œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì˜ ê²½ìš°ì—ëŠ” íšŒì‚¬ëŠ” ì œ10ì¡°ì— ì •í•œ ë°©ë²•ìœ¼ë¡œ íšŒì›ì—ê²Œ í†µì§€í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ8ì¡° (êµ¬ë… ì„œë¹„ìŠ¤ ë° ì´ìš©ìš”ê¸ˆ)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. ì„œë¹„ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¬´ë£Œ ì²´í—˜ ë˜ëŠ” ìœ ë£Œ êµ¬ë… í˜•íƒœë¡œ ì œê³µë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. ìœ ë£Œ êµ¬ë… ì„œë¹„ìŠ¤ì˜ ì´ìš© ìš”ê¸ˆì€ íšŒì‚¬ê°€ ì •í•œ ë°”ì— ë”°ë¥´ë©°, ì„œë¹„ìŠ¤ í™”ë©´ì— ëª…ì‹œë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. íšŒì›ì€ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ê²°ì œ ìˆ˜ë‹¨(í† ìŠ¤í˜ì´ë¨¼ì¸  ë“±)ì„ í†µí•´ ì´ìš©ìš”ê¸ˆì„ ê²°ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. êµ¬ë… í”Œëœë³„ ì œê³µ í˜œíƒì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë¬´ë£Œ ì²´í—˜: ì œí•œëœ íšŸìˆ˜ì˜ ë…¼ìˆ  ë‹µì•ˆ í‰ê°€</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ìœ ë£Œ êµ¬ë…: í”Œëœë³„ ì›” ì´ìš© ê°€ëŠ¥ íšŸìˆ˜ ì œê³µ</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ9ì¡° (ì •ê¸°ê²°ì œ ë° í™˜ë¶ˆ ê·œì •)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. ì •ê¸° ê²°ì œ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘  íšŒì›ì´ ì •ê¸°ê²°ì œë¥¼ ì‹ ì²­í•œ ê²½ìš°, ìµœì´ˆ ê²°ì œì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ë§¤ì›” ìë™ìœ¼ë¡œ ê²°ì œê°€ ì§„í–‰ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì •ê¸°ê²°ì œëŠ” íšŒì›ì´ í•´ì§€í•˜ê¸° ì „ê¹Œì§€ ìë™ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¡ íšŒì›ì€ ì–¸ì œë“ ì§€ ì •ê¸°ê²°ì œë¥¼ í•´ì§€í•  ìˆ˜ ìˆìœ¼ë©°, í•´ì§€ ì‹œ ë‹¤ìŒ ê²°ì œì¼ë¶€í„° ì²­êµ¬ê°€ ì¤‘ë‹¨ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì •ê¸°ê²°ì œ ìˆ˜ë‹¨(ì¹´ë“œ ë“±)ì˜ ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš°, ê³ ê°ì„¼í„°ë¥¼ í†µí•´ ë³€ê²½ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. í™˜ë¶ˆ ê·œì •</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ê°€. ì¼ë°˜ í™˜ë¶ˆ ì›ì¹™</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘  ì„œë¹„ìŠ¤ ì´ìš© ì „(ê²°ì œ í›„ ì„œë¹„ìŠ¤ ë¯¸ì‚¬ìš©): ì „ì•¡ í™˜ë¶ˆ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¡ ì„œë¹„ìŠ¤ ì¼ë¶€ ì´ìš© í›„: ì‚¬ìš©í•˜ì§€ ì•Šì€ ê¸°ê°„ì— ëŒ€í•´ ì¼í•  ê³„ì‚°í•˜ì—¬ í™˜ë¶ˆ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ í™˜ë¶ˆ ê¸ˆì•¡ = (êµ¬ë… ê¸ˆì•¡ / 30ì¼) Ã— ë‚¨ì€ ì¼ìˆ˜</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë‹¨, ì´ë¯¸ ì‚¬ìš©í•œ ë‹µì•ˆì§€ ì±„ì  íšŸìˆ˜ê°€ ìˆëŠ” ê²½ìš°, ì‚¬ìš© íšŸìˆ˜ì— ë”°ë¥¸ ê¸ˆì•¡ì„ ì°¨ê°</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¢ ê²°ì œ ìˆ˜ë‹¨ì˜ í™˜ë¶ˆ ìˆ˜ìˆ˜ë£Œê°€ ë°œìƒí•˜ëŠ” ê²½ìš°, í•´ë‹¹ ìˆ˜ìˆ˜ë£ŒëŠ” íšŒì›ì´ ë¶€ë‹´í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë‚˜. ì •ê¸°ê²°ì œ ì¤‘ë„ í•´ì§€ ì‹œ í™˜ë¶ˆ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘  ì •ê¸°ê²°ì œë¥¼ ì¤‘ë„ í•´ì§€í•˜ëŠ” ê²½ìš°, ì´ë¯¸ ê²°ì œëœ ë‹¹ì›” ì´ìš©ë£ŒëŠ” í™˜ë¶ˆë˜ì§€ ì•Šìœ¼ë©°, ë‹¹ì›” ë§ì¼ê¹Œì§€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¡ ë‹¨, ê²°ì œ í›„ 7ì¼ ì´ë‚´ì´ê³  ì„œë¹„ìŠ¤ë¥¼ ì „í˜€ ì´ìš©í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” ì „ì•¡ í™˜ë¶ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¢ ë‹¤ìŒ ë‹¬ë¶€í„°ëŠ” ê²°ì œê°€ ìë™ìœ¼ë¡œ ì¤‘ë‹¨ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë‹¤. í™˜ë¶ˆ ì œí•œ ì‚¬í•­</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘  íšŒì›ì˜ ê·€ì±…ì‚¬ìœ ë¡œ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œëœ ê²½ìš°ì—ëŠ” í™˜ë¶ˆì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¡ í• ì¸ í˜œíƒì„ ë°›ì€ ê²½ìš°, í™˜ë¶ˆ ì‹œ ì •ìƒê°€ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš© ê¸ˆì•¡ì„ ì°¨ê°í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¢ ë¬´ë£Œ ì²´í—˜ ê¸°ê°„ì€ í™˜ë¶ˆ ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë¼. í™˜ë¶ˆ ì‹ ì²­ ë°©ë²•</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘  í™˜ë¶ˆì„ ì›í•˜ì‹œëŠ” ê²½ìš°, ê³ ê°ì„¼í„°(02-6339-6059)ë¡œ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¡ í™˜ë¶ˆ ì‹ ì²­ í›„ ì˜ì—…ì¼ ê¸°ì¤€ 3~5ì¼ ì´ë‚´ì— ì²˜ë¦¬ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¢ í™˜ë¶ˆì€ ì›ê²°ì œ ìˆ˜ë‹¨ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, ì¹´ë“œ ì·¨ì†Œì˜ ê²½ìš° ì¹´ë“œì‚¬ ì •ì±…ì— ë”°ë¼ ì˜ì—…ì¼ ê¸°ì¤€ 3~7ì¼ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. ê²°ì œ ì˜¤ë¥˜ ë° ê³¼ì˜¤ë‚©</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘  ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë“±ìœ¼ë¡œ ì¸í•œ ê³¼ì˜¤ë‚©ì˜ ê²½ìš°, ì¦‰ì‹œ ì „ì•¡ í™˜ë¶ˆ ì²˜ë¦¬ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â‘¡ íšŒì›ì˜ ì‹¤ìˆ˜ë¡œ ì¸í•œ ì¤‘ë³µ ê²°ì œì˜ ê²½ìš°, ê³ ê°ì„¼í„°ë¥¼ í†µí•´ í™˜ë¶ˆ ì‹ ì²­í•˜ì‹œë©´ í™•ì¸ í›„ ì²˜ë¦¬ë©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ10ì¡° (íšŒì›ì— ëŒ€í•œ í†µì§€)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ê°€ íšŒì›ì— ëŒ€í•œ í†µì§€ë¥¼ í•˜ëŠ” ê²½ìš°, íšŒì›ì´ ë“±ë¡í•œ ì´ë©”ì¼ ì£¼ì†Œë¡œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” ë¶ˆíŠ¹ì •ë‹¤ìˆ˜ íšŒì›ì— ëŒ€í•œ í†µì§€ì˜ ê²½ìš° ì›¹ì‚¬ì´íŠ¸ ê³µì§€ì‚¬í•­ì— ê²Œì‹œí•¨ìœ¼ë¡œì¨ ê°œë³„ í†µì§€ì— ê°ˆìŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ11ì¡° (íšŒì›ì˜ ì˜ë¬´)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">íšŒì›ì€ ë‹¤ìŒ í–‰ìœ„ë¥¼ í•˜ì—¬ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â–¶ ì‹ ì²­ ë˜ëŠ” ë³€ê²½ ì‹œ í—ˆìœ„ ë‚´ìš©ì˜ ë“±ë¡</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â–¶ íƒ€ì¸ì˜ ì •ë³´ ë„ìš©</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â–¶ íšŒì‚¬ê°€ ê²Œì‹œí•œ ì •ë³´ì˜ ë³€ê²½</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â–¶ íšŒì‚¬ê°€ ì •í•œ ì •ë³´ ì´ì™¸ì˜ ì •ë³´(ì»´í“¨í„° í”„ë¡œê·¸ë¨ ë“±) ë“±ì˜ ì†¡ì‹  ë˜ëŠ” ê²Œì‹œ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â–¶ íšŒì‚¬ ê¸°íƒ€ ì œ3ìì˜ ì €ì‘ê¶Œ ë“± ì§€ì ì¬ì‚°ê¶Œì— ëŒ€í•œ ì¹¨í•´</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â–¶ íšŒì‚¬ ê¸°íƒ€ ì œ3ìì˜ ëª…ì˜ˆë¥¼ ì†ìƒì‹œí‚¤ê±°ë‚˜ ì—…ë¬´ë¥¼ ë°©í•´í•˜ëŠ” í–‰ìœ„</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">â–¶ ì™¸ì„¤ ë˜ëŠ” í­ë ¥ì ì¸ ë©”ì‹œì§€, í™”ìƒ, ìŒì„±, ê¸°íƒ€ ê³µì„œì–‘ì†ì— ë°˜í•˜ëŠ” ì •ë³´ë¥¼ ì„œë¹„ìŠ¤ì— ê³µê°œ ë˜ëŠ” ê²Œì‹œí•˜ëŠ” í–‰ìœ„</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ12ì¡° (ì €ì‘ê¶Œì˜ ê·€ì† ë° ì´ìš©ì œí•œ)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ê°€ ì‘ì„±í•œ ì €ì‘ë¬¼ì— ëŒ€í•œ ì €ì‘ê¶Œ ê¸°íƒ€ ì§€ì ì¬ì‚°ê¶Œì€ íšŒì‚¬ì— ê·€ì†í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì›ì´ ì„œë¹„ìŠ¤ ë‚´ì— ê²Œì‹œí•œ ê²Œì‹œë¬¼ì˜ ì €ì‘ê¶Œì€ í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ì €ì‘ìì—ê²Œ ê·€ì†ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. íšŒì›ì€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•¨ìœ¼ë¡œì¨ ì–»ì€ ì •ë³´ ì¤‘ íšŒì‚¬ì—ê²Œ ì§€ì ì¬ì‚°ê¶Œì´ ê·€ì†ëœ ì •ë³´ë¥¼ íšŒì‚¬ì˜ ì‚¬ì „ ìŠ¹ë‚™ ì—†ì´ ë³µì œ, ì†¡ì‹ , ì¶œíŒ, ë°°í¬, ë°©ì†¡ ê¸°íƒ€ ë°©ë²•ì— ì˜í•˜ì—¬ ì˜ë¦¬ëª©ì ìœ¼ë¡œ ì´ìš©í•˜ê±°ë‚˜ ì œ3ìì—ê²Œ ì´ìš©í•˜ê²Œ í•˜ì—¬ì„œëŠ” ì•ˆë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">4. íšŒì›ì´ ì—…ë¡œë“œí•œ ë…¼ìˆ  ë‹µì•ˆ ë° ê´€ë ¨ íŒŒì¼ì— ëŒ€í•œ ì €ì‘ê¶Œì€ íšŒì›ì—ê²Œ ìˆìœ¼ë©°, íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ ì œê³µ ëª©ì ìœ¼ë¡œë§Œ ì´ìš©í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ13ì¡° (ê°œì¸ì •ë³´ë³´í˜¸)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ëŠ” íšŒì›ì˜ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ì‹œ ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•˜ì—¬ í•„ìš”í•œ ë²”ìœ„ì—ì„œ ìµœì†Œí•œì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” íšŒì›ì˜ ê°œì¸ì •ë³´ë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•˜ì—¬ ê´€ë ¨ ë²•ë ¹ì´ ì •í•˜ëŠ” ë°”ë¥¼ ì¤€ìˆ˜í•˜ë©°, ê°œì¸ì •ë³´ì˜ ë³´í˜¸ ë° ì‚¬ìš©ì— ëŒ€í•´ì„œëŠ” ê´€ë ¨ ë²•ë ¹ ë° íšŒì‚¬ì˜ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì´ ì ìš©ë©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ14ì¡° (íšŒì‚¬ì˜ ì˜ë¬´)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ëŠ” ë²•ë ¹ê³¼ ë³¸ ì•½ê´€ì´ ê¸ˆì§€í•˜ê±°ë‚˜ ê³µì„œì–‘ì†ì— ë°˜í•˜ëŠ” í–‰ìœ„ë¥¼ í•˜ì§€ ì•Šìœ¼ë©° ë³¸ ì•½ê´€ì´ ì •í•˜ëŠ” ë°”ì— ë”°ë¼ ì§€ì†ì ì´ê³ , ì•ˆì •ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ë° ìµœì„ ì„ ë‹¤í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” íšŒì›ì´ ì•ˆì „í•˜ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë„ë¡ íšŒì›ì˜ ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•œ ë³´ì•ˆ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒí•˜ëŠ” íšŒì›ì˜ ë¶ˆë§Œ ë˜ëŠ” í”¼í•´êµ¬ì œ ìš”ì²­ì„ ì ì ˆí•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ ì¸ë ¥ ë° ì‹œìŠ¤í…œì„ êµ¬ë¹„í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ15ì¡° (ì†í•´ ë°°ìƒ)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ì˜ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ íšŒì›ì—ê²Œ ë°œìƒí•œ ì†í•´ì— ëŒ€í•˜ì—¬ íšŒì‚¬ì˜ ê³ ì˜ ë˜ëŠ” ì¤‘ê³¼ì‹¤ì´ ì—†ëŠ” í•œ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì›ì´ ë³¸ ì•½ê´€ì„ ìœ„ë°˜í•˜ì—¬ íšŒì‚¬ì— ì†í•´ê°€ ë°œìƒí•œ ê²½ìš°, íšŒì›ì€ íšŒì‚¬ì— ë°œìƒí•œ ëª¨ë“  ì†í•´ë¥¼ ë°°ìƒí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ16ì¡° (ë©´ì±… ì¡°í•­)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ëŠ” ì²œì¬ì§€ë³€ ë˜ëŠ” ì´ì— ì¤€í•˜ëŠ” ë¶ˆê°€í•­ë ¥ìœ¼ë¡œ ì¸í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ëŠ” ì„œë¹„ìŠ¤ ì œê³µì— ê´€í•œ ì±…ì„ì´ ë©´ì œë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” íšŒì›ì˜ ê·€ì±…ì‚¬ìœ ë¡œ ì¸í•œ ì„œë¹„ìŠ¤ ì´ìš©ì˜ ì¥ì• ì— ëŒ€í•˜ì—¬ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. íšŒì‚¬ëŠ” íšŒì›ì´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ê¸°ëŒ€í•˜ëŠ” ìˆ˜ìµì„ ìƒì‹¤í•œ ê²ƒì— ëŒ€í•˜ì—¬ ì±…ì„ì„ ì§€ì§€ ì•Šìœ¼ë©°, ê·¸ ë°–ì— ì„œë¹„ìŠ¤ë¥¼ í†µí•˜ì—¬ ì–»ì€ ìë£Œë¡œ ì¸í•œ ì†í•´ ë“±ì— ëŒ€í•˜ì—¬ë„ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">4. íšŒì‚¬ëŠ” AI ë¶„ì„ ê²°ê³¼ì˜ ì •í™•ì„±ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°, í•´ë‹¹ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ìœ¼ë¡œë§Œ í™œìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ17ì¡° (ë¶„ìŸ í•´ê²°)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ëŠ” íšŒì›ì´ ì œê¸°í•˜ëŠ” ì •ë‹¹í•œ ì˜ê²¬ì´ë‚˜ ë¶ˆë§Œì„ ë°˜ì˜í•˜ê³  ê·¸ í”¼í•´ë¥¼ ë³´ìƒì²˜ë¦¬í•˜ê¸° ìœ„í•˜ì—¬ í”¼í•´ë³´ìƒì²˜ë¦¬ê¸°êµ¬ë¥¼ ì„¤ì¹˜Â·ìš´ì˜í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ëŠ” íšŒì›ìœ¼ë¡œë¶€í„° ì œì¶œë˜ëŠ” ë¶ˆë§Œì‚¬í•­ ë° ì˜ê²¬ì„ ìš°ì„ ì ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ì‹ ì†í•œ ì²˜ë¦¬ê°€ ê³¤ë€í•œ ê²½ìš°ì—ëŠ” íšŒì›ì—ê²Œ ê·¸ ì‚¬ìœ ì™€ ì²˜ë¦¬ì¼ì •ì„ ì¦‰ì‹œ í†µë³´í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. íšŒì‚¬ì™€ íšŒì› ê°„ì— ë°œìƒí•œ ë¶„ìŸì€ ì „ìê±°ë˜ê¸°ë³¸ë²• ì œ28ì¡° ë° ë™ ì‹œí–‰ë ¹ ì œ15ì¡°ì— ì˜í•˜ì—¬ ì„¤ì¹˜ëœ ì „ìê±°ë˜ë¶„ìŸì¡°ì •ìœ„ì›íšŒì˜ ì¡°ì •ì— ë”°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ18ì¡° (ì¬íŒê¶Œ ë° ì¤€ê±°ë²•)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ì™€ íšŒì› ê°„ì— ë°œìƒí•œ ì „ìê±°ë˜ ë¶„ìŸì— ê´€í•œ ì†Œì†¡ì€ ì œì†Œ ë‹¹ì‹œì˜ íšŒì›ì˜ ì£¼ì†Œì— ì˜í•˜ê³ , ì£¼ì†Œê°€ ì—†ëŠ” ê²½ìš°ì—ëŠ” ê±°ì£¼ì§€ë¥¼ ê´€í• í•˜ëŠ” ì§€ë°©ë²•ì›ì˜ ì „ì†ê´€í• ë¡œ í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ì œì†Œ ë‹¹ì‹œ íšŒì›ì˜ ì£¼ì†Œ ë˜ëŠ” ê±°ì£¼ì§€ê°€ ë¶„ëª…í•˜ì§€ ì•Šê±°ë‚˜ ì™¸êµ­ ê±°ì£¼ìì˜ ê²½ìš°ì—ëŠ” ë¯¼ì‚¬ì†Œì†¡ë²•ìƒì˜ ê´€í• ë²•ì›ì— ì œê¸°í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì‚¬ì™€ íšŒì› ê°„ì— ì œê¸°ëœ ì „ìê±°ë˜ ì†Œì†¡ì—ëŠ” ëŒ€í•œë¯¼êµ­ ë²•ë¥ ì„ ì ìš©í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë¶€ì¹™</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì´ ì•½ê´€ì€ 2026ë…„ 1ì›” 3ì¼ë¶€í„° ì‹œí–‰ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì´ ì´ìš©ì•½ê´€ì— ëŒ€í•œ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ê³ ê°ì„¼í„°(02-6339-6059)ë¡œ ì—°ë½ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>\n            </div>\n            \n            <div class=\"mt-8 text-center\">\n                <a href=\"/\" class=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium\">\n                    <i class=\"fas fa-arrow-left mr-2\"></i>í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°\n                </a>\n            </div>\n        </div>\n    </body>\n    </html>\n  `)\n})\n\n// Privacy Policy Page\napp.get('/privacy', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n    </head>\n    <body class=\"bg-gray-50\">\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-10\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-gray-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                </div>\n            </div>\n        </nav>\n\n        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <h1 class=\"text-4xl font-bold text-gray-900 mb-8 text-center\">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</h1>\n            \n            <div class=\"bg-white rounded-lg shadow-lg p-8\">\n                <p class=\"text-gray-700 mb-3 leading-relaxed\">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ1ì¡° (ê°œì¸ì •ë³´ì˜ ì²˜ë¦¬ ëª©ì )</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì‹¬ë§ˆë‹ˆ ìŠ¤í„°ë””(ì´í•˜ \"íšŒì‚¬\")ëŠ” ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì¤‘ìš”ì‹œí•˜ë©°, ã€Œê°œì¸ì •ë³´ ë³´í˜¸ë²•ã€, ã€Œì •ë³´í†µì‹ ë§ ì´ìš©ì´‰ì§„ ë° ì •ë³´ë³´í˜¸ ë“±ì— ê´€í•œ ë²•ë¥ ã€ ë“± ê´€ë ¨ ë²•ë ¹ì„ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. íšŒì‚¬ëŠ” ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì„ í†µí•˜ì—¬ ì´ìš©ìê°€ ì œê³µí•˜ëŠ” ê°œì¸ì •ë³´ê°€ ì–´ë– í•œ ìš©ë„ì™€ ë°©ì‹ìœ¼ë¡œ ì´ìš©ë˜ê³  ìˆìœ¼ë©°, ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ì–´ë– í•œ ì¡°ì¹˜ê°€ ì·¨í•´ì§€ê³  ìˆëŠ”ì§€ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ2ì¡° (ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ì˜ í•­ëª© ë° ìˆ˜ì§‘ ë°©ë²•)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ì˜ í•­ëª©</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ê°€. íšŒì›ê°€ì… ì‹œ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ í•„ìˆ˜í•­ëª©: ì´ë©”ì¼ ì£¼ì†Œ, ë¹„ë°€ë²ˆí˜¸, ì‚¬ìš©ìëª…</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì†Œì…œ(SNS)ì„ í†µí•˜ì—¬ íšŒì›ê°€ì…í•˜ëŠ” ê²½ìš° : ì†Œì…œ(SNS)ì—ì„œ ì œê³µí•˜ëŠ” ì‚¬ìš©ìì˜ ê³„ì • ì •ë³´ì™€ ì¹œêµ¬ ê´€ê³„ ì •ë³´ ë“± ì—°ë™ë˜ëŠ” SNSì—ì„œ í—ˆìš©í•˜ëŠ” ëª¨ë“  ì •ë³´</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë‚˜. ì„œë¹„ìŠ¤ ì´ìš© ì‹œ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì§ì ‘ ì‘ì„±í•˜ê±°ë‚˜ ì—…ë¡œë“œí•œ ë…¼ìˆ  ë¬¸ì œ ë° í‰ê°€ ê¸°ì¤€ íŒŒì¼</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì§ì ‘ ì‘ì„±í•˜ê±°ë‚˜ ì—…ë¡œë“œí•œ í•™ìƒ ë‹µì•ˆ íŒŒì¼</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ AI ë¶„ì„ ê²°ê³¼ ë° ì²¨ì‚­ ë°ì´í„°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì„œë¹„ìŠ¤ ì´ìš© ê¸°ë¡, ì ‘ì† ë¡œê·¸, IP ì£¼ì†Œ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë‹¤. ê²°ì œ ì‹œ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê²°ì œ ì •ë³´ëŠ” ê³„ì•½ëœ PGì‚¬ë¥¼ í†µí•´ ì²˜ë¦¬ë˜ë©°, íšŒì‚¬ëŠ” ê²°ì œ ì™„ë£Œ ì •ë³´ë§Œ ìˆ˜ì‹ í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì¹´ë“œë²ˆí˜¸, ìœ íš¨ê¸°ê°„ ë“± ë¯¼ê°í•œ ê²°ì œì •ë³´ëŠ” íšŒì‚¬ê°€ ì§ì ‘ ë³´ê´€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë°©ë²•</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì›¹ì‚¬ì´íŠ¸ë¥¼ í†µí•œ íšŒì›ê°€ì… ë° ì„œë¹„ìŠ¤ ì´ìš©</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ íŒŒì¼ ì—…ë¡œë“œ ë° ì„œë¹„ìŠ¤ ì´ìš© ê³¼ì •</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê³ ê°ì„¼í„°ë¥¼ í†µí•œ ìƒë‹´ ê³¼ì •</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ3ì¡° (ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì )</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">íšŒì‚¬ëŠ” ìˆ˜ì§‘í•œ ê°œì¸ì •ë³´ë¥¼ ë‹¤ìŒì˜ ëª©ì ì„ ìœ„í•´ í™œìš©í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. ì„œë¹„ìŠ¤ ì œê³µ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ AI ë…¼ìˆ  ì²¨ì‚­ ì„œë¹„ìŠ¤ ì œê³µ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë¬¸ì œ ë° ê¸°ì¤€ ì—…ë¡œë“œ, ë‹µì•ˆ ì œì¶œ, ë¶„ì„ ê²°ê³¼ ì œê³µ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë§ì¶¤í˜• í•™ìŠµ í”¼ë“œë°± ì œê³µ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íšŒì› ê´€ë¦¬</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ íšŒì›ì œ ì„œë¹„ìŠ¤ ì´ìš©ì— ë”°ë¥¸ ë³¸ì¸ í™•ì¸, ê°œì¸ ì‹ë³„</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë¶ˆë²•ì  ì´ìš© ë°©ì§€ ë° ë¹„ì¸ê°€ ì‚¬ìš© ë°©ì§€</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê°€ì… ì˜ì‚¬ í™•ì¸, ì—°ë ¹í™•ì¸</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë¶ˆë§Œì²˜ë¦¬ ë“± ë¯¼ì›ì²˜ë¦¬, ê³ ì§€ì‚¬í•­ ì „ë‹¬</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">3. ìš”ê¸ˆ ê²°ì œ ë° ì •ì‚°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ êµ¬ë… ì„œë¹„ìŠ¤ ì´ìš©ì— ëŒ€í•œ ìš”ê¸ˆ ê²°ì œ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì •ê¸°ê²°ì œ ì²˜ë¦¬ ë° ê²°ì œ ë‚´ì—­ ê´€ë¦¬</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ í™˜ë¶ˆ ì²˜ë¦¬</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">4. ì„œë¹„ìŠ¤ ê°œì„ </p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì‹ ê·œ ì„œë¹„ìŠ¤ ê°œë°œ ë° ê¸°ì¡´ ì„œë¹„ìŠ¤ ê°œì„ </p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ í†µê³„í•™ì  íŠ¹ì„±ì— ë”°ë¥¸ ì„œë¹„ìŠ¤ ì œê³µ ë° ê´‘ê³  ê²Œì¬</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì„œë¹„ìŠ¤ ì´ìš© í†µê³„ ë¶„ì„</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ4ì¡° (ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš© ê¸°ê°„)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">íšŒì‚¬ëŠ” ì›ì¹™ì ìœ¼ë¡œ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì ì´ ë‹¬ì„±ëœ í›„ì—ëŠ” í•´ë‹¹ ì •ë³´ë¥¼ ì§€ì²´ì—†ì´ íŒŒê¸°í•©ë‹ˆë‹¤. ë‹¨, ë‹¤ìŒì˜ ì •ë³´ì— ëŒ€í•´ì„œëŠ” ì•„ë˜ì˜ ì´ìœ ë¡œ ëª…ì‹œí•œ ê¸°ê°„ ë™ì•ˆ ë³´ì¡´í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íšŒì‚¬ ë‚´ë¶€ ë°©ì¹¨ì— ì˜í•œ ì •ë³´ë³´ìœ  ì‚¬ìœ </p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë¶€ì • ì´ìš© ê¸°ë¡: 1ë…„ (ë¶€ì • ì´ìš© ë°©ì§€)</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì„œë¹„ìŠ¤ ì´ìš© ê¸°ë¡: íšŒì› íƒˆí‡´ ì‹œê¹Œì§€</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. ê´€ë ¨ ë²•ë ¹ì— ì˜í•œ ì •ë³´ë³´ìœ  ì‚¬ìœ </p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê³„ì•½ ë˜ëŠ” ì²­ì•½ì² íšŒ ë“±ì— ê´€í•œ ê¸°ë¡: 5ë…„ (ì „ììƒê±°ë˜ë²•)</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ëŒ€ê¸ˆê²°ì œ ë° ì¬í™” ë“±ì˜ ê³µê¸‰ì— ê´€í•œ ê¸°ë¡: 5ë…„ (ì „ììƒê±°ë˜ë²•)</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì†Œë¹„ìì˜ ë¶ˆë§Œ ë˜ëŠ” ë¶„ìŸì²˜ë¦¬ì— ê´€í•œ ê¸°ë¡: 3ë…„ (ì „ììƒê±°ë˜ë²•)</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸ ê¸°ë¡: 3ê°œì›” (í†µì‹ ë¹„ë°€ë³´í˜¸ë²•)</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ5ì¡° (ê°œì¸ì •ë³´ì˜ íŒŒê¸° ì ˆì°¨ ë° ë°©ë²•)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">1. íŒŒê¸° ì ˆì°¨</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì´ìš©ìê°€ íšŒì›ê°€ì… ë“±ì„ ìœ„í•´ ì…ë ¥í•œ ì •ë³´ëŠ” ëª©ì ì´ ë‹¬ì„±ëœ í›„ ë³„ë„ì˜ DBë¡œ ì˜®ê²¨ì ¸ ë‚´ë¶€ ë°©ì¹¨ ë° ê¸°íƒ€ ê´€ë ¨ ë²•ë ¹ì— ì˜í•œ ì •ë³´ë³´í˜¸ ì‚¬ìœ ì— ë”°ë¼ ì¼ì • ê¸°ê°„ ì €ì¥ëœ í›„ íŒŒê¸°ë©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">2. íŒŒê¸° ë°©ë²•</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì „ìì  íŒŒì¼ í˜•íƒœì˜ ì •ë³´: ê¸°ë¡ì„ ì¬ìƒí•  ìˆ˜ ì—†ëŠ” ê¸°ìˆ ì  ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì‚­ì œ</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì¢…ì´ì— ì¶œë ¥ëœ ê°œì¸ì •ë³´: ë¶„ì‡„ê¸°ë¡œ ë¶„ì‡„í•˜ê±°ë‚˜ ì†Œê°</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ6ì¡° (ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">íšŒì‚¬ëŠ” ì›ì¹™ì ìœ¼ë¡œ ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ì•„ë˜ì˜ ê²½ìš°ì—ëŠ” ì˜ˆì™¸ë¡œ í•©ë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ì´ìš©ìê°€ ì‚¬ì „ì— ë™ì˜í•œ ê²½ìš°</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë²•ë ¹ì˜ ê·œì •ì— ì˜ê±°í•˜ê±°ë‚˜, ìˆ˜ì‚¬ ëª©ì ìœ¼ë¡œ ë²•ë ¹ì— ì •í•´ì§„ ì ˆì°¨ì™€ ë°©ë²•ì— ë”°ë¼ ìˆ˜ì‚¬ê¸°ê´€ì˜ ìš”êµ¬ê°€ ìˆëŠ” ê²½ìš°</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ7ì¡° (ê°œì¸ì •ë³´ ì²˜ë¦¬ì˜ ìœ„íƒ)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ í–¥ìƒì„ ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ê°œì¸ì •ë³´ë¥¼ ìœ„íƒí•˜ê³  ìˆìœ¼ë©°, ê´€ê³„ ë²•ë ¹ì— ë”°ë¼ ìœ„íƒê³„ì•½ ì‹œ ê°œì¸ì •ë³´ê°€ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ ì‚¬í•­ì„ ê·œì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ìˆ˜íƒì—…ì²´</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ìœ„íƒì—…ë¬´ ë‚´ìš©</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">í† ìŠ¤í˜ì´ë¨¼ì¸ </p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ê²°ì œ ì²˜ë¦¬ ë° ê²°ì œ ì •ë³´ ê´€ë¦¬</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">Google (Gemini API)</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">AI ë…¼ìˆ  ë¶„ì„ ì„œë¹„ìŠ¤ ì œê³µ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì¹´í˜24</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŒ… ë° ê´€ë¦¬</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ8ì¡° (ì´ìš©ìì˜ ê¶Œë¦¬ì™€ í–‰ì‚¬ ë°©ë²•)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì´ìš©ìëŠ” ì–¸ì œë“ ì§€ ë‹¤ìŒ ê° í˜¸ì˜ ê°œì¸ì •ë³´ ë³´í˜¸ ê´€ë ¨ ê¶Œë¦¬ë¥¼ í–‰ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê°œì¸ì •ë³´ ì—´ëŒ ìš”êµ¬</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê°œì¸ì •ë³´ì— ì˜¤ë¥˜ê°€ ìˆì„ ê²½ìš° ì •ì • ìš”êµ¬</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê°œì¸ì •ë³´ ì‚­ì œ ìš”êµ¬</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê°œì¸ì •ë³´ ì²˜ë¦¬ ì •ì§€ ìš”êµ¬</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ìœ„ ê¶Œë¦¬ í–‰ì‚¬ëŠ” ê³ ê°ì„¼í„°ë¥¼ í†µí•´ í•˜ì‹¤ ìˆ˜ ìˆìœ¼ë©°, íšŒì‚¬ëŠ” ì´ì— ëŒ€í•´ ì§€ì²´ ì—†ì´ ì¡°ì¹˜í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ9ì¡° (ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">íšŒì‚¬ëŠ” ê°œì¸ì •ë³´ ì²˜ë¦¬ì— ê´€í•œ ì—…ë¬´ë¥¼ ì´ê´„í•´ì„œ ì±…ì„ì§€ê³ , ê°œì¸ì •ë³´ ì²˜ë¦¬ì™€ ê´€ë ¨í•œ ì´ìš©ìì˜ ë¶ˆë§Œì²˜ë¦¬ ë° í”¼í•´êµ¬ì œ ë“±ì„ ìœ„í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ìë¥¼ ì§€ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì„±ëª…: ì´ì˜ì„¸</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì§ì±…: ëŒ€í‘œ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì—°ë½ì²˜: 02-6339-6059 ë˜ëŠ” simmanistudy@google.com</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ10ì¡° (ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì˜ ë³€ê²½)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ì´ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì€ 2026ë…„ 1ì›” 3ì¼ë¶€í„° ì ìš©ë˜ë©°, ë²•ë ¹ ë° ë°©ì¹¨ì— ë”°ë¥¸ ë³€ê²½ë‚´ìš©ì˜ ì¶”ê°€, ì‚­ì œ ë° ì •ì •ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” ë³€ê²½ì‚¬í•­ì˜ ì‹œí–‰ 7ì¼ ì „ë¶€í„° ê³µì§€ì‚¬í•­ì„ í†µí•˜ì—¬ ê³ ì§€í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<h2 class=\"text-xl font-bold text-gray-800 mt-6 mb-3\">ì œ11ì¡° (ê°œì¸ì •ë³´ì˜ ì•ˆì „ì„± í™•ë³´ì¡°ì¹˜)</h2>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">íšŒì‚¬ëŠ” ê°œì¸ì •ë³´ì˜ ì•ˆì „ì„± í™•ë³´ë¥¼ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê´€ë¦¬ì  ì¡°ì¹˜: ë‚´ë¶€ê´€ë¦¬ê³„íš ìˆ˜ë¦½Â·ì‹œí–‰, ì •ê¸°ì  ì§ì› êµìœ¡</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ê¸°ìˆ ì  ì¡°ì¹˜: ê°œì¸ì •ë³´ì²˜ë¦¬ì‹œìŠ¤í…œ ë“±ì˜ ì ‘ê·¼ê¶Œí•œ ê´€ë¦¬, ì ‘ê·¼í†µì œì‹œìŠ¤í…œ ì„¤ì¹˜, ê°œì¸ì •ë³´ì˜ ì•”í˜¸í™”, ë³´ì•ˆí”„ë¡œê·¸ë¨ ì„¤ì¹˜</p>\n<p class=\"text-gray-600 ml-6 mb-2\">â€¢ ë¬¼ë¦¬ì  ì¡°ì¹˜: ì „ì‚°ì‹¤, ìë£Œë³´ê´€ì‹¤ ë“±ì˜ ì ‘ê·¼í†µì œ</p>\n<p class=\"text-gray-700 mb-3 leading-relaxed\">ë³¸ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ëŒ€í•œ ë¬¸ì˜ì‚¬í•­ì´ ìˆëŠ” ë¶„ì€ ê³ ê°ì„¼í„°(02-6339-6059)ë¡œ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>\n            </div>\n            \n            <div class=\"mt-8 text-center\">\n                <a href=\"/\" class=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium\">\n                    <i class=\"fas fa-arrow-left mr-2\"></i>í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°\n                </a>\n            </div>\n        </div>\n    </body>\n    </html>\n  `)\n})\n\n// Pricing Page\napp.get('/pricing', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ìš”ê¸ˆì œ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    100: '#e0e9ff',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n        <style>\n          .pricing-card {\n            transition: transform 0.3s ease, box-shadow 0.3s ease;\n          }\n          .pricing-card:hover {\n            transform: translateY(-8px);\n          }\n          .billing-toggle {\n            position: relative;\n            display: inline-block;\n            width: 60px;\n            height: 34px;\n          }\n          .billing-toggle input {\n            opacity: 0;\n            width: 0;\n            height: 0;\n          }\n          .slider {\n            position: absolute;\n            cursor: pointer;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background-color: #ccc;\n            transition: .4s;\n            border-radius: 34px;\n          }\n          .slider:before {\n            position: absolute;\n            content: \"\";\n            height: 26px;\n            width: 26px;\n            left: 4px;\n            bottom: 4px;\n            background-color: white;\n            transition: .4s;\n            border-radius: 50%;\n          }\n          input:checked + .slider {\n            background-color: #6366f1;\n          }\n          input:checked + .slider:before {\n            transform: translateX(26px);\n          }\n        </style>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/\" class=\"text-gray-700 hover:text-navy-700 font-medium\">í™ˆ</a>\n                        <a href=\"/login\" class=\"text-gray-700 hover:text-navy-700 font-medium\">ë¡œê·¸ì¸</a>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Pricing Section -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n            <!-- Header -->\n            <div class=\"text-center mb-12\">\n                <span class=\"inline-block bg-navy-100 text-navy-800 px-4 py-2 rounded-full text-sm font-semibold mb-4\">\n                    ìš”ê¸ˆì œ\n                </span>\n                <h1 class=\"text-4xl font-bold text-gray-900 mb-4\">ì±„ì í•´ì•¼ í•  ë¶„ëŸ‰ì— ë”°ë¥¸ ë‹¤ì–‘í•œ êµ¬ë… í”Œëœ</h1>\n                <p class=\"text-xl text-gray-600 mb-8\">\n                    ìì‹ ì˜ í‰ê°€ ê³„íšì— ë§ëŠ” ìµœì ì˜ í”Œëœì„ ì„ íƒí•˜ì—¬ AI ë…¼ìˆ  í‰ê°€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ ë³´ì„¸ìš”.\n                </p>\n                \n                <!-- Billing Toggle -->\n                <div class=\"flex items-center justify-center space-x-4 mb-4\">\n                    <span id=\"monthlyLabel\" class=\"text-lg font-semibold text-navy-900\">ì›”ê°„ ê²°ì œ</span>\n                    <label class=\"billing-toggle\">\n                        <input type=\"checkbox\" id=\"billingToggle\" onchange=\"toggleBilling()\">\n                        <span class=\"slider\"></span>\n                    </label>\n                    <span id=\"yearlyLabel\" class=\"text-lg font-semibold text-gray-500\">ë§¤ë…„</span>\n                </div>\n                <p class=\"text-purple-600 font-semibold\">\n                    <i class=\"fas fa-tag mr-2\"></i>ì—°ê°„ ê²°ì œì‹œ ìµœëŒ€ 20% í• ì¸\n                </p>\n            </div>\n\n            <!-- Pricing Cards -->\n            <div class=\"grid md:grid-cols-4 gap-6\">\n                <!-- Free Plan -->\n                <div class=\"pricing-card bg-white rounded-xl shadow-lg p-6 border border-gray-200\" data-plan=\"free\">\n                    <div class=\"mb-6\">\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-2\">ë¬´ë£Œ ì²´í—˜</h3>\n                        <p class=\"text-sm text-gray-600 mb-4\">\n                            ì •ê·œ ìˆ˜ì—…ì—ì„œ ì²˜ìŒìœ¼ë¡œ ë…¼ìˆ í˜• í‰ê°€ë¥¼ ë„ì…í•´ ë³´ë ¤ê³  í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬\n                        </p>\n                        <div class=\"text-4xl font-bold text-gray-900 mb-2\">ë¬´ë£Œ</div>\n                    </div>\n                    \n                    <ul class=\"space-y-3 mb-6 text-sm\">\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>í•œë‹¬ì— 20ê°œ ë…¼ìˆ  ë‹µì•ˆì§€ ì±„ì </span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>ë…¼ìˆ  1ê°œë‹¹ ìµœëŒ€ ê¸€ì ìˆ˜ëŠ” 3,000ì</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>ë…¼ìˆ  í‰ê°€ í”¼ë“œë°± ë° í‰ê°€ ê²°ê³¼ ë³´ê³ ì„œ ì œê³µ</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>ê°„í¸í•˜ê²Œ ë£¨ë¸Œë¦­ ì‘ì„±</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>í•™ìƒì´ ì† ê¸€ì”¨ë¡œ ì‘ì„±í•œ ë‹µì•ˆì„ ì¸ì‹í•˜ì—¬ ë””ì§€í„¸ ë¬¸ìë¡œ ë³€í™˜</span>\n                        </li>\n                    </ul>\n                    \n                    <button onclick=\"selectPlan('free', 'monthly')\" data-plan-button=\"free\" class=\"w-full bg-navy-900 text-white py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                        ë¬´ë£Œë¡œ ì‹œì‘í•˜ì„¸ìš”\n                    </button>\n                </div>\n\n                <!-- Starter Plan -->\n                <div class=\"pricing-card bg-white rounded-xl shadow-lg p-6 border border-gray-200\" data-plan=\"starter\">\n                    <div class=\"mb-6\">\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-2\">ìŠ¤íƒ€í„°</h3>\n                        <p class=\"text-sm text-gray-600 mb-4\">\n                            ë…¼ìˆ  í•™ì›ì´ë‚˜ ë°©ê³¼ í›„ ìˆ˜ì—…ì—ì„œ ë…¼ìˆ ì„ ì§€ë„í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬\n                        </p>\n                        <div class=\"monthly-price\">\n                            <div class=\"text-4xl font-bold text-gray-900\">7,500ì›<span class=\"text-lg text-gray-500\">/ì›”</span></div>\n                        </div>\n                        <div class=\"yearly-price hidden\">\n                            <div class=\"text-4xl font-bold text-gray-900\">6,000ì›<span class=\"text-lg text-gray-500\">/ì›”</span></div>\n                            <div class=\"text-sm text-gray-500\">(ì—°ê°„ 72,000ì›)</div>\n                        </div>\n                    </div>\n                    \n                    <ul class=\"space-y-3 mb-6 text-sm\">\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-arrow-left text-navy-700 mr-2 mt-1\"></i>\n                            <span>ë¬´ë£Œ ì²´í—˜ ìš”ê¸ˆì œì˜ ëª¨ë“  ê¸°ëŠ¥ +</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>í•œë‹¬ì— 90ê°œ ë…¼ìˆ  ë‹µì•ˆì§€ ì±„ì </span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>ë…¼ìˆ  1ê°œë‹¹ ìµœëŒ€ ê¸€ì ìˆ˜ëŠ” 5,000ì</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>êµì‚¬ê°€ ì¶œì œí•œ ë¬¸í•­ì— í•™ìƒì´ ì§ì ‘ ë‹µì•ˆì§€ë¥¼ ì œì¶œí•  ìˆ˜ ìˆë„ë¡ í•™ìƒ ì ‘ì† ì½”ë“œ ì œê³µ</span>\n                        </li>\n                    </ul>\n                    \n                    <button onclick=\"selectPlan('starter', 'monthly')\" data-plan-button=\"starter\" class=\"w-full bg-navy-900 text-white py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                        ë¬´ë£Œë¡œ ì‹œì‘í•˜ì„¸ìš”\n                    </button>\n                </div>\n\n                <!-- Basic Plan (Featured) -->\n                <div class=\"pricing-card bg-white rounded-xl shadow-2xl p-6 border-2 border-navy-700 relative\" data-plan=\"basic\">\n                    <div class=\"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2\">\n                        <span class=\"bg-gradient-to-r from-purple-500 to-navy-700 text-white px-6 py-1 rounded-full text-sm font-semibold flex items-center\">\n                            <i class=\"fas fa-star mr-2\"></i>ì ê·¹ ì¶”ì²œ\n                        </span>\n                    </div>\n                    \n                    <div class=\"mb-6 mt-4\">\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-2\">ë² ì´ì§</h3>\n                        <p class=\"text-sm text-gray-600 mb-4\">\n                            ì •ê·œ ìˆ˜ì—…ì—ì„œ ë…¼ìˆ  í‰ê°€ë¥¼ ì‹¤ì‹œí•´ ë³´ê³ ì í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬\n                        </p>\n                        <div class=\"monthly-price\">\n                            <div class=\"text-4xl font-bold text-gray-900\">20,000ì›<span class=\"text-lg text-gray-500\">/ì›”</span></div>\n                        </div>\n                        <div class=\"yearly-price hidden\">\n                            <div class=\"text-4xl font-bold text-gray-900\">16,000ì›<span class=\"text-lg text-gray-500\">/ì›”</span></div>\n                            <div class=\"text-sm text-gray-500\">(ì—°ê°„ 192,000ì›)</div>\n                        </div>\n                    </div>\n                    \n                    <ul class=\"space-y-3 mb-6 text-sm\">\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-arrow-left text-navy-700 mr-2 mt-1\"></i>\n                            <span>ìŠ¤íƒ€í„° ìš”ê¸ˆì œì˜ ëª¨ë“  ê¸°ëŠ¥ +</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>í•œë‹¬ì— 300ê°œ ë…¼ìˆ  ë‹µì•ˆì§€ ì±„ì </span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>ë…¼ìˆ  1ê°œë‹¹ ìµœëŒ€ ê¸€ì ìˆ˜ëŠ” 10,000ì</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>í•œ ë²ˆì— ì—¬ëŸ¬ ê°œ ë…¼ìˆ  ë‹µì•ˆì§€ ì—…ë¡œë“œ ê°€ëŠ¥</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>í•™ê¸‰ë³„ ì„±ê³¼ë¥¼ í‘œì‹œí•´ ì£¼ëŠ” ëŒ€ì‹œë³´ë“œ ì œê³µ</span>\n                        </li>\n                    </ul>\n                    \n                    <button onclick=\"selectPlan('basic', 'monthly')\" data-plan-button=\"basic\" class=\"w-full bg-gradient-to-r from-navy-700 to-navy-900 text-white py-3 rounded-lg font-semibold hover:shadow-xl transition\">\n                        ë¬´ë£Œë¡œ ì‹œì‘í•˜ì„¸ìš”\n                    </button>\n                </div>\n\n                <!-- Pro Plan -->\n                <div class=\"pricing-card bg-white rounded-xl shadow-lg p-6 border border-gray-200\" data-plan=\"pro\">\n                    <div class=\"mb-6\">\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-2\">í”„ë¡œ</h3>\n                        <p class=\"text-sm text-gray-600 mb-4\">\n                            ì•„ì£¼ ë§ì€ ë¶„ëŸ‰ì˜ ë…¼ìˆ ë¬¸ì„ ì±„ì í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬\n                        </p>\n                        <div class=\"monthly-price\">\n                            <div class=\"text-4xl font-bold text-gray-900\">39,000ì›<span class=\"text-lg text-gray-500\">/ì›”</span></div>\n                        </div>\n                        <div class=\"yearly-price hidden\">\n                            <div class=\"text-4xl font-bold text-gray-900\">31,000ì›<span class=\"text-lg text-gray-500\">/ì›”</span></div>\n                            <div class=\"text-sm text-gray-500\">(ì—°ê°„ 372,000ì›)</div>\n                        </div>\n                    </div>\n                    \n                    <ul class=\"space-y-3 mb-6 text-sm\">\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-arrow-left text-navy-700 mr-2 mt-1\"></i>\n                            <span>ë² ì´ì§ ìš”ê¸ˆì œì˜ ëª¨ë“  ê¸°ëŠ¥ +</span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>í•œë‹¬ì— 600ê°œ ë…¼ìˆ  ë‹µì•ˆì§€ ì±„ì </span>\n                        </li>\n                        <li class=\"flex items-start\">\n                            <i class=\"fas fa-check text-green-500 mr-2 mt-1\"></i>\n                            <span>ë…¼ìˆ  1ê°œë‹¹ ìµœëŒ€ ê¸€ì ìˆ˜ëŠ” 15,000ì</span>\n                        </li>\n                    </ul>\n                    \n                    <button onclick=\"selectPlan('pro', 'monthly')\" data-plan-button=\"pro\" class=\"w-full bg-navy-900 text-white py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                        ë¬´ë£Œë¡œ ì‹œì‘í•˜ì„¸ìš”\n                    </button>\n                </div>\n            </div>\n\n        </div>\n\n        <script>\n          let currentBilling = 'monthly';\n          let currentPlan = 'free'; // Default plan\n          \n          // Get current plan from URL parameter\n          window.addEventListener('DOMContentLoaded', () => {\n            // Check login status and show/hide navigation links\n            const isTeacherLoggedIn = localStorage.getItem('isLoggedIn') === 'true';\n            const isStudentLoggedIn = localStorage.getItem('isStudentLoggedIn') === 'true';\n            const isLoggedIn = isTeacherLoggedIn || isStudentLoggedIn;\n            \n            const myPageLink = document.getElementById('myPageLink');\n            const loginDropdown = document.getElementById('loginDropdown');\n            \n            if (isLoggedIn) {\n              // Show \"ë‚˜ì˜ í˜ì´ì§€\" and hide \"ë¡œê·¸ì¸\" dropdown\n              if (myPageLink) myPageLink.style.display = 'block';\n              if (loginDropdown) loginDropdown.style.display = 'none';\n            } else {\n              // Hide \"ë‚˜ì˜ í˜ì´ì§€\" and show \"ë¡œê·¸ì¸\" dropdown\n              if (myPageLink) myPageLink.style.display = 'none';\n              if (loginDropdown) loginDropdown.style.display = 'block';\n            }\n            \n            const urlParams = new URLSearchParams(window.location.search);\n            const plan = urlParams.get('plan');\n            if (plan) {\n              currentPlan = plan;\n              updatePlanDisplay();\n            }\n          });\n          \n          function updatePlanDisplay() {\n            // Hide plans based on current plan\n            if (currentPlan === 'starter') {\n              // Hide free plan for starter users\n              const freePlanCard = document.querySelector('[data-plan=\"free\"]');\n              if (freePlanCard) freePlanCard.style.display = 'none';\n            }\n            \n            // Update button texts\n            document.querySelectorAll('[data-plan-button]').forEach(button => {\n              const planType = button.getAttribute('data-plan-button');\n              if (planType === currentPlan) {\n                button.textContent = 'ì‚¬ìš© ì¤‘';\n                button.disabled = true;\n                button.classList.remove('bg-navy-900', 'hover:bg-navy-800', 'bg-gradient-to-r', 'from-navy-700', 'to-navy-900', 'hover:shadow-xl');\n                button.classList.add('bg-gray-400', 'cursor-not-allowed');\n              } else {\n                button.textContent = 'ì„ íƒí•˜ê¸°';\n              }\n            });\n          }\n          \n          function toggleBilling() {\n            const toggle = document.getElementById('billingToggle');\n            const monthlyLabel = document.getElementById('monthlyLabel');\n            const yearlyLabel = document.getElementById('yearlyLabel');\n            const monthlyPrices = document.querySelectorAll('.monthly-price');\n            const yearlyPrices = document.querySelectorAll('.yearly-price');\n            \n            if (toggle.checked) {\n              currentBilling = 'yearly';\n              monthlyLabel.classList.remove('text-navy-900');\n              monthlyLabel.classList.add('text-gray-500');\n              yearlyLabel.classList.remove('text-gray-500');\n              yearlyLabel.classList.add('text-navy-900');\n              \n              monthlyPrices.forEach(el => el.classList.add('hidden'));\n              yearlyPrices.forEach(el => el.classList.remove('hidden'));\n            } else {\n              currentBilling = 'monthly';\n              yearlyLabel.classList.remove('text-navy-900');\n              yearlyLabel.classList.add('text-gray-500');\n              monthlyLabel.classList.remove('text-gray-500');\n              monthlyLabel.classList.add('text-navy-900');\n              \n              yearlyPrices.forEach(el => el.classList.add('hidden'));\n              monthlyPrices.forEach(el => el.classList.remove('hidden'));\n            }\n          }\n          \n          function selectPlan(plan, billing) {\n            window.location.href = '/checkout?plan=' + plan + '&billing=' + currentBilling;\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Checkout Page\napp.get('/checkout', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ê²°ì œí•˜ê¸° | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    100: '#e0e9ff',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n        <style>\n          .payment-method {\n            cursor: pointer;\n            transition: all 0.3s ease;\n          }\n          .payment-method.active {\n            background-color: #1e3a8a;\n            color: white;\n            border-color: #1e3a8a;\n          }\n        </style>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                    <button onclick=\"history.back()\" class=\"text-gray-700 hover:text-navy-700 font-medium\">\n                        <i class=\"fas fa-arrow-left mr-2\"></i>ëŒì•„ê°€ê¸°\n                    </button>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <!-- Header -->\n            <div class=\"mb-8\">\n                <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">ì„ íƒí•œ ìš”ê¸ˆì œ</h1>\n            </div>\n\n            <!-- Billing Toggle -->\n            <div class=\"bg-white rounded-lg shadow-sm p-4 mb-6\">\n                <div class=\"flex items-center justify-center space-x-4\">\n                    <button id=\"monthlyBtn\" onclick=\"toggleBilling('monthly')\" class=\"px-6 py-2 rounded-lg font-semibold transition bg-navy-900 text-white\">\n                        ì›”ê°„\n                    </button>\n                    <button id=\"yearlyBtn\" onclick=\"toggleBilling('yearly')\" class=\"px-6 py-2 rounded-lg font-semibold transition bg-gray-200 text-gray-700\">\n                        ì—°ê°„ (20% í• ì¸)\n                    </button>\n                </div>\n            </div>\n\n            <!-- Plan Details -->\n            <div class=\"bg-white rounded-lg shadow-md p-8 mb-6 border-l-4 border-lime-400\">\n                <div class=\"flex justify-between items-start mb-4\">\n                    <div>\n                        <h2 id=\"planName\" class=\"text-2xl font-bold text-gray-900 mb-2\">ìŠ¤íƒ€í„° ìš”ê¸ˆì œ</h2>\n                        <p id=\"planDescription\" class=\"text-gray-600\">ë…¼ìˆ  í•™ì›ì´ë‚˜ ë°©ê³¼ í›„ ìˆ˜ì—…ì—ì„œ ë…¼ìˆ ì„ ì§€ë„í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬</p>\n                    </div>\n                    <div class=\"text-right\">\n                        <div id=\"planPrice\" class=\"text-3xl font-bold text-gray-900\">â‚©7,500<span class=\"text-lg text-gray-500\">/ì›”</span></div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Payment Method -->\n            <div class=\"bg-white rounded-lg shadow-md p-8 mb-6\">\n                <h3 class=\"text-lg font-bold text-gray-900 mb-4\">ê²°ì œ ë°©ë²•</h3>\n                <div class=\"grid grid-cols-2 gap-4\">\n                    <div class=\"payment-method active border-2 border-gray-300 rounded-lg p-4 text-center\" onclick=\"selectPaymentMethod('card')\">\n                        <i class=\"fas fa-credit-card text-2xl mb-2\"></i>\n                        <div class=\"font-semibold\">ì‹ ìš©/ì²´í¬ì¹´ë“œ</div>\n                    </div>\n                    <div class=\"payment-method border-2 border-gray-300 rounded-lg p-4 text-center\" onclick=\"selectPaymentMethod('kakao')\">\n                        <i class=\"fas fa-comment text-2xl mb-2\"></i>\n                        <div class=\"font-semibold\">ì¹´ì¹´ì˜¤í˜ì´</div>\n                    </div>\n                </div>\n                <button onclick=\"showAddCard()\" class=\"mt-4 text-navy-700 hover:text-navy-900 text-sm font-semibold\">\n                    <i class=\"fas fa-plus mr-2\"></i>ìƒˆë¡œìš´ ê²°ì œ ì¹´ë“œ ì¶”ê°€\n                </button>\n            </div>\n\n            <!-- Payment Details -->\n            <div class=\"bg-white rounded-lg shadow-md p-8 mb-6\">\n                <h3 class=\"text-lg font-bold text-gray-900 mb-4\">ê²°ì œ ë‚´ì—­</h3>\n                <div class=\"space-y-3\">\n                    <div class=\"flex justify-between text-gray-700\">\n                        <span>ê²°ì œ ê¸ˆì•¡</span>\n                        <span id=\"priceAmount\" class=\"font-semibold\">ì›” â‚©7,500</span>\n                    </div>\n                    <div class=\"flex justify-between text-gray-700\">\n                        <span>ê²°ì œì¼</span>\n                        <span id=\"paymentDate\" class=\"font-semibold\">2025ë…„ 11ì›” 23ì¼</span>\n                    </div>\n                </div>\n                <div class=\"mt-4 pt-4 border-t text-sm text-gray-600\">\n                    <p>ê²°ì œ í›„ ì¦‰ì‹œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n                    <p class=\"mt-2\">ìœ„ ë‚´ìš©ì€ ìµœì¢… ê²°ì œì‹œ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n                </div>\n            </div>\n\n            <!-- Submit Button -->\n            <button onclick=\"processPayment()\" class=\"w-full bg-lime-400 text-black py-4 rounded-lg font-bold text-lg hover:bg-lime-500 transition\">\n                ê²°ì œí•˜ê¸°\n            </button>\n        </div>\n\n        <!-- Add Card Modal -->\n        <div id=\"addCardModal\" class=\"hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n            <div class=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4\">\n                <div class=\"p-6\">\n                    <div class=\"flex justify-between items-center mb-6\">\n                        <h3 class=\"text-xl font-bold text-gray-900\">ìƒˆë¡œìš´ ê²°ì œ ì¹´ë“œ ì¶”ê°€</h3>\n                        <button onclick=\"closeAddCardModal()\" class=\"text-gray-500 hover:text-gray-700\">\n                            <i class=\"fas fa-times text-xl\"></i>\n                        </button>\n                    </div>\n\n                    <form id=\"addCardForm\" onsubmit=\"registerCard(event)\">\n                        <!-- Card Number -->\n                        <div class=\"mb-4\">\n                            <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ì¹´ë“œ ë²ˆí˜¸</label>\n                            <div class=\"grid grid-cols-4 gap-2\">\n                                <input type=\"text\" id=\"cardNum1\" maxlength=\"4\" placeholder=\"1234\" required\n                                    class=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent text-center\"\n                                    oninput=\"moveToNext(this, 'cardNum2')\" />\n                                <input type=\"text\" id=\"cardNum2\" maxlength=\"4\" placeholder=\"1234\" required\n                                    class=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent text-center\"\n                                    oninput=\"moveToNext(this, 'cardNum3')\" />\n                                <input type=\"text\" id=\"cardNum3\" maxlength=\"4\" placeholder=\"1234\" required\n                                    class=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent text-center\"\n                                    oninput=\"moveToNext(this, 'cardNum4')\" />\n                                <input type=\"text\" id=\"cardNum4\" maxlength=\"4\" placeholder=\"1234\" required\n                                    class=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent text-center\"\n                                    oninput=\"moveToNext(this, 'cardExpiry')\" />\n                            </div>\n                        </div>\n\n                        <!-- Expiry Date and CVV -->\n                        <div class=\"grid grid-cols-2 gap-4 mb-4\">\n                            <div>\n                                <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ìœ íš¨ ê¸°ê°„</label>\n                                <input type=\"text\" id=\"cardExpiry\" maxlength=\"5\" placeholder=\"MM / YY\" required\n                                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent\"\n                                    oninput=\"formatExpiry(this)\" />\n                            </div>\n                            <div>\n                                <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                    ë³´ì•ˆì½”ë“œ (CVV/CVC)\n                                    <i class=\"fas fa-question-circle text-gray-400 text-xs ml-1\"></i>\n                                </label>\n                                <input type=\"password\" id=\"cardCvv\" maxlength=\"3\" placeholder=\"â—â—â—\" required\n                                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent text-center\"\n                                    oninput=\"moveToNext(this, 'cardBirthOrBusiness')\" />\n                            </div>\n                        </div>\n\n                        <!-- Birth Date or Business Number -->\n                        <div class=\"mb-6\">\n                            <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                                ìƒë…„ì›”ì¼ (6ìë¦¬) / ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ (10ìë¦¬)\n                                <i class=\"fas fa-question-circle text-gray-400 text-xs ml-1\"></i>\n                            </label>\n                            <input type=\"text\" id=\"cardBirthOrBusiness\" maxlength=\"10\" placeholder=\"ìƒë…„ì›”ì¼ (6ìë¦¬) / ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ (10ìë¦¬)\" required\n                                class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent\" />\n                            <p class=\"text-xs text-gray-500 mt-2\">ë²•ì¸ì¹´ë“œëŠ” ì• 10ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>\n                        </div>\n\n                        <!-- Submit Button -->\n                        <button type=\"submit\" class=\"w-full bg-black text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition\">\n                            ë“±ë¡í•˜ê¸°\n                        </button>\n                    </form>\n                </div>\n            </div>\n        </div>\n\n        <script>\n          let selectedPlan = 'starter';\n          let selectedBilling = 'monthly';\n          let selectedPaymentMethod = 'card';\n\n          const planInfo = {\n            free: {\n              name: 'ë¬´ë£Œ ì²´í—˜',\n              description: 'ì •ê·œ ìˆ˜ì—…ì—ì„œ ì²˜ìŒìœ¼ë¡œ ë…¼ìˆ í˜• í‰ê°€ë¥¼ ë„ì…í•´ ë³´ë ¤ê³  í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬',\n              monthlyPrice: 0,\n              yearlyPrice: 0\n            },\n            starter: {\n              name: 'ìŠ¤íƒ€í„° ìš”ê¸ˆì œ',\n              description: 'ë…¼ìˆ  í•™ì›ì´ë‚˜ ë°©ê³¼ í›„ ìˆ˜ì—…ì—ì„œ ë…¼ìˆ ì„ ì§€ë„í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬',\n              monthlyPrice: 7500,\n              yearlyPrice: 6000\n            },\n            basic: {\n              name: 'ë² ì´ì§ ìš”ê¸ˆì œ',\n              description: 'ì •ê·œ ìˆ˜ì—…ì—ì„œ ë…¼ìˆ  í‰ê°€ë¥¼ ì‹¤ì‹œí•´ ë³´ê³ ì í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬',\n              monthlyPrice: 20000,\n              yearlyPrice: 16000\n            },\n            pro: {\n              name: 'í”„ë¡œ ìš”ê¸ˆì œ',\n              description: 'ì•„ì£¼ ë§ì€ ë¶„ëŸ‰ì˜ ë…¼ìˆ ë¬¸ì„ ì±„ì í•˜ëŠ” êµì‚¬ë“¤ì„ ìœ„í•˜ì—¬',\n              monthlyPrice: 39000,\n              yearlyPrice: 31000\n            }\n          };\n\n          // Initialize from URL parameters\n          window.addEventListener('DOMContentLoaded', () => {\n            const urlParams = new URLSearchParams(window.location.search);\n            const plan = urlParams.get('plan') || 'starter';\n            const billing = urlParams.get('billing') || 'monthly';\n            \n            selectedPlan = plan;\n            selectedBilling = billing;\n            \n            updatePlanDisplay();\n            if (billing === 'yearly') {\n              toggleBilling('yearly');\n            }\n          });\n\n          function toggleBilling(type) {\n            selectedBilling = type;\n            const monthlyBtn = document.getElementById('monthlyBtn');\n            const yearlyBtn = document.getElementById('yearlyBtn');\n            \n            if (type === 'monthly') {\n              monthlyBtn.classList.add('bg-navy-900', 'text-white');\n              monthlyBtn.classList.remove('bg-gray-200', 'text-gray-700');\n              yearlyBtn.classList.remove('bg-navy-900', 'text-white');\n              yearlyBtn.classList.add('bg-gray-200', 'text-gray-700');\n            } else {\n              yearlyBtn.classList.add('bg-navy-900', 'text-white');\n              yearlyBtn.classList.remove('bg-gray-200', 'text-gray-700');\n              monthlyBtn.classList.remove('bg-navy-900', 'text-white');\n              monthlyBtn.classList.add('bg-gray-200', 'text-gray-700');\n            }\n            \n            updatePlanDisplay();\n          }\n\n          function updatePlanDisplay() {\n            const plan = planInfo[selectedPlan];\n            if (!plan) return;\n            \n            const price = selectedBilling === 'monthly' ? plan.monthlyPrice : plan.yearlyPrice;\n            const totalYearly = price * 12;\n            \n            document.getElementById('planName').textContent = plan.name;\n            document.getElementById('planDescription').textContent = plan.description;\n            document.getElementById('planPrice').innerHTML = 'â‚©' + price.toLocaleString() + '<span class=\"text-lg text-gray-500\">/ì›”</span>';\n            \n            const billingText = selectedBilling === 'monthly' ? 'ì›”' : 'ì—°ê°„';\n            document.getElementById('priceAmount').textContent = billingText + ' â‚©' + (selectedBilling === 'monthly' ? price : totalYearly).toLocaleString();\n            \n            // Update payment date\n            const today = new Date();\n            const paymentDate = new Date(today);\n            paymentDate.setMonth(today.getMonth() + 1);\n            document.getElementById('paymentDate').textContent = paymentDate.getFullYear() + 'ë…„ ' + (paymentDate.getMonth() + 1) + 'ì›” ' + paymentDate.getDate() + 'ì¼';\n          }\n\n          function selectPaymentMethod(method) {\n            selectedPaymentMethod = method;\n            document.querySelectorAll('.payment-method').forEach(el => {\n              el.classList.remove('active');\n            });\n            event.target.closest('.payment-method').classList.add('active');\n          }\n\n          function showAddCard() {\n            document.getElementById('addCardModal').classList.remove('hidden');\n          }\n\n          function closeAddCardModal() {\n            document.getElementById('addCardModal').classList.add('hidden');\n            document.getElementById('addCardForm').reset();\n          }\n\n          function moveToNext(current, nextFieldId) {\n            if (current.value.length >= current.maxLength) {\n              const nextField = document.getElementById(nextFieldId);\n              if (nextField) {\n                nextField.focus();\n              }\n            }\n          }\n\n          function formatExpiry(input) {\n            let value = input.value.replace(/\\D/g, '');\n            if (value.length >= 2) {\n              value = value.substring(0, 2) + ' / ' + value.substring(2, 4);\n            }\n            input.value = value;\n          }\n\n          function registerCard(event) {\n            event.preventDefault();\n            \n            const cardNum1 = document.getElementById('cardNum1').value;\n            const cardNum2 = document.getElementById('cardNum2').value;\n            const cardNum3 = document.getElementById('cardNum3').value;\n            const cardNum4 = document.getElementById('cardNum4').value;\n            const cardExpiry = document.getElementById('cardExpiry').value;\n            const cardCvv = document.getElementById('cardCvv').value;\n            const cardBirthOrBusiness = document.getElementById('cardBirthOrBusiness').value;\n            \n            // Basic validation\n            if (cardNum1.length !== 4 || cardNum2.length !== 4 || cardNum3.length !== 4 || cardNum4.length !== 4) {\n              alert('ì¹´ë“œ ë²ˆí˜¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');\n              return;\n            }\n            \n            if (cardCvv.length !== 3) {\n              alert('ë³´ì•ˆì½”ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');\n              return;\n            }\n            \n            if (cardBirthOrBusiness.length !== 6 && cardBirthOrBusiness.length !== 10) {\n              alert('ìƒë…„ì›”ì¼(6ìë¦¬) ë˜ëŠ” ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸(10ìë¦¬)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');\n              return;\n            }\n            \n            // TODO: Implement actual card registration\n            alert('ì¹´ë“œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');\n            closeAddCardModal();\n          }\n\n          function processPayment() {\n            if (confirm('ê²°ì œë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n              alert('ê²°ì œ ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ê²°ì œ APIì™€ ì—°ë™ë©ë‹ˆë‹¤.');\n              // TODO: Implement actual payment processing\n              // window.location.href = '/my-page';\n            }\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// My Page - Teacher's Assignment Management\napp.get('/my-page', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ë‚˜ì˜ í˜ì´ì§€ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    100: '#e0e9ff',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n        <style>\n          .tab-button.active {\n            background-color: #1e3a8a;\n            color: white;\n          }\n          .assignment-rubric-tab.active {\n            background-color: #1e3a8a;\n            color: white;\n          }\n          /* Reference material textarea styling */\n          .reference-input {\n            resize: vertical;\n            min-height: 120px;\n            scrollbar-width: thin;\n            scrollbar-color: #cbd5e1 #f1f5f9;\n          }\n          .reference-input::-webkit-scrollbar {\n            width: 8px;\n          }\n          .reference-input::-webkit-scrollbar-track {\n            background: #f1f5f9;\n            border-radius: 4px;\n          }\n          .reference-input::-webkit-scrollbar-thumb {\n            background: #cbd5e1;\n            border-radius: 4px;\n          }\n          .reference-input::-webkit-scrollbar-thumb:hover {\n            background: #94a3b8;\n          }\n          /* Profile dropdown styling */\n          @keyframes fadeIn {\n            from {\n              opacity: 0;\n              transform: translateY(-10px);\n            }\n            to {\n              opacity: 1;\n              transform: translateY(0);\n            }\n          }\n        </style>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/\" class=\"text-gray-700 hover:text-navy-700 font-medium\">í™ˆ</a>\n                        <span class=\"text-navy-700 font-semibold\">ë‚˜ì˜ í˜ì´ì§€</span>\n                        \n                        <!-- User Info & Usage -->\n                        <div class=\"flex items-center space-x-3\">\n                            <div id=\"usageInfo\" class=\"text-sm font-medium text-gray-700\">ë¬´ë£Œ ì²´í—˜: 0 / 20</div>\n                            \n                            <!-- Profile Dropdown -->\n                            <div class=\"relative\">\n                                <button id=\"teacherProfileButton\" onclick=\"toggleTeacherProfileMenu()\" class=\"w-10 h-10 bg-navy-700 rounded-full flex items-center justify-center text-white hover:bg-navy-600 transition cursor-pointer\">\n                                    <i class=\"fas fa-user\"></i>\n                                </button>\n                                <div id=\"teacherProfileMenu\" class=\"hidden absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-gray-200 z-50\">\n                                    <div class=\"py-1\">\n                                        <a href=\"/account\" class=\"block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 flex items-center\">\n                                            <i class=\"fas fa-user-circle mr-3 text-gray-400\"></i>\n                                            ë‚´ ê³„ì •\n                                        </a>\n                                        <a href=\"/pricing\" class=\"block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 flex items-center\">\n                                            <i class=\"fas fa-crown mr-3 text-yellow-500\"></i>\n                                            ë‚´ ìš”ê¸ˆì œ\n                                        </a>\n                                        <a href=\"/billing\" class=\"block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 flex items-center border-b border-gray-100\">\n                                            <i class=\"fas fa-credit-card mr-3 text-gray-400\"></i>\n                                            êµ¬ë… ê²°ì œ ê´€ë¦¬\n                                        </a>\n                                        <button onclick=\"logout()\" class=\"w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 flex items-center font-medium\">\n                                            <i class=\"fas fa-sign-out-alt mr-3\"></i>\n                                            ë¡œê·¸ì•„ì›ƒ\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <a href=\"/pricing?plan=free\" class=\"bg-lime-200 text-black px-4 py-2 rounded-lg font-semibold hover:bg-lime-300 transition\">\n                            <i class=\"fas fa-arrow-up mr-2\"></i>ì—…ê·¸ë ˆì´ë“œ\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <!-- Header -->\n            <div class=\"mb-8 flex justify-between items-center\">\n                <div>\n                    <h1 class=\"text-4xl font-bold text-gray-900 mb-2\">ë‚˜ì˜ í˜ì´ì§€</h1>\n                    <p class=\"text-xl text-gray-600\">ë…¼ìˆ  ê³¼ì œë¥¼ ê´€ë¦¬í•˜ê³  í•™ìƒ ë‹µì•ˆì§€ë¥¼ ì±„ì í•˜ì„¸ìš”</p>\n                </div>\n                <button onclick=\"showCreateAssignmentModal()\" class=\"bg-navy-900 text-white px-6 py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                    <i class=\"fas fa-plus mr-2\"></i>ìƒˆ ê³¼ì œ ë§Œë“¤ê¸°\n                </button>\n            </div>\n\n            <!-- Tabs -->\n            <div class=\"flex gap-2 mb-6 border-b border-gray-200\">\n                <button id=\"assignmentsTab\" onclick=\"switchTab('assignments')\" class=\"tab-button px-6 py-3 font-semibold rounded-t-lg transition active\">\n                    <i class=\"fas fa-clipboard-list mr-2\"></i>ë‚´ ê³¼ì œ\n                </button>\n                <button id=\"historyTab\" onclick=\"switchTab('history')\" class=\"tab-button px-6 py-3 font-semibold rounded-t-lg transition text-gray-700 hover:bg-gray-100\">\n                    <i class=\"fas fa-history mr-2\"></i>ì±„ì  ì´ë ¥\n                </button>\n            </div>\n\n            <!-- Assignments Tab Content -->\n            <div id=\"assignmentsContent\">\n                <div id=\"assignmentsList\" class=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                    <p class=\"text-gray-500 text-center py-8 col-span-full\">ê³¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                </div>\n            </div>\n\n            <!-- History Tab Content -->\n            <div id=\"historyContent\" class=\"hidden\">\n                <div id=\"historyList\">\n                    <p class=\"text-gray-500 text-center py-8\">ì±„ì  ì´ë ¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                </div>\n            </div>\n        </div>\n\n        <!-- Create Assignment Modal -->\n        <div id=\"createAssignmentModal\" class=\"hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n            <div class=\"bg-white rounded-xl shadow-2xl p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto mx-4\">\n                <div class=\"flex justify-between items-center mb-6\">\n                    <h2 class=\"text-2xl font-bold text-gray-900\">ìƒˆ ê³¼ì œ ë§Œë“¤ê¸°</h2>\n                    <button onclick=\"closeCreateAssignmentModal()\" class=\"text-gray-500 hover:text-gray-700\">\n                        <i class=\"fas fa-times text-2xl\"></i>\n                    </button>\n                </div>\n\n                <!-- Load Existing Assignment -->\n                <div class=\"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200\">\n                    <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                        <i class=\"fas fa-folder-open mr-2 text-blue-600\"></i>ê¸°ì¡´ ê³¼ì œ ë¶ˆëŸ¬ì˜¤ê¸°\n                    </label>\n                    <div class=\"flex gap-2\">\n                        <select id=\"existingAssignmentSelect\" class=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-700\">\n                            <option value=\"\">-- ê¸°ì¡´ ê³¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>\n                        </select>\n                        <button type=\"button\" onclick=\"loadExistingAssignment()\" class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold\">\n                            <i class=\"fas fa-download mr-2\"></i>ë¶ˆëŸ¬ì˜¤ê¸°\n                        </button>\n                    </div>\n                    <p class=\"text-xs text-gray-600 mt-2\">\n                        <i class=\"fas fa-info-circle mr-1\"></i>ê¸°ì¡´ ê³¼ì œë¥¼ ì„ íƒí•˜ê³  'ë¶ˆëŸ¬ì˜¤ê¸°'ë¥¼ í´ë¦­í•˜ë©´ ë‚´ìš©ì„ í¸ì§‘í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n                    </p>\n                </div>\n\n                <form id=\"createAssignmentForm\" onsubmit=\"handleCreateAssignment(event)\">\n                    <div class=\"space-y-4\">\n                        <div>\n                            <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ê³¼ì œ ì œëª©</label>\n                            <input type=\"text\" id=\"assignmentTitle\" class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-700\" placeholder=\"ì˜ˆ: ì œ2ì°¨ ì„¸ê³„ëŒ€ì „ì˜ ì›ì¸ ë¶„ì„\" required>\n                        </div>\n\n                        <div>\n                            <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ê³¼ì œ ì„¤ëª…</label>\n                            <textarea id=\"assignmentDescription\" rows=\"4\" class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-700\" placeholder=\"í•™ìƒë“¤ì—ê²Œ ìš”êµ¬í•˜ëŠ” ë…¼ìˆ  ì£¼ì œì™€ ìš”êµ¬ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”\" required></textarea>\n                        </div>\n\n                        <!-- Prompts (Reference Materials) -->\n                        <div>\n                            <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ì œì‹œë¬¸</label>\n                            <div id=\"assignmentReferenceMaterials\" class=\"space-y-3 mb-2\">\n                                <!-- Initial 4 reference slots with image upload -->\n                                <div class=\"reference-item\">\n                                    <div class=\"flex gap-2 mb-2\">\n                                        <textarea class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm overflow-y-auto\" rows=\"5\" placeholder=\"ì œì‹œë¬¸ ë‚´ìš© (ì„ íƒì‚¬í•­)\"></textarea>\n                                        <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm self-start\">\n                                            <i class=\"fas fa-times\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"flex gap-2\">\n                                        <button type=\"button\" onclick=\"handleReferenceImageUpload(this)\" class=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-xs\">\n                                            <i class=\"fas fa-image mr-1\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ\n                                        </button>\n                                        <span class=\"text-xs text-gray-500 self-center upload-status\"></span>\n                                    </div>\n                                </div>\n                                <div class=\"reference-item\">\n                                    <div class=\"flex gap-2 mb-2\">\n                                        <textarea class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm overflow-y-auto\" rows=\"5\" placeholder=\"ì œì‹œë¬¸ ë‚´ìš© (ì„ íƒì‚¬í•­)\"></textarea>\n                                        <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm self-start\">\n                                            <i class=\"fas fa-times\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"flex gap-2\">\n                                        <button type=\"button\" onclick=\"handleReferenceImageUpload(this)\" class=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-xs\">\n                                            <i class=\"fas fa-image mr-1\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ\n                                        </button>\n                                        <span class=\"text-xs text-gray-500 self-center upload-status\"></span>\n                                    </div>\n                                </div>\n                                <div class=\"reference-item\">\n                                    <div class=\"flex gap-2 mb-2\">\n                                        <textarea class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm overflow-y-auto\" rows=\"5\" placeholder=\"ì œì‹œë¬¸ ë‚´ìš© (ì„ íƒì‚¬í•­)\"></textarea>\n                                        <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm self-start\">\n                                            <i class=\"fas fa-times\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"flex gap-2\">\n                                        <button type=\"button\" onclick=\"handleReferenceImageUpload(this)\" class=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-xs\">\n                                            <i class=\"fas fa-image mr-1\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ\n                                        </button>\n                                        <span class=\"text-xs text-gray-500 self-center upload-status\"></span>\n                                    </div>\n                                </div>\n                                <div class=\"reference-item\">\n                                    <div class=\"flex gap-2 mb-2\">\n                                        <textarea class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm overflow-y-auto\" rows=\"5\" placeholder=\"ì œì‹œë¬¸ ë‚´ìš© (ì„ íƒì‚¬í•­)\"></textarea>\n                                        <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm self-start\">\n                                            <i class=\"fas fa-times\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"flex gap-2\">\n                                        <button type=\"button\" onclick=\"handleReferenceImageUpload(this)\" class=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-xs\">\n                                            <i class=\"fas fa-image mr-1\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ\n                                        </button>\n                                        <span class=\"text-xs text-gray-500 self-center upload-status\"></span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"flex items-center justify-between\">\n                                <button type=\"button\" onclick=\"addReferenceMaterial()\" id=\"addReferenceBtn\" class=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm\">\n                                    <i class=\"fas fa-plus mr-2\"></i>ì œì‹œë¬¸ ì¶”ê°€\n                                </button>\n                                <span id=\"referenceCount\" class=\"text-sm text-gray-600\">4 / 11</span>\n                            </div>\n                        </div>\n\n                        <div class=\"grid md:grid-cols-2 gap-4\">\n                            <div>\n                                <label class=\"block text-sm font-semibold text-gray-700 mb-2\">í•™ë…„ ìˆ˜ì¤€</label>\n                                <select id=\"assignmentGradeLevel\" class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-700\" required>\n                                    <option value=\"\">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”</option>\n                                    <option value=\"ì´ˆë“±í•™êµ\">ì´ˆë“±í•™êµ</option>\n                                    <option value=\"ì¤‘í•™êµ 1í•™ë…„\">ì¤‘í•™êµ 1í•™ë…„</option>\n                                    <option value=\"ì¤‘í•™êµ 2í•™ë…„\">ì¤‘í•™êµ 2í•™ë…„</option>\n                                    <option value=\"ì¤‘í•™êµ 3í•™ë…„\">ì¤‘í•™êµ 3í•™ë…„</option>\n                                    <option value=\"ê³ ë“±í•™êµ 1í•™ë…„\">ê³ ë“±í•™êµ 1í•™ë…„</option>\n                                    <option value=\"ê³ ë“±í•™êµ 2í•™ë…„\">ê³ ë“±í•™êµ 2í•™ë…„</option>\n                                    <option value=\"ê³ ë“±í•™êµ 3í•™ë…„\">ê³ ë“±í•™êµ 3í•™ë…„</option>\n                                </select>\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ì œì¶œ ë§ˆê°ì¼</label>\n                                <input type=\"date\" id=\"assignmentDueDate\" class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-700\">\n                            </div>\n                        </div>\n\n                        <div>\n                            <label class=\"block text-sm font-semibold text-gray-700 mb-2\">í‰ê°€ ë£¨ë¸Œë¦­</label>\n                            \n                            <!-- Rubric Type Selection -->\n                            <div class=\"flex gap-2 mb-4\">\n                                <button \n                                    type=\"button\" \n                                    id=\"assignmentPlatformRubricBtn\"\n                                    onclick=\"switchAssignmentRubricType('platform')\" \n                                    class=\"assignment-rubric-tab flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm font-semibold transition active\"\n                                >\n                                    í”Œë«í¼ ë£¨ë¸Œë¦­\n                                </button>\n                                <button \n                                    type=\"button\" \n                                    id=\"assignmentCustomRubricBtn\"\n                                    onclick=\"switchAssignmentRubricType('custom')\" \n                                    class=\"assignment-rubric-tab flex-1 px-4 py-2 rounded-lg border border-gray-300 text-sm font-semibold transition\"\n                                >\n                                    ë‚˜ì˜ ë£¨ë¸Œë¦­\n                                </button>\n                            </div>\n                            \n                            <!-- Platform Rubric Container -->\n                            <div id=\"assignmentPlatformRubricContainer\">\n                                <div id=\"platformRubricList\" class=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                                    <!-- Platform rubrics will be loaded here -->\n                                </div>\n                                <input type=\"hidden\" id=\"selectedPlatformRubric\" value=\"\" />\n                            </div>\n                            \n                            <!-- Custom Rubric Container -->\n                            <div id=\"assignmentCustomRubricContainer\" class=\"hidden\">\n                                <div id=\"rubricCriteriaList\" class=\"space-y-2 mb-2\">\n                                    <!-- Criteria will be added here -->\n                                </div>\n                                <button type=\"button\" onclick=\"addRubricCriterion()\" class=\"w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm\">\n                                    <i class=\"fas fa-plus mr-2\"></i>í‰ê°€ ê¸°ì¤€ ì¶”ê°€\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"flex gap-4 mt-6\">\n                        <button type=\"submit\" class=\"flex-1 bg-navy-900 text-white px-6 py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                            <i class=\"fas fa-save mr-2\"></i>ê³¼ì œ ìƒì„±\n                        </button>\n                        <button type=\"button\" onclick=\"closeCreateAssignmentModal()\" class=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition\">\n                            ì·¨ì†Œ\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <!-- Rubric PDF Preview Modal -->\n        <div id=\"rubricPreviewModal\" class=\"hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]\">\n            <div class=\"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] mx-4 flex flex-col\">\n                <!-- Modal Header -->\n                <div class=\"flex justify-between items-center p-6 border-b\">\n                    <h2 id=\"rubricPreviewTitle\" class=\"text-2xl font-bold text-gray-900\"></h2>\n                    <div class=\"flex gap-2\">\n                        <button onclick=\"selectCurrentRubric()\" class=\"px-6 py-2 bg-navy-900 text-white rounded-lg hover:bg-navy-800 transition font-semibold\">\n                            ì„ íƒí•˜ê¸° â†’\n                        </button>\n                        <button onclick=\"closeRubricPreview()\" class=\"px-4 py-2 text-gray-500 hover:text-gray-700\">\n                            <i class=\"fas fa-times text-xl\"></i> ë‹«ê¸°\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- PDF Content Area -->\n                <div class=\"flex-1 overflow-y-auto p-6\">\n                    <div id=\"rubricPdfContainer\" class=\"w-full\">\n                        <!-- PDF will be embedded here -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Assignment Detail Modal -->\n        <div id=\"assignmentDetailModal\" class=\"hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n            <div class=\"bg-white rounded-xl shadow-2xl p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto mx-4\">\n                <div class=\"flex justify-between items-center mb-6\">\n                    <h2 id=\"detailTitle\" class=\"text-2xl font-bold text-gray-900\"></h2>\n                    <button onclick=\"closeAssignmentDetailModal()\" class=\"text-gray-500 hover:text-gray-700\">\n                        <i class=\"fas fa-times text-2xl\"></i>\n                    </button>\n                </div>\n\n                <div id=\"assignmentDetailContent\">\n                    <!-- Detail content will be loaded here -->\n                </div>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\"></script>\n        <script>\n          let currentAssignmentId = null;\n          let criterionCounter = 0;\n\n          // Session management\n          const sessionId = localStorage.getItem('session_id');\n          if (!sessionId) {\n            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');\n            window.location.href = '/login';\n          }\n\n          // Configure axios to include session ID in all requests\n          axios.defaults.headers.common['X-Session-ID'] = sessionId;\n\n          // Handle authentication errors\n          let authErrorShown = false;\n          axios.interceptors.response.use(\n            response => response,\n            error => {\n              if (error.response && error.response.status === 401) {\n                console.error('401 Unauthorized error:', error.response.data);\n                console.log('Session ID:', sessionId);\n                \n                if (!authErrorShown) {\n                  authErrorShown = true;\n                  alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');\n                  localStorage.removeItem('session_id');\n                  window.location.href = '/login';\n                }\n              }\n              return Promise.reject(error);\n            }\n          );\n\n          // Switch between tabs\n          function switchTab(tab) {\n            const assignmentsTab = document.getElementById('assignmentsTab');\n            const historyTab = document.getElementById('historyTab');\n            const assignmentsContent = document.getElementById('assignmentsContent');\n            const historyContent = document.getElementById('historyContent');\n\n            if (tab === 'assignments') {\n              assignmentsTab.classList.add('active');\n              historyTab.classList.remove('active');\n              assignmentsContent.classList.remove('hidden');\n              historyContent.classList.add('hidden');\n              loadAssignments();\n            } else {\n              historyTab.classList.add('active');\n              assignmentsTab.classList.remove('active');\n              historyContent.classList.remove('hidden');\n              assignmentsContent.classList.add('hidden');\n              loadHistory();\n            }\n          }\n\n          // Load platform rubrics for assignment creation\n          // Platform rubric definitions with PDF paths\n          const platformRubricData = [\n            { value: 'standard', text: 'í‘œì¤€ ë…¼ìˆ  ë£¨ë¸Œë¦­(4ê°œ ê¸°ì¤€)', pdf: '/rubric-pdfs/í‘œì¤€ ë…¼ìˆ  ë£¨ë¸Œë¦­(4ê°œ ê¸°ì¤€).pdf' },\n            { value: 'kr_elementary', text: 'ì´ˆë“±í•™ìƒìš© í‰ê°€ ê¸°ì¤€', pdf: '/rubric-pdfs/ì´ˆë“±í•™ìƒìš© í‰ê°€ ê¸°ì¤€.pdf' },\n            { value: 'kr_middle', text: 'ì¤‘í•™ìƒìš© í‰ê°€ ê¸°ì¤€', pdf: '/rubric-pdfs/ì¤‘í•™ìƒìš© í‰ê°€ ê¸°ì¤€.pdf' },\n            { value: 'kr_high', text: 'ê³ ë“±í•™ìƒìš© í‰ê°€ ê¸°ì¤€', pdf: '/rubric-pdfs/ê³ ë“±í•™ìƒìš© í‰ê°€ ê¸°ì¤€.pdf' },\n            { value: 'nyregents', text: 'ë‰´ìš• ì£¼ ë¦¬ì  íŠ¸ ì‹œí—˜ ë…¼ì¦ì  ê¸€ì“°ê¸° ë£¨ë¸Œë¦­', pdf: '/rubric-pdfs/ë‰´ìš• ì£¼ ë¦¬ì  íŠ¸ ì‹œí—˜ ë…¼ì¦ì  ê¸€ì“°ê¸° ë£¨ë¸Œë¦­.pdf' },\n            { value: 'nyregents_analytical', text: 'ë‰´ìš• ì£¼ ë¦¬ì  íŠ¸ ì‹œí—˜ ë¶„ì„ì  ê¸€ì“°ê¸° ë£¨ë¸Œë¦­', pdf: '/rubric-pdfs/ë‰´ìš• ì£¼ ë¦¬ì  íŠ¸ ì‹œí—˜ ë¶„ì„ì  ê¸€ì“°ê¸° ë£¨ë¸Œë¦­.pdf' },\n            { value: 'ny_middle', text: 'ë‰´ìš• ì£¼ ì¤‘í•™êµ ë…¼ìˆ  ë£¨ë¸Œë¦­', pdf: '/rubric-pdfs/ë‰´ìš• ì£¼ ì¤‘í•™êµ ë…¼ìˆ  ë£¨ë¸Œë¦­.pdf' },\n            { value: 'ny_elementary', text: 'ë‰´ìš• ì£¼ ì´ˆë“±í•™êµ ë…¼ìˆ  ë£¨ë¸Œë¦­', pdf: '/rubric-pdfs/ë‰´ìš• ì£¼ ì´ˆë“±í•™êµ ë…¼ìˆ  ë£¨ë¸Œë¦­.pdf' },\n            { value: 'ib_myp_highschool', text: 'IB ì¤‘ë“± í”„ë¡œê·¸ë¨ ê³ ë“±í•™êµ ê°œì¸ê³¼ ì‚¬íšŒ ë…¼ìˆ  ë£¨ë¸Œë¦­', pdf: '/rubric-pdfs/IB ì¤‘ë“± í”„ë¡œê·¸ë¨ ê³ ë“±í•™êµ ê°œì¸ê³¼ ì‚¬íšŒ ë…¼ìˆ  ë£¨ë¸Œë¦­.pdf' },\n            { value: 'ib_myp_middleschool', text: 'IB ì¤‘ë“± í”„ë¡œê·¸ë¨ ì¤‘í•™êµ ê°œì¸ê³¼ ì‚¬íšŒ ë…¼ìˆ  ë£¨ë¸Œë¦­', pdf: '/rubric-pdfs/IB ì¤‘ë“± í”„ë¡œê·¸ë¨ ì¤‘í•™êµ ê°œì¸ê³¼ ì‚¬íšŒ ë…¼ìˆ  ë£¨ë¸Œë¦­.pdf' },\n            { value: 'ib_myp_science', text: 'IB ì¤‘ë“± í”„ë¡œê·¸ë¨ ê³¼í•™ ë…¼ìˆ  ë£¨ë¸Œë¦­', pdf: '/rubric-pdfs/IB ì¤‘ë“± í”„ë¡œê·¸ë¨ ê³¼í•™ ë…¼ìˆ  ë£¨ë¸Œë¦­.pdf' }\n          ];\n\n          async function loadPlatformRubrics() {\n            const container = document.getElementById('platformRubricList');\n            if (!container) return;\n            \n            // Create card-based rubric list\n            container.innerHTML = platformRubricData.map(rubric => \\`\n              <div class=\"rubric-card border-2 border-gray-200 rounded-lg p-4 hover:border-navy-700 hover:shadow-md transition cursor-pointer\"\n                   onclick=\"previewRubric('\\${rubric.value}', '\\${rubric.text}', '\\${rubric.pdf}')\">\n                <div class=\"flex items-center justify-between\">\n                  <div class=\"flex-1\">\n                    <h3 class=\"font-semibold text-gray-900\">\\${rubric.text}</h3>\n                    <p class=\"text-sm text-gray-500 mt-1\">í´ë¦­í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸°</p>\n                  </div>\n                  <i class=\"fas fa-file-pdf text-red-600 text-2xl ml-3\"></i>\n                </div>\n              </div>\n            \\`).join('');\n          }\n\n          // Preview rubric PDF\n          let currentRubricSelection = null;\n          \n          function previewRubric(value, text, pdfPath) {\n            currentRubricSelection = { value, text, pdfPath };\n            \n            const modal = document.getElementById('rubricPreviewModal');\n            const titleEl = document.getElementById('rubricPreviewTitle');\n            const containerEl = document.getElementById('rubricPdfContainer');\n            \n            // Encode the PDF path to handle Korean characters\n            const encodedPath = pdfPath.split('/').map(part => encodeURIComponent(part)).join('/');\n            \n            titleEl.textContent = text;\n            containerEl.innerHTML = \\`\n              <embed src=\"\\${encodedPath}\" type=\"application/pdf\" width=\"100%\" height=\"700px\" \n                     class=\"border border-gray-300 rounded-lg\" />\n            \\`;\n            \n            modal.classList.remove('hidden');\n          }\n          \n          function closeRubricPreview() {\n            const modal = document.getElementById('rubricPreviewModal');\n            modal.classList.add('hidden');\n            currentRubricSelection = null;\n          }\n          \n          function selectCurrentRubric() {\n            if (!currentRubricSelection) return;\n            \n            // Set the hidden input value\n            const hiddenInput = document.getElementById('selectedPlatformRubric');\n            hiddenInput.value = currentRubricSelection.value;\n            \n            // Highlight selected card\n            const cards = document.querySelectorAll('#platformRubricList .rubric-card');\n            cards.forEach(card => {\n              card.classList.remove('border-navy-700', 'bg-navy-50');\n              card.classList.add('border-gray-200');\n            });\n            \n            const selectedCard = Array.from(cards).find(card => \n              card.getAttribute('onclick').includes(currentRubricSelection.value)\n            );\n            \n            if (selectedCard) {\n              selectedCard.classList.remove('border-gray-200');\n              selectedCard.classList.add('border-navy-700', 'bg-navy-50');\n            }\n            \n            // Close modal\n            closeRubricPreview();\n            \n            // Show success message\n            alert(\\`\"\\${currentRubricSelection.text}\"ì´(ê°€) ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.\\`);\n          }\n\n          // Load assignments\n          // Print assignment function\n          function printAssignment() {\n            const assignment = window.currentAssignment;\n            if (!assignment) {\n              alert('ê³¼ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n              return;\n            }\n\n            const printWindow = window.open('', '_blank', 'width=800,height=600');\n            \n            const promptsHTML = assignment.prompts && assignment.prompts.length > 0 \n              ? '<div class=\"mb-6\"><h2 class=\"text-xl font-bold mb-3\">ì œì‹œë¬¸</h2><div class=\"space-y-3\">' +\n                assignment.prompts.map((prompt, idx) => \n                  '<div class=\"border border-gray-300 rounded-lg p-4 bg-gray-50\"><div class=\"font-semibold text-blue-900 mb-2\">ì œì‹œë¬¸ ' + (idx + 1) + '</div><div class=\"whitespace-pre-wrap\">' + prompt + '</div></div>'\n                ).join('') + '</div></div>'\n              : '';\n\n            const rubricsHTML = '<div class=\"mb-6\"><h2 class=\"text-xl font-bold mb-3\">í‰ê°€ ë£¨ë¸Œë¦­</h2><div class=\"space-y-2\">' +\n              assignment.rubrics.map((rubric, idx) => \n                '<div class=\"border border-gray-300 rounded-lg p-4\"><div class=\"font-semibold\">' + (idx + 1) + '. ' + rubric.criterion_name + '</div><div class=\"text-sm text-gray-600 mt-1\">' + rubric.criterion_description + '</div></div>'\n              ).join('') + '</div></div>';\n\n            const accessCodeHTML = assignment.access_code \n              ? '<div class=\"mb-6 p-4 bg-yellow-50 border border-yellow-300 rounded-lg\"><h2 class=\"text-xl font-bold mb-2\">í•™ìƒ ì•¡ì„¸ìŠ¤ ì½”ë“œ</h2><div class=\"text-3xl font-mono font-bold text-center py-3\">' + assignment.access_code + '</div><p class=\"text-sm text-gray-600 text-center\">í•™ìƒë“¤ì—ê²Œ ì´ ì½”ë“œë¥¼ ê³µìœ í•˜ì„¸ìš”</p></div>'\n              : '';\n\n            printWindow.document.write(\n              '<html><head>' +\n              '<meta charset=\"UTF-8\">' +\n              '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">' +\n              '<title>' + assignment.title + ' - ì¸ì‡„</title>' +\n              '<script src=\"https://cdn.tailwindcss.com\"><' + '/script>' +\n              '<style>' +\n              'body { padding: 40px; background: white; }' +\n              '.print-title { font-size: 24px; font-weight: bold; margin-bottom: 30px; color: #111827; }' +\n              '@media print { .no-print { display: none; } }' +\n              '</style>' +\n              '</head><body>' +\n              '<div class=\"print-title\">ğŸ“ ' + assignment.title + '</div>' +\n              '<div class=\"mb-6\"><h2 class=\"text-xl font-bold mb-3\">ê³¼ì œ ì„¤ëª…</h2><p class=\"text-gray-700\">' + assignment.description + '</p><div class=\"mt-3 text-sm text-gray-600\"><i class=\"fas fa-graduation-cap mr-2\"></i>' + assignment.grade_level + (assignment.due_date ? ' | <i class=\"fas fa-clock mr-2 text-orange-600\"></i>ë§ˆê°: ' + new Date(assignment.due_date).toLocaleDateString('ko-KR') : '') + '</div></div>' +\n              promptsHTML +\n              rubricsHTML +\n              accessCodeHTML +\n              '<div class=\"no-print\" style=\"margin-top: 32px; display: flex; gap: 16px; justify-content: center;\">' +\n              '<button onclick=\"window.print()\" style=\"padding: 12px 24px; background: #1e3a8a; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;\">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>' +\n              '<button onclick=\"window.close()\" style=\"padding: 12px 24px; background: #e5e7eb; color: #374151; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;\">ë‹«ê¸°</button>' +\n              '</div>' +\n              '</body></html>'\n            );\n            printWindow.document.close();\n          }\n\n          async function loadAssignments() {\n            try {\n              const response = await axios.get('/api/assignments');\n              const assignments = response.data;\n\n              const container = document.getElementById('assignmentsList');\n\n              if (assignments.length === 0) {\n                container.innerHTML = \\`\n                  <div class=\"col-span-full text-center py-12\">\n                    <i class=\"fas fa-clipboard-list text-6xl text-gray-300 mb-4\"></i>\n                    <p class=\"text-gray-500 text-lg mb-4\">ì•„ì§ ë§Œë“  ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>\n                    <button onclick=\"showCreateAssignmentModal()\" class=\"px-6 py-3 bg-navy-900 text-white rounded-lg font-semibold hover:bg-navy-800 transition\">\n                      <i class=\"fas fa-plus mr-2\"></i>ì²« ê³¼ì œ ë§Œë“¤ê¸°\n                    </button>\n                  </div>\n                \\`;\n                return;\n              }\n\n              container.innerHTML = assignments.map(assignment => \\`\n                <div class=\"bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition cursor-pointer\" onclick=\"viewAssignment(\\${assignment.id})\">\n                  <div class=\"flex justify-between items-start mb-4\">\n                    <h3 class=\"text-xl font-bold text-gray-900\">\\${assignment.title}</h3>\n                    <span class=\"text-xs bg-navy-100 text-navy-800 px-3 py-1 rounded-full font-semibold\">\\${assignment.grade_level}</span>\n                  </div>\n                  <p class=\"text-gray-600 text-sm mb-4 line-clamp-2\">\\${assignment.description}</p>\n                  <div class=\"flex items-center justify-between text-sm text-gray-500\">\n                    <div>\n                      <i class=\"fas fa-calendar mr-2\"></i>\n                      \\${new Date(assignment.created_at).toLocaleDateString('ko-KR')}\n                    </div>\n                    \\${assignment.due_date ? \\`\n                      <div class=\"text-orange-600\">\n                        <i class=\"fas fa-clock mr-2\"></i>\n                        ë§ˆê°: \\${new Date(assignment.due_date).toLocaleDateString('ko-KR')}\n                      </div>\n                    \\` : ''}\n                  </div>\n                  <div class=\"mt-4 pt-4 border-t border-gray-200\">\n                    <button onclick=\"event.stopPropagation(); deleteAssignment(\\${assignment.id})\" class=\"text-red-600 hover:text-red-800 text-sm font-semibold\">\n                      <i class=\"fas fa-trash mr-1\"></i>ì‚­ì œ\n                    </button>\n                  </div>\n                </div>\n              \\`).join('');\n            } catch (error) {\n              console.error('Error loading assignments:', error);\n              document.getElementById('assignmentsList').innerHTML = \\`\n                <div class=\"col-span-full text-center py-8 text-red-600\">\n                  <i class=\"fas fa-exclamation-triangle text-3xl mb-3\"></i>\n                  <p>ê³¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>\n                </div>\n              \\`;\n            }\n          }\n\n          // View assignment detail\n          async function viewAssignment(assignmentId) {\n            try {\n              const response = await axios.get(\\`/api/assignment/\\${assignmentId}\\`);\n              const assignment = response.data;\n              currentAssignmentId = assignmentId;\n\n              document.getElementById('detailTitle').textContent = assignment.title;\n\n              // Store assignment for printing\n              window.currentAssignment = assignment;\n\n              document.getElementById('assignmentDetailContent').innerHTML = \\`\n                <div class=\"space-y-6\">\n                  <!-- Top buttons (original) -->\n                  <div class=\"flex justify-end mb-4\">\n                    <button onclick=\"printAssignment()\" class=\"px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition text-sm\">\n                      <i class=\"fas fa-print mr-2\"></i>ì¶œë ¥\n                    </button>\n                  </div>\n\n                  <!-- Access Code Display -->\n                  <div id=\"accessCodeSection\">\n                    \\${assignment.access_code ? \\`\n                    <div class=\"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white\">\n                      <div class=\"flex items-center justify-between\">\n                        <div>\n                          <h3 class=\"font-bold text-lg mb-2\"><i class=\"fas fa-key mr-2\"></i>í•™ìƒ ì ‘ì† ì½”ë“œ</h3>\n                          <p class=\"text-blue-100 text-sm\">ì´ ì½”ë“œë¥¼ í•™ìƒë“¤ì—ê²Œ ê³µìœ í•˜ì„¸ìš”</p>\n                        </div>\n                        <div class=\"bg-white bg-opacity-20 backdrop-blur-sm rounded-lg px-8 py-4\">\n                          <div class=\"text-4xl font-bold tracking-wider\">\\${assignment.access_code}</div>\n                        </div>\n                      </div>\n                    </div>\n                    \\` : \\`\n                    <div class=\"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-6\">\n                      <div class=\"flex items-center justify-between\">\n                        <div>\n                          <h3 class=\"font-bold text-lg mb-2 text-yellow-800\"><i class=\"fas fa-info-circle mr-2\"></i>ì•¡ì„¸ìŠ¤ ì½”ë“œ ë¯¸ìƒì„±</h3>\n                          <p class=\"text-yellow-700 text-sm\">í•™ìƒë“¤ì´ ê³¼ì œì— ì ‘ê·¼í•˜ë ¤ë©´ ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”</p>\n                        </div>\n                        <button \n                          onclick=\"generateAccessCode(\\${assignmentId})\" \n                          class=\"px-6 py-3 bg-yellow-600 text-white rounded-lg font-semibold hover:bg-yellow-700 transition\"\n                        >\n                          <i class=\"fas fa-key mr-2\"></i>ì•¡ì„¸ìŠ¤ ì½”ë“œ ìƒì„±\n                        </button>\n                      </div>\n                    </div>\n                    \\`}\n                  </div>\n\n                  <div class=\"bg-gray-50 rounded-lg p-6\">\n                    <h3 class=\"font-bold text-gray-900 mb-2\">ê³¼ì œ ì„¤ëª…</h3>\n                    <p class=\"text-gray-700\">\\${assignment.description}</p>\n                    <div class=\"mt-4 flex gap-4 text-sm text-gray-600\">\n                      <div><i class=\"fas fa-graduation-cap mr-2\"></i>\\${assignment.grade_level}</div>\n                      \\${assignment.due_date ? \\`<div><i class=\"fas fa-clock mr-2 text-orange-600\"></i>ë§ˆê°: \\${new Date(assignment.due_date).toLocaleDateString('ko-KR')}</div>\\` : ''}\n                    </div>\n                  </div>\n\n                  \\${assignment.prompts && assignment.prompts.length > 0 ? \\`\n                  <div class=\"bg-blue-50 rounded-lg p-6\">\n                    <h3 class=\"font-bold text-gray-900 mb-3\">ì œì‹œë¬¸</h3>\n                    <div class=\"space-y-3\">\n                      \\${assignment.prompts.map((prompt, idx) => \\`\n                        <div class=\"bg-white border border-blue-200 rounded-lg p-4\">\n                          <div class=\"font-semibold text-blue-900 mb-2\">ì œì‹œë¬¸ \\${idx + 1}</div>\n                          <div class=\"text-gray-700 whitespace-pre-wrap\">\\${prompt}</div>\n                        </div>\n                      \\`).join('')}\n                    </div>\n                  </div>\n                  \\` : ''}\n\n                  <div>\n                    <h3 class=\"font-bold text-gray-900 mb-3\">í‰ê°€ ë£¨ë¸Œë¦­ (\\${assignment.rubrics.length}ê°œ ê¸°ì¤€)</h3>\n                    <div class=\"space-y-2\">\n                      \\${assignment.rubrics.map((rubric, idx) => \\`\n                        <div class=\"border border-gray-200 rounded-lg p-4 bg-white\">\n                          <div class=\"font-semibold text-gray-900\">\\${idx + 1}. \\${rubric.criterion_name}</div>\n                          <div class=\"text-sm text-gray-600 mt-1\">\\${rubric.criterion_description}</div>\n                        </div>\n                      \\`).join('')}\n                    </div>\n                  </div>\n\n                  <div>\n                    <div class=\"flex justify-between items-center mb-3\">\n                      <h3 class=\"font-bold text-gray-900\">í•™ìƒ ì œì¶œë¬¼ (\\${assignment.submissions.length}ê°œ)</h3>\n                      <button onclick=\"showAddSubmissionForm()\" class=\"px-4 py-2 bg-navy-900 text-white rounded-lg font-semibold hover:bg-navy-800 transition text-sm\">\n                        <i class=\"fas fa-upload mr-2\"></i>ë‹µì•ˆì§€ ì¶”ê°€\n                      </button>\n                    </div>\n\n                    <div id=\"submissionsList\">\n                      \\${assignment.submissions.length === 0 ? \n                        '<p class=\"text-gray-500 text-center py-8\">ì•„ì§ ì œì¶œëœ ë‹µì•ˆì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' :\n                        '<div class=\"space-y-3\">' +\n                          assignment.submissions.map(submission => \n                            '<div class=\"border border-gray-200 rounded-lg p-4 bg-white hover:bg-gray-50 transition\">' +\n                              '<div class=\"flex justify-between items-start\">' +\n                                '<div class=\"flex-1\">' +\n                                  '<div class=\"font-semibold text-gray-900\">' + submission.student_name + '</div>' +\n                                  '<div class=\"text-sm text-gray-600 mt-1\">' + submission.essay_text.substring(0, 100) + '...</div>' +\n                                  '<div class=\"text-xs text-gray-500 mt-2\">' +\n                                    '<i class=\"fas fa-clock mr-1\"></i>' +\n                                    new Date(submission.submitted_at).toLocaleString('ko-KR') +\n                                  '</div>' +\n                                '</div>' +\n                                '<div class=\"ml-4\">' +\n                                  (submission.graded ? \n                                    '<span class=\"text-green-600 font-semibold text-sm\"><i class=\"fas fa-check-circle mr-1\"></i>ì±„ì ì™„ë£Œ</span>' :\n                                    '<button onclick=\"gradeSubmission(' + submission.id + ')\" class=\"px-4 py-2 bg-navy-900 text-white rounded-lg text-sm font-semibold hover:bg-navy-800 transition\">ì±„ì í•˜ê¸°</button>'\n                                  ) +\n                                '</div>' +\n                              '</div>' +\n                            '</div>'\n                          ).join('') +\n                        '</div>'\n                      }\n                    </div>\n\n                    <div id=\"addSubmissionForm\" class=\"hidden mt-4 border-2 border-dashed border-gray-300 rounded-lg p-6\">\n                      <h4 class=\"font-semibold text-gray-900 mb-4\">ìƒˆ ë‹µì•ˆì§€ ì¶”ê°€</h4>\n                      <form onsubmit=\"handleAddSubmission(event)\">\n                        <div class=\"space-y-3\">\n                          <div id=\"studentNameContainer\">\n                            <input type=\"text\" id=\"studentName\" placeholder=\"í•™ìƒ ì´ë¦„\" class=\"w-full px-4 py-2 border border-gray-300 rounded-lg\" required>\n                          </div>\n                          \n                          <!-- Essay Input Type Tabs -->\n                          <div>\n                            <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ë‹µì•ˆ ì…ë ¥ ë°©ì‹</label>\n                            <div class=\"flex gap-2 mb-3\">\n                              <button \n                                type=\"button\" \n                                id=\"submissionTextInputBtn\"\n                                onclick=\"switchSubmissionInputType('text')\" \n                                class=\"submission-input-tab flex-1 px-4 py-2 rounded-lg border-2 border-gray-300 text-sm font-semibold transition active bg-navy-900 text-white border-navy-900\"\n                              >\n                                <i class=\"fas fa-keyboard mr-2\"></i>í…ìŠ¤íŠ¸ ì…ë ¥\n                              </button>\n                              <button \n                                type=\"button\" \n                                id=\"submissionFileInputBtn\"\n                                onclick=\"switchSubmissionInputType('file')\" \n                                class=\"submission-input-tab flex-1 px-4 py-2 rounded-lg border-2 border-gray-300 text-sm font-semibold transition\"\n                              >\n                                <i class=\"fas fa-file-upload mr-2\"></i>íŒŒì¼ ì„ íƒ\n                              </button>\n                            </div>\n                          </div>\n                          \n                          <!-- Text Input Container -->\n                          <div id=\"submissionTextInputContainer\">\n                            <textarea id=\"studentEssay\" rows=\"6\" placeholder=\"í•™ìƒ ë…¼ìˆ  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”\" class=\"w-full px-4 py-2 border border-gray-300 rounded-lg\" required></textarea>\n                          </div>\n                          \n                          <!-- File Input Container -->\n                          <div id=\"submissionFileInputContainer\" class=\"hidden\">\n                            <div class=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-navy-500 transition\">\n                              <input \n                                type=\"file\" \n                                id=\"submissionEssayFile\" \n                                accept=\"image/*,.pdf\"\n                                class=\"hidden\"\n                                multiple\n                                onchange=\"handleSubmissionFileSelect(event)\"\n                              />\n                              <label for=\"submissionEssayFile\" class=\"cursor-pointer\">\n                                <div class=\"mb-3\">\n                                  <i class=\"fas fa-cloud-upload-alt text-5xl text-navy-700\"></i>\n                                </div>\n                                <p class=\"text-base font-semibold text-gray-700 mb-2\">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš” (ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ ê°€ëŠ¥)</p>\n                                <p class=\"text-sm text-gray-500 mb-3\">\n                                  ì§€ì› í˜•ì‹: ì´ë¯¸ì§€ (JPG, PNG), PDF (ìµœëŒ€ 10MB/íŒŒì¼)<br>\n                                  <span class=\"text-navy-700 font-medium\">íŒŒì¼ëª… í˜•ì‹: í•™ìƒì´ë¦„.pdf ë˜ëŠ” í•™ìƒì´ë¦„_ë‹µì•ˆ.pdf</span>\n                                </p>\n                                <span class=\"inline-block bg-navy-900 text-white px-6 py-2 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                                  <i class=\"fas fa-folder-open mr-2\"></i>íŒŒì¼ ì°¾ê¸° (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)\n                                </span>\n                              </label>\n                            </div>\n                            \n                            <!-- Multiple Files List -->\n                            <div id=\"multipleFilesContainer\" class=\"hidden mt-4\">\n                              <div class=\"flex justify-between items-center mb-3\">\n                                <h4 class=\"font-semibold text-gray-900\">ì„ íƒëœ íŒŒì¼ (<span id=\"fileCount\">0</span>ê°œ)</h4>\n                                <button type=\"button\" onclick=\"clearAllFiles()\" class=\"text-sm text-red-600 hover:text-red-800\">\n                                  <i class=\"fas fa-trash mr-1\"></i>ì „ì²´ ì‚­ì œ\n                                </button>\n                              </div>\n                              <div id=\"filesList\" class=\"space-y-2 max-h-96 overflow-y-auto\">\n                                <!-- File items will be added here -->\n                              </div>\n                            </div>\n                            \n                            <!-- File Preview (Legacy - for single file mode) -->\n                            <div id=\"submissionFilePreview\" class=\"hidden mt-3 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n                              <div class=\"flex items-center justify-between\">\n                                <div class=\"flex items-center\">\n                                  <i class=\"fas fa-file-alt text-3xl text-navy-700 mr-3\"></i>\n                                  <div>\n                                    <p id=\"submissionFileName\" class=\"font-semibold text-gray-800\"></p>\n                                    <p id=\"submissionFileSize\" class=\"text-sm text-gray-500\"></p>\n                                  </div>\n                                </div>\n                                <button \n                                  type=\"button\" \n                                  onclick=\"clearSubmissionFile()\" \n                                  class=\"text-red-500 hover:text-red-700\"\n                                >\n                                  <i class=\"fas fa-times-circle text-2xl\"></i>\n                                </button>\n                              </div>\n                              <!-- Image preview -->\n                              <div id=\"submissionImagePreview\" class=\"hidden mt-3\">\n                                <img id=\"submissionPreviewImg\" src=\"\" alt=\"Preview\" class=\"max-w-full h-auto rounded-lg border border-gray-300\" />\n                              </div>\n                            </div>\n                          </div>\n                          \n                          <div class=\"flex gap-2\">\n                            <button type=\"submit\" class=\"flex-1 px-4 py-2 bg-navy-900 text-white rounded-lg font-semibold hover:bg-navy-800 transition\">ì¶”ê°€</button>\n                            <button type=\"button\" onclick=\"hideAddSubmissionForm()\" class=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition\">ì·¨ì†Œ</button>\n                          </div>\n                        </div>\n                      </form>\n                    </div>\n                  </div>\n\n                  <!-- Bottom action buttons -->\n                  <div class=\"sticky bottom-0 bg-white border-t-2 border-gray-200 pt-4 mt-6 flex justify-end gap-3\">\n                    <button onclick=\"closeAssignmentDetailModal()\" class=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition\">\n                      <i class=\"fas fa-times mr-2\"></i>ë‹«ê¸°\n                    </button>\n                    <button onclick=\"printAssignment()\" class=\"px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition\">\n                      <i class=\"fas fa-print mr-2\"></i>ì¶œë ¥\n                    </button>\n                  </div>\n                </div>\n              \\`;\n\n              document.getElementById('assignmentDetailModal').classList.remove('hidden');\n            } catch (error) {\n              console.error('Error loading assignment:', error);\n              alert('ê³¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n\n          // Grading Settings Modal\n          let currentSubmissionIdForGrading = null;\n          \n          function showGradingSettingsModal(submissionId) {\n            console.log('showGradingSettingsModal called with:', submissionId, 'Type:', typeof submissionId);\n            \n            // Remove any existing modal first\n            const existingModal = document.getElementById('gradingSettingsModal');\n            if (existingModal) {\n              existingModal.remove();\n            }\n            \n            // Store submission ID\n            currentSubmissionIdForGrading = submissionId;\n            console.log('currentSubmissionIdForGrading set to:', currentSubmissionIdForGrading);\n            \n            const modalHTML = \\`\n              <div id=\"gradingSettingsModal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                <div class=\"bg-white rounded-xl shadow-2xl w-full max-w-lg p-6\">\n                  <div class=\"flex justify-between items-center mb-6\">\n                    <h2 class=\"text-2xl font-bold text-gray-900\">\n                      <i class=\"fas fa-sliders-h text-navy-700 mr-2\"></i>\n                      ì±„ì  ì„¤ì •\n                    </h2>\n                    <button onclick=\"closeGradingSettingsModal()\" class=\"text-gray-400 hover:text-gray-600\">\n                      <i class=\"fas fa-times text-2xl\"></i>\n                    </button>\n                  </div>\n                  \n                  <div class=\"space-y-6\">\n                    <!-- Feedback Detail Level -->\n                    <div>\n                      <label class=\"block text-sm font-semibold text-gray-700 mb-3\">\n                        <i class=\"fas fa-list-ul text-navy-700 mr-2\"></i>\n                        í”¼ë“œë°± ì„¸ë¶€ ìˆ˜ì¤€\n                      </label>\n                      <div class=\"grid grid-cols-3 gap-3\">\n                        <button \n                          type=\"button\"\n                          onclick=\"selectFeedbackLevel('detailed')\"\n                          class=\"feedback-level-btn px-4 py-3 border-2 border-gray-300 rounded-lg text-sm font-semibold hover:border-navy-500 transition active\"\n                          data-level=\"detailed\"\n                        >\n                          <i class=\"fas fa-align-justify mb-1\"></i>\n                          <div>ìƒì„¸í•˜ê²Œ</div>\n                        </button>\n                        <button \n                          type=\"button\"\n                          onclick=\"selectFeedbackLevel('moderate')\"\n                          class=\"feedback-level-btn px-4 py-3 border-2 border-gray-300 rounded-lg text-sm font-semibold hover:border-navy-500 transition\"\n                          data-level=\"moderate\"\n                        >\n                          <i class=\"fas fa-align-left mb-1\"></i>\n                          <div>ì¤‘ê°„</div>\n                        </button>\n                        <button \n                          type=\"button\"\n                          onclick=\"selectFeedbackLevel('brief')\"\n                          class=\"feedback-level-btn px-4 py-3 border-2 border-gray-300 rounded-lg text-sm font-semibold hover:border-navy-500 transition\"\n                          data-level=\"brief\"\n                        >\n                          <i class=\"fas fa-minus mb-1\"></i>\n                          <div>ê°„ëµí•˜ê²Œ</div>\n                        </button>\n                      </div>\n                      <p class=\"text-xs text-gray-500 mt-2\">\n                        <i class=\"fas fa-info-circle mr-1\"></i>\n                        í”¼ë“œë°±ì˜ ìƒì„¸í•¨ ì •ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”\n                      </p>\n                    </div>\n                    \n                    <!-- Grading Strictness -->\n                    <div>\n                      <label class=\"block text-sm font-semibold text-gray-700 mb-3\">\n                        <i class=\"fas fa-balance-scale text-navy-700 mr-2\"></i>\n                        ì±„ì  ê°•ë„\n                      </label>\n                      <div class=\"grid grid-cols-3 gap-3\">\n                        <button \n                          type=\"button\"\n                          onclick=\"selectGradingStrictness('lenient')\"\n                          class=\"grading-strictness-btn px-4 py-3 border-2 border-gray-300 rounded-lg text-sm font-semibold hover:border-navy-500 transition\"\n                          data-strictness=\"lenient\"\n                        >\n                          <i class=\"fas fa-smile mb-1\"></i>\n                          <div>ê´€ëŒ€í•˜ê²Œ</div>\n                        </button>\n                        <button \n                          type=\"button\"\n                          onclick=\"selectGradingStrictness('moderate')\"\n                          class=\"grading-strictness-btn px-4 py-3 border-2 border-gray-300 rounded-lg text-sm font-semibold hover:border-navy-500 transition active\"\n                          data-strictness=\"moderate\"\n                        >\n                          <i class=\"fas fa-meh mb-1\"></i>\n                          <div>ë³´í†µ</div>\n                        </button>\n                        <button \n                          type=\"button\"\n                          onclick=\"selectGradingStrictness('strict')\"\n                          class=\"grading-strictness-btn px-4 py-3 border-2 border-gray-300 rounded-lg text-sm font-semibold hover:border-navy-500 transition\"\n                          data-strictness=\"strict\"\n                        >\n                          <i class=\"fas fa-frown mb-1\"></i>\n                          <div>ì—„ê²©í•˜ê²Œ</div>\n                        </button>\n                      </div>\n                      <p class=\"text-xs text-gray-500 mt-2\">\n                        <i class=\"fas fa-info-circle mr-1\"></i>\n                        ì±„ì  ê¸°ì¤€ì˜ ì—„ê²©í•¨ ì •ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”\n                      </p>\n                    </div>\n                  </div>\n                  \n                  <div class=\"flex gap-3 mt-8\">\n                    <button \n                      onclick=\"confirmGradingSettings()\" \n                      class=\"flex-1 px-6 py-3 bg-navy-900 text-white rounded-lg font-semibold hover:bg-navy-800 transition\"\n                    >\n                      <i class=\"fas fa-check mr-2\"></i>ì±„ì  ì‹œì‘\n                    </button>\n                    <button \n                      onclick=\"closeGradingSettingsModal()\" \n                      class=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition\"\n                    >\n                      ì·¨ì†Œ\n                    </button>\n                  </div>\n                </div>\n              </div>\n            \\`;\n            \n            document.body.insertAdjacentHTML('beforeend', modalHTML);\n          }\n          \n          function selectFeedbackLevel(level) {\n            const buttons = document.querySelectorAll('.feedback-level-btn');\n            buttons.forEach(btn => {\n              if (btn.dataset.level === level) {\n                btn.classList.add('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              } else {\n                btn.classList.remove('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              }\n            });\n          }\n          \n          function selectGradingStrictness(strictness) {\n            const buttons = document.querySelectorAll('.grading-strictness-btn');\n            buttons.forEach(btn => {\n              if (btn.dataset.strictness === strictness) {\n                btn.classList.add('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              } else {\n                btn.classList.remove('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              }\n            });\n          }\n          \n          function closeGradingSettingsModal() {\n            const modal = document.getElementById('gradingSettingsModal');\n            if (modal) {\n              modal.remove();\n            }\n            currentSubmissionIdForGrading = null;\n          }\n          \n          async function confirmGradingSettings() {\n            // Get selected settings\n            const feedbackLevelBtn = document.querySelector('.feedback-level-btn.active');\n            const strictnessBtn = document.querySelector('.grading-strictness-btn.active');\n            \n            const feedbackLevel = feedbackLevelBtn ? feedbackLevelBtn.dataset.level : 'detailed';\n            const strictness = strictnessBtn ? strictnessBtn.dataset.strictness : 'moderate';\n            \n            // IMPORTANT: Store submission ID in local variable BEFORE closing modal\n            // because closeGradingSettingsModal sets currentSubmissionIdForGrading to null\n            const submissionId = currentSubmissionIdForGrading;\n            \n            console.log('Grading Settings:', {\n              submissionId: submissionId,\n              feedbackLevel,\n              strictness\n            });\n            \n            // Validate submission ID\n            if (!submissionId) {\n              alert('ì±„ì í•  ë‹µì•ˆì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n              closeGradingSettingsModal();\n              return;\n            }\n            \n            // Close settings modal (this will set currentSubmissionIdForGrading to null)\n            closeGradingSettingsModal();\n            \n            // Show loading modal for regrading\n            showGradingLoadingModal();\n            \n            // Start grading with settings using the stored local variable\n            await executeGradingWithLoading(submissionId, feedbackLevel, strictness);\n          }\n          \n          // Expose functions to window object for onclick handlers\n          window.gradeSubmission = gradeSubmission;\n          window.showGradingSettingsModal = showGradingSettingsModal;\n          window.selectFeedbackLevel = selectFeedbackLevel;\n          window.selectGradingStrictness = selectGradingStrictness;\n          window.closeGradingSettingsModal = closeGradingSettingsModal;\n          window.confirmGradingSettings = confirmGradingSettings;\n          window.togglePrintDropdown = togglePrintDropdown;\n          window.printReport = printReport;\n          window.exportToPDF = exportToPDF;\n          window.regradeSubmission = regradeSubmission;\n          window.previewRubric = previewRubric;\n          window.closeRubricPreview = closeRubricPreview;\n          window.selectCurrentRubric = selectCurrentRubric;\n          window.updateStudentName = updateStudentName;\n          window.removeFile = removeFile;\n          window.clearAllFiles = clearAllFiles;\n\n          // Platform rubric definitions\n          function getPlatformRubricCriteria(type) {\n            const rubrics = {\n              standard: [\n                { name: 'í•µì‹¬ ê°œë…ì˜ ì´í•´ì™€ ë¶„ì„', description: 'ë…¼ì œë¥¼ ì •í™•í•˜ê²Œ íŒŒì•…í•˜ê³  ê¹Šì´ ìˆê²Œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'ì¦ê±°ì™€ ì‚¬ë¡€ í™œìš©', description: 'ë…¼ê±°ê°€ ë…¼ë¦¬ì ì´ê³  ì„¤ë“ë ¥ì´ ìˆìŠµë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì¶œì²˜ ì¸ìš©ì˜ ì •í™•ì„±', description: 'êµ¬ì²´ì ì´ê³  ì ì ˆí•œ ì‚¬ë¡€ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í–ˆìŠµë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ë¬¸ë²• ì •í™•ì„±, êµ¬ì„± ë° íë¦„', description: 'ë¬¸ë²•, ì–´íœ˜, ë¬¸ì¥ êµ¬ì¡°ê°€ ì •í™•í•˜ê³  ì ì ˆí•©ë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ],\n              kr_elementary: [\n                { name: 'ë‚´ìš©ì˜ í’ë¶€ì„±', description: 'ìê¸° ìƒê°ì´ë‚˜ ëŠë‚Œ, ê²½í—˜ì„ ì†”ì§í•˜ê³  êµ¬ì²´ì ìœ¼ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.', order: 1 },\n                { name: 'ê¸€ì˜ ì§œì„', description: 'ì²˜ìŒë¶€í„° ëê¹Œì§€ ìì—°ìŠ¤ëŸ½ê²Œ ê¸€ì´ í˜ëŸ¬ê°‘ë‹ˆë‹¤.', order: 2 },\n                { name: 'í‘œí˜„ê³¼ ë§ì¶¤ë²•', description: 'ë¬¸ì¥ì´ ìì—°ìŠ¤ëŸ½ê³ , ë§ì¶¤ë²•ê³¼ ë„ì–´ì“°ê¸°ê°€ ë°”ë¦…ë‹ˆë‹¤.', order: 3 }\n              ],\n              kr_middle: [\n                { name: 'ì£¼ì œì˜ ëª…ë£Œì„±', description: 'ê¸€ì“´ì´ì˜ ì£¼ì¥ì´ë‚˜ ì£¼ì œê°€ ë¶„ëª…í•˜ê²Œ ë“œëŸ¬ë‚˜ëŠ”ì§€ í‰ê°€í•©ë‹ˆë‹¤.', order: 1 },\n                { name: 'ë…¼ë¦¬ì  êµ¬ì„±', description: 'ì„œë¡ (ë„ì…)-ë³¸ë¡ (ì „ê°œ)-ê²°ë¡ (ì •ë¦¬)ì˜ í˜•ì‹ì„ ê°–ì¶”ê³  ë¬¸ë‹¨ì´ ì˜ êµ¬ë¶„ë˜ì—ˆëŠ”ì§€ í‰ê°€í•©ë‹ˆë‹¤.', order: 2 },\n                { name: 'ê·¼ê±°ì˜ ì ì ˆì„±', description: 'ì£¼ì¥ì„ ë’·ë°›ì¹¨í•˜ê¸° ìœ„í•´ ì ì ˆí•œ ì´ìœ ë‚˜ ì˜ˆì‹œë¥¼ ë“¤ì—ˆëŠ”ì§€ í‰ê°€í•©ë‹ˆë‹¤.', order: 3 },\n                { name: 'í‘œí˜„ì˜ ì •í™•ì„±', description: 'í‘œì¤€ì–´ ì‚¬ìš©, ë§ì¶¤ë²•, ë¬¸ì¥ì˜ í˜¸ì‘ ë“± ê¸°ë³¸ì ì¸ êµ­ì–´ ì‚¬ìš© ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.', order: 4 }\n              ],\n              kr_high: [\n                { name: 'í†µì°°ë ¥ ë° ë¹„íŒì  ì‚¬ê³ ', description: 'ì£¼ì œë¥¼ ë‹¨ìˆœíˆ ë‚˜ì—´í•˜ì§€ ì•Šê³ , ìì‹ ë§Œì˜ ê´€ì ìœ¼ë¡œ ì‹¬ë„ ìˆê²Œ ë¶„ì„í•˜ê±°ë‚˜ ë¹„íŒì ìœ¼ë¡œ ê³ ì°°í–ˆìŠµë‹ˆë‹¤.', order: 1, max_score: 30 },\n                { name: 'ë…¼ì¦ì˜ ì²´ê³„ì„±', description: 'ë…¼ì§€ê°€ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ë˜ë©°, ì˜ˆìƒë˜ëŠ” ë°˜ë¡ ì„ ê³ ë ¤í•˜ê±°ë‚˜ ë…¼ë¦¬ì  ì™„ê²°ì„±ì„ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤.', order: 2, max_score: 30 },\n                { name: 'ê·¼ê±°ì˜ íƒ€ë‹¹ì„± ë° ë‹¤ì–‘ì„±', description: 'ê°ê´€ì  ìë£Œ, ì „ë¬¸ê°€ ê²¬í•´ ë“± ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê·¼ê±°ë¥¼ í™œìš©í•˜ì—¬ ì„¤ë“±ë ¥ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.', order: 3, max_score: 25 },\n                { name: 'ë¬¸ì²´ ë° ì–´ë²•ì˜ ì„¸ë ¨ë¨', description: 'í•™ìˆ ì  ê¸€ì“°ê¸°ì— ì í•©í•œ ì–´ì¡°ì™€ ì„¸ë ¨ëœ ë¬¸ì¥ êµ¬ì‚¬ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.', order: 4, max_score: 15 }\n              ],\n              nyregents: [\n                { name: 'ë‚´ìš©ê³¼ ë¶„ì„ (ì£¼ì¥ ì œì‹œ)', description: 'êµ¬ì²´ì ì¸ ì£¼ì¥ì„ ì œì‹œí•˜ê³ , ìë£Œì™€ ì£¼ì œë¥¼ ì ì ˆíˆ ë¶„ì„í•˜ë©°, ë°˜ë¡ ì„ í‰ê°€í•©ë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'ì¦ê±° í™œìš© ëŠ¥ë ¥', description: 'ê´€ë ¨ ì¦ê±°ë¥¼ í™œìš©í•˜ì—¬ ì¶©ë¶„í•˜ê³  ì ì ˆí•œ ê·¼ê±°ë¥¼ ì œì‹œí•˜ë©°, í‘œì ˆì„ í”¼í•˜ê³  í—ˆìš© ê°€ëŠ¥í•œ ì¸ìš© í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì¼ê´€ì„±ê³¼ êµ¬ì„±', description: 'ê³¼ì œì— ëŒ€í•œ ìˆ˜ìš© ê°€ëŠ¥í•œ ì§‘ì¤‘ë„ë¥¼ ìœ ì§€í•˜ê³ , ì²´ê³„ì ì´ê³  ë…¼ë¦¬ì ì¸ êµ¬ì¡°ë¡œ ê¸€ì„ êµ¬ì„±í•©ë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ì–¸ì–´ ì‚¬ìš©ê³¼ ê·œì¹™', description: 'ì ì ˆí•œ ì–´íœ˜ì™€ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©°, ë¬¸ë²•ê³¼ ë§ì¶¤ë²• ê·œì¹™ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ],\n              nyregents_analytical: [\n                { name: 'ë‚´ìš© ë° ë¶„ì„', description: '4ì : ë¶„ì„ ê¸°ì¤€ì„ ëª…í™•íˆ ì„¤ì •í•˜ëŠ” ë…¼ë¦¬ì ì¸ ì¤‘ì‹¬ ì•„ì´ë””ì–´ì™€ ê¸€ì“°ê¸° ì „ëµì„ ì œì‹œí•˜ê³ , ì €ìê°€ ì¤‘ì‹¬ ì•„ì´ë””ì–´ë¥¼ ì „ê°œí•˜ê¸° ìœ„í•´ ê¸€ì“°ê¸° ì „ëµì„ ì‚¬ìš©í•œ ë°©ì‹ì„ ê¹Šì´ ìˆê²Œ ë¶„ì„í•©ë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'ì¦ê±° í™œìš© ëŠ¥ë ¥', description: '4ì : ë¶„ì„ì„ ë’·ë°›ì¹¨í•˜ê¸° ìœ„í•´ êµ¬ì²´ì ì´ê³  ê´€ë ¨ì„± ìˆëŠ” ì¦ê±°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ì•„ì´ë””ì–´ë¥¼ ëª…í™•í•˜ê³  ì¼ê´€ë˜ê²Œ ì œì‹œí•©ë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì¼ê´€ì„±, êµ¬ì„± ë° ìŠ¤íƒ€ì¼', description: '4ì : ì•„ì´ë””ì–´ì™€ ì •ë³´ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ ì¼ê´€ë˜ê³  ì—°ê²°ëœ ì‘ë‹µì„ ìƒì„±í•˜ë©°, ì •í™•í•œ ì–¸ì–´ì™€ ê±´ì „í•œ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜•ì‹ì ì¸ ìŠ¤íƒ€ì¼ì„ í™•ë¦½í•˜ê³  ìœ ì§€í•©ë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ê·œì¹™ ìˆ™ë‹¬ë„', description: '4ì : í‘œì¤€ì–´ ë¬¸ë²•, ìš©ë²•, êµ¬ë‘ì , ì² ìë²•ì˜ ê·œì¹™ ìˆ™ë‹¬ë„ê°€ ë›°ì–´ë‚˜ë©° ì˜¤ë¥˜ê°€ ë“œë¬¼ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ],\n              ny_middle: [\n                { name: 'ë‚´ìš© ë° ë¶„ì„', description: '4ì : ê³¼ì œì˜ ëª©ì ê³¼ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì£¼ì œë¥¼ ì„¤ë“ë ¥ ìˆê²Œ ëª…í™•íˆ ì œì‹œí•˜ë©°, í…ìŠ¤íŠ¸ì— ëŒ€í•œ í†µì°°ë ¥ ìˆëŠ” ë¶„ì„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'ì¦ê±° í™œìš© ëŠ¥ë ¥', description: '4ì : ì£¼ì œì™€ ê´€ë ¨ëœ ì˜ ì„ íƒëœ ì‚¬ì‹¤, ì •ì˜, êµ¬ì²´ì ì¸ ì„¸ë¶€ ì‚¬í•­, ì¸ìš©ë¬¸ ë˜ëŠ” í…ìŠ¤íŠ¸ì˜ ë‹¤ë¥¸ ì •ë³´ì™€ ì˜ˆì‹œë¥¼ í™œìš©í•˜ì—¬ ì£¼ì œë¥¼ ì „ê°œí•˜ë©°, ë‹¤ì–‘í•˜ê³  ê´€ë ¨ì„± ìˆëŠ” ì¦ê±°ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì¼ê´€ì„±, êµ¬ì„± ë° ë¬¸ì²´', description: '4ì : ì ì ˆí•œ ë‹¤ì–‘í•œ ì „í™˜ì„ ëŠ¥ìˆ™í•˜ê²Œ ì‚¬ìš©í•˜ì—¬ í†µì¼ëœ ì „ì²´ë¥¼ ë§Œë“¤ê³  ì˜ë¯¸ë¥¼ ê°•í™”í•˜ëŠ” ëª…í™•í•œ êµ¬ì„±ì„ ë³´ì—¬ì£¼ë©°, í•™ë…„ì— ì í•©í•˜ê³  ë¬¸ì²´ì ìœ¼ë¡œ ì •êµí•œ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ëšœë ·í•œ ì–´ì¡°ë¥¼ ìœ ì§€í•˜ê³  í˜•ì‹ì ì¸ ë¬¸ì²´ë¥¼ í™•ë¦½í•©ë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ê·œì¹™ ì¤€ìˆ˜', description: '4ì : í•™ë…„ ìˆ˜ì¤€ì— ë§ëŠ” ê·œì¹™ ìˆ™ë‹¬ë„ë¥¼ ë³´ì—¬ì£¼ë©° ì˜¤ë¥˜ê°€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ],\n              ny_elementary: [\n                { name: 'ë‚´ìš© ë° ë¶„ì„', description: '4ì : ê³¼ì œì™€ ëª©ì ì— ë…¼ë¦¬ì ìœ¼ë¡œ ë¶€í•©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì£¼ì œë¥¼ ëª…í™•íˆ ì œì‹œí•˜ë©°, í…ìŠ¤íŠ¸ì— ëŒ€í•œ í†µì°°ë ¥ ìˆëŠ” ì´í•´ì™€ ë¶„ì„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'ì¦ê±° í™œìš© ëŠ¥ë ¥', description: '4ì : í…ìŠ¤íŠ¸ì—ì„œ ê´€ë ¨ì„± ìˆê³  ì˜ ì„ íƒëœ ì‚¬ì‹¤, ì •ì˜, êµ¬ì²´ì  ì„¸ë¶€ì‚¬í•­, ì¸ìš©ë¬¸ ë˜ëŠ” ê¸°íƒ€ ì •ë³´ì™€ ì˜ˆì‹œë¥¼ í™œìš©í•˜ì—¬ ì£¼ì œë¥¼ ì „ê°œí•˜ë©°, ë‹¤ì–‘í•˜ê³  ê´€ë ¨ì„± ìˆëŠ” ì¦ê±°ì˜ ì‚¬ìš©ì„ ì§€ì†í•©ë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì¼ê´€ì„±, êµ¬ì„± ë° ë¬¸ì²´', description: '4ì : ëª…í™•í•˜ê³  ëª©ì ì— ë¶€í•©í•˜ëŠ” êµ¬ì„±ì„ ë³´ì—¬ì£¼ë©°, í•™ë…„ ìˆ˜ì¤€ì— ë§ëŠ” ë‹¨ì–´ì™€ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì•„ì´ë””ì–´ë¥¼ ëŠ¥ìˆ™í•˜ê²Œ ì—°ê²°í•˜ê³ , í•™ë…„ ìˆ˜ì¤€ì— ë§ëŠ” ë¬¸ì²´ì ìœ¼ë¡œ ì •êµí•œ ì–¸ì–´ì™€ ë¶„ì•¼ë³„ ì „ë¬¸ ìš©ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ê·œì¹™ ì¤€ìˆ˜', description: '4ì : í•™ë…„ ìˆ˜ì¤€ì— ë§ëŠ” ê·œì¹™ ìˆ™ë‹¬ë„ë¥¼ ë³´ì—¬ì£¼ë©° ì˜¤ë¥˜ê°€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ],\n              ib_myp_highschool: [\n                { name: 'ì§€ì‹ê³¼ ì´í•´', description: '4ì : ê³¼í•™ì  ì§€ì‹ì„ ê°œê´„ì ìœ¼ë¡œ ì„¤ëª…í•˜ê³ , ìµìˆ™í•œ ìƒí™©ê³¼ ìµìˆ™í•˜ì§€ ì•Šì€ ìƒí™© ëª¨ë‘ì—ì„œ ë¬¸ì œ í•´ê²° ë° í•´ê²°ì±…ì„ ì œì•ˆí•˜ë©°, ì •ë³´ë¥¼ í•´ì„í•˜ì—¬ ê³¼í•™ì ìœ¼ë¡œ ë’·ë°›ì¹¨ë˜ëŠ” íŒë‹¨ì„ ë‚´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'ì¡°ì‚¬', description: '4ì : ê²€ì¦ ê°€ëŠ¥í•œ ë¬¸ì œë¥¼ ê°œìš”ë¡œ ì œì‹œí•˜ê³ , ê³¼í•™ì  ì¶”ë¡ ì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ì„ ì œì‹œí•˜ë©°, ì¶©ë¶„í•˜ê³  ê´€ë ¨ì„± ìˆëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ê³¼ ë³€ìˆ˜ ì¡°ì‘ ë°©ë²•ì„ ê°œìš”ë¡œ ì œì‹œí•˜ê³ , ë…¼ë¦¬ì ì´ê³  ì™„ì „í•˜ë©° ì•ˆì „í•œ ë°©ë²•ì„ ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì˜ì‚¬ ì†Œí†µ', description: '4ì : í•­ìƒ ëª…í™•í•˜ê³  ì ì ˆí•œ ë°©ì‹ìœ¼ë¡œ ì •ë³´ì™€ ì•„ì´ë””ì–´ë¥¼ ì „ë‹¬í•˜ë©°, ëª…í™•í•˜ê³  ë…¼ë¦¬ì ì¸ êµ¬ì¡°ë¡œ íš¨ê³¼ì ìœ¼ë¡œ êµ¬ì„±í•˜ê³ , ì ì ˆí•œ ê´€ë¡€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ë³´ ì¶œì²˜ë¥¼ ì¼ê´€ë˜ê²Œ ì œì‹œí•©ë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ë¹„íŒì  ì‚¬ê³ ', description: '4ì : ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì² ì €íˆ ë¶„ì„í•˜ê³ , ì„œë¡œ ë‹¤ë¥¸ ê´€ì ê³¼ ê·¸ í•¨ì˜ë¥¼ í‰ê°€í•˜ë©°, ë…¼ë¦¬ì ìœ¼ë¡œ ì˜ êµ¬ì„±ëœ ì¦ê±°ë¡œ ë’·ë°›ì¹¨ëœ ì˜ê²¬ì´ë‚˜ ê²°ë¡ ì„ ì œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ],\n              ib_myp_middleschool: [\n                { name: 'ì§€ì‹ê³¼ ì´í•´', description: '4ì : ê³¼í•™ì  ì§€ì‹ì„ ê°œê´„ì ìœ¼ë¡œ ì„¤ëª…í•˜ê³ , ìµìˆ™í•œ ìƒí™©ê³¼ ìµìˆ™í•˜ì§€ ì•Šì€ ìƒí™© ëª¨ë‘ì—ì„œ ë¬¸ì œ í•´ê²° ë° í•´ê²°ì±…ì„ ì œì•ˆí•˜ë©°, ì •ë³´ë¥¼ í•´ì„í•˜ì—¬ ê³¼í•™ì ìœ¼ë¡œ ë’·ë°›ì¹¨ë˜ëŠ” íŒë‹¨ì„ ë‚´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'ì¡°ì‚¬', description: '4ì : ê²€ì¦ ê°€ëŠ¥í•œ ë¬¸ì œë¥¼ ê°œìš”ë¡œ ì œì‹œí•˜ê³ , ê³¼í•™ì  ì¶”ë¡ ì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ì„ ì œì‹œí•˜ë©°, ì¶©ë¶„í•˜ê³  ê´€ë ¨ì„± ìˆëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ê³¼ ë³€ìˆ˜ ì¡°ì‘ ë°©ë²•ì„ ê°œìš”ë¡œ ì œì‹œí•˜ê³ , ë…¼ë¦¬ì ì´ê³  ì™„ì „í•˜ë©° ì•ˆì „í•œ ë°©ë²•ì„ ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì˜ì‚¬ ì†Œí†µ', description: '4ì : í•­ìƒ ëª…í™•í•˜ê³  ì ì ˆí•œ ë°©ì‹ìœ¼ë¡œ ì •ë³´ì™€ ì•„ì´ë””ì–´ë¥¼ ì „ë‹¬í•˜ë©°, ëª…í™•í•˜ê³  ë…¼ë¦¬ì ì¸ êµ¬ì¡°ë¡œ íš¨ê³¼ì ìœ¼ë¡œ êµ¬ì„±í•˜ê³ , ì ì ˆí•œ ê´€ë¡€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ë³´ ì¶œì²˜ë¥¼ ì¼ê´€ë˜ê²Œ ì œì‹œí•©ë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ë¹„íŒì  ì‚¬ê³ ', description: '4ì : ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì² ì €íˆ ë¶„ì„í•˜ê³ , ì„œë¡œ ë‹¤ë¥¸ ê´€ì ê³¼ ê·¸ í•¨ì˜ë¥¼ í‰ê°€í•˜ë©°, ë…¼ë¦¬ì ìœ¼ë¡œ ì˜ êµ¬ì„±ëœ ì¦ê±°ë¡œ ë’·ë°›ì¹¨ëœ ì˜ê²¬ì´ë‚˜ ê²°ë¡ ì„ ì œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ],\n              ib_myp_science: [\n                { name: 'ì§€ì‹ê³¼ ì´í•´', description: '4ì : ê³¼í•™ì  ì§€ì‹ì„ ê°œê´„ì ìœ¼ë¡œ ì„¤ëª…í•˜ê³ , ìµìˆ™í•œ ìƒí™©ê³¼ ìµìˆ™í•˜ì§€ ì•Šì€ ìƒí™© ëª¨ë‘ì—ì„œ ë¬¸ì œ í•´ê²° ë° í•´ê²°ì±…ì„ ì œì•ˆí•˜ë©°, ì •ë³´ë¥¼ í•´ì„í•˜ì—¬ ê³¼í•™ì ìœ¼ë¡œ ë’·ë°›ì¹¨ë˜ëŠ” íŒë‹¨ì„ ë‚´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 1, max_score: 4 },\n                { name: 'íƒêµ¬ ë° ì„¤ê³„', description: '4ì : ê²€ì¦ ê°€ëŠ¥í•œ ë¬¸ì œë¥¼ ê°œìš”ë¡œ ì œì‹œí•˜ê³ , ê³¼í•™ì  ì¶”ë¡ ì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ì„ ì œì‹œí•˜ë©°, ì¶©ë¶„í•˜ê³  ê´€ë ¨ì„± ìˆëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ê³¼ ë³€ìˆ˜ ì¡°ì‘ ë°©ë²•ì„ ê°œìš”ë¡œ ì œì‹œí•˜ê³ , ë…¼ë¦¬ì ì´ê³  ì™„ì „í•˜ë©° ì•ˆì „í•œ ë°©ë²•ì„ ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 2, max_score: 4 },\n                { name: 'ì˜ì‚¬ ì†Œí†µ', description: '4ì : í•­ìƒ ëª…í™•í•˜ê³  ì ì ˆí•œ ë°©ì‹ìœ¼ë¡œ ì •ë³´ì™€ ì•„ì´ë””ì–´ë¥¼ ì „ë‹¬í•˜ë©°, ëª…í™•í•˜ê³  ë…¼ë¦¬ì ì¸ êµ¬ì¡°ë¡œ íš¨ê³¼ì ìœ¼ë¡œ êµ¬ì„±í•˜ê³ , ì ì ˆí•œ ê´€ë¡€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ë³´ ì¶œì²˜ë¥¼ ì¼ê´€ë˜ê²Œ ì œì‹œí•©ë‹ˆë‹¤.', order: 3, max_score: 4 },\n                { name: 'ë¹„íŒì  ì‚¬ê³ ', description: '4ì : ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì² ì €íˆ ë¶„ì„í•˜ê³ , ì„œë¡œ ë‹¤ë¥¸ ê´€ì ê³¼ ê·¸ í•¨ì˜ë¥¼ í‰ê°€í•˜ë©°, ë…¼ë¦¬ì ìœ¼ë¡œ ì˜ êµ¬ì„±ëœ ì¦ê±°ë¡œ ë’·ë°›ì¹¨ëœ ì˜ê²¬ì´ë‚˜ ê²°ë¡ ì„ ì œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', order: 4, max_score: 4 }\n              ]\n            };\n            return rubrics[type] || rubrics.standard;\n          }\n\n          // Rubric type switching for assignment creation\n          function switchAssignmentRubricType(type) {\n            const platformBtn = document.getElementById('assignmentPlatformRubricBtn');\n            const customBtn = document.getElementById('assignmentCustomRubricBtn');\n            const platformContainer = document.getElementById('assignmentPlatformRubricContainer');\n            const customContainer = document.getElementById('assignmentCustomRubricContainer');\n\n            if (type === 'platform') {\n              platformBtn.classList.add('active');\n              customBtn.classList.remove('active');\n              platformContainer.classList.remove('hidden');\n              customContainer.classList.add('hidden');\n            } else {\n              customBtn.classList.add('active');\n              platformBtn.classList.remove('active');\n              customContainer.classList.remove('hidden');\n              platformContainer.classList.add('hidden');\n              \n              // Add 4 default criteria if rubric container is empty\n              const rubricContainer = document.getElementById('rubricCriteriaList');\n              if (rubricContainer && rubricContainer.children.length === 0) {\n                for (let i = 0; i < 4; i++) {\n                  addRubricCriterion();\n                }\n              }\n            }\n          }\n\n          // Show/hide modals\n          async function showCreateAssignmentModal() {\n            document.getElementById('createAssignmentModal').classList.remove('hidden');\n            // Default to platform rubric\n            switchAssignmentRubricType('platform');\n            \n            // Load existing assignments for the dropdown\n            await populateExistingAssignments();\n          }\n          \n          // Populate existing assignments dropdown\n          async function populateExistingAssignments() {\n            try {\n              const response = await axios.get('/api/assignments');\n              const assignments = response.data;\n              \n              const select = document.getElementById('existingAssignmentSelect');\n              // Clear existing options except the first one\n              select.innerHTML = '<option value=\"\">-- ê¸°ì¡´ ê³¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>';\n              \n              assignments.forEach(assignment => {\n                const option = document.createElement('option');\n                option.value = assignment.id;\n                option.textContent = \\`\\${assignment.title} (\\${new Date(assignment.created_at).toLocaleDateString('ko-KR')})\\`;\n                select.appendChild(option);\n              });\n              \n              console.log('Loaded', assignments.length, 'existing assignments');\n            } catch (error) {\n              console.error('Error loading existing assignments:', error);\n            }\n          }\n          \n          // Load existing assignment data\n          async function loadExistingAssignment() {\n            const select = document.getElementById('existingAssignmentSelect');\n            const assignmentId = select.value;\n            \n            if (!assignmentId) {\n              alert('ê³¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');\n              return;\n            }\n            \n            try {\n              const response = await axios.get(\\`/api/assignment/\\${assignmentId}\\`);\n              const assignment = response.data;\n              \n              console.log('Loading assignment:', assignment);\n              \n              // Fill in the form with existing assignment data\n              document.getElementById('assignmentTitle').value = assignment.title + ' (ë³µì‚¬ë³¸)';\n              document.getElementById('assignmentDescription').value = assignment.description || '';\n              document.getElementById('assignmentGradeLevel').value = assignment.grade_level || '';\n              document.getElementById('assignmentDueDate').value = assignment.due_date ? assignment.due_date.split('T')[0] : '';\n              \n              // Load reference materials (prompts)\n              // Handle both string and already-parsed array\n              let prompts = assignment.prompts;\n              if (typeof prompts === 'string') {\n                try {\n                  prompts = JSON.parse(prompts);\n                } catch (e) {\n                  console.error('Failed to parse prompts:', e);\n                  prompts = [];\n                }\n              } else if (!Array.isArray(prompts)) {\n                prompts = [];\n              }\n              \n              const container = document.getElementById('assignmentReferenceMaterials');\n              container.innerHTML = '';\n              \n              console.log('Loaded prompts:', prompts);\n              \n              // Add reference materials\n              prompts.forEach((prompt, index) => {\n                // Handle both string and object formats\n                const promptText = typeof prompt === 'string' ? prompt : (prompt.text || '');\n                const promptImageUrl = typeof prompt === 'object' ? prompt.image_url : '';\n                \n                console.log(\\`Prompt \\${index}:\\`, { promptText: promptText.substring(0, 50), promptImageUrl });\n                \n                const refItem = document.createElement('div');\n                refItem.className = 'reference-item';\n                refItem.innerHTML = \\`\n                  <div class=\"flex gap-2 mb-2\">\n                    <textarea class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm overflow-y-auto\" rows=\"5\" placeholder=\"ì œì‹œë¬¸ ë‚´ìš© (ì„ íƒì‚¬í•­)\">\\${promptText}</textarea>\n                    <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm self-start\">\n                      <i class=\"fas fa-times\"></i>\n                    </button>\n                  </div>\n                  <div class=\"flex gap-2\">\n                    <button type=\"button\" onclick=\"handleReferenceImageUpload(this)\" class=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-xs\">\n                      <i class=\"fas fa-image mr-1\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ\n                    </button>\n                    <span class=\"text-xs text-gray-500 self-center upload-status\">\\${promptImageUrl ? 'ì´ë¯¸ì§€ ì—…ë¡œë“œë¨' : ''}</span>\n                  </div>\n                \\`;\n                container.appendChild(refItem);\n                \n                // Store image URL if exists\n                if (promptImageUrl) {\n                  const textarea = refItem.querySelector('textarea');\n                  textarea.dataset.imageUrl = promptImageUrl;\n                }\n              });\n              \n              // If no prompts, add 4 empty slots\n              if (prompts.length === 0) {\n                for (let i = 0; i < 4; i++) {\n                  addReferenceMaterial();\n                }\n              }\n              \n              // Update reference count\n              updateReferenceCount();\n              \n              // Load rubric criteria\n              // Handle both string and already-parsed array\n              let criteria = assignment.rubric_criteria;\n              if (typeof criteria === 'string') {\n                try {\n                  criteria = JSON.parse(criteria);\n                } catch (e) {\n                  console.error('Failed to parse rubric_criteria:', e);\n                  criteria = [];\n                }\n              } else if (!Array.isArray(criteria)) {\n                criteria = [];\n              }\n              \n              const rubricType = assignment.rubric_type || 'platform';\n              \n              switchAssignmentRubricType(rubricType);\n              \n              if (rubricType === 'custom') {\n                const criteriaList = document.getElementById('rubricCriteriaList');\n                criteriaList.innerHTML = '';\n                criterionCounter = 0;\n                \n                criteria.forEach(criterion => {\n                  addRubricCriterion();\n                  const lastCriterion = criteriaList.lastElementChild;\n                  lastCriterion.querySelector('input[type=\"text\"]').value = criterion.name;\n                  lastCriterion.querySelector('textarea').value = criterion.description || '';\n                });\n              }\n              \n              console.log('Assignment loaded successfully!');\n              alert(\\`ê³¼ì œë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\\nì œëª©: \\${assignment.title}\\nì œì‹œë¬¸ ìˆ˜: \\${prompts.length}ê°œ\\n\\në‚´ìš©ì„ í¸ì§‘í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”.\\`);\n              \n            } catch (error) {\n              console.error('Error loading assignment:', error);\n              alert(\\`ê³¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\\nì˜¤ë¥˜: \\${error.response?.data?.error || error.message}\\`);\n            }\n          }\n\n          function closeCreateAssignmentModal() {\n            document.getElementById('createAssignmentModal').classList.add('hidden');\n            document.getElementById('createAssignmentForm').reset();\n            document.getElementById('rubricCriteriaList').innerHTML = '';\n            criterionCounter = 0;\n            \n            // Reset rubric type to platform\n            switchAssignmentRubricType('platform');\n            \n            // Reset reference materials to 4 default slots\n            const container = document.getElementById('assignmentReferenceMaterials');\n            container.innerHTML = \\`\n              <div class=\"reference-item flex gap-2\">\n                <input type=\"text\" class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm\" placeholder=\"ì°¸ê³  ìë£Œ URL ë˜ëŠ” ì„¤ëª… (ì„ íƒì‚¬í•­)\">\n                <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n              <div class=\"reference-item flex gap-2\">\n                <input type=\"text\" class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm\" placeholder=\"ì°¸ê³  ìë£Œ URL ë˜ëŠ” ì„¤ëª… (ì„ íƒì‚¬í•­)\">\n                <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n              <div class=\"reference-item flex gap-2\">\n                <input type=\"text\" class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm\" placeholder=\"ì°¸ê³  ìë£Œ URL ë˜ëŠ” ì„¤ëª… (ì„ íƒì‚¬í•­)\">\n                <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n              <div class=\"reference-item flex gap-2\">\n                <input type=\"text\" class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm\" placeholder=\"ì°¸ê³  ìë£Œ URL ë˜ëŠ” ì„¤ëª… (ì„ íƒì‚¬í•­)\">\n                <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n            \\`;\n            updateReferenceCount();\n          }\n\n          function closeAssignmentDetailModal() {\n            document.getElementById('assignmentDetailModal').classList.add('hidden');\n            currentAssignmentId = null;\n          }\n\n          // Generate access code for assignment\n          async function generateAccessCode(assignmentId) {\n            try {\n              const confirmed = confirm('ì´ ê³¼ì œì˜ ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');\n              if (!confirmed) return;\n\n              const response = await axios.post(\\`/api/assignment/\\${assignmentId}/generate-access-code\\`);\n              \n              if (response.data.success || response.data.access_code) {\n                const accessCode = response.data.access_code;\n                \n                // Update the access code section in the UI\n                const accessCodeSection = document.getElementById('accessCodeSection');\n                if (accessCodeSection) {\n                  accessCodeSection.innerHTML = \\`\n                    <div class=\"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white\">\n                      <div class=\"flex items-center justify-between\">\n                        <div>\n                          <h3 class=\"font-bold text-lg mb-2\"><i class=\"fas fa-key mr-2\"></i>í•™ìƒ ì ‘ì† ì½”ë“œ</h3>\n                          <p class=\"text-blue-100 text-sm\">ì´ ì½”ë“œë¥¼ í•™ìƒë“¤ì—ê²Œ ê³µìœ í•˜ì„¸ìš”</p>\n                        </div>\n                        <div class=\"bg-white bg-opacity-20 backdrop-blur-sm rounded-lg px-8 py-4\">\n                          <div class=\"text-4xl font-bold tracking-wider\">\\${accessCode}</div>\n                        </div>\n                      </div>\n                    </div>\n                  \\`;\n                }\n                \n                alert('ì•¡ì„¸ìŠ¤ ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ' + accessCode);\n              } else {\n                alert('ì•¡ì„¸ìŠ¤ ì½”ë“œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n              }\n            } catch (error) {\n              console.error('Error generating access code:', error);\n              alert('ì•¡ì„¸ìŠ¤ ì½”ë“œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n\n          // Add rubric criterion\n          function addRubricCriterion() {\n            criterionCounter++;\n            const container = document.getElementById('rubricCriteriaList');\n            const div = document.createElement('div');\n            div.className = 'border border-gray-200 rounded-lg p-3 bg-white';\n            div.id = \\`criterion-\\${criterionCounter}\\`;\n            \n            // Define placeholders for each criterion\n            const placeholders = [\n              { name: 'ê¸°ì¤€ ì´ë¦„(ì˜ˆ: í•µì‹¬ ê°œë…ì˜ ì´í•´ì™€ ë¶„ì„)', description: 'ê¸°ì¤€ ì„¤ëª…(ì˜ˆ: ì œ2ì°¨ ì„¸ê³„ëŒ€ì „ì˜ ì£¼ìš” ì›ì¸ì„ ì •í™•í•˜ê²Œ íŒŒì•…í•˜ê³  ê¹Šì´ ìˆê²Œ ë¶„ì„í•©ë‹ˆë‹¤.)' },\n              { name: 'ê¸°ì¤€ ì´ë¦„(ì˜ˆ: ì¦ê±°ì™€ ì—­ì‚¬ì  ì‚¬ë¡€ í™œìš©)', description: 'ê¸°ì¤€ ì„¤ëª…(ì˜ˆ: ë…¼ê±°ë¥¼ ë’·ë°›ì¹¨í•˜ê¸° ìœ„í•´ êµ¬ì²´ì ì´ê³  ì ì ˆí•œ ì—­ì‚¬ì  ì‚¬ë¡€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.)' },\n              { name: 'ê¸°ì¤€ ì´ë¦„(ì˜ˆ: ì¶œì²˜ ì¸ìš©ì˜ ì •í™•ì„±)', description: 'ê¸°ì¤€ ì„¤ëª…(ì˜ˆ: ì§€ì •ëœ ìë£Œì—ì„œ ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ìµœì†Œ ë‘ ë²ˆ ì¸ìš©í•©ë‹ˆë‹¤.)' },\n              { name: 'ê¸°ì¤€ ì´ë¦„(ì˜ˆ: ë¬¸ë²• ì •í™•ì„±, êµ¬ì„± ë° íë¦„)', description: 'ê¸°ì¤€ ì„¤ëª…(ì˜ˆ: ìµœì†Œí•œì˜ ë¬¸ë²• ì˜¤ë¥˜, ë…¼ë¦¬ì  íë¦„, ë‹¤ì–‘í•œ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.)' }\n            ];\n            \n            const placeholder = placeholders[(criterionCounter - 1) % 4];\n            \n            div.innerHTML = \\`\n              <div class=\"flex justify-between items-center mb-2\">\n                <span class=\"text-xs font-semibold text-gray-600\">ê¸°ì¤€ \\${criterionCounter}</span>\n                <button type=\"button\" onclick=\"removeCriterion(\\${criterionCounter})\" class=\"text-red-500 hover:text-red-700 text-xs\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n              <input type=\"text\" class=\"criterion-name w-full px-3 py-2 border border-gray-200 rounded mb-2 text-sm placeholder-gray-400\" placeholder=\"\\${placeholder.name}\" required>\n              <textarea class=\"criterion-description w-full px-3 py-2 border border-gray-200 rounded mb-2 text-sm placeholder-gray-400\" rows=\"2\" placeholder=\"\\${placeholder.description}\" required></textarea>\n              <div class=\"flex items-center gap-2 mt-2\">\n                <label class=\"text-xs font-semibold text-gray-600 flex-shrink-0\">ìµœëŒ€ ì ìˆ˜:</label>\n                <input type=\"number\" class=\"criterion-max-score w-24 px-3 py-1 border border-gray-200 rounded text-sm\" placeholder=\"4\" min=\"1\" max=\"100\" value=\"4\" required>\n                <span class=\"text-xs text-gray-500\">ì </span>\n              </div>\n            \\`;\n            container.appendChild(div);\n          }\n\n          function removeCriterion(id) {\n            document.getElementById(\\`criterion-\\${id}\\`).remove();\n          }\n\n          // Reference materials management\n          function updateReferenceCount() {\n            const count = document.querySelectorAll('#assignmentReferenceMaterials .reference-item').length;\n            document.getElementById('referenceCount').textContent = \\`\\${count} / 11\\`;\n            const addBtn = document.getElementById('addReferenceBtn');\n            if (count >= 11) {\n              addBtn.disabled = true;\n              addBtn.classList.add('opacity-50', 'cursor-not-allowed');\n            } else {\n              addBtn.disabled = false;\n              addBtn.classList.remove('opacity-50', 'cursor-not-allowed');\n            }\n          }\n\n          function addReferenceMaterial() {\n            const container = document.getElementById('assignmentReferenceMaterials');\n            const count = container.querySelectorAll('.reference-item').length;\n            if (count >= 11) return;\n\n            const div = document.createElement('div');\n            div.className = 'reference-item';\n            div.innerHTML = \\`\n              <div class=\"flex gap-2 mb-2\">\n                <textarea class=\"reference-input flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm overflow-y-auto\" rows=\"5\" placeholder=\"ì œì‹œë¬¸ ë‚´ìš© (ì„ íƒì‚¬í•­)\"></textarea>\n                <button type=\"button\" onclick=\"removeReferenceMaterial(this)\" class=\"px-3 py-2 text-red-600 hover:text-red-800 text-sm self-start\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n              <div class=\"flex gap-2\">\n                <button type=\"button\" onclick=\"handleReferenceImageUpload(this)\" class=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-xs\">\n                  <i class=\"fas fa-image mr-1\"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ\n                </button>\n                <span class=\"text-xs text-gray-500 self-center upload-status\"></span>\n              </div>\n            \\`;\n            container.appendChild(div);\n            updateReferenceCount();\n          }\n\n          function removeReferenceMaterial(btn) {\n            const container = document.getElementById('assignmentReferenceMaterials');\n            if (container.querySelectorAll('.reference-item').length <= 1) {\n              alert('ìµœì†Œ 1ê°œì˜ ì°¸ê³  ìë£Œ ìŠ¬ë¡¯ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');\n              return;\n            }\n            btn.closest('.reference-item').remove();\n            updateReferenceCount();\n          }\n\n          // Handle reference image upload\n          async function handleReferenceImageUpload(btn) {\n            const input = document.createElement('input');\n            input.type = 'file';\n            input.accept = 'image/*';\n            input.onchange = async (e) => {\n              const file = e.target.files[0];\n              if (!file) return;\n\n              const statusSpan = btn.parentElement.querySelector('.upload-status');\n              const textarea = btn.closest('.reference-item').querySelector('.reference-input');\n              \n              statusSpan.textContent = 'ì—…ë¡œë“œ ì¤‘...';\n              btn.disabled = true;\n\n              try {\n                const formData = new FormData();\n                formData.append('file', file);\n\n                const response = await axios.post('/api/upload/image', formData, {\n                  headers: { 'Content-Type': 'multipart/form-data' }\n                });\n\n                if (response.data.extracted_text) {\n                  textarea.value = response.data.extracted_text;\n                  statusSpan.textContent = 'âœ“ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì™„ë£Œ';\n                  statusSpan.className = 'text-xs text-green-600 self-center upload-status';\n                } else {\n                  statusSpan.textContent = 'âœ“ ì—…ë¡œë“œ ì™„ë£Œ';\n                  statusSpan.className = 'text-xs text-green-600 self-center upload-status';\n                }\n              } catch (error) {\n                console.error('Image upload error:', error);\n                statusSpan.textContent = 'âœ— ì—…ë¡œë“œ ì‹¤íŒ¨';\n                statusSpan.className = 'text-xs text-red-600 self-center upload-status';\n                alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.response?.data?.error || error.message));\n              } finally {\n                btn.disabled = false;\n              }\n            };\n            input.click();\n          }\n\n          // Handle create assignment\n          async function handleCreateAssignment(event) {\n            event.preventDefault();\n\n            const title = document.getElementById('assignmentTitle').value;\n            const description = document.getElementById('assignmentDescription').value;\n            const grade_level = document.getElementById('assignmentGradeLevel').value;\n            const due_date = document.getElementById('assignmentDueDate').value;\n\n            // Collect prompts from reference materials\n            const promptInputs = document.querySelectorAll('#assignmentReferenceMaterials .reference-input');\n            const prompts = Array.from(promptInputs)\n              .map(input => input.value.trim())\n              .filter(text => text.length > 0);\n\n            // Check which rubric type is selected\n            const isCustomRubric = !document.getElementById('assignmentCustomRubricContainer').classList.contains('hidden');\n            \n            let rubric_criteria = [];\n            \n            if (isCustomRubric) {\n              // Custom rubric\n              const criteriaElements = document.querySelectorAll('#rubricCriteriaList > div');\n              if (criteriaElements.length === 0) {\n                alert('ìµœì†Œ 1ê°œì˜ í‰ê°€ ê¸°ì¤€ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.');\n                return;\n              }\n              rubric_criteria = Array.from(criteriaElements).map((el, idx) => {\n                const maxScoreInput = el.querySelector('.criterion-max-score');\n                const maxScore = maxScoreInput ? parseInt(maxScoreInput.value) || 4 : 4;\n                return {\n                  name: el.querySelector('.criterion-name').value,\n                  description: el.querySelector('.criterion-description').value,\n                  order: idx + 1,\n                  max_score: maxScore\n                };\n              });\n            } else {\n              // Platform rubric\n              const platformRubricType = document.getElementById('selectedPlatformRubric').value;\n              if (!platformRubricType) {\n                alert('í”Œë«í¼ ë£¨ë¸Œë¦­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n                return;\n              }\n              rubric_criteria = getPlatformRubricCriteria(platformRubricType);\n            }\n\n            try {\n              await axios.post('/api/assignments', {\n                title,\n                description,\n                grade_level,\n                due_date: due_date || null,\n                rubric_criteria,\n                prompts\n              });\n\n              alert('ê³¼ì œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');\n              closeCreateAssignmentModal();\n              loadAssignments();\n            } catch (error) {\n              console.error('Error creating assignment:', error);\n              alert('ê³¼ì œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n\n          // Delete assignment\n          async function deleteAssignment(assignmentId) {\n            if (!confirm('ì •ë§ ì´ ê³¼ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;\n\n            try {\n              await axios.delete(\\`/api/assignment/\\${assignmentId}\\`);\n              alert('ê³¼ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n              loadAssignments();\n            } catch (error) {\n              console.error('Error deleting assignment:', error);\n              alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n\n          // Show/hide submission form\n          function showAddSubmissionForm() {\n            document.getElementById('addSubmissionForm').classList.remove('hidden');\n          }\n\n          function hideAddSubmissionForm() {\n            document.getElementById('addSubmissionForm').classList.add('hidden');\n            // Reset form\n            document.getElementById('studentName').value = '';\n            document.getElementById('studentEssay').value = '';\n            clearSubmissionFile();\n            clearAllFiles();\n            switchSubmissionInputType('text');\n          }\n\n          // Global variable for selected submission file\n          let selectedSubmissionFile = null;\n\n          // Switch between text and file input for submission\n          function switchSubmissionInputType(type) {\n            const textInputBtn = document.getElementById('submissionTextInputBtn');\n            const fileInputBtn = document.getElementById('submissionFileInputBtn');\n            const textInputContainer = document.getElementById('submissionTextInputContainer');\n            const fileInputContainer = document.getElementById('submissionFileInputContainer');\n            const essayTextarea = document.getElementById('studentEssay');\n            const studentNameContainer = document.getElementById('studentNameContainer');\n            const studentNameInput = document.getElementById('studentName');\n            \n            if (type === 'text') {\n              textInputBtn.classList.add('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              fileInputBtn.classList.remove('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              textInputContainer.classList.remove('hidden');\n              fileInputContainer.classList.add('hidden');\n              essayTextarea.required = true;\n              \n              // Show student name field for text input\n              if (studentNameContainer) studentNameContainer.classList.remove('hidden');\n              if (studentNameInput) studentNameInput.setAttribute('required', 'required');\n              \n              // Clear multiple files if any\n              clearAllFiles();\n            } else {\n              fileInputBtn.classList.add('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              textInputBtn.classList.remove('active', 'bg-navy-900', 'text-white', 'border-navy-900');\n              fileInputContainer.classList.remove('hidden');\n              textInputContainer.classList.add('hidden');\n              essayTextarea.required = false;\n              \n              // Show student name field initially (will be hidden if multiple files selected)\n              if (studentNameContainer) studentNameContainer.classList.remove('hidden');\n              if (studentNameInput) studentNameInput.setAttribute('required', 'required');\n            }\n          }\n\n          // Format file size for display\n          function formatFileSize(bytes) {\n            if (bytes === 0) return '0 Bytes';\n            const k = 1024;\n            const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n            const i = Math.floor(Math.log(bytes) / Math.log(k));\n            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n          }\n\n          // Compress image to fit OCR size limit (under 900KB)\n          async function compressImage(file, maxSizeKB = 900) {\n            return new Promise((resolve, reject) => {\n              const reader = new FileReader();\n              reader.onload = function(e) {\n                const img = new Image();\n                img.onload = function() {\n                  const canvas = document.createElement('canvas');\n                  let width = img.width;\n                  let height = img.height;\n                  \n                  // Calculate resize ratio to target ~800KB\n                  const fileSizeKB = file.size / 1024;\n                  if (fileSizeKB <= maxSizeKB) {\n                    // File is already small enough\n                    resolve(file);\n                    return;\n                  }\n                  \n                  // Reduce dimensions to reduce file size\n                  const scaleFactor = Math.sqrt(maxSizeKB / fileSizeKB);\n                  width = Math.floor(width * scaleFactor);\n                  height = Math.floor(height * scaleFactor);\n                  \n                  canvas.width = width;\n                  canvas.height = height;\n                  \n                  const ctx = canvas.getContext('2d');\n                  ctx.drawImage(img, 0, 0, width, height);\n                  \n                  // Convert to blob with quality adjustment\n                  canvas.toBlob(function(blob) {\n                    if (blob) {\n                      // Create a new File object with the compressed blob\n                      const compressedFile = new File([blob], file.name, {\n                        type: 'image/jpeg',\n                        lastModified: Date.now()\n                      });\n                      resolve(compressedFile);\n                    } else {\n                      reject(new Error('Failed to compress image'));\n                    }\n                  }, 'image/jpeg', 0.85); // 85% quality\n                };\n                img.onerror = reject;\n                img.src = e.target.result;\n              };\n              reader.onerror = reject;\n              reader.readAsDataURL(file);\n            });\n          }\n\n          // Handle file selection in submission form\n          // Store multiple selected files with student names\n          let selectedSubmissionFiles = [];\n          \n          // Extract student name from filename\n          function extractStudentNameFromFilename(filename) {\n            // Remove extension\n            const nameWithoutExt = filename.replace(/\\.(pdf|jpg|jpeg|png|gif|bmp|webp)$/i, '');\n            \n            // Remove common suffixes like \"_ë‹µì•ˆ\", \"_ë…¼ìˆ \", \"_ê³¼ì œ\" etc.\n            const cleaned = nameWithoutExt.replace(/[_\\-\\s]*(ë‹µì•ˆ|ë…¼ìˆ |ê³¼ì œ|ì œì¶œ|submission)$/i, '').trim();\n            \n            return cleaned || 'í•™ìƒ';\n          }\n          \n          async function handleSubmissionFileSelect(event) {\n            const files = Array.from(event.target.files);\n            if (!files || files.length === 0) return;\n            \n            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/bmp', 'image/webp', 'application/pdf'];\n            selectedSubmissionFiles = [];\n            \n            // Validate and process each file\n            for (const file of files) {\n              // Validate file size (10MB)\n              if (file.size > 10 * 1024 * 1024) {\n                alert(\\`íŒŒì¼ \"\\${file.name}\"ì˜ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤. ê±´ë„ˆëœë‹ˆë‹¤.\\`);\n                continue;\n              }\n              \n              // Validate file type\n              if (!validTypes.includes(file.type)) {\n                alert(\\`íŒŒì¼ \"\\${file.name}\"ì€(ëŠ”) ì§€ì›í•˜ì§€ ì•ŠëŠ” í˜•ì‹ì…ë‹ˆë‹¤. ê±´ë„ˆëœë‹ˆë‹¤.\\`);\n                continue;\n              }\n              \n              // Compress image if it's too large for OCR\n              let processedFile = file;\n              if (file.type.startsWith('image/') && file.size > 900 * 1024) {\n                try {\n                  console.log(\\`Compressing \\${file.name}: \\${formatFileSize(file.size)}\\`);\n                  processedFile = await compressImage(file);\n                  console.log(\\`Compressed to: \\${formatFileSize(processedFile.size)}\\`);\n                } catch (error) {\n                  console.error('Failed to compress image:', error);\n                  // Continue with original file if compression fails\n                }\n              }\n              \n              // Extract student name from filename\n              const studentName = extractStudentNameFromFilename(file.name);\n              \n              selectedSubmissionFiles.push({\n                file: processedFile,\n                originalName: file.name,\n                studentName: studentName,\n                size: processedFile.size,\n                type: file.type\n              });\n            }\n            \n            // Show multiple files UI\n            if (selectedSubmissionFiles.length > 0) {\n              displayMultipleFiles();\n              document.getElementById('multipleFilesContainer').classList.remove('hidden');\n              document.getElementById('submissionFilePreview').classList.add('hidden');\n              \n              // Hide student name field for multiple files (names are in the file list)\n              const studentNameContainer = document.getElementById('studentNameContainer');\n              const studentNameInput = document.getElementById('studentName');\n              if (studentNameContainer) studentNameContainer.classList.add('hidden');\n              if (studentNameInput) studentNameInput.removeAttribute('required');\n            } else {\n              alert('ì„ íƒí•œ íŒŒì¼ ì¤‘ ìœ íš¨í•œ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');\n              event.target.value = '';\n            }\n          }\n          \n          // Display multiple files list\n          function displayMultipleFiles() {\n            const filesList = document.getElementById('filesList');\n            const fileCount = document.getElementById('fileCount');\n            \n            fileCount.textContent = selectedSubmissionFiles.length;\n            filesList.innerHTML = '';\n            \n            selectedSubmissionFiles.forEach((fileInfo, index) => {\n              const fileItem = document.createElement('div');\n              fileItem.className = 'bg-white border border-gray-200 rounded-lg p-3 flex items-center gap-3';\n              fileItem.innerHTML = \\`\n                <div class=\"flex-shrink-0\">\n                  <i class=\"fas \\${fileInfo.type === 'application/pdf' ? 'fa-file-pdf text-red-600' : 'fa-image text-blue-600'} text-2xl\"></i>\n                </div>\n                <div class=\"flex-1 min-w-0\">\n                  <div class=\"flex items-center gap-2 mb-1\">\n                    <span class=\"text-sm font-medium text-gray-900 truncate\">\\${fileInfo.originalName}</span>\n                    <span class=\"text-xs text-gray-500\">(\\${formatFileSize(fileInfo.size)})</span>\n                  </div>\n                  <div class=\"flex items-center gap-2\">\n                    <label class=\"text-xs text-gray-600\">í•™ìƒ ì´ë¦„:</label>\n                    <input \n                      type=\"text\" \n                      value=\"\\${fileInfo.studentName}\"\n                      onchange=\"updateStudentName(\\${index}, this.value)\"\n                      class=\"text-sm px-2 py-1 border border-gray-300 rounded flex-1\"\n                      placeholder=\"í•™ìƒ ì´ë¦„ ì…ë ¥\"\n                    />\n                  </div>\n                </div>\n                <button \n                  type=\"button\"\n                  onclick=\"removeFile(\\${index})\"\n                  class=\"flex-shrink-0 text-red-600 hover:text-red-800 px-2\"\n                >\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              \\`;\n              filesList.appendChild(fileItem);\n            });\n          }\n          \n          // Update student name for a file\n          function updateStudentName(index, newName) {\n            if (selectedSubmissionFiles[index]) {\n              selectedSubmissionFiles[index].studentName = newName.trim();\n            }\n          }\n          \n          // Remove a file from the list\n          function removeFile(index) {\n            selectedSubmissionFiles.splice(index, 1);\n            if (selectedSubmissionFiles.length > 0) {\n              displayMultipleFiles();\n            } else {\n              clearAllFiles();\n            }\n          }\n          \n          // Clear all selected files\n          function clearAllFiles() {\n            selectedSubmissionFiles = [];\n            document.getElementById('submissionEssayFile').value = '';\n            document.getElementById('multipleFilesContainer').classList.add('hidden');\n            \n            // Show student name field again\n            const studentNameContainer = document.getElementById('studentNameContainer');\n            const studentNameInput = document.getElementById('studentName');\n            if (studentNameContainer) studentNameContainer.classList.remove('hidden');\n            if (studentNameInput) studentNameInput.setAttribute('required', 'required');\n          }\n\n          // Clear selected file in submission form\n          function clearSubmissionFile() {\n            selectedSubmissionFile = null;\n            const fileInput = document.getElementById('submissionEssayFile');\n            if (fileInput) fileInput.value = '';\n            const filePreview = document.getElementById('submissionFilePreview');\n            if (filePreview) filePreview.classList.add('hidden');\n            const imagePreview = document.getElementById('submissionImagePreview');\n            if (imagePreview) imagePreview.classList.add('hidden');\n          }\n\n          // Upload submission file and extract text\n          async function uploadSubmissionFileAndExtractText(file) {\n            // Determine endpoint based on file type\n            let endpoint = '/api/upload/image';\n            if (file.type === 'application/pdf') {\n              endpoint = '/api/upload/pdf';\n            }\n            \n            const formData = new FormData();\n            formData.append('file', file);\n            \n            try {\n              // Show processing message\n              const response = await axios.post(endpoint, formData, {\n                headers: { 'Content-Type': 'multipart/form-data' }\n              });\n              \n              if (response.data && response.data.extracted_text) {\n                return response.data.extracted_text;\n              } else {\n                // Check if there's a specific error message from the server\n                const errorMsg = response.data?.error || 'í…ìŠ¤íŠ¸ ì¶”ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ê°€ ëª…í™•í•œì§€, í…ìŠ¤íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.';\n                throw new Error(errorMsg);\n              }\n            } catch (error) {\n              console.error('File upload error:', error);\n              \n              // Extract error message from various possible sources\n              if (error.response && error.response.data && error.response.data.error) {\n                throw new Error(error.response.data.error);\n              } else if (error.message) {\n                throw new Error(error.message);\n              } else {\n                throw new Error('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');\n              }\n            }\n          }\n\n          // Handle add submission\n          async function handleAddSubmission(event) {\n            event.preventDefault();\n\n            const student_name = document.getElementById('studentName').value;\n            const isFileInput = !document.getElementById('submissionFileInputContainer').classList.contains('hidden');\n            \n            try {\n              if (isFileInput) {\n                // Check if multiple files or single file mode\n                if (selectedSubmissionFiles.length > 0) {\n                  // Multiple files mode - batch upload\n                  await handleBatchSubmissionUpload(event);\n                } else if (selectedSubmissionFile) {\n                  // Legacy single file mode (fallback)\n                  await handleSingleSubmissionUpload(event, student_name);\n                } else {\n                  alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n                  return;\n                }\n              } else {\n                // Text input mode\n                await handleSingleSubmissionUpload(event, student_name);\n              }\n            } catch (error) {\n              console.error('Error adding submission:', error);\n              alert('ë‹µì•ˆì§€ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n          \n          // Handle single submission upload (text or single file)\n          async function handleSingleSubmissionUpload(event, student_name) {\n            const isFileInput = !document.getElementById('submissionFileInputContainer').classList.contains('hidden');\n            let essay_text = '';\n            \n            const submitButton = event.target.querySelector('button[type=\"submit\"]');\n            const originalButtonText = submitButton.innerHTML;\n            \n            try {\n              if (isFileInput && selectedSubmissionFile) {\n                submitButton.disabled = true;\n                submitButton.innerHTML = '<i class=\"fas fa-spinner fa-spin mr-2\"></i>íŒŒì¼ ì²˜ë¦¬ ì¤‘...';\n                \n                // Upload file and extract text\n                essay_text = await uploadSubmissionFileAndExtractText(selectedSubmissionFile);\n                \n                if (!essay_text || essay_text.trim() === '') {\n                  throw new Error('íŒŒì¼ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n                }\n              } else {\n                // Text input mode\n                essay_text = document.getElementById('studentEssay').value;\n              }\n              \n              // Submit the essay\n              await axios.post(\\`/api/assignment/\\${currentAssignmentId}/submission\\`, {\n                student_name,\n                essay_text\n              });\n\n              alert('ë‹µì•ˆì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');\n              hideAddSubmissionForm();\n              viewAssignment(currentAssignmentId);\n            } catch (uploadError) {\n              throw uploadError;\n            } finally {\n              if (submitButton) {\n                submitButton.disabled = false;\n                submitButton.innerHTML = originalButtonText;\n              }\n            }\n          }\n          \n          // Handle batch submission upload (multiple files)\n          async function handleBatchSubmissionUpload(event) {\n            // Validate that all files have student names\n            const filesWithoutNames = selectedSubmissionFiles.filter(f => !f.studentName || f.studentName.trim() === '');\n            if (filesWithoutNames.length > 0) {\n              alert('ëª¨ë“  íŒŒì¼ì— í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');\n              return;\n            }\n            \n            const submitButton = event.target.querySelector('button[type=\"submit\"]');\n            const originalButtonText = submitButton.innerHTML;\n            submitButton.disabled = true;\n            \n            const totalFiles = selectedSubmissionFiles.length;\n            let successCount = 0;\n            let failCount = 0;\n            const errors = [];\n            \n            // Create progress modal\n            showBatchUploadProgress(totalFiles);\n            \n            try {\n              for (let i = 0; i < selectedSubmissionFiles.length; i++) {\n                const fileInfo = selectedSubmissionFiles[i];\n                \n                // Update progress\n                updateBatchUploadProgress(i + 1, totalFiles, fileInfo.studentName, fileInfo.originalName);\n                \n                try {\n                  // Upload file and extract text\n                  const essay_text = await uploadSubmissionFileAndExtractText(fileInfo.file);\n                  \n                  if (!essay_text || essay_text.trim() === '') {\n                    throw new Error('í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹¤íŒ¨');\n                  }\n                  \n                  // Submit the essay\n                  await axios.post(\\`/api/assignment/\\${currentAssignmentId}/submission\\`, {\n                    student_name: fileInfo.studentName,\n                    essay_text\n                  });\n                  \n                  successCount++;\n                } catch (fileError) {\n                  console.error(\\`Error processing \\${fileInfo.originalName}:\\`, fileError);\n                  failCount++;\n                  errors.push({\n                    fileName: fileInfo.originalName,\n                    studentName: fileInfo.studentName,\n                    error: fileError.message\n                  });\n                }\n              }\n              \n              // Show results\n              showBatchUploadResults(successCount, failCount, errors);\n              \n              // Clean up and reload\n              hideAddSubmissionForm();\n              clearAllFiles();\n              viewAssignment(currentAssignmentId);\n              \n            } catch (error) {\n              console.error('Batch upload error:', error);\n              alert('ì¼ê´„ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n            } finally {\n              submitButton.disabled = false;\n              submitButton.innerHTML = originalButtonText;\n              closeBatchUploadProgress();\n            }\n          }\n          \n          // Show batch upload progress modal\n          function showBatchUploadProgress(totalFiles) {\n            const modal = document.createElement('div');\n            modal.id = 'batchUploadProgressModal';\n            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n            modal.innerHTML = \\`\n              <div class=\"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4\">\n                <h3 class=\"text-xl font-bold text-gray-900 mb-4\">\n                  <i class=\"fas fa-upload mr-2 text-navy-700\"></i>ë‹µì•ˆì§€ ì¼ê´„ ì—…ë¡œë“œ ì¤‘\n                </h3>\n                <div class=\"mb-4\">\n                  <div class=\"flex justify-between text-sm text-gray-600 mb-2\">\n                    <span>ì§„í–‰ë¥ </span>\n                    <span id=\"batchProgress\">0 / \\${totalFiles}</span>\n                  </div>\n                  <div class=\"w-full bg-gray-200 rounded-full h-3\">\n                    <div id=\"batchProgressBar\" class=\"bg-navy-700 h-3 rounded-full transition-all\" style=\"width: 0%\"></div>\n                  </div>\n                </div>\n                <div class=\"text-sm text-gray-700\">\n                  <p><strong>í˜„ì¬ ì²˜ë¦¬ ì¤‘:</strong></p>\n                  <p id=\"currentStudent\" class=\"text-navy-700 font-medium\">-</p>\n                  <p id=\"currentFile\" class=\"text-gray-500 text-xs truncate mt-1\">-</p>\n                </div>\n              </div>\n            \\`;\n            document.body.appendChild(modal);\n          }\n          \n          // Update batch upload progress\n          function updateBatchUploadProgress(current, total, studentName, fileName) {\n            const progressText = document.getElementById('batchProgress');\n            const progressBar = document.getElementById('batchProgressBar');\n            const currentStudent = document.getElementById('currentStudent');\n            const currentFile = document.getElementById('currentFile');\n            \n            if (progressText) progressText.textContent = \\`\\${current} / \\${total}\\`;\n            if (progressBar) progressBar.style.width = \\`\\${(current / total) * 100}%\\`;\n            if (currentStudent) currentStudent.textContent = studentName;\n            if (currentFile) currentFile.textContent = fileName;\n          }\n          \n          // Close batch upload progress modal\n          function closeBatchUploadProgress() {\n            const modal = document.getElementById('batchUploadProgressModal');\n            if (modal) modal.remove();\n          }\n          \n          // Show batch upload results\n          function showBatchUploadResults(successCount, failCount, errors) {\n            let message = \\`ì—…ë¡œë“œ ì™„ë£Œ!\\n\\nì„±ê³µ: \\${successCount}ê°œ\\`;\n            \n            if (failCount > 0) {\n              message += \\`\\nì‹¤íŒ¨: \\${failCount}ê°œ\\n\\nì‹¤íŒ¨í•œ íŒŒì¼:\\n\\`;\n              errors.forEach(err => {\n                message += \\`- \\${err.studentName} (\\${err.fileName}): \\${err.error}\\n\\`;\n              });\n            }\n            \n            alert(message);\n          }\n\n          // Grade submission\n          // Global variable to store current grading data\n          let currentGradingData = null;\n\n          async function gradeSubmission(submissionId) {\n            console.log('gradeSubmission called with submissionId:', submissionId, 'Type:', typeof submissionId);\n            // Show grading settings modal\n            showGradingSettingsModal(submissionId);\n          }\n          \n          async function executeGrading(submissionId, feedbackLevel, strictness) {\n            console.log('Execute Grading called with:', {\n              submissionId,\n              feedbackLevel,\n              strictness,\n              submissionIdType: typeof submissionId\n            });\n            \n            // Validate submission ID\n            if (!submissionId || isNaN(submissionId)) {\n              alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë‹µì•ˆì§€ IDì…ë‹ˆë‹¤: ' + submissionId);\n              return;\n            }\n            \n            // Find the button in the submissions list\n            const buttons = document.querySelectorAll('button[onclick*=\"gradeSubmission(' + submissionId + '\"]');\n            const button = buttons.length > 0 ? buttons[0] : null;\n            let originalText = '';\n            \n            if (button) {\n              originalText = button.innerHTML;\n              button.disabled = true;\n              button.innerHTML = '<i class=\"fas fa-spinner fa-spin mr-2\"></i>ì±„ì  ì¤‘...';\n            }\n\n            try {\n              // Get submission details\n              console.log('Fetching submission:', submissionId);\n              const submissionResponse = await axios.get(\\`/api/submission/\\${submissionId}\\`);\n              const submissionData = submissionResponse.data;\n              console.log('Submission data received:', submissionData);\n              \n              // Grade submission with settings\n              const response = await axios.post(\\`/api/submission/\\${submissionId}/grade\\`, {\n                feedback_level: feedbackLevel,\n                grading_strictness: strictness\n              });\n              \n              if (button) {\n                button.disabled = false;\n                button.innerHTML = originalText;\n              }\n              \n              if (response.data.success) {\n                // Store grading data for review\n                currentGradingData = {\n                  submissionId: submissionId,\n                  submission: submissionData,\n                  result: response.data.grading_result,\n                  detailedFeedback: response.data.detailed_feedback,\n                  fromHistory: false  // Mark that this was opened from assignment view\n                };\n                \n                // Show review modal\n                showGradingReviewModal();\n              } else {\n                throw new Error(response.data.error || 'ì±„ì  ì‹¤íŒ¨');\n              }\n            } catch (error) {\n              console.error('Error grading submission:', error);\n              alert('ì±„ì ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.response?.data?.error || error.message));\n              \n              if (button) {\n                button.disabled = false;\n                button.innerHTML = originalText;\n              }\n            }\n          }\n\n          function showGradingLoadingModal() {\n            // Create loading modal\n            const loadingModalHTML = '<div id=\"gradingLoadingModal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">' +\n              '<div class=\"bg-white rounded-xl shadow-2xl p-8 max-w-md\">' +\n                '<div class=\"text-center\">' +\n                  '<div class=\"mb-4\">' +\n                    '<i class=\"fas fa-spinner fa-spin text-6xl text-navy-700\"></i>' +\n                  '</div>' +\n                  '<h3 class=\"text-2xl font-bold text-gray-900 mb-2\">ì±„ì  ì¤‘</h3>' +\n                  '<p class=\"text-gray-600\">AIê°€ ë‹µì•ˆì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>' +\n                  '<p class=\"text-sm text-gray-500 mt-4\">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš” (ì•½ 10-30ì´ˆ ì†Œìš”)</p>' +\n                '</div>' +\n              '</div>' +\n            '</div>';\n            \n            document.body.insertAdjacentHTML('beforeend', loadingModalHTML);\n          }\n\n          function closeGradingLoadingModal() {\n            const modal = document.getElementById('gradingLoadingModal');\n            if (modal) {\n              modal.remove();\n            }\n          }\n\n          async function executeGradingWithLoading(submissionId, feedbackLevel, strictness) {\n            console.log('Execute Grading With Loading called with:', {\n              submissionId,\n              feedbackLevel,\n              strictness,\n              submissionIdType: typeof submissionId\n            });\n            \n            // Validate submission ID\n            if (!submissionId || isNaN(submissionId)) {\n              alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë‹µì•ˆì§€ IDì…ë‹ˆë‹¤: ' + submissionId);\n              closeGradingLoadingModal();\n              return;\n            }\n\n            try {\n              // Get submission details\n              console.log('Fetching submission:', submissionId);\n              const submissionResponse = await axios.get('/api/submission/' + submissionId);\n              const submissionData = submissionResponse.data;\n              console.log('Submission data received:', submissionData);\n              \n              // Grade submission with settings\n              const response = await axios.post('/api/submission/' + submissionId + '/grade', {\n                feedback_level: feedbackLevel,\n                grading_strictness: strictness\n              });\n              \n              // Close loading modal\n              closeGradingLoadingModal();\n              \n              if (response.data.success) {\n                // Store grading data for review\n                currentGradingData = {\n                  submissionId: submissionId,\n                  submission: submissionData,\n                  result: response.data.grading_result,\n                  detailedFeedback: response.data.detailed_feedback,\n                  fromHistory: true  // Mark that this was a regrade from history\n                };\n                \n                // Show review modal\n                showGradingReviewModal();\n                \n                // Refresh grading history list if we're on that tab\n                const historyTab = document.getElementById('historyTab');\n                if (historyTab && historyTab.classList.contains('active')) {\n                  loadHistory();\n                }\n              } else {\n                throw new Error(response.data.error || 'ì±„ì  ì‹¤íŒ¨');\n              }\n            } catch (error) {\n              console.error('Error grading submission:', error);\n              closeGradingLoadingModal();\n              alert('ì±„ì ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.response?.data?.error || error.message));\n            }\n          }\n\n          function showGradingReviewModal() {\n            if (!currentGradingData) return;\n            \n            const result = currentGradingData.result;\n            const feedback = currentGradingData.detailedFeedback;\n            const submission = currentGradingData.submission;\n            \n            // Calculate max score based on number of rubric criteria (each criterion is worth 4 points)\n            const criteriaCount = result.criterion_scores ? result.criterion_scores.length : 1;\n            const maxScore = criteriaCount * 4;\n            \n            // Create modal HTML with split-screen layout\n            const modalHTML = \\`\n              <div id=\"gradingReviewModal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                <div class=\"bg-white rounded-xl shadow-2xl w-full max-w-7xl max-h-[90vh] flex flex-col\">\n                  <!-- Header -->\n                  <div class=\"bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl\">\n                    <h2 class=\"text-2xl font-bold text-gray-900\">\n                      <i class=\"fas fa-clipboard-check text-navy-700 mr-2\"></i>\n                      ì±„ì  ê²°ê³¼ ê²€í† \n                    </h2>\n                    <button onclick=\"closeGradingReviewModal()\" class=\"text-gray-400 hover:text-gray-600\">\n                      <i class=\"fas fa-times text-2xl\"></i>\n                    </button>\n                  </div>\n                  \n                  <!-- Split Screen Content -->\n                  <div class=\"flex-1 overflow-hidden flex\">\n                    <!-- Left Panel: Student Essay -->\n                    <div class=\"w-1/2 border-r border-gray-200 flex flex-col\">\n                      <div class=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\n                        <h3 class=\"text-lg font-bold text-gray-900\">\n                          <i class=\"fas fa-file-alt text-blue-600 mr-2\"></i>\n                          í•™ìƒ ë‹µì•ˆ\n                        </h3>\n                        <p class=\"text-sm text-gray-600 mt-1\">\\${submission.student_name} - \\${submission.assignment_title}</p>\n                      </div>\n                      <div class=\"flex-1 overflow-y-auto p-6\">\n                        <div class=\"prose max-w-none\">\n                          <div class=\"whitespace-pre-wrap text-gray-800 leading-relaxed\">\\${submission.essay_text}</div>\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <!-- Right Panel: Feedback -->\n                    <div class=\"w-1/2 flex flex-col\">\n                      <div class=\"bg-gray-50 px-6 py-3 border-b border-gray-200\">\n                        <h3 class=\"text-lg font-bold text-gray-900\">\n                          <i class=\"fas fa-comment-dots text-green-600 mr-2\"></i>\n                          í”¼ë“œë°± ë° í‰ê°€\n                        </h3>\n                      </div>\n                      <div class=\"flex-1 overflow-y-auto p-6 space-y-6\">\n                    <!-- Overall Score -->\n                    <div class=\"bg-gradient-to-r from-navy-50 to-blue-50 rounded-lg p-6 border-l-4 border-navy-700\">\n                      <div class=\"flex items-center justify-between mb-3\">\n                        <h3 class=\"text-lg font-bold text-gray-900\">ì „ì²´ ì ìˆ˜</h3>\n                        <div class=\"text-3xl font-bold text-navy-700\">\n                          <input type=\"number\" id=\"editTotalScore\" value=\"\\${result.total_score}\" min=\"0\" max=\"\\${maxScore}\" step=\"0.1\"\n                            class=\"w-24 text-center border-2 border-navy-300 rounded-lg px-2 py-1\" />\n                          <span class=\"text-2xl text-gray-600\">/\\${maxScore}</span>\n                        </div>\n                      </div>\n                      <div>\n                        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ì¢…í•© í‰ê°€</label>\n                        <textarea id=\"editSummaryEvaluation\" rows=\"3\" \n                          class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500 focus:border-transparent\"\n                        >\\${result.summary_evaluation}</textarea>\n                      </div>\n                    </div>\n\n                    <!-- Criterion Scores -->\n                    <div>\n                      <h3 class=\"text-lg font-bold text-gray-900 mb-3\">\n                        <i class=\"fas fa-list-check text-navy-700 mr-2\"></i>\n                        í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜\n                      </h3>\n                      <div class=\"space-y-4\" id=\"criterionScoresContainer\">\n                        \\${result.criterion_scores.map((criterion, index) => \\`\n                          <div class=\"border border-gray-200 rounded-lg p-4 bg-white\">\n                            <div class=\"flex justify-between items-start mb-3\">\n                              <h4 class=\"font-semibold text-gray-900\">\\${criterion.criterion_name}</h4>\n                              <div class=\"flex items-center gap-2\">\n                                <input type=\"number\" id=\"editScore_\\${index}\" value=\"\\${criterion.score}\" min=\"1\" max=\"4\" \n                                  class=\"w-16 text-center border border-gray-300 rounded px-2 py-1\" />\n                                <span class=\"text-gray-600\">/4</span>\n                              </div>\n                            </div>\n                            <div class=\"space-y-3\">\n                              <div>\n                                <label class=\"block text-sm font-semibold text-green-700 mb-1\">\n                                  <i class=\"fas fa-check-circle mr-1\"></i>ê°•ì \n                                </label>\n                                <textarea id=\"editStrengths_\\${index}\" rows=\"2\" \n                                  class=\"w-full px-3 py-2 border border-gray-300 rounded text-sm\"\n                                >\\${criterion.strengths}</textarea>\n                              </div>\n                              <div>\n                                <label class=\"block text-sm font-semibold text-orange-700 mb-1\">\n                                  <i class=\"fas fa-exclamation-circle mr-1\"></i>ê°œì„ ì \n                                </label>\n                                <textarea id=\"editImprovements_\\${index}\" rows=\"2\" \n                                  class=\"w-full px-3 py-2 border border-gray-300 rounded text-sm\"\n                                >\\${criterion.areas_for_improvement}</textarea>\n                              </div>\n                            </div>\n                          </div>\n                        \\`).join('')}\n                      </div>\n                    </div>\n\n                    <!-- Overall Comment -->\n                    <div>\n                      <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                        <i class=\"fas fa-comment text-navy-700 mr-1\"></i>\n                        ì¢…í•© ì˜ê²¬\n                      </label>\n                      <textarea id=\"editOverallComment\" rows=\"3\" \n                        class=\"w-full px-4 py-2 border border-gray-300 rounded-lg\"\n                      >\\${result.overall_comment}</textarea>\n                    </div>\n\n                    <!-- Revision Suggestions -->\n                    <div>\n                      <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                        <i class=\"fas fa-lightbulb text-yellow-600 mr-1\"></i>\n                        ìˆ˜ì • ì œì•ˆ\n                      </label>\n                      <textarea id=\"editRevisionSuggestions\" rows=\"5\" \n                        class=\"w-full px-4 py-2 border border-gray-300 rounded-lg\"\n                      >\\${result.revision_suggestions}</textarea>\n                    </div>\n\n                        <!-- Next Steps -->\n                        <div>\n                          <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n                            <i class=\"fas fa-forward text-blue-600 mr-1\"></i>\n                            ë‹¤ìŒ ë‹¨ê³„ ì¡°ì–¸\n                          </label>\n                          <textarea id=\"editNextSteps\" rows=\"4\" \n                            class=\"w-full px-4 py-2 border border-gray-300 rounded-lg\"\n                          >\\${result.next_steps_advice}</textarea>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <!-- Action Buttons -->\n                  <div class=\"bg-gray-50 border-t border-gray-200 px-6 py-4 flex gap-3 rounded-b-xl\">\n                    <!-- Print Button with Dropdown -->\n                    <div class=\"relative\">\n                      <div class=\"flex\">\n                        <button onclick=\"printFeedback()\" \n                          class=\"px-6 py-3 bg-green-600 text-white rounded-l-lg font-semibold hover:bg-green-700 transition\">\n                          <i class=\"fas fa-print mr-2\"></i>ì¶œë ¥\n                        </button>\n                        <button onclick=\"togglePrintDropdown()\" \n                          class=\"px-3 py-3 bg-green-600 text-white rounded-r-lg font-semibold hover:bg-green-700 transition border-l border-green-700\">\n                          <i class=\"fas fa-chevron-down\"></i>\n                        </button>\n                      </div>\n                      <!-- Dropdown Menu -->\n                      <div id=\"printDropdownMenu\" class=\"hidden absolute bottom-full mb-2 left-0 bg-white rounded-lg shadow-xl border border-gray-200 py-2 min-w-[200px] z-50\">\n                        <button onclick=\"printReport()\" \n                          class=\"w-full text-left px-4 py-2 hover:bg-gray-100 transition\">\n                          <i class=\"fas fa-file-alt mr-2 text-blue-600\"></i>ë³´ê³ ì„œ ì¸ì‡„\n                        </button>\n                        <button onclick=\"exportToPDF()\" \n                          class=\"w-full text-left px-4 py-2 hover:bg-gray-100 transition\">\n                          <i class=\"fas fa-file-pdf mr-2 text-red-600\"></i>PDFë¡œ ë‚´ë³´ë‚´ê¸°\n                        </button>\n                      </div>\n                    </div>\n                    \n                    <!-- Regrade Button -->\n                    <button onclick=\"regradeSubmission()\" \n                      class=\"px-6 py-3 bg-yellow-600 text-white rounded-lg font-semibold hover:bg-yellow-700 transition\">\n                      <i class=\"fas fa-redo mr-2\"></i>ì¬ì±„ì \n                    </button>\n                    \n                    <button onclick=\"saveFeedback()\" \n                      class=\"flex-1 px-6 py-3 bg-navy-900 text-white rounded-lg font-semibold hover:bg-navy-800 transition\">\n                      <i class=\"fas fa-save mr-2\"></i>ì €ì¥í•˜ê³  ì™„ë£Œ\n                    </button>\n                    <button onclick=\"closeGradingReviewModal()\" \n                      class=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition\">\n                      <i class=\"fas fa-times mr-2\"></i>ì·¨ì†Œ\n                    </button>\n                  </div>\n                </div>\n              </div>\n            \\`;\n            \n            document.body.insertAdjacentHTML('beforeend', modalHTML);\n            \n            // Setup dropdown event listeners after modal is created\n            setupPrintDropdownListeners();\n          }\n\n          function closeGradingReviewModal() {\n            const modal = document.getElementById('gradingReviewModal');\n            if (modal) {\n              modal.remove();\n            }\n            currentGradingData = null;\n          }\n          \n          // Setup print dropdown listeners\n          function setupPrintDropdownListeners() {\n            const dropdownToggle = document.querySelector('button[onclick=\"togglePrintDropdown()\"]');\n            const dropdown = document.getElementById('printDropdownMenu');\n            const printReportBtn = document.querySelector('button[onclick=\"printReport()\"]');\n            const exportPdfBtn = document.querySelector('button[onclick=\"exportToPDF()\"]');\n            \n            if (dropdownToggle && dropdown) {\n              console.log('Setting up print dropdown listeners');\n              \n              // Remove onclick attribute and use addEventListener\n              dropdownToggle.removeAttribute('onclick');\n              dropdownToggle.addEventListener('click', function(e) {\n                e.stopPropagation();\n                console.log('Dropdown toggle clicked');\n                dropdown.classList.toggle('hidden');\n              });\n              \n              // Setup print report button\n              if (printReportBtn) {\n                printReportBtn.removeAttribute('onclick');\n                printReportBtn.addEventListener('click', function(e) {\n                  e.stopPropagation();\n                  console.log('Print Report clicked');\n                  dropdown.classList.add('hidden');\n                  printFeedback();\n                });\n              }\n              \n              // Setup export to PDF button\n              if (exportPdfBtn) {\n                exportPdfBtn.removeAttribute('onclick');\n                exportPdfBtn.addEventListener('click', function(e) {\n                  e.stopPropagation();\n                  console.log('Export to PDF clicked');\n                  dropdown.classList.add('hidden');\n                  exportToPDF();\n                });\n              }\n              \n              // Close dropdown when clicking outside\n              setTimeout(() => {\n                document.addEventListener('click', function(event) {\n                  const isClickInside = dropdown.contains(event.target) || dropdownToggle.contains(event.target);\n                  if (!isClickInside && !dropdown.classList.contains('hidden')) {\n                    console.log('Closing dropdown - outside click');\n                    dropdown.classList.add('hidden');\n                  }\n                });\n              }, 100);\n            }\n          }\n          \n          // Toggle print dropdown menu (kept for compatibility)\n          function togglePrintDropdown() {\n            const dropdown = document.getElementById('printDropdownMenu');\n            if (dropdown) {\n              console.log('togglePrintDropdown called');\n              dropdown.classList.toggle('hidden');\n            }\n          }\n          \n          // Print report function\n          function printReport() {\n            console.log('Print Report clicked');\n            togglePrintDropdown();\n            printFeedback(); // Use existing print functionality\n          }\n          \n          // Export to PDF function using jsPDF\n          async function exportToPDF() {\n            console.log('Export to PDF clicked');\n            \n            if (!currentGradingData) {\n              alert('ì±„ì  ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n              togglePrintDropdown();\n              return;\n            }\n            \n            // Close dropdown first\n            togglePrintDropdown();\n            \n            try {\n              // Show loading message\n              const loadingMsg = document.createElement('div');\n              loadingMsg.id = 'pdf-loading';\n              loadingMsg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n              loadingMsg.innerHTML = \\`\n                <div class=\"bg-white rounded-lg p-8 text-center\">\n                  <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-navy-900 mx-auto mb-4\"></div>\n                  <p class=\"text-lg font-semibold\">PDF ìƒì„± ì¤‘...</p>\n                  <p class=\"text-sm text-gray-600 mt-2\">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>\n                </div>\n              \\`;\n              document.body.appendChild(loadingMsg);\n              \n              const submission = currentGradingData.submission;\n              const result = currentGradingData.result;\n              \n              // Calculate max score based on number of criteria\n              const criteriaCount = result.criterion_scores ? result.criterion_scores.length : 1;\n              const maxScore = criteriaCount * 4;\n              \n              // Collect current edited values\n              const totalScore = document.getElementById('editTotalScore').value;\n              const summaryEvaluation = document.getElementById('editSummaryEvaluation').value;\n              const overallComment = document.getElementById('editOverallComment').value;\n              const revisionSuggestions = document.getElementById('editRevisionSuggestions').value;\n              const nextSteps = document.getElementById('editNextSteps').value;\n              \n              // Initialize jsPDF with Korean font support\n              const { jsPDF } = window.jspdf;\n              const doc = new jsPDF({\n                orientation: 'portrait',\n                unit: 'mm',\n                format: 'a4'\n              });\n              \n              // Set up Korean font (using default unicode support)\n              doc.setFont('helvetica');\n              \n              let yPos = 20;\n              const margin = 20;\n              const pageWidth = 210;\n              const maxWidth = pageWidth - (margin * 2);\n              \n              // Title\n              doc.setFontSize(24);\n              doc.setTextColor(30, 58, 138); // Navy color\n              doc.text('AI ë…¼ìˆ  ì±„ì  ê²°ê³¼', margin, yPos);\n              yPos += 15;\n              \n              // Header info\n              doc.setFontSize(11);\n              doc.setTextColor(0, 0, 0);\n              doc.text(\\`ê³¼ì œ: \\${submission.assignment_title}\\`, margin, yPos);\n              yPos += 7;\n              doc.text(\\`í•™ìƒ: \\${submission.student_name}\\`, margin, yPos);\n              yPos += 7;\n              doc.text(\\`ì œì¶œì¼: \\${new Date(submission.submitted_at).toLocaleString('ko-KR')}\\`, margin, yPos);\n              yPos += 12;\n              \n              // Score box\n              doc.setFillColor(30, 58, 138);\n              doc.roundedRect(margin, yPos, maxWidth, 25, 3, 3, 'F');\n              doc.setTextColor(255, 255, 255);\n              doc.setFontSize(16);\n              doc.text('ì „ì²´ ì ìˆ˜', pageWidth / 2, yPos + 8, { align: 'center' });\n              doc.setFontSize(28);\n              doc.text(\\`\\${totalScore} / \\${maxScore}\\`, pageWidth / 2, yPos + 20, { align: 'center' });\n              yPos += 35;\n              \n              // Helper function to add section\n              function addSection(title, content, icon = '') {\n                if (yPos > 250) {\n                  doc.addPage();\n                  yPos = 20;\n                }\n                \n                doc.setFillColor(249, 250, 251);\n                doc.roundedRect(margin, yPos, maxWidth, 8, 2, 2, 'F');\n                doc.setFontSize(13);\n                doc.setTextColor(30, 58, 138);\n                doc.text(\\`\\${icon} \\${title}\\`, margin + 3, yPos + 6);\n                yPos += 12;\n                \n                doc.setFontSize(10);\n                doc.setTextColor(0, 0, 0);\n                const lines = doc.splitTextToSize(content, maxWidth);\n                doc.text(lines, margin, yPos);\n                yPos += (lines.length * 5) + 8;\n              }\n              \n              // Student Essay\n              addSection('í•™ìƒ ë‹µì•ˆ', submission.essay_text.substring(0, 500) + '...', 'ğŸ“„');\n              \n              // Summary Evaluation\n              addSection('ì¢…í•© í‰ê°€', summaryEvaluation, 'ğŸ“Š');\n              \n              // Criterion Scores\n              if (yPos > 230) {\n                doc.addPage();\n                yPos = 20;\n              }\n              \n              doc.setFillColor(249, 250, 251);\n              doc.roundedRect(margin, yPos, maxWidth, 8, 2, 2, 'F');\n              doc.setFontSize(13);\n              doc.setTextColor(30, 58, 138);\n              doc.text('ğŸ“‹ í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜', margin + 3, yPos + 6);\n              yPos += 15;\n              \n              result.criterion_scores.forEach((criterion, index) => {\n                if (yPos > 260) {\n                  doc.addPage();\n                  yPos = 20;\n                }\n                \n                const score = document.getElementById(\\`editScore_\\${index}\\`).value;\n                const strengths = document.getElementById(\\`editStrengths_\\${index}\\`).value;\n                const improvements = document.getElementById(\\`editImprovements_\\${index}\\`).value;\n                \n                doc.setFontSize(11);\n                doc.setTextColor(0, 0, 0);\n                doc.text(\\`\\${criterion.criterion_name}: \\${score}/4\\`, margin, yPos);\n                yPos += 6;\n                \n                doc.setFontSize(9);\n                doc.setTextColor(5, 150, 105);\n                doc.text('ê°•ì :', margin + 3, yPos);\n                yPos += 5;\n                doc.setTextColor(0, 0, 0);\n                const strengthLines = doc.splitTextToSize(strengths, maxWidth - 6);\n                doc.text(strengthLines, margin + 3, yPos);\n                yPos += (strengthLines.length * 4) + 3;\n                \n                doc.setTextColor(234, 88, 12);\n                doc.text('ê°œì„ ì :', margin + 3, yPos);\n                yPos += 5;\n                doc.setTextColor(0, 0, 0);\n                const improvementLines = doc.splitTextToSize(improvements, maxWidth - 6);\n                doc.text(improvementLines, margin + 3, yPos);\n                yPos += (improvementLines.length * 4) + 8;\n              });\n              \n              // Other sections\n              addSection('ì¢…í•© ì˜ê²¬', overallComment, 'ğŸ’¬');\n              addSection('ìˆ˜ì • ì œì•ˆ', revisionSuggestions, 'ğŸ’¡');\n              addSection('ë‹¤ìŒ ë‹¨ê³„ ì¡°ì–¸', nextSteps, 'ğŸ¯');\n              \n              // Remove loading message\n              document.getElementById('pdf-loading').remove();\n              \n              // Save PDF\n              const filename = \\`ì±„ì ê²°ê³¼_\\${submission.student_name}_\\${new Date().toISOString().split('T')[0]}.pdf\\`;\n              doc.save(filename);\n              \n              alert('PDF íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');\n              \n            } catch (error) {\n              console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);\n              document.getElementById('pdf-loading')?.remove();\n              alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì¸ì‡„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');\n              printFeedback();\n            }\n          }\n          \n          // Regrade submission function\n          function regradeSubmission() {\n            if (!currentGradingData) {\n              alert('ì±„ì  ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n              return;\n            }\n            \n            // CRITICAL: Store submission ID BEFORE closing modal\n            // because closeGradingReviewModal sets currentGradingData to null\n            const submissionId = currentGradingData.submissionId;\n            console.log('Regrade submission:', submissionId, 'Type:', typeof submissionId);\n            \n            if (!submissionId || isNaN(submissionId)) {\n              alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë‹µì•ˆì§€ IDì…ë‹ˆë‹¤: ' + submissionId);\n              return;\n            }\n            \n            // Close review modal\n            closeGradingReviewModal();\n            \n            // Show grading settings modal for regrade with the stored ID\n            showGradingSettingsModal(submissionId);\n          }\n\n          function printFeedback() {\n            if (!currentGradingData) return;\n            \n            const submission = currentGradingData.submission;\n            const result = currentGradingData.result;\n            \n            // Calculate max score based on number of criteria\n            const criteriaCount = result.criterion_scores ? result.criterion_scores.length : 1;\n            const maxScore = criteriaCount * 4;\n            \n            // Collect current edited values\n            const totalScore = document.getElementById('editTotalScore').value;\n            const summaryEvaluation = document.getElementById('editSummaryEvaluation').value;\n            const overallComment = document.getElementById('editOverallComment').value;\n            const revisionSuggestions = document.getElementById('editRevisionSuggestions').value;\n            const nextSteps = document.getElementById('editNextSteps').value;\n            \n            // Build criterion scores HTML\n            let criterionHTML = '';\n            result.criterion_scores.forEach((criterion, index) => {\n              const score = document.getElementById(\\`editScore_\\${index}\\`).value;\n              const strengths = document.getElementById(\\`editStrengths_\\${index}\\`).value;\n              const improvements = document.getElementById(\\`editImprovements_\\${index}\\`).value;\n              \n              criterionHTML += \\`\n                <div style=\"margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;\">\n                  <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n                    <strong>\\${criterion.criterion_name}</strong>\n                    <span style=\"font-size: 18px; font-weight: bold; color: #1e3a8a;\">\\${score}/4</span>\n                  </div>\n                  <div style=\"margin-bottom: 8px;\">\n                    <strong style=\"color: #059669;\">ê°•ì :</strong>\n                    <p style=\"margin: 5px 0; white-space: pre-wrap;\">\\${strengths}</p>\n                  </div>\n                  <div>\n                    <strong style=\"color: #ea580c;\">ê°œì„ ì :</strong>\n                    <p style=\"margin: 5px 0; white-space: pre-wrap;\">\\${improvements}</p>\n                  </div>\n                </div>\n              \\`;\n            });\n            \n            // Create print window\n            const printWindow = window.open('', '_blank');\n            printWindow.document.write(\\`\n              <!DOCTYPE html>\n              <html>\n              <head>\n                <meta charset=\"UTF-8\">\n                <title>ì±„ì  ê²°ê³¼ - \\${submission.student_name}</title>\n                <style>\n                  body {\n                    font-family: 'Noto Sans KR', Arial, sans-serif;\n                    line-height: 1.6;\n                    max-width: 800px;\n                    margin: 0 auto;\n                    padding: 20px;\n                  }\n                  h1, h2, h3 { color: #1e3a8a; }\n                  .header {\n                    border-bottom: 3px solid #1e3a8a;\n                    padding-bottom: 15px;\n                    margin-bottom: 20px;\n                  }\n                  .section {\n                    margin-bottom: 25px;\n                    padding: 15px;\n                    background: #f9fafb;\n                    border-radius: 8px;\n                  }\n                  .score-box {\n                    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);\n                    color: white;\n                    padding: 20px;\n                    border-radius: 10px;\n                    text-align: center;\n                    margin-bottom: 20px;\n                  }\n                  .score-box h2 {\n                    color: white;\n                    margin: 0 0 10px 0;\n                  }\n                  .score {\n                    font-size: 48px;\n                    font-weight: bold;\n                  }\n                  .essay-content {\n                    background: white;\n                    padding: 15px;\n                    border-left: 4px solid #3b82f6;\n                    margin-bottom: 20px;\n                    white-space: pre-wrap;\n                  }\n                  @media print {\n                    body { padding: 0; }\n                    .no-print { display: none; }\n                  }\n                </style>\n              </head>\n              <body>\n                <div class=\"header\">\n                  <h1>ğŸ“ AI ë…¼ìˆ  ì±„ì  ê²°ê³¼</h1>\n                  <p><strong>ê³¼ì œ:</strong> \\${submission.assignment_title}</p>\n                  <p><strong>í•™ìƒ:</strong> \\${submission.student_name}</p>\n                  <p><strong>ì œì¶œì¼:</strong> \\${new Date(submission.submitted_at).toLocaleString('ko-KR')}</p>\n                </div>\n                \n                <div class=\"score-box\">\n                  <h2>ì „ì²´ ì ìˆ˜</h2>\n                  <div class=\"score\">\\${totalScore} / \\${maxScore}</div>\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ“„ í•™ìƒ ë‹µì•ˆ</h2>\n                  <div class=\"essay-content\">\\${submission.essay_text}</div>\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ“Š ì¢…í•© í‰ê°€</h2>\n                  <p style=\"white-space: pre-wrap;\">\\${summaryEvaluation}</p>\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ“‹ í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜</h2>\n                  \\${criterionHTML}\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ’¬ ì¢…í•© ì˜ê²¬</h2>\n                  <p style=\"white-space: pre-wrap;\">\\${overallComment}</p>\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ’¡ ìˆ˜ì • ì œì•ˆ</h2>\n                  <p style=\"white-space: pre-wrap;\">\\${revisionSuggestions}</p>\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ ì¡°ì–¸</h2>\n                  <p style=\"white-space: pre-wrap;\">\\${nextSteps}</p>\n                </div>\n                \n                <div class=\"no-print\" style=\"text-align: center; margin-top: 30px;\">\n                  <button onclick=\"window.print()\" style=\"padding: 10px 30px; background: #1e3a8a; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;\">\n                    ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°\n                  </button>\n                  <button onclick=\"window.close()\" style=\"padding: 10px 30px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-left: 10px;\">\n                    ë‹«ê¸°\n                  </button>\n                </div>\n              </body>\n              </html>\n            \\`);\n            printWindow.document.close();\n          }\n\n          async function saveFeedback() {\n            if (!currentGradingData) return;\n            \n            try {\n              // Collect edited data\n              const editedResult = {\n                total_score: parseFloat(document.getElementById('editTotalScore').value),\n                summary_evaluation: document.getElementById('editSummaryEvaluation').value,\n                overall_comment: document.getElementById('editOverallComment').value,\n                revision_suggestions: document.getElementById('editRevisionSuggestions').value,\n                next_steps_advice: document.getElementById('editNextSteps').value,\n                criterion_scores: currentGradingData.result.criterion_scores.map((criterion, index) => ({\n                  criterion_name: criterion.criterion_name,\n                  score: parseInt(document.getElementById(\\`editScore_\\${index}\\`).value),\n                  strengths: document.getElementById(\\`editStrengths_\\${index}\\`).value,\n                  areas_for_improvement: document.getElementById(\\`editImprovements_\\${index}\\`).value\n                }))\n              };\n              \n              // Update feedback on server\n              const response = await axios.put(\\`/api/submission/\\${currentGradingData.submissionId}/feedback\\`, {\n                grading_result: editedResult\n              });\n              \n              if (response.data.success) {\n                alert('í”¼ë“œë°±ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');\n                \n                // CRITICAL: Save fromHistory flag BEFORE closing modal\n                // closeGradingReviewModal() sets currentGradingData to null\n                const isFromHistory = currentGradingData.fromHistory;\n                \n                closeGradingReviewModal();\n                \n                // If opened from grading history, reload history instead of viewAssignment\n                if (isFromHistory) {\n                  loadHistory();\n                } else if (currentAssignmentId) {\n                  viewAssignment(currentAssignmentId);\n                }\n              } else {\n                throw new Error('í”¼ë“œë°± ì €ì¥ ì‹¤íŒ¨');\n              }\n            } catch (error) {\n              console.error('Error saving feedback:', error);\n              alert('í”¼ë“œë°± ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.response?.data?.error || error.message));\n            }\n          }\n\n          // Track selected submissions for export\n          let selectedSubmissions = new Set();\n\n          // Load history\n          // Helper function to convert UTC to KST (Korea Standard Time, UTC+9)\n          function toKST(utcDateString) {\n            if (!utcDateString) return new Date();\n            const date = new Date(utcDateString);\n            // Add 9 hours for KST\n            date.setHours(date.getHours() + 9);\n            return date;\n          }\n          \n          // State for sorting\n          let sortField = 'submitted_at';\n          let sortOrder = 'desc';\n          \n          async function loadHistory() {\n            try {\n              const response = await axios.get('/api/grading-history');\n              let history = response.data;\n\n              const container = document.getElementById('historyList');\n\n              if (history.length === 0) {\n                container.innerHTML = \\`\n                  <div class=\"text-center py-12\">\n                    <i class=\"fas fa-history text-6xl text-gray-300 mb-4\"></i>\n                    <p class=\"text-gray-500 text-lg\">ì•„ì§ ì±„ì  ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>\n                    <p class=\"text-gray-400 text-sm mt-2\">í•™ìƒ ë‹µì•ˆì„ ì±„ì í•˜ë©´ ì—¬ê¸°ì— ê¸°ë¡ì´ ë‚¨ìŠµë‹ˆë‹¤.</p>\n                  </div>\n                \\`;\n                return;\n              }\n\n              // Group submissions by assignment\n              const groupedByAssignment = {};\n              history.forEach(item => {\n                const key = item.assignment_id || item.assignment_title;\n                if (!groupedByAssignment[key]) {\n                  groupedByAssignment[key] = {\n                    title: item.assignment_title,\n                    assignment_id: item.assignment_id,\n                    submissions: [],\n                    latest_submission_date: item.submitted_at // Track latest submission date for sorting\n                  };\n                }\n                groupedByAssignment[key].submissions.push(item);\n                // Update latest submission date if this submission is more recent\n                if (new Date(item.submitted_at) > new Date(groupedByAssignment[key].latest_submission_date)) {\n                  groupedByAssignment[key].latest_submission_date = item.submitted_at;\n                }\n              });\n\n              // Sort assignments by latest submission date (most recent first)\n              const sortedAssignments = Object.values(groupedByAssignment).sort((a, b) => {\n                return new Date(b.latest_submission_date) - new Date(a.latest_submission_date);\n              });\n\n              // Create toolbar with action buttons\n              const toolbar = \\`\n                <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6\">\n                  <div class=\"flex justify-between items-center\">\n                    <div class=\"flex items-center space-x-4\">\n                      <label class=\"flex items-center cursor-pointer\">\n                        <input type=\"checkbox\" id=\"selectAll\" onchange=\"toggleSelectAll()\" class=\"w-4 h-4 text-navy-900 border-gray-300 rounded focus:ring-navy-500\">\n                        <span class=\"ml-2 text-sm font-medium text-gray-700\">ì „ì²´ ì„ íƒ</span>\n                      </label>\n                      <span class=\"text-sm text-gray-600\">\n                        <span id=\"selectedCount\">0</span>ê°œ ì„ íƒë¨\n                      </span>\n                      <button onclick=\"reviewSelected()\" class=\"text-sm text-blue-600 hover:text-blue-800 font-medium\">\n                        í´ë¦­í•˜ì—¬ ì¬ê²€í†  â†’\n                      </button>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                      <button onclick=\"deleteSelected()\" id=\"deleteButton\"\n                        class=\"px-4 py-2 text-sm bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n                        disabled>\n                        <i class=\"fas fa-trash mr-2\"></i>ì œì¶œë¬¼ ì‚­ì œ\n                      </button>\n                      <div class=\"relative\">\n                        <button id=\"exportButton\" onclick=\"toggleExportMenu()\" \n                          class=\"px-4 py-2 text-sm bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n                          disabled>\n                          <i class=\"fas fa-print mr-2\"></i>ì¶œë ¥\n                          <i class=\"fas fa-chevron-down ml-2 text-xs\"></i>\n                        </button>\n                        <div id=\"exportMenu\" class=\"hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-10\">\n                          <button onclick=\"exportToPDF()\" class=\"w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center border-b border-gray-100\">\n                            <i class=\"fas fa-file-pdf text-red-600 mr-3\"></i>\n                            <span class=\"font-medium\">PDF (ê°œë³„ ì¶œë ¥)</span>\n                          </button>\n                          <button onclick=\"exportToSinglePDF()\" class=\"w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center\">\n                            <i class=\"fas fa-file-pdf text-blue-600 mr-3\"></i>\n                            <span class=\"font-medium\">ë‹¨ì¼ PDF íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</span>\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              \\`;\n\n              // Render assignments with grouped submissions (sorted by latest submission date)\n              const assignmentsHTML = sortedAssignments.map(assignment => {\n                // Sort submissions based on current sort settings\n                const sortedSubmissions = [...assignment.submissions].sort((a, b) => {\n                  let comparison = 0;\n                  switch(sortField) {\n                    case 'student_name':\n                      comparison = a.student_name.localeCompare(b.student_name, 'ko');\n                      break;\n                    case 'submitted_at':\n                      comparison = new Date(a.submitted_at) - new Date(b.submitted_at);\n                      break;\n                    case 'graded_at':\n                      comparison = new Date(a.graded_at) - new Date(b.graded_at);\n                      break;\n                    case 'overall_score':\n                      comparison = a.overall_score - b.overall_score;\n                      break;\n                  }\n                  return sortOrder === 'asc' ? comparison : -comparison;\n                });\n\n                return \\`\n                  <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 mb-6\">\n                    <div class=\"bg-gray-50 px-6 py-4 border-b border-gray-200\">\n                      <h3 class=\"text-lg font-bold text-gray-900\">\n                        <i class=\"fas fa-clipboard-list mr-2 text-navy-700\"></i>\n                        \\${assignment.title}\n                      </h3>\n                    </div>\n                    <div class=\"overflow-x-auto\">\n                      <table class=\"w-full\">\n                        <thead class=\"bg-gray-50 border-b border-gray-200\">\n                          <tr>\n                            <th class=\"px-6 py-3 text-left w-12\">\n                              <input type=\"checkbox\" class=\"assignment-checkbox w-4 h-4 text-navy-900 border-gray-300 rounded\" \n                                onchange=\"toggleAssignmentSelection(this)\" data-assignment-id=\"\\${assignment.title}\">\n                            </th>\n                            <th class=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                              onclick=\"sortSubmissions('student_name')\">\n                              ì„±ëª…\n                              <i class=\"fas fa-sort\\${sortField === 'student_name' ? (sortOrder === 'asc' ? '-up' : '-down') : ''} ml-1 text-gray-400\"></i>\n                            </th>\n                            <th class=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                              onclick=\"sortSubmissions('submitted_at')\">\n                              ì œì¶œì¼\n                              <i class=\"fas fa-sort\\${sortField === 'submitted_at' ? (sortOrder === 'asc' ? '-up' : '-down') : ''} ml-1 text-gray-400\"></i>\n                            </th>\n                            <th class=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                              onclick=\"sortSubmissions('graded_at')\">\n                              ì±„ì ì¼\n                              <i class=\"fas fa-sort\\${sortField === 'graded_at' ? (sortOrder === 'asc' ? '-up' : '-down') : ''} ml-1 text-gray-400\"></i>\n                            </th>\n                            <th class=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                              onclick=\"sortSubmissions('overall_score')\">\n                              í‰ì \n                              <i class=\"fas fa-sort\\${sortField === 'overall_score' ? (sortOrder === 'asc' ? '-up' : '-down') : ''} ml-1 text-gray-400\"></i>\n                            </th>\n                          </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-gray-200\">\n                          \\${sortedSubmissions.map(item => \\`\n                            <tr class=\"hover:bg-gray-50 cursor-pointer\" onclick=\"reviewSubmissionFromHistory(\\${item.submission_id})\">\n                              <td class=\"px-6 py-4\" onclick=\"event.stopPropagation()\">\n                                <input type=\"checkbox\" \n                                  class=\"submission-checkbox w-4 h-4 text-navy-900 border-gray-300 rounded focus:ring-navy-500\" \n                                  data-submission-id=\"\\${item.submission_id}\"\n                                  data-assignment-id=\"\\${assignment.title}\"\n                                  onchange=\"updateSelection()\">\n                              </td>\n                              <td class=\"px-6 py-4\">\n                                <div class=\"flex items-center\">\n                                  <div class=\"w-8 h-8 bg-navy-100 rounded-full flex items-center justify-center mr-3\">\n                                    <i class=\"fas fa-user text-navy-700 text-xs\"></i>\n                                  </div>\n                                  <div>\n                                    <div class=\"text-sm font-medium text-gray-900\">\\${item.student_name}</div>\n                                    <div class=\"text-xs text-gray-500\">\\${item.grade_level}</div>\n                                  </div>\n                                </div>\n                              </td>\n                              <td class=\"px-6 py-4\">\n                                <div class=\"text-sm text-gray-900\">\n                                  \\${toKST(item.submitted_at).toLocaleDateString('ko-KR')}\n                                </div>\n                                <div class=\"text-xs text-gray-500\">\n                                  \\${toKST(item.submitted_at).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}\n                                </div>\n                              </td>\n                              <td class=\"px-6 py-4\">\n                                <div class=\"text-sm text-gray-900\">\n                                  \\${toKST(item.graded_at).toLocaleDateString('ko-KR')}\n                                </div>\n                                <div class=\"text-xs text-gray-500\">\n                                  \\${toKST(item.graded_at).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}\n                                </div>\n                              </td>\n                              <td class=\"px-6 py-4\">\n                                <div class=\"flex items-center\">\n                                  <span class=\"text-xl font-bold text-navy-900\">\\${item.overall_score}</span>\n                                  <span class=\"text-sm text-gray-500 ml-1\">/\\${item.max_score || 4}</span>\n                                </div>\n                              </td>\n                            </tr>\n                          \\`).join('')}\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n                \\`;\n              }).join('');\n\n              container.innerHTML = toolbar + \\`<div class=\"space-y-6\">\\${assignmentsHTML}</div>\\`;\n                  \\`).join('')}\n                </div>\n              \\`;\n            } catch (error) {\n              console.error('Error loading history:', error);\n              document.getElementById('historyList').innerHTML = \\`\n                <div class=\"text-center py-8 text-red-600\">\n                  <i class=\"fas fa-exclamation-triangle text-3xl mb-3\"></i>\n                  <p>ì±„ì  ì´ë ¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>\n                </div>\n              \\`;\n            }\n          }\n\n          async function reviewSubmissionFromHistory(submissionId) {\n            try {\n              // Check session before making requests\n              const sessionId = localStorage.getItem('session_id');\n              console.log('Review submission - Session ID:', sessionId);\n              console.log('Review submission - Submission ID:', submissionId);\n              \n              if (!sessionId) {\n                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');\n                window.location.href = '/login';\n                return;\n              }\n              \n              // Fetch submission details\n              console.log('Fetching submission details...');\n              const submissionResponse = await axios.get(\\`/api/submission/\\${submissionId}\\`);\n              console.log('Submission response:', submissionResponse.status, submissionResponse.data);\n              \n              // Check if response indicates authentication error\n              if (submissionResponse.status === 401) {\n                alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');\n                localStorage.removeItem('session_id');\n                window.location.href = '/login';\n                return;\n              }\n              \n              const submission = submissionResponse.data;\n              \n              // Fetch grading feedback (teacher API)\n              console.log('Fetching feedback...');\n              const feedbackResponse = await axios.get(\\`/api/submission/\\${submissionId}/feedback\\`);\n              console.log('Feedback response:', feedbackResponse.status, feedbackResponse.data);\n              const feedback = feedbackResponse.data;\n              \n              // Prepare grading data for modal\n              currentGradingData = {\n                submissionId: submissionId,\n                submission: submission,\n                result: {\n                  total_score: feedback.summary?.total_score || 0,\n                  summary_evaluation: feedback.summary?.summary_evaluation || '',\n                  overall_comment: feedback.summary?.overall_comment || '',\n                  revision_suggestions: feedback.summary?.revision_suggestions || '',\n                  next_steps_advice: feedback.summary?.next_steps_advice || '',\n                  criterion_scores: (feedback.criteria || []).map(criterion => ({\n                    criterion_name: criterion.criterion_name,\n                    score: criterion.score,\n                    strengths: criterion.positive_feedback || '',\n                    areas_for_improvement: criterion.improvement_areas || ''\n                  }))\n                },\n                detailedFeedback: feedback,\n                fromHistory: true  // Mark that this was opened from grading history\n              };\n              \n              // Show the review modal\n              showGradingReviewModal();\n            } catch (error) {\n              console.error('Error loading submission for review:', error);\n              \n              // Don't show another alert if it's a 401 error (interceptor already handled it)\n              if (error.response?.status === 401) {\n                return;\n              }\n              \n              alert('ë‹µì•ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.response?.data?.error || error.message));\n            }\n          }\n\n          function toggleSelectAll() {\n            const selectAll = document.getElementById('selectAll');\n            const checkboxes = document.querySelectorAll('.submission-checkbox');\n            \n            checkboxes.forEach(checkbox => {\n              checkbox.checked = selectAll.checked;\n            });\n            \n            updateSelection();\n          }\n\n          function updateSelection() {\n            const checkboxes = document.querySelectorAll('.submission-checkbox:checked');\n            selectedSubmissions = new Set(Array.from(checkboxes).map(cb => cb.dataset.submissionId));\n            \n            const count = selectedSubmissions.size;\n            document.getElementById('selectedCount').textContent = count;\n            \n            const exportButton = document.getElementById('exportButton');\n            const deleteButton = document.getElementById('deleteButton');\n            \n            if (exportButton) exportButton.disabled = count === 0;\n            if (deleteButton) deleteButton.disabled = count === 0;\n            \n            // Update \"select all\" checkbox state\n            const allCheckboxes = document.querySelectorAll('.submission-checkbox');\n            const selectAllCheckbox = document.getElementById('selectAll');\n            if (selectAllCheckbox) {\n              selectAllCheckbox.checked = allCheckboxes.length > 0 && count === allCheckboxes.length;\n              selectAllCheckbox.indeterminate = count > 0 && count < allCheckboxes.length;\n            }\n          }\n          \n          function toggleAssignmentSelection(checkbox) {\n            const assignmentId = checkbox.dataset.assignmentId;\n            const assignmentCheckboxes = document.querySelectorAll(\\`.submission-checkbox[data-assignment-id=\"\\${assignmentId}\"]\\`);\n            \n            assignmentCheckboxes.forEach(cb => {\n              cb.checked = checkbox.checked;\n            });\n            \n            updateSelection();\n          }\n          \n          function sortSubmissions(field) {\n            if (sortField === field) {\n              // Toggle sort order\n              sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';\n            } else {\n              // New field, default to descending\n              sortField = field;\n              sortOrder = 'desc';\n            }\n            \n            // Reload history with new sort\n            loadHistory();\n          }\n          \n          function reviewSelected() {\n            if (selectedSubmissions.size === 0) {\n              alert('ì„ íƒëœ ì œì¶œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.');\n              return;\n            }\n            \n            // Open first selected submission for review\n            const firstSubmissionId = Array.from(selectedSubmissions)[0];\n            reviewSubmissionFromHistory(firstSubmissionId);\n          }\n          \n          async function deleteSelected() {\n            if (selectedSubmissions.size === 0) {\n              alert('ì„ íƒëœ ì œì¶œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.');\n              return;\n            }\n            \n            const count = selectedSubmissions.size;\n            if (!confirm(\\`ì„ íƒëœ \\${count}ê°œì˜ ì œì¶œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\\`)) {\n              return;\n            }\n            \n            try {\n              const deletePromises = Array.from(selectedSubmissions).map(submissionId =>\n                axios.delete(\\`/api/submissions/\\${submissionId}\\`)\n              );\n              \n              await Promise.all(deletePromises);\n              \n              alert(\\`\\${count}ê°œì˜ ì œì¶œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\\`);\n              \n              // Clear selection and reload history\n              selectedSubmissions.clear();\n              loadHistory();\n            } catch (error) {\n              console.error('ì‚­ì œ ì‹¤íŒ¨:', error);\n              alert('ì œì¶œë¬¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n\n          function toggleExportMenu() {\n            const menu = document.getElementById('exportMenu');\n            menu.classList.toggle('hidden');\n          }\n\n          // Close export menu when clicking outside\n          document.addEventListener('click', function(event) {\n            const menu = document.getElementById('exportMenu');\n            const button = document.getElementById('exportButton');\n            if (menu && button && !menu.contains(event.target) && !button.contains(event.target)) {\n              menu.classList.add('hidden');\n            }\n          });\n\n          async function exportToPDF() {\n            if (selectedSubmissions.size === 0) return;\n            \n            document.getElementById('exportMenu').classList.add('hidden');\n            \n            // Open each submission in a new window for printing\n            for (const submissionId of selectedSubmissions) {\n              await printSubmission(submissionId);\n              // Add delay to prevent browser blocking multiple windows\n              await new Promise(resolve => setTimeout(resolve, 500));\n            }\n          }\n\n          async function exportToSinglePDF() {\n            if (selectedSubmissions.size === 0) return;\n            \n            document.getElementById('exportMenu').classList.add('hidden');\n            \n            try {\n              // Fetch all selected submission details\n              const submissions = await Promise.all(\n                Array.from(selectedSubmissions).map(id => \n                  axios.get(\\`/api/submission/\\${id}\\`).then(res => res.data)\n                )\n              );\n              \n              // Generate combined HTML for all submissions\n              const combinedHTML = await generateCombinedPDF(submissions);\n              \n              // Open in new window\n              const printWindow = window.open('', '_blank');\n              printWindow.document.write(combinedHTML);\n              printWindow.document.close();\n            } catch (error) {\n              console.error('Error generating combined PDF:', error);\n              alert('PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);\n            }\n          }\n\n          async function printSubmission(submissionId) {\n            try {\n              const response = await axios.get(\\`/api/submission/\\${submissionId}\\`);\n              const submission = response.data;\n              \n              // Get feedback details\n              const feedbackResponse = await axios.get(\\`/api/student/submission/\\${submissionId}/feedback\\`);\n              const feedback = feedbackResponse.data;\n              \n              // Generate print HTML\n              const printHTML = generatePrintHTML(submission, feedback);\n              \n              const printWindow = window.open('', '_blank');\n              printWindow.document.write(printHTML);\n              printWindow.document.close();\n            } catch (error) {\n              console.error('Error printing submission:', error);\n              alert(\\`ë‹µì•ˆì§€ \\${submissionId} ì¶œë ¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\\`);\n            }\n          }\n\n          function generatePrintHTML(submission, feedback) {\n            const summary = feedback.summary || {};\n            const criteriaFeedback = feedback.criteria || [];\n            \n            // Calculate max score based on number of criteria\n            const maxScore = criteriaFeedback.length * 4;\n            \n            let criterionHTML = '';\n            criteriaFeedback.forEach(criterion => {\n              criterionHTML += \\`\n                <div style=\"margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;\">\n                  <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n                    <strong>\\${criterion.criterion_name}</strong>\n                    <span style=\"font-size: 18px; font-weight: bold; color: #1e3a8a;\">\\${criterion.score}/4</span>\n                  </div>\n                  <div style=\"margin-bottom: 8px;\">\n                    <strong style=\"color: #059669;\">ê°•ì :</strong>\n                    <p style=\"margin: 5px 0; white-space: pre-wrap;\">\\${criterion.positive_feedback || 'ì—†ìŒ'}</p>\n                  </div>\n                  <div>\n                    <strong style=\"color: #ea580c;\">ê°œì„ ì :</strong>\n                    <p style=\"margin: 5px 0; white-space: pre-wrap;\">\\${criterion.improvement_areas || 'ì—†ìŒ'}</p>\n                  </div>\n                </div>\n              \\`;\n            });\n            \n            return \\`\n              <!DOCTYPE html>\n              <html>\n              <head>\n                <meta charset=\"UTF-8\">\n                <title>ì±„ì  ê²°ê³¼ - \\${submission.student_name}</title>\n                <style>\n                  body {\n                    font-family: 'Noto Sans KR', Arial, sans-serif;\n                    line-height: 1.6;\n                    max-width: 800px;\n                    margin: 0 auto;\n                    padding: 20px;\n                  }\n                  h1, h2, h3 { color: #1e3a8a; }\n                  .header {\n                    border-bottom: 3px solid #1e3a8a;\n                    padding-bottom: 15px;\n                    margin-bottom: 20px;\n                  }\n                  .section {\n                    margin-bottom: 25px;\n                    padding: 15px;\n                    background: #f9fafb;\n                    border-radius: 8px;\n                  }\n                  .score-box {\n                    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);\n                    color: white;\n                    padding: 20px;\n                    border-radius: 10px;\n                    text-align: center;\n                    margin-bottom: 20px;\n                  }\n                  .score-box h2 {\n                    color: white;\n                    margin: 0 0 10px 0;\n                  }\n                  .score {\n                    font-size: 48px;\n                    font-weight: bold;\n                  }\n                  .essay-content {\n                    background: white;\n                    padding: 15px;\n                    border-left: 4px solid #3b82f6;\n                    margin-bottom: 20px;\n                    white-space: pre-wrap;\n                  }\n                  @media print {\n                    body { padding: 0; }\n                    .no-print { display: none; }\n                  }\n                </style>\n              </head>\n              <body>\n                <div class=\"header\">\n                  <h1>ğŸ“ AI ë…¼ìˆ  ì±„ì  ê²°ê³¼</h1>\n                  <p><strong>ê³¼ì œ:</strong> \\${submission.assignment_title}</p>\n                  <p><strong>í•™ìƒ:</strong> \\${submission.student_name}</p>\n                  <p><strong>ì œì¶œì¼:</strong> \\${new Date(submission.submitted_at).toLocaleString('ko-KR')}</p>\n                </div>\n                \n                <div class=\"score-box\">\n                  <h2>ì „ì²´ ì ìˆ˜</h2>\n                  <div class=\"score\">\\${summary.total_score || 0} / \\${maxScore}</div>\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ“„ í•™ìƒ ë‹µì•ˆ</h2>\n                  <div class=\"essay-content\">\\${submission.essay_text}</div>\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ“‹ í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜</h2>\n                  \\${criterionHTML}\n                </div>\n                \n                <div class=\"section\">\n                  <h2>ğŸ’¬ ì¢…í•© ì˜ê²¬</h2>\n                  <p style=\"white-space: pre-wrap;\">\\${summary.overall_comment || 'ì—†ìŒ'}</p>\n                </div>\n                \n                <div class=\"no-print\" style=\"text-align: center; margin-top: 30px;\">\n                  <button onclick=\"window.print()\" style=\"padding: 10px 30px; background: #1e3a8a; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;\">\n                    ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°\n                  </button>\n                  <button onclick=\"window.close()\" style=\"padding: 10px 30px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-left: 10px;\">\n                    ë‹«ê¸°\n                  </button>\n                </div>\n              </body>\n              </html>\n            \\`;\n          }\n\n          async function generateCombinedPDF(submissions) {\n            let combinedContent = '';\n            \n            for (let i = 0; i < submissions.length; i++) {\n              const submission = submissions[i];\n              \n              try {\n                const feedbackResponse = await axios.get(\\`/api/student/submission/\\${submission.id}/feedback\\`);\n                const feedback = feedbackResponse.data;\n                const summary = feedback.summary || {};\n                const criteriaFeedback = feedback.criteria || [];\n                \n                let criterionHTML = '';\n                criteriaFeedback.forEach(criterion => {\n                  criterionHTML += \\`\n                    <div style=\"margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;\">\n                      <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n                        <strong>\\${criterion.criterion_name}</strong>\n                        <span style=\"font-size: 18px; font-weight: bold; color: #1e3a8a;\">\\${criterion.score}/4</span>\n                      </div>\n                      <div style=\"margin-bottom: 8px;\">\n                        <strong style=\"color: #059669;\">ê°•ì :</strong>\n                        <p style=\"margin: 5px 0; white-space: pre-wrap;\">\\${criterion.positive_feedback || 'ì—†ìŒ'}</p>\n                      </div>\n                      <div>\n                        <strong style=\"color: #ea580c;\">ê°œì„ ì :</strong>\n                        <p style=\"margin: 5px 0; white-space: pre-wrap;\">\\${criterion.improvement_areas || 'ì—†ìŒ'}</p>\n                      </div>\n                    </div>\n                  \\`;\n                });\n                \n                // ìµœëŒ€ ì ìˆ˜ ë™ì  ê³„ì‚°\n                const maxScore = criteriaFeedback.length * 4;\n                \n                combinedContent += \\`\n                  <div class=\"submission-section\" style=\"\\${i > 0 ? 'page-break-before: always;' : ''}\">\n                    <div class=\"header\">\n                      <h1>ğŸ“ AI ë…¼ìˆ  ì±„ì  ê²°ê³¼ (\\${i + 1}/\\${submissions.length})</h1>\n                      <p><strong>ê³¼ì œ:</strong> \\${submission.assignment_title}</p>\n                      <p><strong>í•™ìƒ:</strong> \\${submission.student_name}</p>\n                      <p><strong>ì œì¶œì¼:</strong> \\${new Date(submission.submitted_at).toLocaleString('ko-KR')}</p>\n                    </div>\n                    \n                    <div class=\"score-box\">\n                      <h2>ì „ì²´ ì ìˆ˜</h2>\n                      <div class=\"score\">\\${summary.total_score || 0} / \\${maxScore}</div>\n                    </div>\n                    \n                    <div class=\"section\">\n                      <h2>ğŸ“„ í•™ìƒ ë‹µì•ˆ</h2>\n                      <div class=\"essay-content\">\\${submission.essay_text}</div>\n                    </div>\n                    \n                    <div class=\"section\">\n                      <h2>ğŸ“‹ í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜</h2>\n                      \\${criterionHTML}\n                    </div>\n                    \n                    <div class=\"section\">\n                      <h2>ğŸ’¬ ì¢…í•© ì˜ê²¬</h2>\n                      <p style=\"white-space: pre-wrap;\">\\${summary.overall_comment || 'ì—†ìŒ'}</p>\n                    </div>\n                  </div>\n                \\`;\n              } catch (error) {\n                console.error(\\`Error fetching feedback for submission \\${submission.id}:\\`, error);\n              }\n            }\n            \n            return \\`\n              <!DOCTYPE html>\n              <html>\n              <head>\n                <meta charset=\"UTF-8\">\n                <title>ì±„ì  ê²°ê³¼ í†µí•© ë¬¸ì„œ - \\${submissions.length}ê°œ ë‹µì•ˆ</title>\n                <style>\n                  body {\n                    font-family: 'Noto Sans KR', Arial, sans-serif;\n                    line-height: 1.6;\n                    max-width: 800px;\n                    margin: 0 auto;\n                    padding: 20px;\n                  }\n                  h1, h2, h3 { color: #1e3a8a; }\n                  .header {\n                    border-bottom: 3px solid #1e3a8a;\n                    padding-bottom: 15px;\n                    margin-bottom: 20px;\n                  }\n                  .section {\n                    margin-bottom: 25px;\n                    padding: 15px;\n                    background: #f9fafb;\n                    border-radius: 8px;\n                  }\n                  .score-box {\n                    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);\n                    color: white;\n                    padding: 20px;\n                    border-radius: 10px;\n                    text-align: center;\n                    margin-bottom: 20px;\n                  }\n                  .score-box h2 {\n                    color: white;\n                    margin: 0 0 10px 0;\n                  }\n                  .score {\n                    font-size: 48px;\n                    font-weight: bold;\n                  }\n                  .essay-content {\n                    background: white;\n                    padding: 15px;\n                    border-left: 4px solid #3b82f6;\n                    margin-bottom: 20px;\n                    white-space: pre-wrap;\n                  }\n                  .submission-section {\n                    margin-bottom: 40px;\n                  }\n                  @media print {\n                    body { padding: 0; }\n                    .no-print { display: none; }\n                  }\n                </style>\n              </head>\n              <body>\n                <div class=\"no-print\" style=\"text-align: center; padding: 20px; background: #f0f9ff; border-radius: 10px; margin-bottom: 30px;\">\n                  <h2 style=\"color: #1e3a8a; margin-bottom: 10px;\">ğŸ“š ì±„ì  ê²°ê³¼ í†µí•© ë¬¸ì„œ</h2>\n                  <p style=\"color: #64748b;\">ì´ <strong>\\${submissions.length}ê°œ</strong>ì˜ ë‹µì•ˆì§€ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤</p>\n                  <button onclick=\"window.print()\" style=\"padding: 12px 40px; background: #1e3a8a; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px;\">\n                    ğŸ–¨ï¸ ì „ì²´ ì¸ì‡„í•˜ê¸°\n                  </button>\n                  <button onclick=\"window.close()\" style=\"padding: 12px 40px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-left: 10px; margin-top: 10px;\">\n                    ë‹«ê¸°\n                  </button>\n                </div>\n                \n                \\${combinedContent}\n              </body>\n              </html>\n            \\`;\n          }\n\n          // Load user info and usage\n          async function loadUserInfo() {\n            try {\n              // TODO: Replace with actual API call to get user info\n              // For now, using dummy data\n              const userName = 'í™ê¸¸ë™';\n              const currentPlan = 'free'; // free, starter, basic, pro\n              const usageCount = 1; // Current usage count\n              \n              // Plan limits and names\n              const planInfo = {\n                free: { name: 'ë¬´ë£Œ ì²´í—˜', limit: 20 },\n                starter: { name: 'ìŠ¤íƒ€í„°', limit: 90 },\n                basic: { name: 'ë² ì´ì§', limit: 300 },\n                pro: { name: 'í”„ë¡œ', limit: 600 }\n              };\n              \n              const plan = planInfo[currentPlan] || planInfo.free;\n              \n              // Update UI\n              document.getElementById('usageInfo').textContent = plan.name + ': ' + usageCount + ' / ' + plan.limit;\n              \n              // Update upgrade link\n              const upgradeLink = document.querySelector('a[href*=\"/pricing\"]');\n              if (upgradeLink) {\n                upgradeLink.href = '/pricing?plan=' + currentPlan;\n              }\n            } catch (error) {\n              console.error('Error loading user info:', error);\n              document.getElementById('usageInfo').textContent = 'ë¬´ë£Œ ì²´í—˜: 0 / 20';\n            }\n          }\n\n          // Initial load\n          // Logout function\n          function toggleTeacherProfileMenu() {\n            const menu = document.getElementById('teacherProfileMenu');\n            menu.classList.toggle('hidden');\n          }\n          \n          // Close profile menu when clicking outside\n          document.addEventListener('click', function(event) {\n            const profileButton = document.getElementById('teacherProfileButton');\n            const profileMenu = document.getElementById('teacherProfileMenu');\n            \n            if (profileButton && profileMenu && \n                !profileButton.contains(event.target) && \n                !profileMenu.contains(event.target)) {\n              profileMenu.classList.add('hidden');\n            }\n          });\n          \n          function logout() {\n            if (!confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n              return;\n            }\n            \n            // Clear all localStorage data\n            localStorage.removeItem('session_id');\n            localStorage.removeItem('user_name');\n            localStorage.removeItem('user_email');\n            localStorage.removeItem('isLoggedIn');\n            localStorage.removeItem('student_session_id');\n            localStorage.removeItem('student_name');\n            localStorage.removeItem('student_email');\n            localStorage.removeItem('student_grade_level');\n            localStorage.removeItem('isStudentLoggedIn');\n            \n            // Redirect to home page\n            window.location.href = '/';\n          }\n          \n          // Close profile dropdown when clicking outside\n          document.addEventListener('click', function(event) {\n            const profileDropdown = document.querySelector('.profile-dropdown');\n            if (profileDropdown && !profileDropdown.contains(event.target)) {\n              const menu = document.querySelector('.profile-dropdown-menu');\n              if (menu && !menu.classList.contains('hidden')) {\n                // Optional: add logic to close dropdown\n              }\n            }\n          });\n          \n          loadUserInfo();\n          loadPlatformRubrics();\n          loadAssignments();\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Admin Dashboard - System Management\napp.get('/admin', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n        <style>\n          .stat-card {\n            transition: all 0.3s ease;\n          }\n          .stat-card:hover {\n            transform: translateY(-4px);\n            box-shadow: 0 12px 24px -6px rgba(0, 0, 0, 0.15);\n          }\n          .tab-button {\n            transition: all 0.3s ease;\n          }\n          .tab-button.active {\n            background-color: #1e3a8a;\n            color: white;\n          }\n        </style>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-gradient-to-r from-blue-900 to-purple-900 shadow-lg sticky top-0 z-50\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <div class=\"flex items-center\">\n                        <i class=\"fas fa-shield-alt text-3xl text-white mr-3\"></i>\n                        <span class=\"text-2xl font-bold text-white\">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</span>\n                    </div>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/\" class=\"text-white hover:text-blue-200 font-medium\">\n                            <i class=\"fas fa-home mr-1\"></i>í™ˆ\n                        </a>\n                        <a href=\"/admin/cms\" class=\"text-white hover:text-blue-200 font-medium\">\n                            <i class=\"fas fa-book mr-1\"></i>CMS\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <!-- Header -->\n            <div class=\"mb-8\">\n                <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">ì‹œìŠ¤í…œ ê´€ë¦¬</h1>\n                <p class=\"text-gray-600\">AI ë…¼ìˆ  í‰ê°€ ì‹œìŠ¤í…œì˜ ì „ì²´ í˜„í™©ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>\n            </div>\n\n            <!-- Stats Overview -->\n            <div id=\"statsOverview\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n                <div class=\"text-center py-8\">\n                    <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n                    <p class=\"text-gray-500 mt-4\">í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                </div>\n            </div>\n\n            <!-- Tabs -->\n            <div class=\"bg-white rounded-lg shadow-md mb-8\">\n                <div class=\"border-b border-gray-200\">\n                    <nav class=\"flex space-x-4 px-6\" aria-label=\"Tabs\">\n                        <button onclick=\"switchTab('overview')\" id=\"tab-overview\" class=\"tab-button active px-4 py-4 text-sm font-semibold rounded-t-lg\">\n                            <i class=\"fas fa-chart-line mr-2\"></i>ê°œìš”\n                        </button>\n                        <button onclick=\"switchTab('activity')\" id=\"tab-activity\" class=\"tab-button px-4 py-4 text-sm font-semibold rounded-t-lg text-gray-600 hover:text-gray-900\">\n                            <i class=\"fas fa-history mr-2\"></i>ìµœê·¼ í™œë™\n                        </button>\n                        <button onclick=\"switchTab('users')\" id=\"tab-users\" class=\"tab-button px-4 py-4 text-sm font-semibold rounded-t-lg text-gray-600 hover:text-gray-900\">\n                            <i class=\"fas fa-users mr-2\"></i>ì‚¬ìš©ì ê´€ë¦¬\n                        </button>\n                        <button onclick=\"switchTab('analytics')\" id=\"tab-analytics\" class=\"tab-button px-4 py-4 text-sm font-semibold rounded-t-lg text-gray-600 hover:text-gray-900\">\n                            <i class=\"fas fa-chart-bar mr-2\"></i>ë¶„ì„\n                        </button>\n                    </nav>\n                </div>\n\n                <!-- Tab Contents -->\n                <div class=\"p-6\">\n                    <!-- Overview Tab -->\n                    <div id=\"content-overview\" class=\"tab-content\">\n                        <h2 class=\"text-xl font-bold text-gray-900 mb-6\">ì‹œìŠ¤í…œ ê°œìš”</h2>\n                        \n                        <!-- Top Teachers -->\n                        <div class=\"mb-8\">\n                            <h3 class=\"text-lg font-semibold text-gray-800 mb-4\">\n                                <i class=\"fas fa-trophy text-yellow-500 mr-2\"></i>ìµœë‹¤ í™œë™ êµì‚¬\n                            </h3>\n                            <div id=\"topTeachers\" class=\"space-y-3\">\n                                <p class=\"text-gray-500\">ë¡œë”© ì¤‘...</p>\n                            </div>\n                        </div>\n\n                        <!-- Active Students -->\n                        <div>\n                            <h3 class=\"text-lg font-semibold text-gray-800 mb-4\">\n                                <i class=\"fas fa-star text-blue-500 mr-2\"></i>ìµœë‹¤ ì œì¶œ í•™ìƒ\n                            </h3>\n                            <div id=\"activeStudents\" class=\"space-y-3\">\n                                <p class=\"text-gray-500\">ë¡œë”© ì¤‘...</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Activity Tab -->\n                    <div id=\"content-activity\" class=\"tab-content hidden\">\n                        <h2 class=\"text-xl font-bold text-gray-900 mb-6\">ìµœê·¼ í™œë™ (ìµœê·¼ 50ê°œ)</h2>\n                        <div id=\"recentActivity\">\n                            <p class=\"text-gray-500\">ë¡œë”© ì¤‘...</p>\n                        </div>\n                    </div>\n\n                    <!-- Users Tab -->\n                    <div id=\"content-users\" class=\"tab-content hidden\">\n                        <h2 class=\"text-xl font-bold text-gray-900 mb-6\">ì‚¬ìš©ì ê´€ë¦¬</h2>\n                        \n                        <!-- Teachers List -->\n                        <div class=\"mb-8\">\n                            <h3 class=\"text-lg font-semibold text-gray-800 mb-4\">\n                                <i class=\"fas fa-chalkboard-teacher text-green-600 mr-2\"></i>êµì‚¬ ëª©ë¡\n                            </h3>\n                            <div id=\"teachersList\" class=\"overflow-x-auto\">\n                                <p class=\"text-gray-500\">ë¡œë”© ì¤‘...</p>\n                            </div>\n                        </div>\n\n                        <!-- Students List -->\n                        <div>\n                            <h3 class=\"text-lg font-semibold text-gray-800 mb-4\">\n                                <i class=\"fas fa-user-graduate text-blue-600 mr-2\"></i>í•™ìƒ ëª©ë¡\n                            </h3>\n                            <div id=\"studentsList\" class=\"overflow-x-auto\">\n                                <p class=\"text-gray-500\">ë¡œë”© ì¤‘...</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Analytics Tab -->\n                    <div id=\"content-analytics\" class=\"tab-content hidden\">\n                        <h2 class=\"text-xl font-bold text-gray-900 mb-6\">ì‹œìŠ¤í…œ ë¶„ì„</h2>\n                        <div class=\"grid md:grid-cols-2 gap-6\">\n                            <div class=\"bg-white p-6 rounded-lg border border-gray-200\">\n                                <h3 class=\"text-lg font-semibold mb-4\">ì œì¶œ í˜„í™©</h3>\n                                <canvas id=\"submissionChart\"></canvas>\n                            </div>\n                            <div class=\"bg-white p-6 rounded-lg border border-gray-200\">\n                                <h3 class=\"text-lg font-semibold mb-4\">í‰ê·  ì ìˆ˜ ë¶„í¬</h3>\n                                <canvas id=\"scoreChart\"></canvas>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          let statsData = null;\n\n          async function loadStats() {\n            try {\n              const response = await axios.get('/api/admin/stats');\n              statsData = response.data;\n              displayStats(statsData);\n            } catch (error) {\n              console.error('Error loading stats:', error);\n              document.getElementById('statsOverview').innerHTML = \\`\n                <div class=\"col-span-4 text-center py-8 text-red-600\">\n                  <i class=\"fas fa-exclamation-triangle text-3xl mb-3\"></i>\n                  <p>í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>\n                </div>\n              \\`;\n            }\n          }\n\n          function displayStats(data) {\n            const overview = data.overview;\n            const recent = data.recent_activity;\n\n            document.getElementById('statsOverview').innerHTML = \\`\n              <div class=\"stat-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-white/20 rounded-lg p-3\">\n                    <i class=\"fas fa-chalkboard-teacher text-3xl\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold\">\\${overview.total_teachers}</div>\n                    <div class=\"text-sm opacity-90\">ëª…</div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold\">ì „ì²´ êµì‚¬</div>\n              </div>\n\n              <div class=\"stat-card bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-white/20 rounded-lg p-3\">\n                    <i class=\"fas fa-user-graduate text-3xl\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold\">\\${overview.total_students}</div>\n                    <div class=\"text-sm opacity-90\">ëª…</div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold\">ì „ì²´ í•™ìƒ</div>\n              </div>\n\n              <div class=\"stat-card bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-white/20 rounded-lg p-3\">\n                    <i class=\"fas fa-file-alt text-3xl\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold\">\\${overview.total_submissions}</div>\n                    <div class=\"text-sm opacity-90\">ê±´</div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold\">ì „ì²´ ì œì¶œë¬¼</div>\n              </div>\n\n              <div class=\"stat-card bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-white/20 rounded-lg p-3\">\n                    <i class=\"fas fa-check-circle text-3xl\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold\">\\${overview.graded_submissions}</div>\n                    <div class=\"text-sm opacity-90\">ê±´</div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold\">ì±„ì  ì™„ë£Œ</div>\n              </div>\n\n              <div class=\"stat-card bg-white rounded-xl shadow-lg p-6 border-2 border-blue-200\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-blue-100 rounded-lg p-3\">\n                    <i class=\"fas fa-clock text-3xl text-blue-600\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold text-blue-900\">\\${overview.pending_submissions}</div>\n                    <div class=\"text-sm text-gray-600\">ê±´</div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold text-gray-800\">ì±„ì  ëŒ€ê¸°</div>\n              </div>\n\n              <div class=\"stat-card bg-white rounded-xl shadow-lg p-6 border-2 border-green-200\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-green-100 rounded-lg p-3\">\n                    <i class=\"fas fa-chart-line text-3xl text-green-600\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold text-green-900\">\\${overview.average_score.toFixed(1)}</div>\n                    <div class=\"text-sm text-gray-600\">ì </div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold text-gray-800\">í‰ê·  ì ìˆ˜</div>\n              </div>\n\n              <div class=\"stat-card bg-white rounded-xl shadow-lg p-6 border-2 border-purple-200\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-purple-100 rounded-lg p-3\">\n                    <i class=\"fas fa-calendar-week text-3xl text-purple-600\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold text-purple-900\">\\${recent.submissions_last_7_days}</div>\n                    <div class=\"text-sm text-gray-600\">ê±´</div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold text-gray-800\">ìµœê·¼ 7ì¼ ì œì¶œ</div>\n              </div>\n\n              <div class=\"stat-card bg-white rounded-xl shadow-lg p-6 border-2 border-orange-200\">\n                <div class=\"flex items-center justify-between mb-4\">\n                  <div class=\"bg-orange-100 rounded-lg p-3\">\n                    <i class=\"fas fa-tasks text-3xl text-orange-600\"></i>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-3xl font-bold text-orange-900\">\\${overview.total_assignments}</div>\n                    <div class=\"text-sm text-gray-600\">ê°œ</div>\n                  </div>\n                </div>\n                <div class=\"text-lg font-semibold text-gray-800\">ì „ì²´ ê³¼ì œ</div>\n              </div>\n            \\`;\n\n            // Display top teachers\n            if (data.top_teachers.length > 0) {\n              document.getElementById('topTeachers').innerHTML = data.top_teachers.map((t, idx) => \\`\n                <div class=\"flex items-center justify-between bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition\">\n                  <div class=\"flex items-center space-x-4\">\n                    <div class=\"bg-yellow-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold\">\n                      \\${idx + 1}\n                    </div>\n                    <div>\n                      <div class=\"font-semibold text-gray-900\">\\${t.name}</div>\n                      <div class=\"text-sm text-gray-600\">\\${t.email}</div>\n                    </div>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-xl font-bold text-blue-600\">\\${t.submission_count}</div>\n                    <div class=\"text-xs text-gray-500\">ì œì¶œë¬¼</div>\n                  </div>\n                </div>\n              \\`).join('');\n            } else {\n              document.getElementById('topTeachers').innerHTML = '<p class=\"text-gray-500\">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>';\n            }\n\n            // Display active students\n            if (data.active_students.length > 0) {\n              document.getElementById('activeStudents').innerHTML = data.active_students.map((s, idx) => \\`\n                <div class=\"flex items-center justify-between bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition\">\n                  <div class=\"flex items-center space-x-4\">\n                    <div class=\"bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold\">\n                      \\${idx + 1}\n                    </div>\n                    <div>\n                      <div class=\"font-semibold text-gray-900\">\\${s.name}</div>\n                      <div class=\"text-sm text-gray-600\">\\${s.email} â€¢ \\${s.grade_level}</div>\n                    </div>\n                  </div>\n                  <div class=\"text-right\">\n                    <div class=\"text-xl font-bold text-green-600\">\\${s.submission_count}</div>\n                    <div class=\"text-xs text-gray-500\">ì œì¶œë¬¼</div>\n                  </div>\n                </div>\n              \\`).join('');\n            } else {\n              document.getElementById('activeStudents').innerHTML = '<p class=\"text-gray-500\">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>';\n            }\n          }\n\n          async function loadRecentActivity() {\n            try {\n              const response = await axios.get('/api/admin/recent-activity');\n              const activities = response.data;\n\n              if (activities.length === 0) {\n                document.getElementById('recentActivity').innerHTML = \\`\n                  <div class=\"text-center py-12\">\n                    <i class=\"fas fa-inbox text-6xl text-gray-300 mb-4\"></i>\n                    <p class=\"text-gray-500\">ìµœê·¼ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</p>\n                  </div>\n                \\`;\n                return;\n              }\n\n              document.getElementById('recentActivity').innerHTML = \\`\n                <div class=\"space-y-3\">\n                  \\${activities.map(act => \\`\n                    <div class=\"flex items-center justify-between bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition\">\n                      <div class=\"flex items-center space-x-4\">\n                        <div class=\"\\${act.graded ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} rounded-lg p-3\">\n                          <i class=\"fas \\${act.graded ? 'fa-check-circle' : 'fa-clock'} text-xl\"></i>\n                        </div>\n                        <div>\n                          <div class=\"font-semibold text-gray-900\">\\${act.student_name}ì˜ ì œì¶œë¬¼</div>\n                          <div class=\"text-sm text-gray-600\">\n                            <span class=\"font-medium\">\\${act.assignment_title}</span> â€¢ \n                            êµì‚¬: \\${act.teacher_name}\n                          </div>\n                        </div>\n                      </div>\n                      <div class=\"text-right\">\n                        <div class=\"text-sm font-medium \\${act.graded ? 'text-green-600' : 'text-yellow-600'}\">\n                          \\${act.graded ? 'ì±„ì  ì™„ë£Œ' : 'ì±„ì  ëŒ€ê¸°'}\n                        </div>\n                        <div class=\"text-xs text-gray-500\">\n                          \\${new Date(act.timestamp).toLocaleString('ko-KR')}\n                        </div>\n                      </div>\n                    </div>\n                  \\`).join('')}\n                </div>\n              \\`;\n            } catch (error) {\n              console.error('Error loading activity:', error);\n              document.getElementById('recentActivity').innerHTML = \\`\n                <p class=\"text-red-600\">í™œë™ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>\n              \\`;\n            }\n          }\n\n          async function loadUsers() {\n            try {\n              const response = await axios.get('/api/admin/users');\n              const { teachers, students } = response.data;\n\n              // Display teachers\n              if (teachers.length > 0) {\n                document.getElementById('teachersList').innerHTML = \\`\n                  <table class=\"min-w-full divide-y divide-gray-200\">\n                    <thead class=\"bg-gray-50\">\n                      <tr>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ì´ë¦„</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ì´ë©”ì¼</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ê³¼ì œ</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ì œì¶œë¬¼</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ê°€ì…ì¼</th>\n                      </tr>\n                    </thead>\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\n                      \\${teachers.map(t => \\`\n                        <tr class=\"hover:bg-gray-50\">\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\\${t.name}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\\${t.email}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\\${t.assignment_count || 0}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\\${t.submission_count || 0}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                            \\${new Date(t.created_at).toLocaleDateString('ko-KR')}\n                          </td>\n                        </tr>\n                      \\`).join('')}\n                    </tbody>\n                  </table>\n                \\`;\n              } else {\n                document.getElementById('teachersList').innerHTML = '<p class=\"text-gray-500\">êµì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>';\n              }\n\n              // Display students\n              if (students.length > 0) {\n                document.getElementById('studentsList').innerHTML = \\`\n                  <table class=\"min-w-full divide-y divide-gray-200\">\n                    <thead class=\"bg-gray-50\">\n                      <tr>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ì´ë¦„</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ì´ë©”ì¼</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">í•™ë…„</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ì œì¶œë¬¼</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ê°€ì…ì¼</th>\n                      </tr>\n                    </thead>\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\n                      \\${students.map(s => \\`\n                        <tr class=\"hover:bg-gray-50\">\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\\${s.name}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\\${s.email}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\\${s.grade_level || '-'}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\\${s.submission_count || 0}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                            \\${new Date(s.created_at).toLocaleDateString('ko-KR')}\n                          </td>\n                        </tr>\n                      \\`).join('')}\n                    </tbody>\n                  </table>\n                \\`;\n              } else {\n                document.getElementById('studentsList').innerHTML = '<p class=\"text-gray-500\">í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';\n              }\n            } catch (error) {\n              console.error('Error loading users:', error);\n              document.getElementById('teachersList').innerHTML = '<p class=\"text-red-600\">ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>';\n              document.getElementById('studentsList').innerHTML = '<p class=\"text-red-600\">ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>';\n            }\n          }\n\n          function switchTab(tabName) {\n            // Hide all tabs\n            document.querySelectorAll('.tab-content').forEach(tab => {\n              tab.classList.add('hidden');\n            });\n\n            // Remove active class from all buttons\n            document.querySelectorAll('.tab-button').forEach(btn => {\n              btn.classList.remove('active');\n              btn.classList.add('text-gray-600');\n            });\n\n            // Show selected tab\n            document.getElementById(\\`content-\\${tabName}\\`).classList.remove('hidden');\n            const activeBtn = document.getElementById(\\`tab-\\${tabName}\\`);\n            activeBtn.classList.add('active');\n            activeBtn.classList.remove('text-gray-600');\n\n            // Load data if needed\n            if (tabName === 'activity' && document.getElementById('recentActivity').innerHTML.includes('ë¡œë”©')) {\n              loadRecentActivity();\n            } else if (tabName === 'users' && document.getElementById('teachersList').innerHTML.includes('ë¡œë”©')) {\n              loadUsers();\n            } else if (tabName === 'analytics') {\n              loadAnalytics();\n            }\n          }\n\n          function loadAnalytics() {\n            if (!statsData) return;\n\n            const overview = statsData.overview;\n\n            // Submission Status Chart\n            const submissionCtx = document.getElementById('submissionChart').getContext('2d');\n            new Chart(submissionCtx, {\n              type: 'doughnut',\n              data: {\n                labels: ['ì±„ì  ì™„ë£Œ', 'ì±„ì  ëŒ€ê¸°'],\n                datasets: [{\n                  data: [overview.graded_submissions, overview.pending_submissions],\n                  backgroundColor: ['#10b981', '#f59e0b']\n                }]\n              },\n              options: {\n                responsive: true,\n                plugins: {\n                  legend: {\n                    position: 'bottom'\n                  }\n                }\n              }\n            });\n\n            // Score Distribution Chart (dummy data for now)\n            const scoreCtx = document.getElementById('scoreChart').getContext('2d');\n            new Chart(scoreCtx, {\n              type: 'bar',\n              data: {\n                labels: ['0-25%', '26-50%', '51-75%', '76-100%'],\n                datasets: [{\n                  label: 'í•™ìƒ ìˆ˜',\n                  data: [12, 35, 68, 45],\n                  backgroundColor: '#3b82f6'\n                }]\n              },\n              options: {\n                responsive: true,\n                plugins: {\n                  legend: {\n                    display: false\n                  }\n                },\n                scales: {\n                  y: {\n                    beginAtZero: true\n                  }\n                }\n              }\n            });\n          }\n\n          // Initial load\n          loadStats();\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Admin CMS Page - Resource Management\napp.get('/admin/cms', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>ê´€ë¦¬ì í˜ì´ì§€ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        \n        <!-- Quill Rich Text Editor -->\n        <link href=\"https://cdn.quilljs.com/1.3.6/quill.snow.css\" rel=\"stylesheet\">\n        <script src=\"https://cdn.quilljs.com/1.3.6/quill.js\"></script>\n        \n        <script>\n          tailwind.config = {\n            theme: {\n              extend: {\n                colors: {\n                  navy: {\n                    50: '#f0f4ff',\n                    100: '#e0e9ff',\n                    200: '#c7d7ff',\n                    300: '#a4b8ff',\n                    400: '#8195ff',\n                    500: '#6366f1',\n                    600: '#4f46e5',\n                    700: '#4338ca',\n                    800: '#3730a3',\n                    900: '#1e3a8a',\n                  }\n                }\n              }\n            }\n          }\n        </script>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <a href=\"/\" class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-navy-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </span>\n                    </a>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/\" class=\"text-gray-700 hover:text-navy-700 font-medium\">í™ˆ</a>\n                        <span class=\"text-navy-700 font-semibold\">ê´€ë¦¬ì í˜ì´ì§€</span>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <div class=\"mb-8 flex justify-between items-center\">\n                <div>\n                    <h1 class=\"text-4xl font-bold text-gray-900 mb-2\">ìë£Œ ê´€ë¦¬</h1>\n                    <p class=\"text-xl text-gray-600\">í‰ê°€ ê´€ë ¨ ìë£Œë¥¼ ì¶”ê°€í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>\n                </div>\n                <button onclick=\"showCreateForm()\" class=\"bg-navy-900 text-white px-6 py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                    <i class=\"fas fa-plus mr-2\"></i>ìƒˆ ìë£Œ ì‘ì„±\n                </button>\n            </div>\n\n            <!-- Create/Edit Form (Hidden by default) -->\n            <div id=\"resourceForm\" class=\"hidden bg-white rounded-xl shadow-lg p-8 mb-8\">\n                <h2 class=\"text-2xl font-bold text-gray-900 mb-6\">ìë£Œ ì‘ì„±</h2>\n                <form id=\"postForm\" onsubmit=\"handleSubmit(event)\">\n                    <input type=\"hidden\" id=\"postId\" value=\"\">\n                    \n                    <div class=\"mb-4\">\n                        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ì¹´í…Œê³ ë¦¬</label>\n                        <select id=\"category\" class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500\" required>\n                            <option value=\"rubric\">ë£¨ë¸Œë¦­</option>\n                            <option value=\"exam\">ê¸°ì¶œ ë¬¸ì œ</option>\n                            <option value=\"evaluation\">ë…¼ìˆ  í‰ê°€ ìë£Œ</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"mb-4\">\n                        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ì œëª©</label>\n                        <input type=\"text\" id=\"title\" class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500\" placeholder=\"ìë£Œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”\" required>\n                    </div>\n                    \n                    <div class=\"mb-4\">\n                        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ì‘ì„±ì</label>\n                        <input type=\"text\" id=\"author\" class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy-500\" placeholder=\"ì‘ì„±ì ì´ë¦„\" value=\"Admin\">\n                    </div>\n                    \n                    <div class=\"mb-6\">\n                        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">ë‚´ìš©</label>\n                        <!-- Quill Rich Text Editor -->\n                        <div id=\"editor-container\" style=\"height: 400px; background: white;\"></div>\n                        <input type=\"hidden\" id=\"content\" required>\n                    </div>\n                    \n                    <div class=\"flex gap-4\">\n                        <button type=\"submit\" class=\"flex-1 bg-navy-900 text-white px-6 py-3 rounded-lg font-semibold hover:bg-navy-800 transition\">\n                            <i class=\"fas fa-save mr-2\"></i>ì €ì¥\n                        </button>\n                        <button type=\"button\" onclick=\"hideForm()\" class=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition\">\n                            ì·¨ì†Œ\n                        </button>\n                    </div>\n                </form>\n            </div>\n\n            <!-- Posts List -->\n            <div class=\"grid md:grid-cols-3 gap-6\">\n                <!-- Rubric Posts -->\n                <div>\n                    <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">\n                        <i class=\"fas fa-clipboard-list text-navy-700 mr-2\"></i>ë£¨ë¸Œë¦­\n                    </h2>\n                    <div id=\"rubricPosts\" class=\"space-y-4\">\n                        <p class=\"text-gray-500 text-center py-4\">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                    </div>\n                </div>\n                \n                <!-- Exam Posts -->\n                <div>\n                    <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">\n                        <i class=\"fas fa-file-alt text-navy-700 mr-2\"></i>ê¸°ì¶œ ë¬¸ì œ\n                    </h2>\n                    <div id=\"examPosts\" class=\"space-y-4\">\n                        <p class=\"text-gray-500 text-center py-4\">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                    </div>\n                </div>\n                \n                <!-- Evaluation Posts -->\n                <div>\n                    <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">\n                        <i class=\"fas fa-book text-navy-700 mr-2\"></i>ë…¼ìˆ  í‰ê°€ ìë£Œ\n                    </h2>\n                    <div id=\"evaluationPosts\" class=\"space-y-4\">\n                        <p class=\"text-gray-500 text-center py-4\">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          // Initialize Quill Rich Text Editor\n          let quillEditor = null;\n          \n          function initializeQuill() {\n            if (quillEditor) {\n              return; // Already initialized\n            }\n            \n            quillEditor = new Quill('#editor-container', {\n              theme: 'snow',\n              modules: {\n                toolbar: [\n                  [{ 'header': [1, 2, 3, 4, 5, 6, false] }],\n                  [{ 'size': ['small', false, 'large', 'huge'] }],\n                  ['bold', 'italic', 'underline', 'strike'],\n                  [{ 'color': [] }, { 'background': [] }],\n                  [{ 'list': 'ordered'}, { 'list': 'bullet' }],\n                  [{ 'align': [] }],\n                  ['link', 'image'],\n                  ['clean']\n                ]\n              },\n              placeholder: 'ìë£Œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...'\n            });\n            \n            // Custom image handler for better UX\n            quillEditor.getModule('toolbar').addHandler('image', function() {\n              const input = document.createElement('input');\n              input.setAttribute('type', 'file');\n              input.setAttribute('accept', 'image/*');\n              input.click();\n              \n              input.onchange = async () => {\n                const file = input.files[0];\n                if (file) {\n                  // Check file size (max 5MB)\n                  if (file.size > 5 * 1024 * 1024) {\n                    alert('ì´ë¯¸ì§€ íŒŒì¼ì€ 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');\n                    return;\n                  }\n                  \n                  // Convert to base64 for embedding\n                  const reader = new FileReader();\n                  reader.onload = (e) => {\n                    const range = quillEditor.getSelection(true);\n                    quillEditor.insertEmbed(range.index, 'image', e.target.result);\n                    quillEditor.setSelection(range.index + 1);\n                  };\n                  reader.readAsDataURL(file);\n                }\n              };\n            });\n          }\n          \n          async function loadAllPosts() {\n            await loadPostsByCategory('rubric', 'rubricPosts');\n            await loadPostsByCategory('exam', 'examPosts');\n            await loadPostsByCategory('evaluation', 'evaluationPosts');\n          }\n          \n          async function loadPostsByCategory(category, containerId) {\n            try {\n              const response = await axios.get(\\`/api/resources/\\${category}\\`);\n              const posts = response.data;\n              \n              const container = document.getElementById(containerId);\n              \n              if (posts.length === 0) {\n                container.innerHTML = '<p class=\"text-gray-500 text-center py-4\">ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤</p>';\n                return;\n              }\n              \n              container.innerHTML = posts.map(post => \\`\n                <div class=\"bg-white rounded-lg shadow hover:shadow-md transition\">\n                  <div class=\"p-4 flex items-center justify-between\">\n                    <div class=\"flex-1\">\n                      <h3 class=\"font-bold text-gray-900\">\\${post.title}</h3>\n                      <p class=\"text-sm text-gray-500 mt-1\">\n                        <span>\\${post.author || 'Admin'}</span>\n                        <span class=\"mx-2\">â€¢</span>\n                        <span>\\${new Date(post.created_at).toLocaleDateString('ko-KR')}</span>\n                      </p>\n                    </div>\n                    <div class=\"flex gap-2 ml-4\">\n                      \\${category === 'exam' ? \\`\n                        <a href=\"\\${post.file}\" target=\"_blank\" class=\"px-4 py-2 bg-navy-100 text-navy-800 rounded text-sm font-semibold hover:bg-navy-200 transition\">\n                          <i class=\"fas fa-file-pdf mr-1\"></i>PDF ë³´ê¸°\n                        </a>\n                      \\` : \\`\n                        <a href=\"/resource/\\${post.id}\" class=\"px-4 py-2 bg-navy-100 text-navy-800 rounded text-sm font-semibold hover:bg-navy-200 transition\">\n                          <i class=\"fas fa-eye mr-1\"></i>ë³´ê¸°\n                        </a>\n                        <button onclick=\"editPost(\\${post.id})\" class=\"px-4 py-2 bg-gray-100 text-gray-700 rounded text-sm font-semibold hover:bg-gray-200 transition\">\n                          <i class=\"fas fa-edit mr-1\"></i>ìˆ˜ì •\n                        </button>\n                        <button onclick=\"deletePost(\\${post.id})\" class=\"px-4 py-2 bg-red-100 text-red-700 rounded text-sm font-semibold hover:bg-red-200 transition\">\n                          <i class=\"fas fa-trash mr-1\"></i>ì‚­ì œ\n                        </button>\n                      \\`}\n                    </div>\n                  </div>\n                </div>\n              \\`).join('');\n            } catch (error) {\n              console.error('Error loading posts:', error);\n              document.getElementById(containerId).innerHTML = '<p class=\"text-red-500 text-center py-4\">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</p>';\n            }\n          }\n          \n          function showCreateForm() {\n            document.getElementById('resourceForm').classList.remove('hidden');\n            document.getElementById('postId').value = '';\n            document.getElementById('postForm').reset();\n            \n            // Initialize Quill editor\n            initializeQuill();\n            quillEditor.setContents([]); // Clear editor content\n          }\n          \n          function hideForm() {\n            document.getElementById('resourceForm').classList.add('hidden');\n          }\n          \n          async function handleSubmit(event) {\n            event.preventDefault();\n            \n            const postId = document.getElementById('postId').value;\n            const category = document.getElementById('category').value;\n            const title = document.getElementById('title').value;\n            const author = document.getElementById('author').value;\n            \n            // Get content from Quill editor\n            const content = quillEditor.root.innerHTML;\n            \n            // Validate content\n            if (!content || content.trim() === '<p><br></p>' || content.trim() === '') {\n              alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');\n              return;\n            }\n            \n            // Update hidden input for form validation\n            document.getElementById('content').value = content;\n            \n            // Prevent creating/editing exam category (static files)\n            if (category === 'exam') {\n              alert('ê¸°ì¶œ ë¬¸ì œëŠ” ì •ì  íŒŒì¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤. PDF íŒŒì¼ì„ ì§ì ‘ ì—…ë¡œë“œí•˜ë ¤ë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');\n              return;\n            }\n            \n            try {\n              if (postId) {\n                // Update existing post\n                await axios.put(\\`/api/admin/resource/\\${postId}\\`, { title, content, author });\n                alert('ìë£Œê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');\n              } else {\n                // Create new post\n                await axios.post('/api/admin/resource', { category, title, content, author });\n                alert('ìë£Œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');\n              }\n              \n              hideForm();\n              loadAllPosts();\n            } catch (error) {\n              console.error('Error saving post:', error);\n              alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n          \n          async function editPost(id) {\n            try {\n              const response = await axios.get(\\`/api/resource/\\${id}\\`);\n              const post = response.data;\n              \n              document.getElementById('postId').value = post.id;\n              document.getElementById('category').value = post.category;\n              document.getElementById('title').value = post.title;\n              document.getElementById('author').value = post.author || 'Admin';\n              \n              // Initialize Quill editor and load content\n              initializeQuill();\n              \n              // Set HTML content in Quill editor\n              quillEditor.root.innerHTML = post.content;\n              \n              document.getElementById('resourceForm').classList.remove('hidden');\n              window.scrollTo({ top: 0, behavior: 'smooth' });\n            } catch (error) {\n              console.error('Error loading post:', error);\n              alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');\n            }\n          }\n          \n          async function deletePost(id) {\n            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;\n            \n            try {\n              await axios.delete(\\`/api/admin/resource/\\${id}\\`);\n              alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n              loadAllPosts();\n            } catch (error) {\n              console.error('Error deleting post:', error);\n              alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n            }\n          }\n          \n          loadAllPosts();\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Student Dashboard Page\napp.get('/student/dashboard', (c) => {\n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>í•™ìƒ ëŒ€ì‹œë³´ë“œ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <div class=\"flex items-center\">\n                        <a href=\"/\" class=\"text-2xl font-bold text-blue-900 hover:text-blue-700\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€\n                        </a>\n                    </div>\n                    <div class=\"flex items-center space-x-4\">\n                        <!-- User Profile Dropdown -->\n                        <div class=\"relative\">\n                            <button id=\"profileButton\" onclick=\"toggleProfileMenu()\" class=\"flex items-center space-x-2 text-gray-700 hover:text-blue-700 font-medium\">\n                                <i class=\"fas fa-user-circle text-2xl\"></i>\n                                <span id=\"studentName\"></span>\n                                <i class=\"fas fa-chevron-down text-sm\"></i>\n                            </button>\n                            \n                            <!-- Dropdown Menu -->\n                            <div id=\"profileMenu\" class=\"hidden absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50\">\n                                <a href=\"/student/account\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-100\">\n                                    <i class=\"fas fa-user-cog mr-2\"></i>ë‚´ ê³„ì •\n                                </a>\n                                <a href=\"/student/subscription\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-100\">\n                                    <i class=\"fas fa-crown mr-2\"></i>ë‚´ ìš”ê¸ˆì œ\n                                </a>\n                                <a href=\"/student/billing\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-100\">\n                                    <i class=\"fas fa-credit-card mr-2\"></i>êµ¬ë… ê²°ì œ ê´€ë¦¬\n                                </a>\n                                <div class=\"border-t border-gray-200 my-2\"></div>\n                                <button onclick=\"handleLogout()\" class=\"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 font-medium\">\n                                    <i class=\"fas fa-sign-out-alt mr-2\"></i>ë¡œê·¸ì•„ì›ƒ\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <!-- Access Code Input Section -->\n            <div class=\"bg-white rounded-xl shadow-lg p-8 mb-8\">\n                <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">\n                    <i class=\"fas fa-key text-blue-600 mr-2\"></i>ê³¼ì œ ì•¡ì„¸ìŠ¤ ì½”ë“œ ì…ë ¥\n                </h2>\n                <p class=\"text-gray-600 mb-6\">ì„ ìƒë‹˜ê»˜ì„œ ì œê³µí•œ 6ìë¦¬ ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>\n                <form onsubmit=\"handleAccessCode(event)\" class=\"flex gap-4\">\n                    <input \n                        id=\"accessCode\" \n                        type=\"text\" \n                        maxlength=\"6\" \n                        pattern=\"[0-9]{6}\" \n                        required\n                        class=\"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg font-mono\"\n                        placeholder=\"ì˜ˆ: 123456\"\n                    />\n                    <button \n                        type=\"submit\" \n                        class=\"px-8 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition\">\n                        ê³¼ì œ í™•ì¸\n                    </button>\n                </form>\n            </div>\n\n            <!-- Assignment Details (hidden by default) -->\n            <div id=\"assignmentDetails\" class=\"hidden bg-white rounded-xl shadow-lg p-8 mb-8\">\n                <h2 class=\"text-2xl font-bold text-gray-900 mb-4\" id=\"assignmentTitle\"></h2>\n                <p class=\"text-gray-700 mb-4\" id=\"assignmentDescription\"></p>\n                <div class=\"mb-6\">\n                    <h3 class=\"font-semibold text-gray-800 mb-2\">í‰ê°€ ê¸°ì¤€:</h3>\n                    <div id=\"rubricsList\" class=\"space-y-2\"></div>\n                </div>\n                \n                <!-- Essay Input -->\n                <div class=\"mb-6\">\n                    <label class=\"block text-lg font-semibold text-gray-800 mb-2\">\n                        ë‹µì•ˆ ì‘ì„±\n                    </label>\n                    <textarea \n                        id=\"essayText\" \n                        rows=\"12\" \n                        class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        placeholder=\"ì—¬ê¸°ì— ë‹µì•ˆì„ ì‘ì„±í•˜ì„¸ìš”...\"\n                    ></textarea>\n                </div>\n                \n                <button \n                    onclick=\"handleSubmit()\" \n                    class=\"w-full px-8 py-4 bg-green-600 text-white rounded-lg font-bold text-lg hover:bg-green-700 transition\">\n                    <i class=\"fas fa-paper-plane mr-2\"></i>ë‹µì•ˆ ì œì¶œí•˜ê¸°\n                </button>\n            </div>\n\n            <!-- My Submissions Section -->\n            <div class=\"bg-white rounded-xl shadow-lg p-8\">\n                <h2 class=\"text-2xl font-bold text-gray-900 mb-6\">\n                    <i class=\"fas fa-history text-blue-600 mr-2\"></i>ë‚˜ì˜ ì œì¶œë¬¼\n                </h2>\n                <div id=\"submissionsList\">\n                    <p class=\"text-gray-500 text-center py-8\">ì œì¶œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                </div>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          let currentAccessCode = null;\n          let currentAssignment = null;\n          \n          // Check if logged in\n          window.addEventListener('DOMContentLoaded', () => {\n            const sessionId = localStorage.getItem('student_session_id');\n            const studentName = localStorage.getItem('student_name');\n            \n            if (!sessionId || !studentName) {\n              alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');\n              window.location.href = '/student/login';\n              return;\n            }\n            \n            document.getElementById('studentName').textContent = studentName + ' í•™ìƒ';\n            loadSubmissions();\n          });\n          \n          async function handleAccessCode(event) {\n            event.preventDefault();\n            \n            const accessCode = document.getElementById('accessCode').value;\n            const sessionId = localStorage.getItem('student_session_id');\n            \n            if (!accessCode || accessCode.length !== 6) {\n              alert('6ìë¦¬ ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');\n              return;\n            }\n            \n            try {\n              const response = await axios.get(\\`/api/assignment/code/\\${accessCode}\\`);\n              \n              currentAccessCode = accessCode;\n              currentAssignment = response.data;\n              \n              displayAssignment(response.data);\n            } catch (error) {\n              alert('ê³¼ì œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + (error.response?.data?.error || error.message));\n            }\n          }\n          \n          function displayAssignment(assignment) {\n            document.getElementById('assignmentTitle').textContent = assignment.title;\n            document.getElementById('assignmentDescription').textContent = assignment.description;\n            \n            // Display prompts if available\n            let promptsHTML = '';\n            if (assignment.prompts && assignment.prompts.length > 0) {\n              promptsHTML = \\`\n                <div class=\"mb-6\">\n                  <h3 class=\"font-semibold text-gray-800 mb-2\">ì œì‹œë¬¸:</h3>\n                  <div class=\"space-y-3\">\n                    \\${assignment.prompts.map((prompt, idx) => \\`\n                      <div class=\"bg-blue-50 border border-blue-200 p-4 rounded-lg\">\n                        <div class=\"font-semibold text-blue-900 mb-2\">ì œì‹œë¬¸ \\${idx + 1}</div>\n                        <div class=\"text-gray-700 whitespace-pre-wrap\">\\${prompt}</div>\n                      </div>\n                    \\`).join('')}\n                  </div>\n                </div>\n              \\`;\n            }\n            \n            const rubricsList = document.getElementById('rubricsList');\n            rubricsList.innerHTML = promptsHTML + assignment.rubrics.map((r, idx) => \\`\n              <div class=\"bg-gray-50 p-3 rounded-lg\">\n                <span class=\"font-semibold text-blue-700\">\\${idx + 1}. \\${r.criterion_name}</span>\n                <p class=\"text-sm text-gray-600 mt-1\">\\${r.criterion_description}</p>\n              </div>\n            \\`).join('');\n            \n            document.getElementById('assignmentDetails').classList.remove('hidden');\n            document.getElementById('essayText').focus();\n          }\n          \n          async function handleSubmit() {\n            const essayText = document.getElementById('essayText').value.trim();\n            \n            if (!essayText) {\n              alert('ë‹µì•ˆì„ ì‘ì„±í•´ì£¼ì„¸ìš”');\n              return;\n            }\n            \n            if (!currentAccessCode) {\n              alert('ê³¼ì œ ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”');\n              return;\n            }\n            \n            const sessionId = localStorage.getItem('student_session_id');\n            \n            try {\n              const response = await axios.post('/api/student/submit', {\n                access_code: currentAccessCode,\n                essay_text: essayText\n              }, {\n                headers: { 'X-Student-Session-ID': sessionId }\n              });\n              \n              if (response.data.success) {\n                const version = response.data.version;\n                const isResubmission = response.data.is_resubmission;\n                \n                alert(isResubmission \n                  ? \\`ë‹µì•ˆì´ ì¬ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! (ë²„ì „ \\${version})\\`\n                  : 'ë‹µì•ˆì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ì„ ìƒë‹˜ì˜ ì±„ì ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');\n                \n                document.getElementById('essayText').value = '';\n                document.getElementById('assignmentDetails').classList.add('hidden');\n                document.getElementById('accessCode').value = '';\n                currentAccessCode = null;\n                currentAssignment = null;\n                \n                loadSubmissions();\n              }\n            } catch (error) {\n              console.error('Submit error:', error);\n              const errorMsg = error.response?.data?.error || error.message;\n              const debugInfo = error.response?.data?.debug || '';\n              \n              alert('ì œì¶œ ì‹¤íŒ¨: ' + errorMsg + (debugInfo ? '\\\\n\\\\në””ë²„ê·¸ ì •ë³´: ' + debugInfo : '') + '\\\\n\\\\në‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”:\\\\n1. ì•¡ì„¸ìŠ¤ ì½”ë“œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸\\\\n2. ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸\\\\n3. ì¸í„°ë„· ì—°ê²° í™•ì¸');\n            }\n          }\n          \n          async function loadSubmissions() {\n            const sessionId = localStorage.getItem('student_session_id');\n            \n            try {\n              const response = await axios.get('/api/student/my-submissions', {\n                headers: { 'X-Student-Session-ID': sessionId }\n              });\n              \n              const submissions = response.data;\n              const container = document.getElementById('submissionsList');\n              \n              if (submissions.length === 0) {\n                container.innerHTML = \\`\n                  <div class=\"text-center py-8\">\n                    <i class=\"fas fa-inbox text-6xl text-gray-300 mb-4\"></i>\n                    <p class=\"text-gray-500\">ì•„ì§ ì œì¶œí•œ ë‹µì•ˆì´ ì—†ìŠµë‹ˆë‹¤</p>\n                  </div>\n                \\`;\n                return;\n              }\n              \n              container.innerHTML = submissions.map(sub => \\`\n                <div class=\"border-b border-gray-200 pb-4 mb-4 last:border-0\">\n                  <div class=\"flex justify-between items-start mb-2\">\n                    <div>\n                      <h3 class=\"font-semibold text-gray-900\">\\${sub.assignment_title}</h3>\n                      <p class=\"text-sm text-gray-500\">\n                        ì œì¶œì¼: \\${new Date(sub.submitted_at).toLocaleString('ko-KR')}\n                        \\${sub.is_resubmission ? \\` â€¢ ë²„ì „ \\${sub.submission_version}\\` : ''}\n                      </p>\n                    </div>\n                    <div class=\"text-right\">\n                      \\${sub.graded \n                        ? \\`<div class=\"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold mb-2\">\n                             ì±„ì  ì™„ë£Œ\n                           </div>\n                           \\${sub.total_score ? \\`<div class=\"text-2xl font-bold text-blue-600\">\\${sub.total_score}ì </div>\\` : ''}\n                          \\`\n                        : '<div class=\"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-semibold\">ì±„ì  ëŒ€ê¸°ì¤‘</div>'\n                      }\n                    </div>\n                  </div>\n                  \\${sub.graded \n                    ? \\`<button onclick=\"viewFeedback(\\${sub.id})\" \n                              class=\"mt-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-semibold hover:bg-blue-200 transition\">\n                          <i class=\"fas fa-eye mr-1\"></i>ìƒì„¸ í”¼ë“œë°± ë³´ê¸°\n                        </button>\\`\n                    : ''\n                  }\n                </div>\n              \\`).join('');\n            } catch (error) {\n              console.error('Error loading submissions:', error);\n              document.getElementById('submissionsList').innerHTML = \\`\n                <p class=\"text-red-600 text-center py-8\">ì œì¶œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>\n              \\`;\n            }\n          }\n          \n          function viewFeedback(submissionId) {\n            window.location.href = \\`/student/feedback/\\${submissionId}\\`;\n          }\n          \n          function toggleProfileMenu() {\n            const menu = document.getElementById('profileMenu');\n            menu.classList.toggle('hidden');\n          }\n          \n          // Close profile menu when clicking outside\n          document.addEventListener('click', function(event) {\n            const profileButton = document.getElementById('profileButton');\n            const profileMenu = document.getElementById('profileMenu');\n            \n            if (profileButton && profileMenu && \n                !profileButton.contains(event.target) && \n                !profileMenu.contains(event.target)) {\n              profileMenu.classList.add('hidden');\n            }\n          });\n          \n          function handleLogout() {\n            localStorage.removeItem('student_session_id');\n            localStorage.removeItem('student_name');\n            localStorage.removeItem('student_email');\n            localStorage.removeItem('student_grade_level');\n            localStorage.removeItem('isStudentLoggedIn');\n            window.location.href = '/student/login';\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\n// Student Feedback View Page\napp.get('/student/feedback/:id', (c) => {\n  const submissionId = c.req.param('id')\n  \n  return c.html(`\n    <!DOCTYPE html>\n    <html lang=\"ko\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>í”¼ë“œë°± ìƒì„¸ | AI ë…¼ìˆ  í‰ê°€</title>\n        <script src=\"https://cdn.tailwindcss.com\"></script>\n        <link href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css\" rel=\"stylesheet\">\n        <style>\n          .score-circle {\n            width: 60px;\n            height: 60px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            color: white;\n          }\n          .score-1 { background-color: #ef4444; }\n          .score-2 { background-color: #f59e0b; }\n          .score-3 { background-color: #3b82f6; }\n          .score-4 { background-color: #10b981; }\n        </style>\n    </head>\n    <body class=\"bg-gray-50\">\n        <!-- Navigation -->\n        <nav class=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between h-16 items-center\">\n                    <div class=\"flex items-center\">\n                        <span class=\"text-2xl font-bold text-blue-900\">\n                            <i class=\"fas fa-graduation-cap mr-2\"></i>AI ë…¼ìˆ  í‰ê°€ - í•™ìƒ\n                        </span>\n                    </div>\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"/student/dashboard\" class=\"text-gray-700 hover:text-blue-700 font-medium\">\n                            <i class=\"fas fa-arrow-left mr-1\"></i>ëŒ€ì‹œë³´ë“œë¡œ\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </nav>\n\n        <!-- Main Content -->\n        <div class=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <div id=\"feedbackContent\">\n                <p class=\"text-gray-500 text-center py-8\">í”¼ë“œë°±ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n            </div>\n        </div>\n\n        <script src=\"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js\"></script>\n        <script>\n          const submissionId = ${submissionId};\n          \n          window.addEventListener('DOMContentLoaded', () => {\n            const sessionId = localStorage.getItem('student_session_id');\n            if (!sessionId) {\n              alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');\n              window.location.href = '/student/login';\n              return;\n            }\n            \n            loadFeedback();\n          });\n          \n          async function loadFeedback() {\n            const sessionId = localStorage.getItem('student_session_id');\n            \n            try {\n              const response = await axios.get(\\`/api/student/submission/\\${submissionId}/feedback\\`, {\n                headers: { 'X-Student-Session-ID': sessionId }\n              });\n              \n              const { criterion_feedbacks, summary } = response.data;\n              displayFeedback(criterion_feedbacks, summary);\n            } catch (error) {\n              console.error('Error loading feedback:', error);\n              document.getElementById('feedbackContent').innerHTML = \\`\n                <div class=\"text-center py-8 text-red-600\">\n                  <i class=\"fas fa-exclamation-triangle text-3xl mb-3\"></i>\n                  <p>í”¼ë“œë°±ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>\n                </div>\n              \\`;\n            }\n          }\n          \n          function displayFeedback(feedbacks, summary) {\n            const container = document.getElementById('feedbackContent');\n            \n            container.innerHTML = \\`\n              <!-- Overall Summary Card -->\n              <div class=\"bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl shadow-lg p-8 mb-8 text-white\">\n                <div class=\"flex items-center justify-between mb-6\">\n                  <h1 class=\"text-3xl font-bold\">ì „ì²´ í‰ê°€ ê²°ê³¼</h1>\n                  <div class=\"text-6xl font-bold\">\\${summary.total_score}ì </div>\n                </div>\n                <p class=\"text-lg mb-4\">\\${summary.overall_comment}</p>\n                \n                <div class=\"grid md:grid-cols-2 gap-4 mt-6\">\n                  <div class=\"bg-white/20 backdrop-blur rounded-lg p-4\">\n                    <div class=\"flex items-center mb-2\">\n                      <i class=\"fas fa-thumbs-up text-2xl mr-2\"></i>\n                      <h3 class=\"font-bold text-lg\">ê°•ì </h3>\n                    </div>\n                    <p>\\${summary.strengths}</p>\n                  </div>\n                  \n                  <div class=\"bg-white/20 backdrop-blur rounded-lg p-4\">\n                    <div class=\"flex items-center mb-2\">\n                      <i class=\"fas fa-lightbulb text-2xl mr-2\"></i>\n                      <h3 class=\"font-bold text-lg\">ë³´ì™„í•  ì </h3>\n                    </div>\n                    <p>\\${summary.weaknesses}</p>\n                  </div>\n                </div>\n                \n                <div class=\"mt-4 bg-yellow-400/30 rounded-lg p-4\">\n                  <h3 class=\"font-bold mb-2\"><i class=\"fas fa-star mr-2\"></i>ìš°ì„  ê°œì„  ì‚¬í•­</h3>\n                  <p>\\${summary.improvement_priority}</p>\n                </div>\n              </div>\n              \n              <!-- Criterion-by-Criterion Feedback -->\n              <div class=\"space-y-6\">\n                <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">\n                  <i class=\"fas fa-clipboard-list text-blue-600 mr-2\"></i>ê¸°ì¤€ë³„ ìƒì„¸ í”¼ë“œë°±\n                </h2>\n                \n                \\${feedbacks.map((fb, idx) => \\`\n                  <div class=\"bg-white rounded-xl shadow-lg p-6\">\n                    <div class=\"flex items-start justify-between mb-4\">\n                      <div class=\"flex-1\">\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-1\">\\${fb.criterion_name}</h3>\n                        <p class=\"text-sm text-gray-600\">\\${fb.criterion_description}</p>\n                      </div>\n                      <div class=\"score-circle score-\\${fb.score} ml-4\">\n                        \\${fb.score}\n                      </div>\n                    </div>\n                    \n                    <div class=\"space-y-4\">\n                      <div class=\"bg-green-50 border-l-4 border-green-500 p-4 rounded\">\n                        <div class=\"flex items-center mb-2\">\n                          <i class=\"fas fa-check-circle text-green-600 mr-2\"></i>\n                          <h4 class=\"font-semibold text-green-800\">ì˜í•œ ì </h4>\n                        </div>\n                        <p class=\"text-gray-700\">\\${fb.positive_feedback}</p>\n                      </div>\n                      \n                      <div class=\"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded\">\n                        <div class=\"flex items-center mb-2\">\n                          <i class=\"fas fa-exclamation-circle text-yellow-600 mr-2\"></i>\n                          <h4 class=\"font-semibold text-yellow-800\">ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„</h4>\n                        </div>\n                        <p class=\"text-gray-700\">\\${fb.improvement_areas}</p>\n                      </div>\n                      \n                      <div class=\"bg-blue-50 border-l-4 border-blue-500 p-4 rounded\">\n                        <div class=\"flex items-center mb-2\">\n                          <i class=\"fas fa-lightbulb text-blue-600 mr-2\"></i>\n                          <h4 class=\"font-semibold text-blue-800\">êµ¬ì²´ì ì¸ ê°œì„  ë°©ë²•</h4>\n                        </div>\n                        <div class=\"text-gray-700 whitespace-pre-line\">\\${fb.specific_suggestions}</div>\n                      </div>\n                    </div>\n                  </div>\n                \\`).join('')}\n              </div>\n              \n              <!-- Action Buttons -->\n              <div class=\"mt-8 flex gap-4\">\n                <a href=\"/student/dashboard\" \n                   class=\"flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold text-center hover:bg-gray-300 transition\">\n                  <i class=\"fas fa-arrow-left mr-2\"></i>ëŒ€ì‹œë³´ë“œë¡œ\n                </a>\n                <button onclick=\"window.print()\" \n                        class=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition\">\n                  <i class=\"fas fa-print mr-2\"></i>ì¸ì‡„í•˜ê¸°\n                </button>\n              </div>\n            \\`;\n          }\n        </script>\n    </body>\n    </html>\n  `)\n})\n\nexport default app\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/middleware/auth.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token {","line":1,"column":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Context } from 'hono'\nimport type { Bindings } from '../types'\n\nexport interface User {\n  id: number\n  name: string\n  email: string\n  type?: 'teacher' | 'student'\n}\n\nexport interface Student {\n  id: number\n  name: string\n  email: string\n  type: 'student'\n}\n\n/**\n * Get user from session\n */\nexport async function getUserFromSession(c: Context<{ Bindings: Bindings }>): Promise<User | null> {\n  const sessionId = c.req.header('X-Session-ID')\n  if (!sessionId) return null\n  \n  const db = c.env.DB\n  const session = await db.prepare(\n    'SELECT s.*, u.id as user_id, u.name, u.email FROM sessions s JOIN users u ON s.user_id = u.id WHERE s.id = ? AND s.expires_at > datetime(\"now\")'\n  ).bind(sessionId).first()\n  \n  if (!session) return null\n  \n  return {\n    id: session.user_id as number,\n    name: session.name as string,\n    email: session.email as string,\n    type: 'teacher'\n  }\n}\n\n/**\n * Get student from session\n */\nexport async function getStudentFromSession(c: Context<{ Bindings: Bindings }>): Promise<Student | null> {\n  const sessionId = c.req.header('X-Session-ID')\n  if (!sessionId) return null\n  \n  const db = c.env.DB\n  const session = await db.prepare(\n    'SELECT s.*, st.id as student_id, st.name, st.email FROM student_sessions s JOIN students st ON s.student_id = st.id WHERE s.id = ? AND s.expires_at > datetime(\"now\")'\n  ).bind(sessionId).first()\n  \n  if (!session) return null\n  \n  return {\n    id: session.student_id as number,\n    name: session.name as string,\n    email: session.email as string,\n    type: 'student'\n  }\n}\n\n/**\n * Require authentication middleware - returns user or sends 401 response\n */\nexport async function requireAuth(c: Context<{ Bindings: Bindings }>): Promise<User | Response> {\n  const user = await getUserFromSession(c)\n  if (!user) {\n    return c.json({ error: 'Unauthorized - Please login' }, 401)\n  }\n  return user\n}\n\n/**\n * Require student authentication middleware - returns student or sends 401 response\n */\nexport async function requireStudentAuth(c: Context<{ Bindings: Bindings }>): Promise<Student | Response> {\n  const student = await getStudentFromSession(c)\n  if (!student) {\n    return c.json({ error: 'Unauthorized - Please login as student' }, 401)\n  }\n  return student\n}\n\n/**\n * Optional authentication - returns user or null without sending response\n */\nexport async function optionalAuth(c: Context<{ Bindings: Bindings }>): Promise<User | null> {\n  return await getUserFromSession(c)\n}\n\n/**\n * Check if result is a Response (error response)\n */\nexport function isErrorResponse(result: any): result is Response {\n  return result instanceof Response\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/middleware/error.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token {","line":1,"column":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Context } from 'hono'\n\n/**\n * Error handler middleware\n */\nexport async function errorHandler(err: Error, c: Context) {\n  console.error('Error:', err)\n  \n  return c.json({\n    error: 'Internal Server Error',\n    message: process.env.NODE_ENV === 'development' ? err.message : undefined,\n    stack: process.env.NODE_ENV === 'development' ? err.stack : undefined\n  }, 500)\n}\n\n/**\n * Wrap async route handler with try-catch\n */\nexport function asyncHandler(fn: (c: any) => Promise<Response>) {\n  return async (c: any) => {\n    try {\n      return await fn(c)\n    } catch (error) {\n      console.error('Async handler error:', error)\n      return c.json({\n        error: 'Internal Server Error',\n        message: error instanceof Error ? error.message : 'Unknown error'\n      }, 500)\n    }\n  }\n}\n\n/**\n * Validation error response\n */\nexport function validationError(c: Context, message: string) {\n  return c.json({ error: 'Validation Error', message }, 400)\n}\n\n/**\n * Not found error response\n */\nexport function notFoundError(c: Context, resource: string = 'Resource') {\n  return c.json({ error: 'Not Found', message: `${resource} not found` }, 404)\n}\n\n/**\n * Unauthorized error response\n */\nexport function unauthorizedError(c: Context, message: string = 'Unauthorized') {\n  return c.json({ error: 'Unauthorized', message }, 401)\n}\n\n/**\n * Forbidden error response\n */\nexport function forbiddenError(c: Context, message: string = 'Forbidden') {\n  return c.json({ error: 'Forbidden', message }, 403)\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/renderer.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token <","line":5,"column":5}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { jsxRenderer } from 'hono/jsx-renderer'\n\nexport const renderer = jsxRenderer(({ children }) => {\n  return (\n    <html>\n      <head>\n        <link href=\"/static/style.css\" rel=\"stylesheet\" />\n      </head>\n      <body>{children}</body>\n    </html>\n  )\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/routes/auth.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token {","line":2,"column":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Hono } from 'hono'\nimport type { Bindings } from '../types'\nimport { asyncHandler } from '../middleware/error'\nimport { hashPassword } from '../utils/helpers'\n\nconst auth = new Hono<{ Bindings: Bindings }>()\n\n/**\n * POST /api/auth/signup - User signup\n */\nauth.post('/signup', asyncHandler(async (c) => {\n  const { name, email, password } = await c.req.json()\n  const db = c.env.DB\n  \n  // Check if user already exists\n  const existingUser = await db.prepare(\n    'SELECT id FROM users WHERE email = ?'\n  ).bind(email).first()\n  \n  if (existingUser) {\n    return c.json({ error: 'Email already registered' }, 400)\n  }\n  \n  // Hash password using btoa (simple encoding - should use bcrypt in production)\n  const passwordHash = btoa(password)\n  \n  // Insert new user\n  const result = await db.prepare(\n    'INSERT INTO users (name, email, password_hash) VALUES (?, ?, ?)'\n  ).bind(name, email, passwordHash).run()\n  \n  // Create free subscription\n  await db.prepare(\n    'INSERT INTO subscriptions (user_id, plan_type, billing_cycle) VALUES (?, ?, ?)'\n  ).bind(result.meta.last_row_id, 'free', 'monthly').run()\n  \n  return c.json({ success: true, user_id: result.meta.last_row_id })\n}))\n\n/**\n * POST /api/auth/login - User login\n */\nauth.post('/login', asyncHandler(async (c) => {\n  const { email, password } = await c.req.json()\n  const db = c.env.DB\n  \n  // Find user\n  const user = await db.prepare(\n    'SELECT id, name, email, password_hash FROM users WHERE email = ?'\n  ).bind(email).first()\n  \n  if (!user) {\n    return c.json({ error: 'Invalid email or password' }, 401)\n  }\n  \n  // Verify password (using btoa - should use bcrypt.compare in production)\n  const passwordHash = btoa(password)\n  if (passwordHash !== user.password_hash) {\n    return c.json({ error: 'Invalid email or password' }, 401)\n  }\n  \n  // Create session\n  const sessionId = crypto.randomUUID()\n  const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 days\n  \n  await db.prepare(\n    'INSERT INTO sessions (id, user_id, expires_at) VALUES (?, ?, ?)'\n  ).bind(sessionId, user.id, expiresAt.toISOString()).run()\n  \n  return c.json({\n    success: true,\n    session_id: sessionId,\n    user: {\n      id: user.id,\n      name: user.name,\n      email: user.email\n    }\n  })\n}))\n\n/**\n * POST /api/auth/logout - User logout\n */\nauth.post('/logout', asyncHandler(async (c) => {\n  const { session_id } = await c.req.json()\n  const db = c.env.DB\n  \n  await db.prepare(\n    'DELETE FROM sessions WHERE id = ?'\n  ).bind(session_id).run()\n  \n  return c.json({ success: true })\n}))\n\n/**\n * POST /api/student/auth/signup - Student signup\n */\nauth.post('/student/signup', asyncHandler(async (c) => {\n  const { name, email, password, grade_level } = await c.req.json()\n  const db = c.env.DB\n  \n  // Check if student already exists\n  const existingStudent = await db.prepare(\n    'SELECT id FROM student_users WHERE email = ?'\n  ).bind(email).first()\n  \n  if (existingStudent) {\n    return c.json({ error: 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤' }, 400)\n  }\n  \n  // Simple password hashing (use bcrypt in production)\n  const passwordHash = btoa(password)\n  \n  // Insert new student\n  const result = await db.prepare(\n    'INSERT INTO student_users (name, email, password_hash, grade_level) VALUES (?, ?, ?, ?)'\n  ).bind(name, email, passwordHash, grade_level).run()\n  \n  return c.json({ success: true, student_id: result.meta.last_row_id })\n}))\n\n/**\n * POST /api/student/auth/login - Student login\n */\nauth.post('/student/login', asyncHandler(async (c) => {\n  const { email, password } = await c.req.json()\n  const db = c.env.DB\n  \n  // Find student\n  const student = await db.prepare(\n    'SELECT id, name, email, password_hash, grade_level FROM student_users WHERE email = ?'\n  ).bind(email).first()\n  \n  if (!student) {\n    return c.json({ error: 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' }, 401)\n  }\n  \n  // Verify password\n  const passwordHash = btoa(password)\n  if (passwordHash !== student.password_hash) {\n    return c.json({ error: 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' }, 401)\n  }\n  \n  // Create session\n  const sessionId = crypto.randomUUID()\n  const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 days\n  \n  await db.prepare(\n    'INSERT INTO student_sessions (id, student_id, expires_at) VALUES (?, ?, ?)'\n  ).bind(sessionId, student.id, expiresAt.toISOString()).run()\n  \n  return c.json({\n    success: true,\n    session_id: sessionId,\n    student: {\n      id: student.id,\n      name: student.name,\n      email: student.email,\n      grade_level: student.grade_level\n    }\n  })\n}))\n\nexport default auth\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/types.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token type","line":3,"column":8}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Type definitions for the essay grading system\n\nexport type Bindings = {\n  DB: D1Database;\n  R2_BUCKET: R2Bucket;\n  GOOGLE_APPLICATION_CREDENTIALS: string;\n  OPENAI_API_KEY?: string;\n  OPENAI_BASE_URL?: string;\n  ANTHROPIC_API_KEY?: string;\n  MAX_FILE_SIZE: string;\n  ALLOWED_IMAGE_TYPES: string;\n  ALLOWED_PDF_TYPES: string;\n  R2_PUBLIC_URL: string;\n}\n\nexport interface RubricCriterion {\n  id?: number;\n  criterion_name: string;\n  criterion_description: string;\n  criterion_order: number;\n  max_score?: number; // Optional max score per criterion (default: 4)\n}\n\nexport interface GradingRequest {\n  assignment_prompt: string;\n  grade_level: string;\n  rubric_criteria: Omit<RubricCriterion, 'id'>[];\n  essay_text: string;\n}\n\nexport interface CriterionScore {\n  criterion_name: string;\n  score: number;\n  strengths: string;\n  areas_for_improvement: string;\n}\n\nexport interface GradingResult {\n  total_score: number;\n  summary_evaluation: string;\n  criterion_scores: CriterionScore[];\n  overall_comment: string;\n  revision_suggestions: string;\n  next_steps_advice: string;\n}\n\nexport interface GradingSession {\n  id: number;\n  assignment_prompt: string;\n  grade_level: string;\n  created_at: string;\n}\n\nexport interface Essay {\n  id: number;\n  session_id: number;\n  essay_text: string;\n  submitted_at: string;\n}\n\nexport interface StoredGradingResult extends GradingResult {\n  id: number;\n  essay_id: number;\n  graded_at: string;\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/upload-service.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token as","line":20,"column":50}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File Upload Service\n// Handles image OCR (Google Vision and OCR.space) and PDF text extraction\n\nimport * as pdfjsLib from 'pdfjs-dist';\nimport {\n  arrayBufferToBase64,\n  callVisionAPI,\n  extractTextFromVisionResponse,\n  createTextDetectionRequest,\n  createDocumentTextDetectionRequest\n} from './utils/vision-api';\n\n// Disable PDF.js Worker for Cloudflare Workers environment\n// Cloudflare Workers doesn't support Web Workers or 'document' object\n// Use direct processing without Worker to avoid \"document is not defined\" error\nif (typeof globalThis !== 'undefined') {\n  // Disable worker by setting to false string\n  // This forces PDF.js to use the main thread for processing\n  pdfjsLib.GlobalWorkerOptions.workerSrc = '';\n  pdfjsLib.GlobalWorkerOptions.workerPort = null as any;\n}\n\ninterface UploadedFile {\n  name: string;\n  type: string;\n  size: number;\n  buffer: ArrayBuffer;\n}\n\ninterface ProcessingResult {\n  success: boolean;\n  extractedText?: string;\n  error?: string;\n  processingTimeMs?: number;\n}\n\n/**\n * Process image file using Google Cloud Vision API with Service Account\n * Refactored to use common callVisionAPI function\n */\nexport async function processImageOCR(\n  file: UploadedFile,\n  credentialsJson: string\n): Promise<ProcessingResult> {\n  const startTime = Date.now();\n\n  try {\n    // Convert ArrayBuffer to base64\n    const base64Image = arrayBufferToBase64(file.buffer);\n\n    // Create Vision API request for text detection\n    const requestBody = createTextDetectionRequest(base64Image);\n\n    // Call Vision API using common function\n    const result = await callVisionAPI('images:annotate', requestBody, credentialsJson);\n\n    // Extract text from response\n    const extractedText = extractTextFromVisionResponse(result);\n\n    if (!extractedText) {\n      return {\n        success: false,\n        error: 'No text detected in image',\n        processingTimeMs: Date.now() - startTime,\n      };\n    }\n\n    return {\n      success: true,\n      extractedText,\n      processingTimeMs: Date.now() - startTime,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: `OCR processing failed: ${String(error)}`,\n      processingTimeMs: Date.now() - startTime,\n    };\n  }\n}\n\n/**\n * Process PDF file and extract text using PDF.js\n */\nexport async function processPDFExtraction(\n  file: UploadedFile\n): Promise<ProcessingResult> {\n  const startTime = Date.now();\n\n  try {\n    // Load PDF document without Worker (Cloudflare Workers compatible)\n    const loadingTask = pdfjsLib.getDocument({\n      data: new Uint8Array(file.buffer),\n      verbosity: 0, // Suppress warnings in production\n      useWorkerFetch: false, // Disable worker fetch for Cloudflare Workers\n      isEvalSupported: false, // Disable eval for security\n      useSystemFonts: false, // Don't rely on system fonts\n    });\n\n    const pdf = await loadingTask.promise;\n    const numPages = pdf.numPages;\n    let fullText = '';\n\n    // Extract text from each page\n    for (let pageNum = 1; pageNum <= numPages; pageNum++) {\n      const page = await pdf.getPage(pageNum);\n      const textContent = await page.getTextContent();\n\n      const pageText = textContent.items\n        .map((item: any) => item.str)\n        .join(' ');\n\n      fullText += `\\n\\n[Page ${pageNum}]\\n${pageText}`;\n    }\n\n    if (!fullText.trim()) {\n      return {\n        success: false,\n        error: 'No text found in PDF (may be image-based PDF)',\n        processingTimeMs: Date.now() - startTime,\n      };\n    }\n\n    return {\n      success: true,\n      extractedText: fullText.trim(),\n      processingTimeMs: Date.now() - startTime,\n    };\n  } catch (error) {\n    const errorMsg = error instanceof Error ? error.message : String(error);\n    console.error('PDF extraction error:', errorMsg);\n    return {\n      success: false,\n      error: `PDF processing failed: ${errorMsg}`,\n      processingTimeMs: Date.now() - startTime,\n    };\n  }\n}\n\n/**\n * Process image-based PDF using Google Vision API\n * (For PDFs that are scanned images)\n * Refactored to use common callVisionAPI function\n * \n * Note: Google Vision API's images:annotate endpoint can handle PDF files directly\n * It processes the first page of the PDF (or can be configured for multi-page)\n */\nexport async function processImagePDFOCR(\n  file: UploadedFile,\n  credentialsJson: string\n): Promise<ProcessingResult> {\n  const startTime = Date.now();\n\n  try {\n    // Convert ArrayBuffer to base64\n    const base64Pdf = arrayBufferToBase64(file.buffer);\n\n    // Create Vision API request for document text detection\n    const requestBody = createDocumentTextDetectionRequest(base64Pdf);\n\n    // Call Vision API using common function\n    const result = await callVisionAPI('images:annotate', requestBody, credentialsJson);\n    console.log('Vision API response:', JSON.stringify(result).substring(0, 500));\n\n    // Extract text from response using common function\n    const fullText = extractTextFromVisionResponse(result);\n\n    if (!fullText || !fullText.trim()) {\n      return {\n        success: false,\n        error: 'No text extracted from PDF',\n        processingTimeMs: Date.now() - startTime,\n      };\n    }\n\n    console.log(`Successfully extracted ${fullText.length} characters from PDF`);\n\n    return {\n      success: true,\n      extractedText: fullText.trim(),\n      processingTimeMs: Date.now() - startTime,\n    };\n  } catch (error) {\n    const errorMsg = error instanceof Error ? error.message : String(error);\n    console.error('PDF OCR error:', errorMsg);\n    return {\n      success: false,\n      error: `PDF OCR failed: ${errorMsg}`,\n      processingTimeMs: Date.now() - startTime,\n    };\n  }\n}\n\n/**\n * Process PDF using OCR.space API\n * OCR.space supports PDF files natively and is simpler than Google Vision\n */\nexport async function processOCRSpace(\n  file: UploadedFile,\n  apiKey: string\n): Promise<ProcessingResult> {\n  const startTime = Date.now();\n\n  try {\n    console.log(`Processing file with OCR.space: ${file.name} (${file.size} bytes)`);\n\n    // Convert ArrayBuffer to base64\n    const base64File = arrayBufferToBase64(file.buffer);\n\n    // Determine file extension from filename\n    const fileExtension = file.name.split('.').pop()?.toLowerCase() || 'pdf';\n    \n    // OCR.space API using FormData (better compatibility)\n    const formData = new FormData();\n    \n    // Create a blob from buffer with proper type\n    const blob = new Blob([file.buffer], { type: file.type });\n    formData.append('file', blob, file.name);\n    // OCR.space language codes: kor=Korean, eng=English\n    // For Engine 2, use 'kor' for Korean\n    formData.append('language', 'kor');\n    formData.append('isOverlayRequired', 'false');\n    formData.append('detectOrientation', 'true');\n    formData.append('scale', 'true');\n    formData.append('OCREngine', '2');\n    formData.append('filetype', fileExtension);\n    \n    // Call OCR.space API with FormData\n    const response = await fetch('https://api.ocr.space/parse/image', {\n      method: 'POST',\n      headers: {\n        'apikey': apiKey,\n      },\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error('OCR.space API error response:', errorText);\n      throw new Error(`OCR.space API error (${response.status}): ${errorText}`);\n    }\n\n    const result = await response.json();\n    console.log('OCR.space response:', JSON.stringify(result).substring(0, 500));\n\n    // Check for API errors\n    if (result.IsErroredOnProcessing) {\n      const errorMsg = result.ErrorMessage?.[0] || 'Unknown OCR.space error';\n      console.error('OCR.space processing error:', errorMsg);\n      return {\n        success: false,\n        error: `OCR.space error: ${errorMsg}`,\n        processingTimeMs: Date.now() - startTime,\n      };\n    }\n\n    // Extract text from all pages\n    let fullText = '';\n    if (result.ParsedResults && result.ParsedResults.length > 0) {\n      for (const page of result.ParsedResults) {\n        if (page.ParsedText) {\n          fullText += page.ParsedText + '\\n\\n';\n        }\n      }\n    }\n\n    if (!fullText || !fullText.trim()) {\n      return {\n        success: false,\n        error: 'No text extracted from file',\n        processingTimeMs: Date.now() - startTime,\n      };\n    }\n\n    console.log(`Successfully extracted ${fullText.length} characters with OCR.space`);\n\n    return {\n      success: true,\n      extractedText: fullText.trim(),\n      processingTimeMs: Date.now() - startTime,\n    };\n  } catch (error) {\n    const errorMsg = error instanceof Error ? error.message : String(error);\n    console.error('OCR.space error:', errorMsg);\n    return {\n      success: false,\n      error: `OCR.space failed: ${errorMsg}`,\n      processingTimeMs: Date.now() - startTime,\n    };\n  }\n}\n\n/**\n * Validate uploaded file\n */\nexport function validateFile(\n  file: File,\n  allowedTypes: string[],\n  maxSize: number\n): { valid: boolean; error?: string } {\n  // Check file size\n  if (file.size > maxSize) {\n    const maxSizeMB = (maxSize / (1024 * 1024)).toFixed(1);\n    return {\n      valid: false,\n      error: `File size exceeds ${maxSizeMB}MB limit`,\n    };\n  }\n\n  // Check file type\n  if (!allowedTypes.includes(file.type)) {\n    return {\n      valid: false,\n      error: `File type ${file.type} is not allowed`,\n    };\n  }\n\n  return { valid: true };\n}\n\n// arrayBufferToBase64 function removed - now imported from utils/vision-api.ts\n\n/**\n * Helper: Generate unique storage key\n */\nexport function generateStorageKey(\n  userId: number | null,\n  fileName: string\n): string {\n  const timestamp = Date.now();\n  const random = Math.random().toString(36).substring(7);\n  const sanitizedName = fileName.replace(/[^a-zA-Z0-9.-]/g, '_');\n  const userPrefix = userId ? `user_${userId}` : 'anonymous';\n  return `${userPrefix}/${timestamp}_${random}_${sanitizedName}`;\n}\n\n/**\n * Store processing log\n */\nexport async function logProcessingStep(\n  db: any,\n  uploadedFileId: number,\n  step: string,\n  status: string,\n  message: string | null,\n  processingTimeMs: number | null\n) {\n  try {\n    // D1 doesn't support undefined values, so convert null to appropriate defaults\n    const finalMessage = message ?? '';\n    const finalProcessingTime = processingTimeMs ?? 0;\n    \n    await db\n      .prepare(\n        `INSERT INTO file_processing_log \n         (uploaded_file_id, step, status, message, processing_time_ms) \n         VALUES (?, ?, ?, ?, ?)`\n      )\n      .bind(uploadedFileId, step, status, finalMessage, finalProcessingTime)\n      .run();\n  } catch (error) {\n    console.error('Failed to log processing step:', error);\n  }\n}\n\n/**\n * Upload file to R2 storage\n */\nexport async function uploadToR2(\n  r2Bucket: R2Bucket,\n  storageKey: string,\n  fileData: ArrayBuffer,\n  contentType: string\n): Promise<{ success: boolean; url?: string; error?: string }> {\n  try {\n    // Upload file to R2\n    await r2Bucket.put(storageKey, fileData, {\n      httpMetadata: {\n        contentType: contentType,\n      },\n    });\n\n    // R2 files are accessible via custom domain or R2.dev subdomain\n    // For now, we'll just return the storage key\n    // In production, you would configure a custom domain\n    return {\n      success: true,\n      url: storageKey, // Or construct full URL if custom domain is configured\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: `R2 upload failed: ${String(error)}`,\n    };\n  }\n}\n\n/**\n * Delete file from R2 storage\n */\nexport async function deleteFromR2(\n  r2Bucket: R2Bucket,\n  storageKey: string\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    await r2Bucket.delete(storageKey);\n    return { success: true };\n  } catch (error) {\n    return {\n      success: false,\n      error: `R2 delete failed: ${String(error)}`,\n    };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/utils/helpers.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token :","line":8,"column":43}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Helper utility functions\n */\n\n/**\n * Convert ArrayBuffer to base64\n */\nexport function arrayBufferToBase64(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer)\n  let binary = ''\n  for (let i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i])\n  }\n  return btoa(binary)\n}\n\n/**\n * Generate random string\n */\nexport function generateRandomString(length: number = 32): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\n  let result = ''\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length))\n  }\n  return result\n}\n\n/**\n * Generate UUID v4\n */\nexport function generateUUID(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = Math.random() * 16 | 0\n    const v = c === 'x' ? r : (r & 0x3 | 0x8)\n    return v.toString(16)\n  })\n}\n\n/**\n * Hash password (simple implementation - use bcrypt in production)\n */\nexport async function hashPassword(password: string): Promise<string> {\n  // For Cloudflare Workers, use Web Crypto API\n  const encoder = new TextEncoder()\n  const data = encoder.encode(password)\n  const hash = await crypto.subtle.digest('SHA-256', data)\n  return Array.from(new Uint8Array(hash))\n    .map(b => b.toString(16).padStart(2, '0'))\n    .join('')\n}\n\n/**\n * Verify password hash\n */\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  const passwordHash = await hashPassword(password)\n  return passwordHash === hash\n}\n\n/**\n * Sanitize filename\n */\nexport function sanitizeFilename(filename: string): string {\n  return filename.replace(/[^a-zA-Z0-9._-]/g, '_')\n}\n\n/**\n * Get file extension\n */\nexport function getFileExtension(filename: string): string {\n  const parts = filename.split('.')\n  return parts.length > 1 ? parts[parts.length - 1].toLowerCase() : ''\n}\n\n/**\n * Format file size\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes'\n  const k = 1024\n  const sizes = ['Bytes', 'KB', 'MB', 'GB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i]\n}\n\n/**\n * Sleep/delay function\n */\nexport function sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\n/**\n * Truncate string\n */\nexport function truncate(str: string, length: number = 100): string {\n  if (str.length <= length) return str\n  return str.substring(0, length) + '...'\n}\n\n/**\n * Parse JSON safely\n */\nexport function safeJSONParse<T>(json: string, defaultValue: T): T {\n  try {\n    return JSON.parse(json) as T\n  } catch {\n    return defaultValue\n  }\n}\n\n/**\n * Validate email format\n */\nexport function isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  return emailRegex.test(email)\n}\n\n/**\n * Generate access code (6 character alphanumeric)\n */\nexport function generateAccessCode(): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n  let code = ''\n  for (let i = 0; i < 6; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length))\n  }\n  return code\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/user/webapp-ai/src/utils/vision-api.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token :","line":11,"column":43}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Google Vision API utility functions\n * Provides common functions for calling Vision API to reduce code duplication\n */\n\nimport { getAccessToken, loadServiceAccountCredentials } from '../google-auth-service'\n\n/**\n * Convert ArrayBuffer to base64 string\n */\nexport function arrayBufferToBase64(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer)\n  let binary = ''\n  for (let i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i])\n  }\n  return btoa(binary)\n}\n\ninterface VisionAPIRequest {\n  image: {\n    content: string\n  }\n  features: Array<{\n    type: string\n    maxResults?: number\n  }>\n  imageContext?: {\n    languageHints?: string[]\n  }\n}\n\ninterface VisionAPIResponse {\n  responses: Array<{\n    textAnnotations?: Array<{\n      description: string\n      locale?: string\n    }>\n    fullTextAnnotation?: {\n      text: string\n    }\n    error?: {\n      code: number\n      message: string\n    }\n  }>\n}\n\n/**\n * Call Google Vision API with authenticated request\n * This is a common function to eliminate duplicate Vision API call code\n * \n * @param endpoint - Vision API endpoint (e.g., 'images:annotate', 'files:annotate')\n * @param requestBody - Request body for Vision API\n * @param credentialsJson - Service account credentials JSON string\n * @returns Promise<VisionAPIResponse>\n */\nexport async function callVisionAPI(\n  endpoint: string,\n  requestBody: { requests: VisionAPIRequest[] },\n  credentialsJson: string\n): Promise<VisionAPIResponse> {\n  // Load service account credentials\n  const credentials = await loadServiceAccountCredentials(credentialsJson)\n  \n  // Get OAuth 2.0 access token\n  const accessToken = await getAccessToken(credentials)\n  \n  // Call Vision API\n  const response = await fetch(\n    `https://vision.googleapis.com/v1/${endpoint}`,\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${accessToken}`,\n      },\n      body: JSON.stringify(requestBody)\n    }\n  )\n  \n  // Handle API errors\n  if (!response.ok) {\n    const errorText = await response.text()\n    console.error(`Vision API error response (${endpoint}):`, errorText)\n    throw new Error(`Vision API error (${response.status}): ${errorText}`)\n  }\n  \n  // Parse and return response\n  const result = await response.json()\n  return result\n}\n\n/**\n * Extract text from Vision API response\n * Handles both textAnnotations and fullTextAnnotation formats\n * \n * @param response - Vision API response\n * @returns Extracted text or null if no text found\n */\nexport function extractTextFromVisionResponse(response: VisionAPIResponse): string | null {\n  if (!response.responses || response.responses.length === 0) {\n    return null\n  }\n  \n  const firstResponse = response.responses[0]\n  \n  // Check for errors in response\n  if (firstResponse.error) {\n    console.error('Vision API returned error:', firstResponse.error)\n    return null\n  }\n  \n  // Try fullTextAnnotation first (DOCUMENT_TEXT_DETECTION)\n  if (firstResponse.fullTextAnnotation?.text) {\n    return firstResponse.fullTextAnnotation.text\n  }\n  \n  // Fallback to textAnnotations (TEXT_DETECTION)\n  if (firstResponse.textAnnotations && firstResponse.textAnnotations.length > 0) {\n    return firstResponse.textAnnotations[0].description\n  }\n  \n  return null\n}\n\n/**\n * Create Vision API request for text detection (for images)\n */\nexport function createTextDetectionRequest(base64Content: string): { requests: VisionAPIRequest[] } {\n  return {\n    requests: [\n      {\n        image: {\n          content: base64Content\n        },\n        features: [\n          {\n            type: 'TEXT_DETECTION',\n            maxResults: 1\n          }\n        ],\n        imageContext: {\n          languageHints: ['ko', 'en'] // Korean and English\n        }\n      }\n    ]\n  }\n}\n\n/**\n * Create Vision API request for document text detection (for PDFs/documents)\n */\nexport function createDocumentTextDetectionRequest(base64Content: string): { requests: VisionAPIRequest[] } {\n  return {\n    requests: [\n      {\n        image: {\n          content: base64Content\n        },\n        features: [\n          {\n            type: 'DOCUMENT_TEXT_DETECTION',\n            maxResults: 1\n          }\n        ],\n        imageContext: {\n          languageHints: ['ko', 'en'] // Korean and English\n        }\n      }\n    ]\n  }\n}\n","usedDeprecatedRules":[]}]
